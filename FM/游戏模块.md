# 后端架构

按照功能分模块

中心思想：面向数据库编程、面向接口编程

## generate_app

用于生成球员、教练、日程表、初始化存档

### save_init

功能：存档初始化模块

结果：创建一个新的 `Save` 表

前端传入一个 `init_config`（作为请求体），指定联赛类型以及一些初始化杂项

#### 基本步骤

API `{user_id}/init_save` 接收新建存档请求，开始调用此模块

根据 `init_config` 进行存档配置

初始化联赛、球员、教练，构建第一个赛季的日程表，写入数据库

#### init_config

（TODO）

- `user_id`
- `league_type`：要生成的联赛类型（五大联赛、世超等）

### player_generator

球员生成模块

### coach_generator

教练生成模块

### calendar_generator

日程表生成模块

唯二触发条件

1. 出发日程表生成事项时
2. 初始化存档时

## game_app

用于比赛

### gameEvE

AI 间比赛

### gamePvE

玩家与 AI 间的比赛

### rating

球员评分模块

### value

球员身价提升模块

身价与球员位置能力、近期评分有关

PS：年龄只会影响俱乐部对他的估价，不会影响身价

#### 位置能力

位置能力赋予球员一个基本的底价

（暂时不考虑可以胜任多位置带来的优势）

#### 评分

评分通常指近一年评分

评分带来的溢价非常高，甚至可以占到 50%

## financial_app

或许需要一个掌管财政的模块？

收入来源

- 联赛、杯赛的奖金
- 广告收入
- 门票收入

消费去向

- 球员薪资
- 薪资
- 球员奖金
- 转会费用
- 青训设施提升

## transfer_app

转会模块



思路

- 

## message_app

通知处理模块

感觉会非常复杂。。

## training_app

训练模块

### player_training

专门处理球员能力提升的功能模块

球员只能在一次训练中获得两项能力的提升

- 基本能力（传球与体力）
- 专项能力（对应职责的专项能力）

专项能力有个默认范围，涵盖对该位置影响重大的能力属性；通常情况下，专项能力更多地被**教练的战术比重**所影响，如，着重中路渗透的球队，中场球员的传球能力就会被重点培养。

能力提升每周一次，基础值是 0.2；守门员的基础增长值是 0.1

教练的**训练能力**影响训练效果，50 为界，以上按百分比增加增长值，以下亦然

球员自身的**士气**影响训练效果，50 为界，以上按百分比增加增长值，以下亦然

### coach_training

处理教练在战术训练日进行战术比重调整的算法模块

思路

- 教练在每一场比赛开始前进行一次战术模拟，模拟球队即为下一场比赛的对手（取每个球员的能力值，取阵型，不取战术比重），两方的战术比重均调制均衡

- 模拟若干场（视教练的分析能力而定），统计各个战术的执行成功率，根据成功率调整战术比重

模拟比赛调用 `gameEvE`，不用存数据库，只需要保存战术执行成功率即可

## tag_app

处理角色标签的模块

思路：在需要判断标签处调用这个模块

### player_tag

### coach_tag

## event_app

事项处理模块

## Calendar_app

日程表处理模块

悲哀的发现，一张完整的日程表不能一次性生成，因为有小组赛和淘汰赛。。。

