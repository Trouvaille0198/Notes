<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>sentry-sdk - 伤心肠粉的酱油碟子</title><meta name=author content>
<meta name=author-link content><meta name=description content="sentry-sdk 官方文档：https://docs.sentry.io/platforms/p"><meta name=keywords content='Python'><meta itemprop=name content="sentry-sdk"><meta itemprop=description content="sentry-sdk 官方文档：https://docs.sentry.io/platforms/p"><meta itemprop=datePublished content="2023-12-12T00:00:00+00:00"><meta itemprop=dateModified content="2024-04-27T05:32:21+00:00"><meta itemprop=wordCount content="1982"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="Python"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E5%B8%B8%E7%94%A8%E5%BA%93/sentry-sdk/"><meta property="og:site_name" content="伤心肠粉的酱油碟子"><meta property="og:title" content="sentry-sdk"><meta property="og:description" content="sentry-sdk 官方文档：https://docs.sentry.io/platforms/p"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-27T05:32:21+00:00"><meta property="article:tag" content="Python"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="sentry-sdk"><meta name=twitter:description content="sentry-sdk 官方文档：https://docs.sentry.io/platforms/p"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E5%B8%B8%E7%94%A8%E5%BA%93/sentry-sdk/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/%E5%8D%9A%E7%89%A9/geoguessr-%E4%B8%8E%E5%9B%BE%E5%AF%BB/%E5%85%B7%E4%BD%93%E5%9B%BD%E5%AE%B6/%E6%B3%B0%E5%9B%BD/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E6%A0%87%E5%87%86%E5%BA%93/contextvars/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"sentry-sdk","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/%E4%B8%93%E4%B8%9A\/python\/%E5%B8%B8%E7%94%A8%E5%BA%93\/sentry-sdk\/"},"genre":"posts","keywords":"Python","wordcount":1982,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/%E4%B8%93%E4%B8%9A\/python\/%E5%B8%B8%E7%94%A8%E5%BA%93\/sentry-sdk\/","datePublished":"2023-12-12T00:00:00+00:00","dateModified":"2024-04-27T05:32:21+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>sentry-sdk</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/python/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Python</a></span></div><div class=post-meta-line><span title="2023-12-12 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-12-12>2023-12-12</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 1982 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#术语>术语</a><ul><li><a href=#event>Event</a></li><li><a href=#capturing>Capturing</a></li><li><a href=#release>Release</a></li><li><a href=#breadcrumb>Breadcrumb</a></li><li><a href=#issue>Issue</a></li><li><a href=#fingerprint>fingerprint</a></li><li><a href=#transaction>Transaction</a></li></ul></li><li><a href=#配置>配置</a><ul><li><a href=#basic-options>Basic Options</a></li><li><a href=#第三方模块集成>第三方模块集成</a><ul><li><a href=#flask>Flask</a><ul><li><a href=#自定义>自定义</a></li></ul></li><li><a href=#logging>logging</a><ul><li><a href=#自定义-1>自定义</a></li><li><a href=#忽略指定-logger>忽略指定 logger</a></li></ul></li></ul></li></ul></li><li><a href=#进阶设置>进阶设置</a><ul><li><a href=#breadcrumbs>Breadcrumbs</a><ul><li><a href=#手动记录>手动记录</a></li><li><a href=#自动上报>自动上报</a></li><li><a href=#自定义-2>自定义</a></li></ul></li><li><a href=#过滤事件>过滤事件</a><ul><li><a href=#使用-before_send-过滤错误事件>使用 before_send 过滤错误事件</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=sentry-sdk>sentry-sdk</h1><blockquote><p>官方文档：https://docs.sentry.io/platforms/python/?original_referrer=https%3A%2F%2Fsentry.io%2F</p></blockquote><p>Sentry&rsquo;s Python SDK enables automatic reporting of errors and performance data in your application.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pip install --upgrade sentry-sdk
</span></span></code></pre></td></tr></table></div></div><h2 id=术语>术语</h2><h3 id=event>Event</h3><p>An <em>event</em> is one instance of sending data to Sentry. Generally, this data is an error or exception.</p><p>错误发生时向 sentry 发送的一个实例</p><h3 id=capturing>Capturing</h3><p>The reporting of an event is called <em>capturing</em>. When an event is captured, it’s sent to Sentry.</p><p>一次事件的上报过程就叫做捕获</p><h3 id=release>Release</h3><blockquote><p><a href="https://docs.sentry.io/product/releases/?original_referrer=https%3A%2F%2Fsentry.io%2F" target=_blank rel="external nofollow noopener noreferrer">https://docs.sentry.io/product/releases/?original_referrer=https%3A%2F%2Fsentry.io%2F</a></p></blockquote><p>A <em>release</em> is a version of your code deployed to an environment. When you notify Sentry about a <a href="https://try.sentry-demo.com/demo/start/?scenario=oneRelease&amp;projectSlug=react&amp;source=docs" target=_blank rel="external nofollow noopener noreferrer">release</a>, you can easily identify new issues and regressions.</p><p>代码的版本，不同版本的操作将会分开展示</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://docs.sentry.io/static/6bedb945957ca3cbb93df067b9f5c401/c1b63/release_index.png data-srcset="https://docs.sentry.io/static/6bedb945957ca3cbb93df067b9f5c401/c1b63/release_index.png, https://docs.sentry.io/static/6bedb945957ca3cbb93df067b9f5c401/c1b63/release_index.png 1.5x, https://docs.sentry.io/static/6bedb945957ca3cbb93df067b9f5c401/c1b63/release_index.png 2x" data-sizes=auto alt=https://docs.sentry.io/static/6bedb945957ca3cbb93df067b9f5c401/c1b63/release_index.png title="View of the release index page showing each version of projects related to the release and the project details."></p><h3 id=breadcrumb>Breadcrumb</h3><p>Sentry uses <em>breadcrumbs</em> to create a trail of events that happened prior to an issue. These events are very similar to traditional logs, but can record more rich structured data.</p><p>Breadcrumbs are different from events: they will not create an event in Sentry, but will be buffered until the next event is sent.</p><p>错误发生之前的一系列追踪信息，类似于日志上下文的概念</p><p>面包屑不会作为一个单独的 issue 或 event 显示在页面上，而是会在 event 的详情页上展现</p><h3 id=issue>Issue</h3><p>An <em>issue</em> is a grouping of similar events.</p><p>同类型的一系列事件</p><h3 id=fingerprint>fingerprint</h3><p>All events have a fingerprintThe set of characteristics that define an event.. Events with the same fingerprint are grouped together into an issue.</p><p>指纹相同的事件会聚集成一类 issue</p><p>By default, Sentry will run one of our built-in grouping algorithms to generate a fingerprint based on information available within the event such as <code>stacktrace</code>, <code>exception</code>, and <code>message</code>.</p><h3 id=transaction>Transaction</h3><blockquote><p><a href=https://docs.sentry.io/product/performance/transaction-summary/ target=_blank rel="external nofollow noopener noreferrer">https://docs.sentry.io/product/performance/transaction-summary/</a></p></blockquote><p>A transaction represents a single instance of an activity you want to measure or track, like a page load, page navigation, or an asynchronous task. Having transaction information lets you monitor the overall performance of your application beyond when it crashes or generates an error. Without transactions, you can only know when things in your application have actually gone wrong, which is important, but not the whole picture.</p><h2 id=配置>配置</h2><p>配置操作应当在程序最开始执行处完成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>import sentry_sdk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sentry_sdk.init<span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=nv>dsn</span><span class=o>=</span><span class=s2>&#34;https://examplePublicKey@o0.ingest.sentry.io/0&#34;</span>,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Enable performance monitoring</span>
</span></span><span class=line><span class=cl>    <span class=nv>enable_tracing</span><span class=o>=</span>True,
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=basic-options>Basic Options</h3><blockquote><p><a href="https://docs.sentry.io/platforms/python/configuration/options/?original_referrer=https%3A%2F%2Fsentry.io%2F" target=_blank rel="external nofollow noopener noreferrer">https://docs.sentry.io/platforms/python/configuration/options/?original_referrer=https%3A%2F%2Fsentry.io%2F</a></p></blockquote><p>Options are passed to the <code>init()</code> function as optional keyword arguments:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sentry_sdk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dsn</span><span class=o>=</span><span class=s2>&#34;https://examplePublicKey@o0.ingest.sentry.io/0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max_breadcrumbs</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_tracing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># By default the SDK will try to use the SENTRY_RELEASE</span>
</span></span><span class=line><span class=cl>    <span class=c1># environment variable, or infer a git commit</span>
</span></span><span class=line><span class=cl>    <span class=c1># SHA as release, however you may want to set</span>
</span></span><span class=line><span class=cl>    <span class=c1># something more human-readable.</span>
</span></span><span class=line><span class=cl>    <span class=c1># release=&#34;myapp@1.0.0&#34;,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Options that can be read from an environment variable (SENTRY_DSN, SENTRY_ENVIRONMENT, SENTRY_RELEASE) are read automatically.</p><ul><li><p>dsn：sentry 配置的 dsn 数据源地址</p><ul><li>If this value is not provided, the SDK will try to read it from the <code>SENTRY_DSN</code> environment variable</li></ul></li><li><p>debug：是否开启 debug 模式，默认 False</p><ul><li>debug 模式会打印错误</li></ul></li><li><p>release：指定代码的发行版本（即 release）</p><ul><li>By default the SDK will try to read this value from the <code>SENTRY_RELEASE</code> environment variable</li></ul></li><li><p>environment：指定代码运行环境</p><ul><li>This string is freeform and set to <code>production</code> by default</li><li>By default the SDK will try to read this value from the <code>SENTRY_ENVIRONMENT</code> environment variable.</li></ul></li><li><p>sample_rate：指定发送事件的比例</p><ul><li>范围是 0.0 到 1.0</li><li>The default is <code>1.0</code> which means that 100% of error events are sent. If set to <code>0.1</code> only 10% of error events will be sent.</li><li>Events are picked <strong>randomly</strong>.</li></ul></li><li><p>attach_stacktrace：堆栈异常是否随消息一起发送，默认 False</p><ul><li>When enabled, stack traces are automatically attached to all messages logged</li><li>Grouping in Sentry is different for events with stack traces and without. As a result, you will get new groups as you enable or disable this flag for certain events.</li></ul></li><li><p>include_source_context：是否开启代码前后文，默认 True</p><ul><li>This source context includes the five lines of code above and below the line of code where an error happened.</li></ul></li><li><p>include_local_variables：是否包含本地变量，默认 True</p><ul><li>When enabled, the SDK will capture a snapshot of local variables to send with the event to help with debugging.</li></ul></li></ul><hr><p>以下是一些 hooks 参数</p><ul><li><p>before_send：发送 event 之前</p></li><li><p>before_send_transaction：</p></li><li><p>before_breadcrumb：</p></li></ul><h3 id=第三方模块集成>第三方模块集成</h3><blockquote><p><a href="https://docs.sentry.io/platforms/python/integrations/?original_referrer=https%3A%2F%2Fsentry.io%2F" target=_blank rel="external nofollow noopener noreferrer">https://docs.sentry.io/platforms/python/integrations/?original_referrer=https%3A%2F%2Fsentry.io%2F</a></p></blockquote><h4 id=flask>Flask</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pip install --upgrade <span class=s1>&#39;sentry-sdk[flask]&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=自定义>自定义</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sentry_sdk</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sentry_sdk.integrations.flask</span> <span class=kn>import</span> <span class=n>FlaskIntegration</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dsn</span><span class=o>=</span><span class=s2>&#34;https://examplePublicKey@o0.ingest.sentry.io/0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_tracing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>integrations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>FlaskIntegration</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>transaction_style</span><span class=o>=</span><span class=s2>&#34;url&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=logging>logging</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>  <span class=c1># same as above</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;I am ignored&#34;</span><span class=p>)</span> <span class=c1># 不会被揭露</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;I am a breadcrumb&#34;</span><span class=p>)</span> <span class=c1># 作为面包屑被记录</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;I am an event&#34;</span><span class=p>,</span> <span class=n>extra</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>bar</span><span class=o>=</span><span class=mi>43</span><span class=p>))</span> <span class=c1># 作为错误事件bei上报</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span><span class=s2>&#34;An exception happened&#34;</span><span class=p>)</span> <span class=c1># 作为异常事件被上报，并随附堆栈信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>There will be an error event with the message <code>"I am an event"</code>.</li><li><code>"I am a breadcrumb"</code> will be attached as a breadcrumb to that event.</li><li><code>bar</code> will end up in the event&rsquo;s <code>extra</code> attributes.</li><li><code>"An exception happened"</code> will send the current exception from <code>sys.exc_info()</code> with the stack trace and everything to the Sentry Python SDK. If there&rsquo;s no exception, the current stack will be attached.</li><li>The debug message <code>"I am ignored"</code> will not surface anywhere. To capture it, you need to lower <code>level</code> to <code>DEBUG</code> (See below).</li></ul><h5 id=自定义-1>自定义</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sentry_sdk</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sentry_sdk.integrations.logging</span> <span class=kn>import</span> <span class=n>LoggingIntegration</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The SDK will honor the level set by the logging library, which is WARNING by default.</span>
</span></span><span class=line><span class=cl><span class=c1># If we want to capture records with lower severity, we need to configure</span>
</span></span><span class=line><span class=cl><span class=c1># the logger level first.</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dsn</span><span class=o>=</span><span class=s2>&#34;https://examplePublicKey@o0.ingest.sentry.io/0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>integrations</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>LoggingIntegration</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span>        <span class=c1># Capture info and above as breadcrumbs</span>
</span></span><span class=line><span class=cl>            <span class=n>event_level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span>   <span class=c1># Send records as events</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>You can pass the following keyword arguments to <code>LoggingIntegration()</code>:</p><ul><li><code>level</code> (default <code>INFO</code>)<ul><li>The Sentry Python SDK will record log records with a level higher than or equal to <code>level</code> <strong>as breadcrumbs</strong>. Inversely, the SDK completely ignores any log record with a level lower than this one.</li><li>If a value of <code>None</code> occurs, the SDK won&rsquo;t send log records as breadcrumbs.</li></ul></li><li><code>event_level</code> (default <code>ERROR</code>)<ul><li>The Sentry Python SDK will report log records with a level higher than or equal to <code>event_level</code> <strong>as events</strong> as long as the logger itself is set to output records of those log levels (see note below).</li><li>If a value of <code>None</code> occurs, the SDK won&rsquo;t send log records as events.</li></ul></li></ul><h5 id=忽略指定-logger>忽略指定 logger</h5><p>Sometimes a logger is extremely noisy and spams you with pointless errors. You can ignore that logger by calling <code>ignore_logger</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sentry_sdk.integrations.logging</span> <span class=kn>import</span> <span class=n>ignore_logger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ignore_logger</span><span class=p>(</span><span class=s2>&#34;a.spammy.logger&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&#34;a.spammy.logger&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;hi&#34;</span><span class=p>)</span>  <span class=c1># no error sent to sentry</span>
</span></span></code></pre></td></tr></table></div></div><p>You can also use <code>before-send</code> and <code>before-breadcrumb</code> to ignore only certain messages.</p><h2 id=进阶设置>进阶设置</h2><h3 id=breadcrumbs>Breadcrumbs</h3><h4 id=手动记录>手动记录</h4><p>You can manually add breadcrumbs whenever something interesting happens.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sentry_sdk</span> <span class=kn>import</span> <span class=n>add_breadcrumb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_breadcrumb</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=o>=</span><span class=s1>&#39;auth&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=o>=</span><span class=s1>&#39;Authenticated user </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>user</span><span class=o>.</span><span class=n>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>level</span><span class=o>=</span><span class=s1>&#39;info&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>The available breadcrumb keys are <code>type</code>, <code>category</code>, <code>message</code>, <code>level</code>, <code>timestamp</code> (which many SDKs will set automatically for you), and <code>data</code>, which is the place to put any additional information you&rsquo;d like the breadcrumb to include.</p><p>Using keys other than these six won&rsquo;t cause an error, but will result in the data being dropped when the event is processed by Sentry.</p><h4 id=自动上报>自动上报</h4><p>SDKs and their associated integrations will automatically record many types of breadcrumbs.</p><p>For example, the browser JavaScript SDK will automatically record clicks and key presses on DOM elements, XHR/fetch requests, console API calls, and all location changes.</p><h4 id=自定义-2>自定义</h4><p>SDKs allow you to customize breadcrumbs through the <code>before_breadcrumb</code> hook.</p><p>This hook is passed an already assembled breadcrumb and, in some SDKs, an optional hint. The function can modify the breadcrumb or decide to discard it entirely by returning <code>null</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sentry_sdk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>before_breadcrumb</span><span class=p>(</span><span class=n>crumb</span><span class=p>,</span> <span class=n>hint</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>crumb</span><span class=p>[</span><span class=s1>&#39;category&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;a.spammy.Logger&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>crumb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>before_breadcrumb</span><span class=o>=</span><span class=n>before_breadcrumb</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=过滤事件>过滤事件</h3><p>We also offer <a href="https://docs.sentry.io/product/data-management-settings/filtering/?original_referrer=https%3A%2F%2Fsentry.io%2F" target=_blank rel="external nofollow noopener noreferrer">Inbound Filters</a> to filter events in sentry.io. We recommend filtering at the client level though, because it removes the overhead of sending events you don&rsquo;t actually want.</p><h4 id=使用-before_send-过滤错误事件>使用 before_send 过滤错误事件</h4><p>Configure your SDK to filter error events by using the <code>before_send</code> callback method and configuring, enabling, or disabling integrations.</p><p>参数</p><ul><li><p>even</p><ul><li><code>before_send</code> receives the event object as a parameter, which you can use to either modify the event’s data or drop it completely by returning <code>null</code>, based on custom logic and the data available on the event.</li></ul></li><li><p>hint</p><ul><li>The <code>before_send</code> callback is passed both the <code>event</code> and a second argument, <code>hint</code>, that holds one or more hints.</li><li>Typically a <code>hint</code> holds the original exception so that additional data can be extracted or grouping is affected.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># In this example, the fingerprintThe set of characteristics that define an event. is forced to a common value if an exception of a certain type has been caught</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sentry_sdk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>before_send</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>hint</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;exc_info&#39;</span> <span class=ow>in</span> <span class=n>hint</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_value</span><span class=p>,</span> <span class=n>tb</span> <span class=o>=</span> <span class=n>hint</span><span class=p>[</span><span class=s1>&#39;exc_info&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc_value</span><span class=p>,</span> <span class=n>DatabaseUnavailable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=p>[</span><span class=s1>&#39;fingerprint&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;database-unavailable&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sentry_sdk</span><span class=o>.</span><span class=n>init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>before_send</span><span class=o>=</span><span class=n>before_send</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2024-04-27 05:32:21">更新于 2024-04-27</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E5%B8%B8%E7%94%A8%E5%BA%93/sentry-sdk/ data-title=sentry-sdk data-hashtags=Python><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E5%B8%B8%E7%94%A8%E5%BA%93/sentry-sdk/ data-hashtag=Python><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E5%B8%B8%E7%94%A8%E5%BA%93/sentry-sdk/ data-title=sentry-sdk><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/python/>Python</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/%E5%8D%9A%E7%89%A9/geoguessr-%E4%B8%8E%E5%9B%BE%E5%AF%BB/%E5%85%B7%E4%BD%93%E5%9B%BD%E5%AE%B6/%E6%B3%B0%E5%9B%BD/ class=prev rel=prev title="图寻 - 泰国"><i class="fa-solid fa-angle-left fa-fw"></i>图寻 - 泰国</a>
<a href=/Notes/posts/%E4%B8%93%E4%B8%9A/python/%E6%A0%87%E5%87%86%E5%BA%93/contextvars/ class=next rel=next title="Python contextvars 库">Python contextvars 库<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022 - 2024</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"7I9AMOLA4S",algoliaIndex:"Notes",algoliaSearchKey:"3c1638dfe9f4d49a59d81ff6943416b8",highlightTag:"em",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>