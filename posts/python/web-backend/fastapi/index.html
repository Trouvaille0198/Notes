<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>FastAPI - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="FastAPI 认识 运行 1 uvicorn main:app --reload main：main.py 文件（一个 Python「模块」）。 ap"><meta name=keywords content="Python,后端"><meta itemprop=name content="FastAPI"><meta itemprop=description content="FastAPI 认识 运行 1 uvicorn main:app --reload main：main.py 文件（一个 Python「模块」）。 ap"><meta itemprop=datePublished content="2021-10-23T00:00:00+00:00"><meta itemprop=dateModified content="2022-08-29T06:30:23+00:00"><meta itemprop=wordCount content="9874"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="Python,后端,"><meta property="og:title" content="FastAPI"><meta property="og:description" content="FastAPI 认识 运行 1 uvicorn main:app --reload main：main.py 文件（一个 Python「模块」）。 ap"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/python/web-backend/fastapi/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-29T06:30:23+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="FastAPI"><meta name=twitter:description content="FastAPI 认识 运行 1 uvicorn main:app --reload main：main.py 文件（一个 Python「模块」）。 ap"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/python/web-backend/fastapi/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/golang/go-test/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/python/web-backend/django/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"FastAPI","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/python\/web-backend\/fastapi\/"},"genre":"posts","keywords":"Python, 后端","wordcount":9874,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/python\/web-backend\/fastapi\/","datePublished":"2021-10-23T00:00:00+00:00","dateModified":"2022-08-29T06:30:23+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>FastAPI</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/python/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Python</a></span></div><div class=post-meta-line><span title="2021-10-23 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-10-23>2021-10-23</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 9874 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 20 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#认识>认识</a><ul><li><a href=#运行>运行</a></li><li><a href=#查看-api-文档>查看 API 文档</a></li></ul></li><li><a href=#特性>特性</a><ul><li><a href=#基本格式>基本格式</a></li><li><a href=#路径参数>路径参数</a></li><li><a href=#枚举>枚举</a></li><li><a href=#查询参数>查询参数</a><ul><li><a href=#可选参数>可选参数</a></li><li><a href=#必需不必需与可选>必需、不必需与可选</a></li><li><a href=#查询参数列表>查询参数列表</a></li></ul></li><li><a href=#请求体-request>请求体 request</a><ul><li><a href=#模板>模板</a></li><li><a href=#访问模型属性>访问模型属性</a></li><li><a href=#请求体加参数>请求体加参数</a></li><li><a href=#多个请求体>多个请求体</a><ul><li><a href=#多个请求体-1>多个请求体</a></li><li><a href=#添加额外请求体-body>添加额外请求体 <code>body</code></a></li><li><a href=#嵌入单个请求体参数>嵌入单个请求体参数</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#请求体字段>请求体字段</a></li><li><a href=#嵌套模型>嵌套模型</a><ul><li><a href=#list>List</a></li><li><a href=#set>Set</a></li><li><a href=#嵌套类型>嵌套类型</a></li><li><a href=#特殊的类型和校验>特殊的类型和校验</a></li><li><a href=#带有一组子模型的属性>带有一组子模型的属性</a></li><li><a href=#深度嵌套模型>深度嵌套模型</a></li><li><a href=#纯列表请求体>纯列表请求体</a></li><li><a href=#任意-dict-构成的请求体>任意 <code>dict</code> 构成的请求体</a></li></ul></li><li><a href=#模型示例>模型示例</a><ul><li><a href=#config-和-schema_extra><code>Config</code> 和 <code>schema_extra</code></a></li><li><a href=#example><code>example</code></a></li><li><a href=#body-等的额外参数><code>Body</code> 等的额外参数</a></li></ul></li><li><a href=#文件请求>文件请求</a></li></ul></li><li><a href=#校验>校验</a><ul><li><a href=#对查询参数的校验>对查询参数的校验</a></li><li><a href=#声明更多元数据>声明更多元数据</a></li><li><a href=#别名参数>别名参数</a></li><li><a href=#弃用参数>弃用参数</a></li><li><a href=#对路径参数的校验>对路径参数的校验</a></li><li><a href=#数值校验>数值校验</a></li></ul></li><li><a href=#cookie-参数>Cookie 参数</a></li><li><a href=#header-参数>Header 参数</a><ul><li><a href=#特性-1>特性</a></li><li><a href=#接受重复值>接受重复值</a></li></ul></li><li><a href=#响应-response>响应 response</a><ul><li><a href=#响应模型-response_model>响应模型 response_model</a></li><li><a href=#过滤默认值>过滤默认值</a></li><li><a href=#指定返回的数据>指定返回的数据</a></li><li><a href=#多个模型>多个模型</a><ul><li><a href=#union>Union</a></li><li><a href=#列表形式的响应模型>列表形式的响应模型</a></li><li><a href=#任意-dict-构成的响应>任意 dict 构成的响应</a></li></ul></li><li><a href=#响应状态码>响应状态码</a><ul><li><a href=#简介>简介</a></li><li><a href=#便捷变量>便捷变量</a></li></ul></li><li><a href=#表单数据>表单数据</a></li><li><a href=#文件响应>文件响应</a></li><li><a href=#错误处理>错误处理</a></li></ul></li><li><a href=#路径修饰器的其他参数>路径修饰器的其他参数</a><ul><li><a href=#tags>tags</a></li><li><a href=#summary-and-description>Summary and description</a></li><li><a href=#description-from-docstring>Description from docstring</a></li><li><a href=#response-description>Response description</a></li><li><a href=#deprecated>deprecated</a></li></ul></li></ul></li><li><a href=#orm>ORM</a><ul><li><a href=#目录格式>目录格式</a></li></ul></li><li><a href=#跨域资源共享>跨域资源共享</a><ul><li><a href=#源>源</a></li><li><a href=#corsmiddleware>CORSMiddleware</a></li></ul></li><li><a href=#文件结构>文件结构</a><ul><li><a href=#路径分离-apirouter>路径分离 APIRouter</a></li><li><a href=#主体>主体</a></li><li><a href=#依赖项>依赖项</a><ul><li><a href=#声明依赖项>声明依赖项</a><ul><li><a href=#函数式>函数式</a></li><li><a href=#对象式>对象式</a></li></ul></li><li><a href=#子依赖项>子依赖项</a></li><li><a href=#路径操作装饰器依赖项>路径操作装饰器依赖项</a></li><li><a href=#全局依赖项>全局依赖项</a></li></ul></li><li><a href=#测试>测试</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=fastapi>FastAPI</h1><h2 id=认识>认识</h2><h3 id=运行>运行</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>uvicorn main:app --reload
</span></span></code></pre></td></tr></table></div></div><ul><li><code>main</code>：<code>main.py</code> 文件（一个 Python「模块」）。</li><li><code>app</code>：在 <code>main.py</code> 文件中通过 <code>app = FastAPI()</code> 创建的对象。</li><li><code>--reload</code>：让服务器在更新代码后重新启动。仅在开发时使用该选项</li></ul><h3 id=查看-api-文档>查看 API 文档</h3><p>交互式文档：<code>url/docs</code></p><p>可选的文档：<code>url/redoc</code></p><h2 id=特性>特性</h2><h3 id=基本格式>基本格式</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span> <span class=c1># 路径操作装饰器</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>root</span><span class=p>():</span> <span class=c1># 路径操作函数</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=路径参数>路径参数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>):</span> <span class=c1># 无类型</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span> <span class=c1># 有类型</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>关于路径顺序：</p><p>由于路径操作是按<strong>顺序</strong>依次运行的，你需要确保路径 <code>/users/me</code> 声明在路径 <code>/users/{user_id}</code>之前</p><h3 id=枚举>枚举</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ModelName</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>alexnet</span> <span class=o>=</span> <span class=s2>&#34;alexnet&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resnet</span> <span class=o>=</span> <span class=s2>&#34;resnet&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>lenet</span> <span class=o>=</span> <span class=s2>&#34;lenet&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/models/</span><span class=si>{model_name}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_model</span><span class=p>(</span><span class=n>model_name</span><span class=p>:</span> <span class=n>ModelName</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>model_name</span> <span class=o>==</span> <span class=n>ModelName</span><span class=o>.</span><span class=n>alexnet</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;model_name&#34;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Deep Learning FTW!&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>model_name</span><span class=o>.</span><span class=n>value</span> <span class=o>==</span> <span class=s2>&#34;lenet&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;model_name&#34;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;LeCNN all the images&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;model_name&#34;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Have some residuals&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=查询参数>查询参数</h3><p>声明不属于路径参数的其他函数参数时，它们将被自动解释为"查询字符串"参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fake_items_db</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Baz&#34;</span><span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fake_items_db</span><span class=p>[</span><span class=n>skip</span> <span class=p>:</span> <span class=n>skip</span> <span class=o>+</span> <span class=n>limit</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>查询字符串是键值对的集合，这些键值对位于 URL 的 <code>？</code> 之后，并以 <code>&</code> 符号分隔。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http://127.0.0.1:8000/items/?skip<span class=o>=</span>0<span class=p>&amp;</span><span class=nv>limit</span><span class=o>=</span><span class=m>10</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=可选参数>可选参数</h4><p>通过同样的方式，你可以将它们的默认值设置为 <code>None</code> 来声明可选查询参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>q</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=n>q</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在这个例子中，函数参数 <code>q</code> 将是可选的，并且默认值为 <code>None</code>。</p><h4 id=必需不必需与可选>必需、不必需与可选</h4><p>当你想让一个查询参数成为必需的，不声明任何默认值就可以</p><p>如果你不想添加一个特定的值，而只是想使该参数成为可选的，则将默认值设置为 <code>None</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_user_item</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>needy</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>item</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;needy&#34;</span><span class=p>:</span> <span class=n>needy</span><span class=p>,</span> <span class=s2>&#34;skip&#34;</span><span class=p>:</span> <span class=n>skip</span><span class=p>,</span> <span class=s2>&#34;limit&#34;</span><span class=p>:</span> <span class=n>limit</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>needy</code>，一个必需的 <code>str</code> 类型参数。意味着必须传入</li><li><code>skip</code>，一个默认值为 <code>0</code> 的 <code>int</code> 类型参数。意味着不必须传入，但是会存在</li><li><code>limit</code>，一个可选的 <code>int</code> 类型参数。意味着不传入就不存在</li></ul><h4 id=查询参数列表>查询参数列表</h4><p>当你使用 <code>Query</code> 显式地定义查询参数时，你还可以声明它去接收一组值，或换句话来说，接收多个值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>输入类似于 <code>http://localhost:8000/items/?q=foo&q=bar</code> 的 url 即可接收到多个查询值</p><p>你还可以定义在没有任何给定值时的默认 <code>list</code> 值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>([</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>你也可以直接使用 <code>list</code> 代替 <code>List [str]</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=n>Query</span><span class=p>([])</span>
</span></span></code></pre></td></tr></table></div></div><p>在这种情况下，将不会检查列表的内容。</p><p>例如，<code>List[int]</code> 将检查（并记录到文档）列表的内容必须是整数。但是单独的 <code>list</code> 不会。</p><h3 id=请求体-request>请求体 request</h3><p><strong>请求体</strong>是客户端发送给 API 的数据。<strong>响应体</strong>是 API 发送给客户端的数据。</p><p>你的 API 几乎总是要发送<strong>响应</strong>体。但是客户端并不总是需要发送<strong>请求</strong>体。</p><h4 id=模板>模板</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>导入 Pydantic 的 BaseModel</p></li><li><p>创建数据模型</p><ul><li>将你的数据模型声明为继承自 <code>BaseModel</code> 的类。</li><li>使用标准的 Python 类型来声明所有属性</li></ul></li><li><p>将模型声明为参数</p></li></ol><h4 id=访问模型属性>访问模型属性</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>item_dict</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>item</span><span class=o>.</span><span class=n>tax</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>price_with_tax</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>price</span> <span class=o>+</span> <span class=n>item</span><span class=o>.</span><span class=n>tax</span>
</span></span><span class=line><span class=cl>        <span class=n>item_dict</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;price_with_tax&#34;</span><span class=p>:</span> <span class=n>price_with_tax</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item_dict</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=请求体加参数>请求体加参数</h4><p>你可以同时声明路径参数和请求体。</p><p><strong>FastAPI</strong> 将识别出与路径参数匹配的函数参数应<strong>从路径中获取</strong>，而声明为 Pydantic 模型的函数参数应<strong>从请求体中获取</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span> <span class=c1># Item是自己定义的模型</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=o>**</span><span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>()}</span>
</span></span></code></pre></td></tr></table></div></div><p>甚至可以做到<strong>请求体 + 路径参数 + 查询参数</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>,</span> <span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=o>**</span><span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>q</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=n>q</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></td></tr></table></div></div><p>函数参数将依次按如下规则进行识别：</p><ul><li>如果在<strong>路径</strong>中也声明了该参数，它将被用作路径参数。</li><li>如果参数属于<strong>单一类型</strong>（比如 <code>int</code>、<code>float</code>、<code>str</code>、<code>bool</code> 等）它将被解释为<strong>查询</strong>参数。</li><li>如果参数的类型被声明为一个 <strong>Pydantic 模型</strong>，它将被解释为<strong>请求体</strong>。</li></ul><h4 id=多个请求体>多个请求体</h4><h5 id=多个请求体-1>多个请求体</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>,</span> <span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>item</span><span class=p>,</span> <span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>user</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><p>在这种情况下，<strong>FastAPI</strong> 将注意到该函数中有多个<strong>请求体参数（两个 Pydantic 模型参数）</strong>。</p><p>因此，它将使用参数名称作为请求体中的键（字段名称），并期望一个类似于以下内容的请求体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;item&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;dave&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;full_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Dave Grohl&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=添加额外请求体-body>添加额外请求体 <code>body</code></h5><p>为了扩展先前的模型，你可能决定除了 <code>item</code> 和 <code>user</code> 之外，还想在同一请求体中具有另一个键 <code>importance</code>。</p><p>你可以使用 <code>Body</code> 指示 <strong>FastAPI</strong> 将其作为请求体的另一个键进行处理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Body</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>,</span> <span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>,</span> <span class=n>importance</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Body</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>item</span><span class=p>,</span> <span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>user</span><span class=p>,</span> <span class=s2>&#34;importance&#34;</span><span class=p>:</span> <span class=n>importance</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><p>在这种情况下，<strong>FastAPI</strong> 将期望像这样的请求体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;item&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;dave&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;full_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Dave Grohl&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;importance&#34;</span><span class=p>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=嵌入单个请求体参数>嵌入单个请求体参数</h5><p>假设你只有一个来自 Pydantic 模型 <code>Item</code> 的请求体参数 <code>item</code>。</p><p>默认情况下，<strong>FastAPI</strong> 将直接期望这样的请求体。</p><p>但是，如果你希望它期望一个拥有 <code>item</code> 键并在值中包含模型内容的 JSON，就像在声明额外的请求体参数时所做的那样，则可以使用一个特殊的 <code>Body</code> 参数 <code>embed</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>item</span><span class=p>:</span> <span class=n>Item</span> <span class=o>=</span> <span class=n>Body</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>embed</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Body</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span> <span class=o>=</span> <span class=n>Body</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>embed</span><span class=o>=</span><span class=kc>True</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>item</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><p>在这种情况下，<strong>FastAPI</strong> 将期望像这样的请求体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;item&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>而不是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=总结>总结</h5><ul><li><p>你可以添加多个请求体参数到路径操作函数中，<strong>即使一个请求只能有一个请求体</strong>。</p></li><li><p>但是 <strong>FastAPI</strong> 会处理它，在函数中为你提供正确的数据，并在路径操作中校验并记录正确的模式。</p></li><li><p>你还可以声明将作为请求体的一部分所接收的单一值。</p></li><li><p>你还可以指示 <strong>FastAPI</strong> 在仅声明了一个请求体参数的情况下，将原本的请求体嵌入到一个键中。</p></li></ul><h4 id=请求体字段>请求体字段</h4><p>与使用 <code>Query</code>、<code>Path</code> 和 <code>Body</code> 在<em>路径操作函数</em>中声明额外的校验和元数据的方式相同，你可以使用 Pydantic 的 <code>Field</code> 在 Pydantic 模型内部声明校验和元数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>Field</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;The description of the item&#34;</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>300</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;The price must be greater than zero&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Field</code> 的工作方式和 <code>Query</code>、<code>Path</code> 和 <code>Body</code> 相同，包括它们的参数等等也完全相同</p><blockquote><p>实际上，<code>Query</code>、<code>Path</code> 和其他你将在之后看到的类，创建的是由一个共同的 <code>Params</code> 类派生的子类的对象，该共同类本身又是 Pydantic 的 <code>FieldInfo</code> 类的子类。</p><p>请记住当你从 <code>fastapi</code> 导入 <code>Query</code>、<code>Path</code> 等对象时，他们实际上是返回特殊类的函数。</p></blockquote><h4 id=嵌套模型>嵌套模型</h4><p>使用 <strong>FastAPI</strong>，你可以定义、校验、记录文档并使用任意深度嵌套的模型（归功于 Pydantic）。</p><h5 id=list>List</h5><p>最普通的写法是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1># Here!</span>
</span></span></code></pre></td></tr></table></div></div><p>这将使 <code>tags</code> 成为一个由元素组成的列表。不过它没有声明每个元素的类型</p><p>但是 Python 有一种特定的方法来声明具有<strong>子类型</strong>的 list</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>tags</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=set>Set</h5><p>使用 <code>Set</code> 好处多多</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Set</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>tags</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>即使你收到带有重复数据的请求，这些数据也会被转换为一组唯一项。</p></li><li><p>而且，每当你输出该数据时，即使源数据有重复，它们也将作为一组唯一项输出。</p></li><li><p>并且还会被相应地标注 / 记录文档。</p></li></ul><h5 id=嵌套类型>嵌套类型</h5><p>Pydantic 模型的每个属性都具有类型。</p><p>但是这个类型本身可以是另一个 Pydantic 模型。</p><p>因此，你可以声明拥有特定属性名称、类型和校验的深度嵌套的 JSON 对象。</p><p>上述这些都可以任意的嵌套</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Image</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>image</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Image</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><p>这意味着 <strong>FastAPI</strong> 将期望类似于以下内容的请求体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;rock&#34;</span><span class=p>,</span> <span class=s2>&#34;metal&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;image&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://example.com/baz.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;The Foo live&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=特殊的类型和校验>特殊的类型和校验</h5><p>除了普通的单一值类型（如 <code>str</code>、<code>int</code>、<code>float</code> 等）外，你还可以使用从 <code>str</code> 继承的更复杂的单一值类型。</p><p>例如，在 <code>Image</code> 模型中我们有一个 <code>url</code> 字段，我们可以把它声明为 Pydantic 的 <code>HttpUrl</code>，而不是 <code>str</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>HttpUrl</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Image</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span></code></pre></td></tr></table></div></div><p>该字符串将被检查是否为有效的 URL，并在 JSON Schema / OpenAPI 文档中进行记录。</p><h5 id=带有一组子模型的属性>带有一组子模型的属性</h5><p>你还可以将 Pydantic 模型用作 <code>list</code>、<code>set</code> 等的子类型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Image</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>images</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>item</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><p>这将期望（转换，校验，记录文档等）下面这样的 JSON 请求体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The pretender&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;price&#34;</span><span class=p>:</span> <span class=mf>42.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;rock&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;metal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;bar&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;images&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://example.com/baz.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;The Foo live&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://example.com/dave.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;The Baz&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=深度嵌套模型>深度嵌套模型</h5><p>你可以定义任意深度的嵌套模型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Image</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>images</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Offer</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Item</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=纯列表请求体>纯列表请求体</h5><p>如果你期望的 JSON 请求体的最外层是一个 JSON <code>array</code>（即 Python <code>list</code>），则可以在路径操作函数的参数中声明此类型，就像声明 Pydantic 模型一样：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>images</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Image</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=n>HttpUrl</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/images/multiple/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_multiple_images</span><span class=p>(</span><span class=n>images</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>images</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=任意-dict-构成的请求体>任意 <code>dict</code> 构成的请求体</h5><p>你也可以将请求体声明为使用某类型的键和其他类型值的 <code>dict</code>。</p><p>无需事先知道有效的字段/属性（在使用 Pydantic 模型的场景）名称是什么。</p><p>如果你想接收一些尚且未知的键，这将很有用。</p><hr><p>其他有用的场景是当你想要接收其他类型的键时，例如 <code>int</code>。</p><p>这也是我们在接下来将看到的。</p><p>在下面的例子中，你将接受任意键为 <code>int</code> 类型并且值为 <code>float</code> 类型的 <code>dict</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/index-weights/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_index_weights</span><span class=p>(</span><span class=n>weights</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>weights</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>请记住 <strong>JSON 仅支持将 <code>str</code> 作为键</strong>。</p><p>但是 Pydantic 具有自动转换数据的功能。</p><p>这意味着，即使你的 API 客户端只能将字符串作为键发送，只要这些字符串内容仅包含整数，Pydantic 就会对其进行转换并校验。</p><p>然后你接收的名为 <code>weights</code> 的 <code>dict</code> 实际上将具有 <code>int</code> 类型的键和 <code>float</code> 类型的值。</p></blockquote><h4 id=模型示例>模型示例</h4><h5 id=config-和-schema_extra><code>Config</code> 和 <code>schema_extra</code></h5><p>可以使用 <code>Config</code> 和 <code>schema_extra</code> 为 Pydantic 模型声明一个示例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Config</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>schema_extra</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;example&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;A very nice Item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>35.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>传递的那些额外参数不会添加任何验证，只会添加注释，用于文档的目的。</p></blockquote><h5 id=example><code>example</code></h5><p>或者使用 <code>example</code> 为单个字段添加示例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>Field</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>example</span><span class=o>=</span><span class=s2>&#34;Foo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>example</span><span class=o>=</span><span class=s2>&#34;A very nice Item&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>example</span><span class=o>=</span><span class=mf>35.4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>example</span><span class=o>=</span><span class=mf>3.2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>不过这样写感觉蛮麻烦的&mldr;</p><h5 id=body-等的额外参数><code>Body</code> 等的额外参数</h5><p>可以通过传递额外信息给 <code>Field</code> 同样的方式操作<code>Path</code>, <code>Query</code>, <code>Body</code>等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>item</span><span class=p>:</span> <span class=n>Item</span> <span class=o>=</span> <span class=n>Body</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>example</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;A very nice Item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>35.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>3.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span> <span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>item</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><p>感觉也没必要</p><h4 id=文件请求>文件请求</h4><p>To receive uploaded files, install python-multipart</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pip install python-multipart
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>File</span><span class=p>,</span> <span class=n>UploadFile</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/files/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_file</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=nb>bytes</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;file_size&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>file</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/uploadfile/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_upload_file</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=n>UploadFile</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;filename&#34;</span><span class=p>:</span> <span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Uploadfile 的属性</p><ul><li><code>filename</code>: A <code>str</code> with the original file name that was uploaded (e.g. <code>myimage.jpg</code>).</li><li><code>content_type</code>: A <code>str</code> with the content type (MIME type / media type) (e.g. <code>image/jpeg</code>).</li><li><code>file</code>: This is the actual Python file that you can pass directly to other functions or libraries that expect a &ldquo;file-like&rdquo; object.</li></ul><p>方法</p><ul><li><code>write(data)</code>: Writes <code>data</code> (<code>str</code> or <code>bytes</code>) to the file.</li><li><code>read(size)</code>: Reads <code>size</code> (<code>int</code>) bytes/characters of the file.</li><li><code>seek(offset)</code>: Goes to the byte position</li><li><code>offset</code>(<code>int</code>) in the file.<ul><li>E.g., <code>await myfile.seek(0)</code> would go to the start of the file.</li><li>This is especially useful if you run <code>await myfile.read()</code> once and then need to read the contents again.</li></ul></li><li><code>close()</code>: Closes the file</li></ul><p>As all these methods are <code>async</code> methods, you need to &ldquo;await&rdquo; them.</p><p>For example, inside of an <code>async</code> <em>path operation function</em> you can get the contents with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>contents = await myfile.read()
</span></span></code></pre></td></tr></table></div></div><p>If you are inside of a normal <code>def</code> <em>path operation function</em>, you can access the <code>UploadFile.file</code> directly, for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>contents = myfile.file.read()
</span></span></code></pre></td></tr></table></div></div><p>至于多文件上传</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/files/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_files</span><span class=p>(</span><span class=n>files</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>bytes</span><span class=p>]</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;file_sizes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>file</span><span class=p>)</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/uploadfiles/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_upload_files</span><span class=p>(</span><span class=n>files</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>UploadFile</span><span class=p>]</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;filenames&#34;</span><span class=p>:</span> <span class=p>[</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>]}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=校验>校验</h3><h4 id=对查询参数的校验>对查询参数的校验</h4><p>除了可以设置参数是否可选，还能对参数设置其他的约束条件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Query</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>50</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><p>其中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>使得参数可选，等同于：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><p>甚至还能用正则。。。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>regex</span><span class=o>=</span><span class=s2>&#34;^fixedquery$&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>默认值可以更换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=s2>&#34;fixedquery&#34;</span><span class=p>,</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>若要声明为必须参数，使用 <code>...</code></strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=声明更多元数据>声明更多元数据</h4><p>你可以添加更多有关该参数的信息。</p><p>这些信息将包含在生成的 OpenAPI 模式中，并由文档用户界面和外部工具所使用</p><p><strong>添加 title 与 description</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Query string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Query string for the items to search in the database that have a good match&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=别名参数>别名参数</h4><p>要添加含有 &ldquo;<code>-</code>&rdquo; 之类被 python 所禁止的变量名，可以用 <code>alias</code> 参数声明一个别名，该别名将用于在 URL 中查找查询参数值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>item_query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>alias</span><span class=o>=</span><span class=s2>&#34;item-query&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>可以传入类似 <code>http://127.0.0.1:8000/items/?item-query=foobaritems</code> 的参数了</p><h4 id=弃用参数>弃用参数</h4><p>现在假设你不再喜欢此参数。</p><p>你不得不将其保留一段时间，因为有些客户端正在使用它，但你希望文档清楚地将其展示为已弃用。</p><p>那么将参数 <code>deprecated=True</code> 传入 <code>Query</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>alias</span><span class=o>=</span><span class=s2>&#34;item-query&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Query string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Query string for the items to search in the database that have a good match&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_length</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>regex</span><span class=o>=</span><span class=s2>&#34;^fixedquery$&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>deprecated</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=对路径参数的校验>对路径参数的校验</h4><p>首先，从 <code>fastapi</code> 导入 <code>Path</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Path</span><span class=p>,</span> <span class=n>Query</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>路径参数总是必需的，因为它必须是路径的一部分。</p><p>所以，你应该在声明时使用 <code>...</code> 将其标记为必需参数。</p><p>然而，即使你使用 <code>None</code> 声明路径参数或设置一个其他默认值也不会有任何影响，它依然会是必需参数</p></blockquote><p>模板如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;The ID of the item to get&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><p>为了解决 “带有「默认值」的参数放在没有「默认值」的参数之前，Python 将会报错” 的问题，API 中的参数可以自由排布</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;The ID of the item to get&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不想这样，传递 <code>*</code> 作为函数的第一个参数</p><blockquote><p>Python 不会对该 <code>*</code> 做任何事情，但是它将知道之后的所有参数都应作为关键字参数（键值对），也被称为 <code>kwargs</code>，来调用。即使它们没有默认值</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;The ID of the item to get&#34;</span><span class=p>),</span> <span class=n>q</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=数值校验>数值校验</h4><ul><li><code>gt</code>：大于（<code>g</code>reater <code>t</code>han）</li><li><code>ge</code>：大于等于（<code>g</code>reater than or <code>e</code>qual）</li><li><code>lt</code>：小于（<code>l</code>ess <code>t</code>han）</li><li><code>le</code>：小于等于（<code>l</code>ess than or <code>e</code>qual）</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>item_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;The ID of the item to get&#34;</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>le</span><span class=o>=</span><span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cookie-参数>Cookie 参数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Cookie</span>
</span></span></code></pre></td></tr></table></div></div><p>可以像定义 <code>Query</code> 参数和 <code>Path</code> 参数一样来定义 <code>Cookie</code> 参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>ads_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Cookie</span><span class=p>(</span><span class=kc>None</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;ads_id&#34;</span><span class=p>:</span> <span class=n>ads_id</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>Cookie</code> 、<code>Path</code> 、<code>Query</code> 是兄弟类，它们都继承自公共的 <code>Param</code> 类</p><p>但请记住，当你从 <code>fastapi</code> 导入的 <code>Query</code>、<code>Path</code>、<code>Cookie</code> 或其他参数声明函数，这些实际上是返回特殊类的函数。</p></blockquote><h3 id=header-参数>Header 参数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Header</span>
</span></span></code></pre></td></tr></table></div></div><p>使用和 <code>Path</code>, <code>Query</code> and <code>Cookie</code> 一样的结构定义 header 参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>user_agent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=kc>None</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=n>user_agent</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=特性-1>特性</h4><p>默认情况下, <code>Header</code> 将把参数名称的字符从下划线 (<code>_</code>) 转换为连字符 (<code>-</code>) 来提取并记录 headers</p><p>同时，HTTP headers 是大小写不敏感的，因此，因此可以使用标准 Python 样式(也称为 &ldquo;snake_case&rdquo;)声明它们</p><p>若需要禁用下划线到连字符的自动转换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Header</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>convert_underscores</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=接受重复值>接受重复值</h4><p>相同的 header 具有多个值时，可以在类型声明中使用一个 list 来定义这些情况</p><p>比如，为了声明一个 <code>X-Token</code> header 可以出现多次，你可以这样写</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>x_token</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=kc>None</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;X-Token values&#34;</span><span class=p>:</span> <span class=n>x_token</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果你与<em>路径操作</em>通信时发送两个 HTTP headers，就像：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Token</span><span class=p>:</span> <span class=n>foo</span>
</span></span><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Token</span><span class=p>:</span> <span class=n>bar</span>
</span></span></code></pre></td></tr></table></div></div><p>响应会是:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;X-Token values&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;foo&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=响应-response>响应 response</h3><h4 id=响应模型-response_model>响应模型 response_model</h4><p>使用 <code>response_model</code> 参数来声明用于响应的模型，也就是要向前端返回的数据类型</p><p>这样做的主要目的是<strong>确保私有数据在返回时被过滤掉</strong></p><p>FastAPI 将使用此 <code>response_model</code> 来：</p><ul><li>将输出数据转换为其声明的类型</li><li>校验数据。</li><li>在 OpenAPI 的<em>路径操作</em>中为响应添加一个 JSON Schema。</li><li>并在自动生成文档系统中使用</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserIn</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>email</span><span class=p>:</span> <span class=n>EmailStr</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserOut</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>email</span><span class=p>:</span> <span class=n>EmailStr</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/user/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>UserOut</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_user</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>UserIn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>FastAPI</strong> 将会负责过滤掉未在输出模型中声明的所有数据</p><h4 id=过滤默认值>过滤默认值</h4><p>响应模型也可以拥有默认值</p><p>你可以设置路径操作装饰器的 <code>response_model_exclude_unset=True</code> 参数，以便在响应的返回数据中去除默认值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span> <span class=n>response_model_exclude_unset</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=指定返回的数据>指定返回的数据</h4><p>使用路径操作装饰器的 <code>response_model_include</code> 和 <code>response_model_exclude</code> 参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>tax</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>10.5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>items</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;foo&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>50.2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;bar&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>,</span> <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The Bar fighters&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>62</span><span class=p>,</span> <span class=s2>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>20.2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;baz&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Baz&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;There goes my baz&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>50.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tax&#34;</span><span class=p>:</span> <span class=mf>10.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>/name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model_include</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;description&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item_name</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>items</span><span class=p>[</span><span class=n>item_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>/public&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span> <span class=n>response_model_exclude</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;tax&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item_public_data</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>items</span><span class=p>[</span><span class=n>item_id</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>可以用 set，也可以用 list</p><h4 id=多个模型>多个模型</h4><p>拥有多个相关的模型是很常见的。</p><p>对用户模型来说尤其如此，因为：</p><ul><li><strong>输入模型</strong>需要拥有密码属性。</li><li><strong>输出模型</strong>不应该包含密码。</li><li><strong>数据库模型</strong>很可能需要保存密码的哈希值</li></ul><p>下面是应该如何根据它们的密码字段以及使用位置去定义模型的大概思路</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>EmailStr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserBase</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>email</span><span class=p>:</span> <span class=n>EmailStr</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserIn</span><span class=p>(</span><span class=n>UserBase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserOut</span><span class=p>(</span><span class=n>UserBase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserInDB</span><span class=p>(</span><span class=n>UserBase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>hashed_password</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fake_password_hasher</span><span class=p>(</span><span class=n>raw_password</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;supersecret&#34;</span> <span class=o>+</span> <span class=n>raw_password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fake_save_user</span><span class=p>(</span><span class=n>user_in</span><span class=p>:</span> <span class=n>UserIn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>hashed_password</span> <span class=o>=</span> <span class=n>fake_password_hasher</span><span class=p>(</span><span class=n>user_in</span><span class=o>.</span><span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_in_db</span> <span class=o>=</span> <span class=n>UserInDB</span><span class=p>(</span><span class=o>**</span><span class=n>user_in</span><span class=o>.</span><span class=n>dict</span><span class=p>(),</span> <span class=n>hashed_password</span><span class=o>=</span><span class=n>hashed_password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;User saved! ..not really&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user_in_db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/user/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>UserOut</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_user</span><span class=p>(</span><span class=n>user_in</span><span class=p>:</span> <span class=n>UserIn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user_saved</span> <span class=o>=</span> <span class=n>fake_save_user</span><span class=p>(</span><span class=n>user_in</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user_saved</span>
</span></span></code></pre></td></tr></table></div></div><p>最终的结果如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>UserInDB</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>user_dict</span><span class=p>[</span><span class=s2>&#34;username&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>user_dict</span><span class=p>[</span><span class=s2>&#34;password&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>email</span> <span class=o>=</span> <span class=n>user_dict</span><span class=p>[</span><span class=s2>&#34;email&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>full_name</span> <span class=o>=</span> <span class=n>user_dict</span><span class=p>[</span><span class=s2>&#34;full_name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>hashed_password</span> <span class=o>=</span> <span class=n>hashed_password</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=union>Union</h5><p>你可以将一个响应声明为两种类型的 <code>Union</code>，这意味着该响应将是两种类型中的任何一种。</p><p>这将在 OpenAPI 中使用 <code>anyOf</code> 进行定义。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Union</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BaseItem</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CarItem</span><span class=p>(</span><span class=n>BaseItem</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span> <span class=o>=</span> <span class=s2>&#34;car&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaneItem</span><span class=p>(</span><span class=n>BaseItem</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span> <span class=o>=</span> <span class=s2>&#34;plane&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>size</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>items</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;item1&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;All my friends drive a low rider&#34;</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;car&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;item2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Music is my aeroplane, it&#39;s my aeroplane&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;plane&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;size&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Union</span><span class=p>[</span><span class=n>PlaneItem</span><span class=p>,</span> <span class=n>CarItem</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>items</span><span class=p>[</span><span class=n>item_id</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>定义一个 Union 类型时，首先包括最详细的类型，然后是不太详细的类型。在上面的示例中，更详细的 PlaneItem 位于 Union[PlaneItem，CarItem] 中的 CarItem 之前</p></blockquote><h5 id=列表形式的响应模型>列表形式的响应模型</h5><p>可以用同样的方式声明由对象列表构成的响应</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Item</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>items</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span> <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;There comes my hero&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Red&#34;</span><span class=p>,</span> <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;It&#39;s my aeroplane&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>List</span><span class=p>[</span><span class=n>Item</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>items</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=任意-dict-构成的响应>任意 dict 构成的响应</h5><p>你还可以使用一个任意的普通 <code>dict</code> 声明响应，仅声明键和值的类型，而不使用 Pydantic 模型。</p><p>如果你事先不知道有效的字段/属性名称（对于 Pydantic 模型是必需的），这将很有用。</p><p>在这种情况下，你可以使用 <code>typing.Dict</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/keyword-weights/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_keyword_weights</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;foo&#34;</span><span class=p>:</span> <span class=mf>2.3</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>:</span> <span class=mf>3.4</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=响应状态码>响应状态码</h4><p>可以在路径操作器中使用 <code>status_code</code> 参数来声明用于响应的 HTTP 状态码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>201</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=简介>简介</h5><ul><li><code>100</code> 及以上状态码用于「消息」响应。你很少直接使用它们。具有这些状态代码的响应不能带有响应体。</li><li><code>200</code> 及以上状态码用于「成功」响应。这些是你最常使用的。<ul><li><code>200</code> 是默认状态代码，它表示一切「正常」。</li><li>另一个例子会是 <code>201</code>，「已创建」。它通常在数据库中创建了一条新记录后使用。</li><li>一个特殊的例子是 <code>204</code>，「无内容」。此响应在没有内容返回给客户端时使用，因此该响应不能包含响应体。</li></ul></li><li><strong><code>300</code></strong> 及以上状态码用于「重定向」。具有这些状态码的响应可能有或者可能没有响应体，但 <code>304</code>「未修改」是个例外，该响应不得含有响应体。</li><li><code>400</code> 及以上状态码用于「客户端错误」响应。这些可能是你第二常使用的类型。<ul><li>一个例子是 <code>404</code>，用于「未找到」响应。</li><li>对于来自客户端的一般错误，你可以只使用 <code>400</code>。</li></ul></li><li><code>500</code> 及以上状态码用于服务器端错误。你几乎永远不会直接使用它们。当你的应用程序代码或服务器中的某些部分出现问题时，它将自动返回这些状态代码之一</li></ul><h5 id=便捷变量>便捷变量</h5><p>可以使用来自 <code>fastapi.status</code> 的便捷变量</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>status</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_201_CREATED</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>仅仅是为了自动补全&mldr;</p><h4 id=表单数据>表单数据</h4><p>When you need to receive form fields instead of JSON, you can use <code>Form</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Form</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/login/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>login</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Form</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Form</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=n>username</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=文件响应>文件响应</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>File</span><span class=p>,</span> <span class=n>Form</span><span class=p>,</span> <span class=n>UploadFile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/files/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_file</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>:</span> <span class=nb>bytes</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>fileb</span><span class=p>:</span><span class=n>UploadFile</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>token</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Form</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_size&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>file</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;token&#34;</span><span class=p>:</span> <span class=n>token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileb_content_type&#34;</span><span class=p>:</span> <span class=n>fileb</span><span class=o>.</span><span class=n>content_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=错误处理>错误处理</h4><p>使用 <code>HTTPException</code> 来向前端返回错误请求</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>HTTPException</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>items</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;foo&#34;</span><span class=p>:</span> <span class=s2>&#34;The Foo Wrestlers&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>item_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Item not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>[</span><span class=n>item_id</span><span class=p>]}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=路径修饰器的其他参数>路径修饰器的其他参数</h3><h4 id=tags>tags</h4><p>传递 list 或 str 参数</p><p>Tags will be added to the OpenAPI schema and used by the automatic documentation interfaces</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>42</span><span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/users/&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;users&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_users</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[{</span><span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;johndoe&#34;</span><span class=p>}]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=summary-and-description>Summary and description</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/items/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;Create an item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Create an item with all the information, name, description, price, tax and a set of unique tags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=description-from-docstring>Description from docstring</h4><p>You can write Markdown in the docstring, it will be interpreted and displayed correctly</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;Create an item&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Create an item with all the information:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    - **name**: each item must have a name
</span></span></span><span class=line><span class=cl><span class=s2>    - **description**: a long description
</span></span></span><span class=line><span class=cl><span class=s2>    - **price**: required
</span></span></span><span class=line><span class=cl><span class=s2>    - **tax**: if the item doesn&#39;t have tax, you can omit this
</span></span></span><span class=line><span class=cl><span class=s2>    - **tags**: a set of unique tag strings for this item
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=response-description>Response description</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/items/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>Item</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;Create an item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_description</span><span class=o>=</span><span class=s2>&#34;The created item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Notice that <code>response_description</code> refers specifically to the response, the <code>description</code> refers to the <em>path operation</em> in general.</p></blockquote><h4 id=deprecated>deprecated</h4><p>标记已废弃的 API</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/elements/&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>],</span> <span class=n>deprecated</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_elements</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[{</span><span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>}]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=orm>ORM</h2><p>使用 sqlalchemy</p><h3 id=目录格式>目录格式</h3><p>数据库操作 Demo：https://www.jianshu.com/p/ca0d29b6e127</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── sql_app
</span></span><span class=line><span class=cl>    ├── __init__.py <span class=c1># 声明模块</span>
</span></span><span class=line><span class=cl>    ├── crud.py <span class=c1># 增删查改函数</span>
</span></span><span class=line><span class=cl>    ├── database.py 
</span></span><span class=line><span class=cl>    ├── main.py
</span></span><span class=line><span class=cl>    ├── models.py <span class=c1># 数据库表格模板</span>
</span></span><span class=line><span class=cl>    └── schemas.py 
</span></span></code></pre></td></tr></table></div></div><h2 id=跨域资源共享>跨域资源共享</h2><p>跨域资源共享指浏览器中运行的前端拥有与后端通信的 JavaScript 代码，而后端处于与前端不同的「源」的情况。</p><h3 id=源>源</h3><p>源是协议（<code>http</code>，<code>https</code>）、域（<code>myapp.com</code>，<code>localhost</code>，<code>localhost.tiangolo.com</code>）以及端口（<code>80</code>、<code>443</code>、<code>8080</code>）的组合。</p><p>因此，这些都是不同的源：</p><ul><li><code>http://localhost</code></li><li><code>https://localhost</code></li><li><code>http://localhost:8080</code></li></ul><p>即使它们都在 <code>localhost</code> 中，但是它们使用不同的协议或者端口，所以它们都是不同的「源」。</p><p>后端必须有一个「允许的源」列表，才能接收来自前端的请求</p><p>可以使用 <code>"*"</code>（一个「通配符」）声明这个列表，表示全部都是允许的，但为了一切都能正常工作，最好显式地指定允许的源</p><h3 id=corsmiddleware>CORSMiddleware</h3><p>你可以在 <strong>FastAPI</strong> 应用中使用 <code>CORSMiddleware</code> 来配置它。</p><ul><li>导入 <code>CORSMiddleware</code>。</li><li>创建一个允许的源列表（由字符串组成）。</li><li>将其作为「中间件」添加到你的 <strong>FastAPI</strong> 应用中。</li></ul><p>你也可以指定后端是否允许：</p><ul><li>凭证（授权 headers，Cookies 等）。</li><li>特定的 HTTP 方法（<code>POST</code>，<code>PUT</code>）或者使用通配符 <code>"*"</code> 允许所有方法。</li><li>特定的 HTTP headers 或者使用通配符 <code>"*"</code> 允许所有 headers。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.middleware.cors</span> <span class=kn>import</span> <span class=n>CORSMiddleware</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>origins</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http://localhost.tiangolo.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://localhost.tiangolo.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http://localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http://localhost:8080&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>add_middleware</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>CORSMiddleware</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_origins</span><span class=o>=</span><span class=n>origins</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_credentials</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_headers</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>参数</strong></p><ul><li><code>allow_origins</code> - 一个允许跨域请求的源列表。例如 <code>['https://example.org', 'https://www.example.org']</code>。你可以使用 <code>['*']</code> 允许任何源。</li><li><code>allow_origin_regex</code> - 一个正则表达式字符串，匹配的源允许跨域请求。例如 <code>'https://.*\.example\.org'</code>。</li><li><code>allow_methods</code> - 一个允许跨域请求的 HTTP 方法列表。默认为 <code>['GET']</code>。你可以使用 <code>['*']</code> 来允许所有标准方法。</li><li><code>allow_headers</code> - 一个允许跨域请求的 HTTP 请求头列表。默认为 <code>[]</code>。你可以使用 <code>['*']</code> 允许所有的请求头。<code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code> 以及 <code>Content-Type</code> 请求头总是允许 CORS 请求。</li><li><code>allow_credentials</code> - 指示跨域请求支持 cookies。默认是 <code>False</code>。另外，允许凭证时 <code>allow_origins</code> 不能设定为 <code>['*']</code>，必须指定源。</li><li><code>expose_headers</code> - 指示可以被浏览器访问的响应头。默认为 <code>[]</code>。</li><li><code>max_age</code> - 设定浏览器缓存 CORS 响应的最长时间，单位是秒。默认为 <code>600</code>。</li></ul><h2 id=文件结构>文件结构</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── app
</span></span><span class=line><span class=cl>│   ├── __init__.py
</span></span><span class=line><span class=cl>│   ├── main.py
</span></span><span class=line><span class=cl>│   ├── dependencies.py
</span></span><span class=line><span class=cl>│   └── routers
</span></span><span class=line><span class=cl>│   │   ├── __init__.py
</span></span><span class=line><span class=cl>│   │   ├── items.py
</span></span><span class=line><span class=cl>│   │   └── users.py
</span></span><span class=line><span class=cl>│   └── internal
</span></span><span class=line><span class=cl>│       ├── __init__.py
</span></span><span class=line><span class=cl>│       └── admin.py
</span></span></code></pre></td></tr></table></div></div><h3 id=路径分离-apirouter>路径分离 APIRouter</h3><p>可以将 <code>APIRouter</code> 视为一个「迷你 <code>FastAPI</code>」类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>APIRouter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/users/&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;users&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_users</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[{</span><span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;Rick&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;Morty&#34;</span><span class=p>}]</span>
</span></span></code></pre></td></tr></table></div></div><p>可以在 <code>APIRouter</code> 中增添配置，免去将配置项添加到每一个路径操作中的烦恼</p><ul><li><code>prefix</code>：父级路径</li><li><code>tags</code>：标签</li><li><code>responses</code></li><li><code>dependencies</code>：注入的依赖项</li></ul><blockquote><p>仍然可以添加<em>更多</em>将会应用于特定的<em>路径操作</em>的 <code>tags</code>，以及一些特定于该<em>路径操作</em>的额外 <code>responses</code></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>prefix</span><span class=o>=</span><span class=s2>&#34;/items&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=n>Depends</span><span class=p>(</span><span class=n>get_token_header</span><span class=p>)],</span>
</span></span><span class=line><span class=cl>    <span class=n>responses</span><span class=o>=</span><span class=p>{</span><span class=mi>404</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Not found&#34;</span><span class=p>}},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fake_items_db</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;plumbus&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Plumbus&#34;</span><span class=p>},</span> <span class=s2>&#34;gun&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Portal Gun&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fake_items_db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/</span><span class=si>{item_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_item</span><span class=p>(</span><span class=n>item_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>item_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>fake_items_db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Item not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=n>fake_items_db</span><span class=p>[</span><span class=n>item_id</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>],</span> <span class=s2>&#34;item_id&#34;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=主体>主体</h3><p>主题通常位于项目根目录，名字为 <code>main.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.dependencies</span> <span class=kn>import</span> <span class=n>get_query_token</span><span class=p>,</span> <span class=n>get_token_header</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.internal</span> <span class=kn>import</span> <span class=n>admin</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.routers</span> <span class=kn>import</span> <span class=n>items</span><span class=p>,</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=n>Depends</span><span class=p>(</span><span class=n>get_query_token</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span><span class=n>users</span><span class=o>.</span><span class=n>router</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span><span class=n>items</span><span class=o>.</span><span class=n>router</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>admin</span><span class=o>.</span><span class=n>router</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>prefix</span><span class=o>=</span><span class=s2>&#34;/admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;admin&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=n>Depends</span><span class=p>(</span><span class=n>get_token_header</span><span class=p>)],</span>
</span></span><span class=line><span class=cl>    <span class=n>responses</span><span class=o>=</span><span class=p>{</span><span class=mi>418</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a teapot&#34;</span><span class=p>}},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 没必要</span>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>root</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello Bigger Applications!&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>「相对导入」：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.routers</span> <span class=kn>import</span> <span class=n>items</span><span class=p>,</span> <span class=n>users</span>
</span></span></code></pre></td></tr></table></div></div><p>「绝对导入」：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.routers</span> <span class=kn>import</span> <span class=n>items</span><span class=p>,</span> <span class=n>users</span>
</span></span></code></pre></td></tr></table></div></div></blockquote><h3 id=依赖项>依赖项</h3><h4 id=声明依赖项>声明依赖项</h4><h5 id=函数式>函数式</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>common_parameters</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=n>q</span><span class=p>,</span> <span class=s2>&#34;skip&#34;</span><span class=p>:</span> <span class=n>skip</span><span class=p>,</span> <span class=s2>&#34;limit&#34;</span><span class=p>:</span> <span class=n>limit</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>commons</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>common_parameters</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>commons</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/users/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_users</span><span class=p>(</span><span class=n>commons</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>common_parameters</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>commons</span>
</span></span></code></pre></td></tr></table></div></div><p>只能传给 Depends 一个参数。</p><p>且该参数必须是可调用对象，比如函数。</p><p>该函数接收的参数和<em>路径操作函数</em>的参数一样</p><h5 id=对象式>对象式</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fake_items_db</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;item_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Baz&#34;</span><span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommonQueryParams</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>q</span> <span class=o>=</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>skip</span> <span class=o>=</span> <span class=n>skip</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>limit</span> <span class=o>=</span> <span class=n>limit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>(</span><span class=n>commons</span><span class=p>:</span> <span class=n>CommonQueryParams</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>CommonQueryParams</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>commons</span><span class=o>.</span><span class=n>q</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=n>commons</span><span class=o>.</span><span class=n>q</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span> <span class=o>=</span> <span class=n>fake_items_db</span><span class=p>[</span><span class=n>commons</span><span class=o>.</span><span class=n>skip</span> <span class=p>:</span> <span class=n>commons</span><span class=o>.</span><span class=n>skip</span> <span class=o>+</span> <span class=n>commons</span><span class=o>.</span><span class=n>limit</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span>
</span></span></code></pre></td></tr></table></div></div><p>Instead of writing:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>commons: CommonQueryParams = Depends(CommonQueryParams)
</span></span></code></pre></td></tr></table></div></div><p>&mldr; you can also write:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>commons: CommonQueryParams = Depends()
</span></span></code></pre></td></tr></table></div></div><h4 id=子依赖项>子依赖项</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Cookie</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>query_extractor</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>query_or_cookie_extractor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>query_extractor</span><span class=p>),</span> <span class=n>last_query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Cookie</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>q</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>last_query</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_query</span><span class=p>(</span><span class=n>query_or_default</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>query_or_cookie_extractor</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;q_or_cookie&#34;</span><span class=p>:</span> <span class=n>query_or_default</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>query_or_cookie_extractor</code> 的参数：</p><ul><li>尽管该函数自身是依赖项，但还声明了另一个依赖项（它「依赖」于其他对象）<ul><li>该函数依赖 <code>query_extractor</code>, 并把 <code>query_extractor</code> 的返回值赋给参数 <code>q</code></li></ul></li><li>同时，该函数还声明了类型是 <code>str</code> 的可选 cookie（<code>last_query</code>）<ul><li>用户未提供查询参数 <code>q</code> 时，则使用上次使用后保存在 cookie 中的查询</li></ul></li></ul><blockquote><p>如果在同一个<em>路径操作</em> 多次声明了同一个依赖项，例如，多个依赖项共用一个子依赖项，<strong>FastAPI</strong> 在处理同一请求时，只调用一次该子依赖项。</p></blockquote><h4 id=路径操作装饰器依赖项>路径操作装饰器依赖项</h4><p>有时，我们并不需要在<em>路径操作函数</em>中使用依赖项的返回值。或者说，有些依赖项不返回值，但仍要执行或解析该依赖项。</p><p>对于这种情况，不必在声明<em>路径操作函数</em>的参数时使用 <code>Depends</code>，而是可以在<em>路径操作装饰器</em>中添加一个由 <code>dependencies</code> 组成的 <code>list</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Header</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>verify_token</span><span class=p>(</span><span class=n>x_token</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x_token</span> <span class=o>!=</span> <span class=s2>&#34;fake-super-secret-token&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;X-Token header invalid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>verify_key</span><span class=p>(</span><span class=n>x_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=o>...</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x_key</span> <span class=o>!=</span> <span class=s2>&#34;fake-super-secret-key&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;X-Key header invalid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/items/&#34;</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=n>Depends</span><span class=p>(</span><span class=n>verify_token</span><span class=p>),</span> <span class=n>Depends</span><span class=p>(</span><span class=n>verify_key</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[{</span><span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;item&#34;</span><span class=p>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>}]</span>
</span></span></code></pre></td></tr></table></div></div><p>路径操作装饰器依赖项（以下简称为**“路径装饰器依赖项”**）的执行或解析方式和普通依赖项一样，但就算这些依赖项会返回值，它们的值也不会传递给<em>路径操作函数</em>。</p><h4 id=全局依赖项>全局依赖项</h4><p>有时，我们要为整个应用添加依赖项</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=n>Depends</span><span class=p>(</span><span class=n>verify_token</span><span class=p>),</span> <span class=n>Depends</span><span class=p>(</span><span class=n>verify_key</span><span class=p>)])</span>
</span></span></code></pre></td></tr></table></div></div><p>一些在应用程序的好几个地方所使用的依赖项，可以放在它们自己的 <code>dependencies</code> 模块（<code>app/dependencies.py</code>）中</p><h3 id=测试>测试</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.testclient</span> <span class=kn>import</span> <span class=n>TestClient</span>
</span></span></code></pre></td></tr></table></div></div><p>Import <code>TestClient</code>.</p><p>Create a <code>TestClient</code> passing to it your <strong>FastAPI</strong> application.</p><p>Create functions with a name that starts with <code>test_</code> (this is standard <code>pytest</code> conventions).</p><p>Use the <code>TestClient</code> object the same way as you do with <code>requests</code>.</p><p>Write simple <code>assert</code> statements with the standard Python expressions that you need to check (again, standard <code>pytest</code>).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.testclient</span> <span class=kn>import</span> <span class=n>TestClient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>read_main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>TestClient</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_read_main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=o>==</span> <span class=p>{</span><span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-08-29 06:30:23">更新于 2022-08-29</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/python/web-backend/fastapi/ data-title=FastAPI data-hashtags=Python,后端><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/python/web-backend/fastapi/ data-hashtag=Python><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/python/web-backend/fastapi/ data-title=FastAPI><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/python/>Python</a>,&nbsp;<a href=/Notes/tags/%E5%90%8E%E7%AB%AF/>后端</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/golang/go-test/ class=prev rel=prev title="Go test 教程"><i class="fa-solid fa-angle-left fa-fw"></i>Go test 教程</a>
<a href=/Notes/posts/python/web-backend/django/ class=next rel=next title=Django>Django<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>