<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>设计模式 Python 实现 - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="设计模式 Python 实现 认识 设计模式 定义 设计模式是对软件设计中普遍存在或反复出向的各种问题"><meta name=keywords content="设计模式"><meta itemprop=name content="设计模式 Python 实现"><meta itemprop=description content="设计模式 Python 实现 认识 设计模式 定义 设计模式是对软件设计中普遍存在或反复出向的各种问题"><meta itemprop=datePublished content="2022-01-21T00:00:00+00:00"><meta itemprop=dateModified content="2023-06-14T09:56:49+00:00"><meta itemprop=wordCount content="9432"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="设计模式,"><meta property="og:title" content="设计模式 Python 实现"><meta property="og:description" content="设计模式 Python 实现 认识 设计模式 定义 设计模式是对软件设计中普遍存在或反复出向的各种问题"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/python/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-21T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-14T09:56:49+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="设计模式 Python 实现"><meta name=twitter:description content="设计模式 Python 实现 认识 设计模式 定义 设计模式是对软件设计中普遍存在或反复出向的各种问题"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/python/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/python/%E7%89%B9%E6%80%A7/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/%E5%88%B7%E9%A2%98/array/2.-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"设计模式 Python 实现","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/python\/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0\/"},"genre":"posts","keywords":"设计模式","wordcount":9432,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/python\/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0\/","datePublished":"2022-01-21T00:00:00+00:00","dateModified":"2023-06-14T09:56:49+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>设计模式 Python 实现</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/%E4%B8%93%E4%B8%9A%E8%AF%BE/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;专业课</a></span></div><div class=post-meta-line><span title="2022-01-21 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-01-21>2022-01-21</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 9432 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 19 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#认识>认识</a><ul><li><a href=#设计模式>设计模式</a><ul><li><a href=#定义>定义</a></li><li><a href=#分类>分类</a></li></ul></li><li><a href=#接口>接口</a></li></ul></li><li><a href=#面向对象设计原则>面向对象设计原则</a><ul><li><a href=#开放封闭原则>开放封闭原则</a></li><li><a href=#里氏替换原则>里氏替换原则</a></li><li><a href=#依赖倒置原则>依赖倒置原则</a></li><li><a href=#接口隔离原则>接口隔离原则</a></li><li><a href=#单一职责原则>单一职责原则</a></li></ul></li><li><a href=#创建型模式>创建型模式</a><ul><li><a href=#简单工厂模式>简单工厂模式</a></li><li><a href=#工厂方法模式>工厂方法模式</a></li><li><a href=#抽象工厂模式>抽象工厂模式</a></li><li><a href=#建造者模式>建造者模式</a></li><li><a href=#单例模式>单例模式</a></li><li><a href=#创建型模式概述>创建型模式概述</a></li></ul></li><li><a href=#结构型模式>结构型模式</a><ul><li><ul><li><ul><li><ul><li><a href=#适配器模式>适配器模式</a></li><li><a href=#桥模式>桥模式</a></li><li><a href=#3-组合模式>3. 组合模式</a></li><li><a href=#4-外观模式>4. 外观模式</a></li><li><a href=#5-代理模式>5. 代理模式</a></li></ul></li></ul></li></ul></li></ul></li><li><a href=#行为型模式>行为型模式</a><ul><li><ul><li><ul><li><ul><li><a href=#责任链模式>责任链模式</a></li><li><a href=#2-观察者模式>2. 观察者模式</a></li><li><a href=#3-策略模式>3. 策略模式</a></li><li><a href=#4-模板方法模式>4. 模板方法模式</a></li></ul></li></ul></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=设计模式-python-实现>设计模式 Python 实现</h1><h2 id=认识>认识</h2><h3 id=设计模式>设计模式</h3><h4 id=定义>定义</h4><p>设计模式是对软件设计中普遍存在或反复出向的各种问题所提出的解决方案。每一个设计模式系统地被命名、解释和评价了面向对象系统中一个重要和重复出现的设计</p><h4 id=分类>分类</h4><p><strong>创建型模式</strong></p><ul><li><p>隐藏底层模块的逻辑，关注怎么创建对象</p></li><li><p>工厂方法模式、抽象工厂模式、创建者模式、原型模式、单例模式</p></li></ul><p><strong>结构型模式</strong></p><ul><li><p>类之间如何协同工作，应该组成什么结构</p></li><li><p>适配器模式、桥模式、组合模式、装饰模式、外观模式、享元模式、代理模式。</p></li></ul><p><strong>行为型模式</strong></p><ul><li><p>关注行为，也就是方法，应该怎样某些行为</p></li><li><p>解释器模式、责任链模式、命令模式、迭代器模式、中介者模式、备忘录模式、观察者模式、状态模式、策略模式、访问者模式、模板方法模式。</p></li></ul><h3 id=接口>接口</h3><p><strong>定义</strong>：若干抽象方法的集合</p><p><strong>作用</strong>：限制实现接口的类必须按照接口给定的调用方式实现这些方法，对高层模块隐藏了类的内部实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具有抽象方法的类就是接口类，</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        抽象方法，在实现的类中必须实现的方法。限制实现接口的类必须按照接口给定的调用方式实现这些方法
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 不能说是继承接口类，应该说是实现接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        实现接口类中的必须实现的方法
</span></span></span><span class=line><span class=cl><span class=s2>        :param money:
</span></span></span><span class=line><span class=cl><span class=s2>        :return:
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支付宝支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        实现接口类中的必须实现的方法
</span></span></span><span class=line><span class=cl><span class=s2>        :param money:
</span></span></span><span class=line><span class=cl><span class=s2>        :return:
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;微信支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下面是高层代码，在调用的时候是看不到底层类的内部实现</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>WechatPay</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>w</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=面向对象设计原则>面向对象设计原则</h2><h3 id=开放封闭原则>开放封闭原则</h3><p>一个软件实体如类、模块和函数应该<strong>对扩展开放</strong>，<strong>对修改关闭</strong>。</p><p>即软件实体应该在不修改原代码的情况下进行修改。</p><h3 id=里氏替换原则>里氏替换原则</h3><p>里氏替换原则通俗来讲就是：子类可以扩展父类的功能，但不能改变父类原有的功能。也就是说：子类继承父类时，除添加新的方法完成新增功能外，尽量不要重写父类的方法。</p><p>根据上述理解，对里氏替换原则的定义可以总结如下：</p><ul><li>子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法</li><li>子类中可以增加自己特有的方法</li><li>当子类的方法重载父类的方法时，方法的前置条件（即方法的输入参数）要比父类的方法更宽松</li><li>当子类的方法实现父类的方法时（重写/重载或实现抽象方法），方法的后置条件（即方法的的输出/返回值）要比父类的方法更严格或相等</li></ul><p>所有引用父类的地方必须能透明地使用其子类的对象</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>print_name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>VipUser</span><span class=p>(</span><span class=n>User</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>print_name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        保证参数和返回值类型需要和父类一样
</span></span></span><span class=line><span class=cl><span class=s2>        :return:
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_name</span><span class=p>(</span><span class=n>u</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    不论使用User还是继承User的VipUser，调用的方式是一样的。这就要求User和VipUser的方法参数和返回值类型是一样的
</span></span></span><span class=line><span class=cl><span class=s2>    :param u:
</span></span></span><span class=line><span class=cl><span class=s2>    :return:
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span><span class=o>.</span><span class=n>print_name</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=依赖倒置原则>依赖倒置原则</h3><ul><li><p>高层模块不应该依赖底层模块，二者都应该依赖抽象。</p></li><li><p>抽象不应该依赖细节，细节应该应该依赖抽象。</p></li></ul><p><strong>要针对接口编程，而不是针对实现编程</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 接口，抽象不应该依赖细节</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c1># 底层代码和高层代码都是细节，细节应该依赖抽象</span>
</span></span><span class=line><span class=cl><span class=c1># 底层代码</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支付宝支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;微信支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高层代码，高层模块不应该依赖底层模块，二者都应该依赖抽象</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>WechatPay</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>w</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=接口隔离原则>接口隔离原则</h3><ul><li><p>使用多个专门的接口，而不使用单一的总接口</p></li><li><p>高层的代码不应该依赖那些它不需要的接口</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LandAnimal</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>walk</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WaterAnimal</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>swim</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SkyAnimal</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>fly</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高层的代码不应该依赖那些它不需要的接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Tiger</span><span class=p>(</span><span class=n>LandAnimal</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>walk</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高层的代码不应该依赖那些它不需要的接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Frog</span><span class=p>(</span><span class=n>LandAnimal</span><span class=p>,</span> <span class=n>WaterAnimal</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>walk</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=单一职责原则>单一职责原则</h3><p>不要存在多于一个导致类变更的原因，一个类只负责一项职责，一个类只做一件事。</p><p><strong>把面向过程的代码放到类中，虽然用到了类，但不是面向对象</strong>。</p><h2 id=创建型模式>创建型模式</h2><h3 id=简单工厂模式>简单工厂模式</h3><p>简单工厂模式不在 23 种设计模式之中，但很重要。</p><p>简单工厂模式不直接向客户端暴露对象创建的细节，而是通过一个<strong>工厂类</strong>来负责创建产品类的实例。</p><p>简单工程模式的角色有：工厂角色、抽象产品角色、具体产品角色</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象产品角色，以什么样的表现去使用</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 产品角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>use_huabei</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>=</span> <span class=n>use_huabei</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;花呗支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支付宝余额支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 产品角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;微信支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 工厂类角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentFactory</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;Alipay&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;WechatPay&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>WechatPay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;HuabeiPay&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Alipay</span><span class=p>(</span><span class=n>use_huabei</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s1>&#39;No such payment named </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>method</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 客户端调用。不直接向客户端暴露对象创建的实现细节，而是通过一个工厂类来负责创建产品类的实例</span>
</span></span><span class=line><span class=cl><span class=n>pf</span> <span class=o>=</span> <span class=n>PaymentFactory</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>create_payment</span><span class=p>(</span><span class=s1>&#39;HuabeiPay&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=工厂方法模式>工厂方法模式</h3><p>简单工厂模式只创建一个工厂类，当有新的产品时，需要修改工厂类代码。</p><p>而工厂方法模式的<strong>每个具体产品对应一个具体的工厂类</strong>，不需要修改工厂类代码，并且同时也能满足隐藏对象创建的细节。</p><p>但是工厂方法模式也是有缺点的：每增加一个具体产品类，就必须增加一个相应的具体方法。</p><p>工厂模式方法模式的概念是定义了一个用于创建对象的接口（<strong>工厂接口</strong>），让子类决定实例化哪一个产品类。</p><p>角色有抽象工厂角色、具体工厂角色、抽象产品角色和具体产品角色。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象产品角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体产品角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>use_huabei</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>=</span> <span class=n>use_huabei</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;花呗支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支付宝余额支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;微信支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象工厂角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentFactory</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体工厂角色</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AlipayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HuabeiFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>(</span><span class=n>use_huabei</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hfp</span> <span class=o>=</span> <span class=n>HuabeiFactory</span><span class=p>()</span><span class=o>.</span><span class=n>create_payment</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>hfp</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>  <span class=c1># 花呗支付了100元!</span>
</span></span></code></pre></td></tr></table></div></div><p>缺点是每增加一个具体产品类，就必须增加一个相应的具体方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>use_huabei</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>=</span> <span class=n>use_huabei</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_huabei</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;花呗支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支付宝余额支付了</span><span class=si>{0}</span><span class=s2>元!&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;微信支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankPay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;银行支付了</span><span class=si>%d</span><span class=s2>元!&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>money</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建产品的工厂类的接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentFactory</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 工厂类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AlipayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 工厂类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WechatPayPayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 工厂类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HuabeiPayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Alipay</span><span class=p>(</span><span class=n>use_huabei</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 新增加银行支付的工厂类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankPayFactory</span><span class=p>(</span><span class=n>PaymentFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BankPay</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bfp</span> <span class=o>=</span> <span class=n>BankPayFactory</span><span class=p>()</span><span class=o>.</span><span class=n>create_payment</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>bfp</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>  <span class=c1># 银行支付了100元!</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=抽象工厂模式>抽象工厂模式</h3><p>定义一个工厂类的接口让工厂的子类来创建一系列相关或者相互依赖的对象。</p><p>相比工厂方法模式，<strong>抽象工厂模式中的每一个具体工厂都生产一套产品</strong>。</p><p>下面是生产厂商生产一部手机的例子：生产一部手机如果说只需要手机壳、CPU 和操作系统这三个类对象，其中每个类对象都有不同的种类。对每个具体工厂，分别生产一部手机需要的三个对象。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------抽象的产品------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PhoneShell</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PhoneCPU</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PhoneOS</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c1># ------具体的产品------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SmallShell</span><span class=p>(</span><span class=n>PhoneShell</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;普通手机小手机壳&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BigShell</span><span class=p>(</span><span class=n>PhoneShell</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;普通手机大手机壳&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppleShell</span><span class=p>(</span><span class=n>PhoneShell</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;苹果手机壳&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapDragonCPU</span><span class=p>(</span><span class=n>PhoneCPU</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;骁龙CPU&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HuaweiCPU</span><span class=p>(</span><span class=n>PhoneCPU</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;化为CPU&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppleCPU</span><span class=p>(</span><span class=n>PhoneCPU</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;苹果CPU&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AndroidOS</span><span class=p>(</span><span class=n>PhoneOS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;IOS系统&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppleOS</span><span class=p>(</span><span class=n>PhoneOS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;安卓系统&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------抽象的工厂------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PhoneFactory</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------具体的工厂------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HuaweiFactory</span><span class=p>(</span><span class=n>PhoneFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>SmallShell</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>HuaweiCPU</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>AndroidOS</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppleFactory</span><span class=p>(</span><span class=n>PhoneFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_shell</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>AppleShell</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_cpu</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>AppleCPU</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_os</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>AppleOS</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------客户端------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Phone</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shell</span><span class=p>,</span> <span class=n>cpu</span><span class=p>,</span> <span class=n>os</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shell</span> <span class=o>=</span> <span class=n>shell</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cpu</span> <span class=o>=</span> <span class=n>cpu</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>os</span> <span class=o>=</span> <span class=n>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_info</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;手机信息：&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shell</span><span class=o>.</span><span class=n>show_shell</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cpu</span><span class=o>.</span><span class=n>show_cpu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>os</span><span class=o>.</span><span class=n>show_os</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_phone</span><span class=p>(</span><span class=n>factory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>shell</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=n>make_shell</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cpu</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=n>make_cpu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=n>make_os</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Phone</span><span class=p>(</span><span class=n>shell</span><span class=p>,</span> <span class=n>cpu</span><span class=p>,</span> <span class=n>os</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>make_phone</span><span class=p>(</span><span class=n>HuaweiFactory</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>show_info</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>手机信息：
</span></span></span><span class=line><span class=cl><span class=s2>普通手机小手机壳
</span></span></span><span class=line><span class=cl><span class=s2>华为CPU
</span></span></span><span class=line><span class=cl><span class=s2>IOS系统
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>抽象工厂模式的角色有：抽象工厂角色、具体工厂角色、抽象产品角色、具体产品角色和客户端。</p><p>优点</p><ul><li>将客户端和类的具体实现相分离；</li><li><strong>每个工厂创建了一个完整的产品系列</strong>，使得易于交换产品系列；</li><li>有利于产品的一致性，即产品之间的约束关系。</li></ul><p>缺点</p><ul><li><strong>难以支持新种类抽象产品</strong>。</li></ul><h3 id=建造者模式>建造者模式</h3><p>建造者模式是将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p><p>角色</p><ul><li>抽象创建者</li><li>具体创建者</li><li>指挥者</li><li>产品</li></ul><p>建造者模式与抽象工厂模式相似，也用来创建复杂的对象。主要区别是 <strong>建造者模式着重一步步构造一个复杂对象（控制顺序），而抽象工厂模式着重于多个系列的产品对象</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------产品------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Player</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>face</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>arms</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>legs</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>face</span> <span class=o>=</span> <span class=n>face</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>arms</span> <span class=o>=</span> <span class=n>arms</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>legs</span> <span class=o>=</span> <span class=n>legs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>face</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>body</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>arms</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>legs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------抽象建造者------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlayerBuilder</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_face</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_body</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_arms</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_legs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------具体建造者,隐藏了一个产品的内部结构------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GirlBuilder</span><span class=p>(</span><span class=n>PlayerBuilder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span> <span class=o>=</span> <span class=n>Player</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_face</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>face</span> <span class=o>=</span> <span class=s1>&#39;漂亮的脸蛋&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_body</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=s1>&#39;苗条的身材&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_arms</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>arms</span> <span class=o>=</span> <span class=s1>&#39;细细的胳膊&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_legs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>legs</span> <span class=o>=</span> <span class=s1>&#39;大长腿&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------具体建造者，表示代码------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MonsterBuilder</span><span class=p>(</span><span class=n>PlayerBuilder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span> <span class=o>=</span> <span class=n>Player</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_face</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>face</span> <span class=o>=</span> <span class=s1>&#39;绿脸&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_body</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=s1>&#39;魁梧的身体&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_arms</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>arms</span> <span class=o>=</span> <span class=s1>&#39;粗壮的胳膊&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build_legs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>legs</span> <span class=o>=</span> <span class=s1>&#39;粗壮的大腿&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------指挥者，构造代码(构造代码和表示代码分开)，可以对构造过程进行更加精细地控制------</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlayerDirectory</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>builder_player</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>builder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        隐藏了装配过程
</span></span></span><span class=line><span class=cl><span class=s2>        :param builder:
</span></span></span><span class=line><span class=cl><span class=s2>        :return:
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=n>build_face</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=n>build_body</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=n>build_arms</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=n>build_legs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>builder</span><span class=o>.</span><span class=n>player</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ------客户端------</span>
</span></span><span class=line><span class=cl><span class=n>builder</span> <span class=o>=</span> <span class=n>GirlBuilder</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>director</span> <span class=o>=</span> <span class=n>PlayerDirectory</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>director</span><span class=o>.</span><span class=n>builder_player</span><span class=p>(</span><span class=n>builder</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>  <span class=c1># 漂亮的脸蛋,苗条的身材,细细的胳膊,大长腿</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=单例模式>单例模式</h3><p>单例模式保证一个类只有一个实例，并提供一个访问它的全局访问点。</p><p>优点是对唯一实例的受控访问（只有一个实例），单例相当于全局变量，但防止了命名空间被污染（变量命名不会有冲突）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=s2>&#34;_instance&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Singleton</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span><span class=p>(</span><span class=n>Singleton</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ms1</span> <span class=o>=</span> <span class=n>MyClass</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ms2</span> <span class=o>=</span> <span class=n>MyClass</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ms1</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>ms2</span><span class=o>.</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>id</span><span class=p>(</span><span class=n>ms1</span><span class=p>),</span> <span class=nb>id</span><span class=p>(</span><span class=n>ms2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>2 2
</span></span></span><span class=line><span class=cl><span class=s2>139843914173312 139843914173312
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果实例只出现一次，如：</p><ul><li>日志系统中只需要创建一个日志对象（否则两个日志对象同时操作一个文件就会造成操作冲突）；</li><li>数据库连接池只需要创建一个对象来操作数据库（否则增加系统开销，浪费系统资源）；</li><li>操作系统只需要创建一个文件系统对象来操作文件系统。</li></ul><h3 id=创建型模式概述>创建型模式概述</h3><p>抽象工厂模式和建造者模式相比于简单工厂模式和工厂方法模式而言更加灵活也更加复杂。</p><p>通常情况下，<strong>软件设计以简单工厂模式或工厂方法模式开始</strong>，当发现设计需要更大的灵活性的时候，则向更加复杂的设计模式演化。</p><h2 id=结构型模式>结构型模式</h2><h6 id=适配器模式>适配器模式</h6><p>将一个类的接口转换成客户希望的另外一个接口，适配器使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。<strong><code>实现适配器的两种方式，类适配器使用多继承，对象适配器使用组合</code></strong>。<strong><code>组合就是一个类中放入另一类的对象。</code></strong> 先来看下组合：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=fm>__init__</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=n>A</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>类适配器模式使用示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 类适配器模式使用示例：</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 目标接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=nb>object</span><span class=p>,</span> <span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;支付了</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 待适配的类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankPay</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>cost</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;银联支付了</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 类适配器</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentAdapter</span><span class=p>(</span><span class=n>Payment</span><span class=p>,</span> <span class=n>BankPay</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    把不兼容cost转换成pay
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cost</span><span class=p>(</span><span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>PaymentAdapter</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>银联支付了100
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>对象适配器模式使用示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 类适配器模式使用示例：</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 目标接口</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Payment</span><span class=p>(</span><span class=nb>object</span><span class=p>,</span> <span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Alipay</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;支付了</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 待适配的类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankPay</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>cost</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;银联支付了</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 待适配的类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ApplePay</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>cost</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;苹果支付了</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对象适配器</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentAdapter</span><span class=p>(</span><span class=n>Payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment</span> <span class=o>=</span> <span class=n>payment</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>money</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment</span><span class=o>.</span><span class=n>cost</span><span class=p>(</span><span class=n>money</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>PaymentAdapter</span><span class=p>(</span><span class=n>ApplePay</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>PaymentAdapter</span><span class=p>(</span><span class=n>BankPay</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>pay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>苹果支付了100
</span></span></span><span class=line><span class=cl><span class=s2>银联支付了100
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>适配器模式有三种角色，分别是目标接口、待适配的类和适配器。适用场景是：想使用一个已存在的类，而它的接口不符合你的要求。想使用一些已经存在的类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口。</p><h6 id=桥模式>桥模式</h6><p>桥模式是将一个事物的两个维度分离，使其都可以独立地变化。当事物有两个维度的表现，两个维度都可能扩展时使用。优点是：抽象和实现相分离，扩展能力强。如果不使用桥模式，在任何维度进行扩展，需要改好多代码，因为使用到了继承：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Shape</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Circle</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedRectangle</span><span class=p>(</span><span class=n>Rectangle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GreenRectangle</span><span class=p>(</span><span class=n>Rectangle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedCircle</span><span class=p>(</span><span class=n>Circle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GreenCircle</span><span class=p>(</span><span class=n>Circle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p>以上代码形状和颜色两个维度是通过类的继承关系紧密结合在一起，是紧耦合。紧耦合是是不可取的，应用桥模式的思想，可以使用组合来实现（松耦合）。如果需要画直线，直接加上直线的类。需要新颜色，直接加上颜色的类。两个维度都可以自由扩展，不需要添加很多代码。这里的角色有抽象、细化抽象、实现者和具体实现者：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Shape</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>color</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color</span> <span class=o>=</span> <span class=n>color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实现</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Color</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>paint</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 细化抽象</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;长方形&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color</span><span class=o>.</span><span class=n>paint</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果要扩展形状，只需要添加形状类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Circle</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;圆形&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color</span><span class=o>.</span><span class=n>paint</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 细化实现</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Red</span><span class=p>(</span><span class=n>Color</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>paint</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;画红色的</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>shape</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果要扩展颜色，只需要添加颜色类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Green</span><span class=p>(</span><span class=n>Color</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>paint</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;画绿色的</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>shape</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rectangle</span> <span class=o>=</span> <span class=n>Rectangle</span><span class=p>(</span><span class=n>Red</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>rectangle</span><span class=o>.</span><span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>circle</span> <span class=o>=</span> <span class=n>Circle</span><span class=p>(</span><span class=n>Green</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>circle</span><span class=o>.</span><span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>画红色的长方形
</span></span></span><span class=line><span class=cl><span class=s2>画绿色的圆形
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=3-组合模式>3. 组合模式</h6><p>将对象组合成树形结构以表示“部分-整体”的层次结构(特别是结构是递归的)，组合模式使得用户对单个对象和组合对象的使用具有一致性。优点是定义了包含基本对象和组合对象的层次结构；简化客户端代码，客户端可以一致地使用组合对象和单个对象；更加容易增加新类型的组件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象组件</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Graphic</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 叶子组件</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Point</span><span class=p>(</span><span class=n>Graphic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;点(</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>)&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 叶子组件</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Line</span><span class=p>(</span><span class=n>Graphic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>p1</span><span class=p>,</span> <span class=n>p2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p1</span> <span class=o>=</span> <span class=n>p1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p2</span> <span class=o>=</span> <span class=n>p2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;线段[(</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>)]&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 复合组件</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Picture</span><span class=p>(</span><span class=n>Graphic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>iterable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>iterable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>graphic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>graphic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>g</span><span class=o>.</span><span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 简单图形</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------简单图形------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>Point</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>l1</span> <span class=o>=</span> <span class=n>Line</span><span class=p>(</span><span class=n>Point</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>Point</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>l2</span> <span class=o>=</span> <span class=n>Line</span><span class=p>(</span><span class=n>Point</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>),</span> <span class=n>Point</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>l1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>l2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------复合图形(p,l1,l2)------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 复合图形</span>
</span></span><span class=line><span class=cl><span class=n>pic</span> <span class=o>=</span> <span class=n>Picture</span><span class=p>([</span><span class=n>p</span><span class=p>,</span> <span class=n>l1</span><span class=p>,</span> <span class=n>l2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>pic</span><span class=o>.</span><span class=n>draw</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=4-外观模式>4. 外观模式</h6><p>外观模式为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层的接口，这个接口使得这一子系统更加容易使用。外观模式下的角色有外观和子系统类，优点是：减少系统相互依赖，提高灵活性，提高了安全性。下面看一个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 子系统类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CPU</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;CPU start to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;CPU stop to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 子系统类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Disk</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Disk start to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Disk stop to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 子系统类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Memory</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Memory start to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Memory stop to run...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 外观</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Computer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>CPU</span> <span class=o>=</span> <span class=n>CPU</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Disc</span> <span class=o>=</span> <span class=n>Disk</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Member</span> <span class=o>=</span> <span class=n>Memory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>CPU</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Disc</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Member</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>CPU</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Disc</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Member</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 客户端，高层代码</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>Computer</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=5-代理模式>5. 代理模式</h6><p>为其它对象提供一种代理以控制对这个对象的访问。角色有抽象实体、实体和代理。应用场景有远程代理：为远程的对象提供代理（通过 ORM 向数据库写值，不用关注数据库是在远程）；虚代理：根据需要创建很大的对象（需要的时候创建对象）；保护代理：控制对原始对象的访问，用于对象有不同的访问权限。下面是不使用虚代理的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import ABCMeta, abstractmethod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Subject(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class RealSubject(Subject):
</span></span><span class=line><span class=cl>    def __init__(self, filename):
</span></span><span class=line><span class=cl>        self.filename = filename
</span></span><span class=line><span class=cl>        print(&#39;读取文件内容！&#39;)
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            self.content = f.read()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        return self.content
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            f.write(content)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>subj = RealSubject(&#39;test.txt&#39;)
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>读取文件内容！
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><p>使用虚代理的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import ABCMeta, abstractmethod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Subject(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class RealSubject(Subject):
</span></span><span class=line><span class=cl>    def __init__(self, filename):
</span></span><span class=line><span class=cl>        self.filename = filename
</span></span><span class=line><span class=cl>        print(&#39;读取文件内容！&#39;)
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            self.content = f.read()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        return self.content
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            f.write(content)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class VirtualProxy(Subject):
</span></span><span class=line><span class=cl>    def __init__(self, filename):
</span></span><span class=line><span class=cl>        self.filename = filename
</span></span><span class=line><span class=cl>        self.subj = None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        if not self.subj:
</span></span><span class=line><span class=cl>            self.subj = RealSubject(self.filename)
</span></span><span class=line><span class=cl>        return self.subj.get_content()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        if not self.subj:
</span></span><span class=line><span class=cl>            self.subj = RealSubject(self.filename)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        return self.subj.set_content(content)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>subj = VirtualProxy(&#39;test.txt&#39;)
</span></span><span class=line><span class=cl>print(subj.get_content())
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>读取文件内容！
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><p>不使用虚代理，只要是实例化 RealSubject 类，就会读取这个文件占用内存。使用虚代理后，可以和根据需要创建对象，用户不调用是不会创建 RealSubject 对象的，节省了内存的开销。如果需要只有读的权限而没有写的权限，可以使用保护代理：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import ABCMeta, abstractmethod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Subject(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class RealSubject(Subject):
</span></span><span class=line><span class=cl>    def __init__(self, filename):
</span></span><span class=line><span class=cl>        self.filename = filename
</span></span><span class=line><span class=cl>        print(&#39;读取文件内容！&#39;)
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            self.content = f.read()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        return self.content
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        with open(self.filename, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:
</span></span><span class=line><span class=cl>            f.write(content)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class ProtectedSubject(Subject):
</span></span><span class=line><span class=cl>    def __init__(self, filename):
</span></span><span class=line><span class=cl>        self.subj = RealSubject(filename)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_content(self):
</span></span><span class=line><span class=cl>        return self.subj.get_content()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_content(self, content):
</span></span><span class=line><span class=cl>        raise PermissionError(&#39;无写入权限！&#39;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>subj = ProtectedSubject(&#39;test.txt&#39;)
</span></span><span class=line><span class=cl>print(subj.get_content())
</span></span><span class=line><span class=cl>subj.set_content(&#39;abc&#39;)
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>读取文件内容！
</span></span><span class=line><span class=cl>test file!
</span></span><span class=line><span class=cl>Traceback (most recent call last):
</span></span><span class=line><span class=cl>  File &#34;/home/thanlon/projects/PycharmProjects/untitled/代理模式.py&#34;, line 42, in &lt;module&gt;
</span></span><span class=line><span class=cl>    subj.set_content(&#39;abc&#39;)
</span></span><span class=line><span class=cl>  File &#34;/home/thanlon/projects/PycharmProjects/untitled/代理模式.py&#34;, line 37, in set_content
</span></span><span class=line><span class=cl>    raise PermissionError(&#39;无写入权限！&#39;)
</span></span><span class=line><span class=cl>PermissionError: 无写入权限！
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><h2 id=行为型模式>行为型模式</h2><h6 id=责任链模式>责任链模式</h6><p>​ 责任链模式的内容：使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链并沿着这条链传递该请求，直到有一个对象处理它为止。责任链的角色有抽象处理者、具体处理者和客户端。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import ABCMeta, abstractmethod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 抽象的处理者
</span></span><span class=line><span class=cl>class Handler(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def handle_leave(self, day):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体的处理者
</span></span><span class=line><span class=cl>class GeneralManager(Handler):
</span></span><span class=line><span class=cl>    def handle_leave(self, day):
</span></span><span class=line><span class=cl>        if day &lt;= 30:
</span></span><span class=line><span class=cl>            print(&#39;总经理准假%d&#39; % day)
</span></span><span class=line><span class=cl>        else:
</span></span><span class=line><span class=cl>            print(&#39;可以辞职了！&#39;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体的处理者
</span></span><span class=line><span class=cl>class DepartmentManager(Handler):
</span></span><span class=line><span class=cl>    def __init__(self):
</span></span><span class=line><span class=cl>        self.next = GeneralManager()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def handle_leave(self, day):
</span></span><span class=line><span class=cl>        if day &lt;= 7:
</span></span><span class=line><span class=cl>            print(&#39;项目主管准假%d&#39; % day)
</span></span><span class=line><span class=cl>        else:
</span></span><span class=line><span class=cl>            print(&#39;部门经理职权不足&#39;)
</span></span><span class=line><span class=cl>            self.next.handle_leave(day)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体的处理者
</span></span><span class=line><span class=cl>class ProjectDirector(Handler):
</span></span><span class=line><span class=cl>    def __init__(self):
</span></span><span class=line><span class=cl>        self.next = DepartmentManager()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def handle_leave(self, day):
</span></span><span class=line><span class=cl>        if day &lt;= 3:
</span></span><span class=line><span class=cl>            print(&#39;项目主管准假%d&#39; % day)
</span></span><span class=line><span class=cl>        else:
</span></span><span class=line><span class=cl>            print(&#39;项目主管职权不足&#39;)
</span></span><span class=line><span class=cl>            self.next.handle_leave(day)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>day = 20
</span></span><span class=line><span class=cl>p = ProjectDirector()
</span></span><span class=line><span class=cl>p.handle_leave(day)
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>项目主管职权不足
</span></span><span class=line><span class=cl>部门经理职权不足
</span></span><span class=line><span class=cl>总经理准假20
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><p>​ 使用场景：有多个对象可以处理一个请求，哪个对象处理由运行时决定；在不明确接收者的情况下，向多个对象中的一个提交一个请求。优点是降低耦合度，一个对象无需知道是其它哪一个对象处理其请求。</p><h6 id=2-观察者模式>2. 观察者模式</h6><p>​ 观察者模式应用比较广泛，又被称为“发布-订阅”模式。它用来定义对象间一种一对多的依赖关系，当一个对象的状态发生变化时，所有依赖它的对象都得到通知并被自动更新。观察者模式的角色有：抽象主题、具体主题（发布者）、抽象观察者和具体观察者（订阅者）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import ABCMeta, abstractmethod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 抽象的订阅者
</span></span><span class=line><span class=cl>class Observer(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def update(self, notice):
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        :param notice: Notice类的对象
</span></span><span class=line><span class=cl>        :return:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 抽象的发布者：可以是接口，子类不需要实现，所以不需要定义抽象方法！
</span></span><span class=line><span class=cl>class Notice:
</span></span><span class=line><span class=cl>    def __init__(self):
</span></span><span class=line><span class=cl>        self.observers = []
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def attach(self, obs):
</span></span><span class=line><span class=cl>        self.observers.append(obs)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def detach(self, obs):
</span></span><span class=line><span class=cl>        self.observers.remove(obs)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def notify(self):
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        推送
</span></span><span class=line><span class=cl>        :return:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        for obs in self.observers:
</span></span><span class=line><span class=cl>            obs.update(self)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体的发布者
</span></span><span class=line><span class=cl>class StaffNotice(Notice):
</span></span><span class=line><span class=cl>    def __init__(self, company_info):
</span></span><span class=line><span class=cl>        super().__init__()  # 调用父类对象声明observers属性
</span></span><span class=line><span class=cl>        self.__company_info = company_info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @property
</span></span><span class=line><span class=cl>    def company_info(self):
</span></span><span class=line><span class=cl>        return self.__company_info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @company_info.setter
</span></span><span class=line><span class=cl>    def company_info(self, info):
</span></span><span class=line><span class=cl>        self.__company_info = info
</span></span><span class=line><span class=cl>        self.notify()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体的订阅者
</span></span><span class=line><span class=cl>class Staff(Observer):
</span></span><span class=line><span class=cl>    def __init__(self):
</span></span><span class=line><span class=cl>        self.company_info = None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def update(self, notice):
</span></span><span class=line><span class=cl>        self.company_info = notice.company_info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>staff_notice = StaffNotice(&#39;初始化公司信息&#39;)
</span></span><span class=line><span class=cl>staff1 = Staff()
</span></span><span class=line><span class=cl>staff2 = Staff()
</span></span><span class=line><span class=cl>staff_notice.attach(staff1)
</span></span><span class=line><span class=cl>staff_notice.attach(staff2)
</span></span><span class=line><span class=cl># print(staff1.company_info) None
</span></span><span class=line><span class=cl># print(staff2.company_info) None
</span></span><span class=line><span class=cl>staff_notice.company_info = &#39;假期放假通知！&#39;
</span></span><span class=line><span class=cl>print(staff1.company_info)
</span></span><span class=line><span class=cl>print(staff2.company_info)
</span></span><span class=line><span class=cl>staff_notice.detach(staff2)
</span></span><span class=line><span class=cl>staff_notice.company_info = &#39;明天开会！&#39;
</span></span><span class=line><span class=cl>print(staff1.company_info)
</span></span><span class=line><span class=cl>print(staff2.company_info)
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>假期放假通知！
</span></span><span class=line><span class=cl>假期放假通知！
</span></span><span class=line><span class=cl>明天开会！
</span></span><span class=line><span class=cl>假期放假通知！
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><p>​ 使用场景：当一个抽象模型有两个方面，其中一个方面依赖另一个方面。将这两者封装在独立对象中以使它们可以各自独立地改变和复用；当对一个对象的改变需要同时改变其它对象，而不知道具体有多少对象待改变；当一个对象必须通知其它对象，而它又不能假定其它对象是谁。换言之，你不希望这些对象是紧耦合的。优点：目标和观察者之间的抽象耦合最小；支持广播通信。</p><h6 id=3-策略模式>3. 策略模式</h6><p>​ 定义一个个算法，把它们封装起来，并且使它们可以相互替换。本模式使得算法可独立于使用它的客户而变化。角色有：抽象策略、具体策略和上下文。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from abc import abstractmethod, ABCMeta
</span></span><span class=line><span class=cl>from datetime import datetime
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 抽象策略
</span></span><span class=line><span class=cl>class Strategy(metaclass=ABCMeta):
</span></span><span class=line><span class=cl>    @abstractmethod
</span></span><span class=line><span class=cl>    def execute(self, data):
</span></span><span class=line><span class=cl>        pass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体策略
</span></span><span class=line><span class=cl>class FastStrategy(Strategy):
</span></span><span class=line><span class=cl>    def execute(self, data):
</span></span><span class=line><span class=cl>        print(&#34;使用较快的策略处理%s&#34; % data)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 具体策略
</span></span><span class=line><span class=cl>class SlowStrategy(Strategy):
</span></span><span class=line><span class=cl>    def execute(self, data):
</span></span><span class=line><span class=cl>        print(&#34;使用较慢的策略处理%s&#34; % data)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 上下文
</span></span><span class=line><span class=cl>class Context:
</span></span><span class=line><span class=cl>    def __init__(self, strategy, data):
</span></span><span class=line><span class=cl>        self.data = data
</span></span><span class=line><span class=cl>        self.strategy = strategy
</span></span><span class=line><span class=cl>        # 可以定义用户不知道的东西
</span></span><span class=line><span class=cl>        self.date = datetime.now()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def set_strategy(self, strategy):
</span></span><span class=line><span class=cl>        self.strategy = strategy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def do_strategy(self):
</span></span><span class=line><span class=cl>        self.strategy.execute(self.data)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>data = &#34;Hello!&#34;
</span></span><span class=line><span class=cl># 使用较快的策略处理
</span></span><span class=line><span class=cl>fast_strategy = FastStrategy()
</span></span><span class=line><span class=cl>context = Context(fast_strategy, data)
</span></span><span class=line><span class=cl>context.do_strategy()
</span></span><span class=line><span class=cl># 使用较慢的策略处理
</span></span><span class=line><span class=cl>slow_strategy = SlowStrategy()
</span></span><span class=line><span class=cl>context = Context(slow_strategy, data)
</span></span><span class=line><span class=cl>context.do_strategy()
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>使用较快的策略处理Hello!
</span></span><span class=line><span class=cl>使用较慢的策略处理Hello!
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span></code></pre></td></tr></table></div></div><p>​ 优点：定义了一些列可重用的算法和行为；消除了一些条件语句；可以提供相同行为的不同实现；缺点：客户必须了解不同的策略。</p><h6 id=4-模板方法模式>4. 模板方法模式</h6><p>​ 内容：定义一个操作中的算法骨架，将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。使用模板方法，需要用到两种角色，分别是抽象类和具体类。抽象类的作用是是定义抽象类（钩子操作），实现一个模板方法作为算法的骨架。具体类的作用实现原子操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>time</span> <span class=kn>import</span> <span class=n>sleep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 抽象类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Window</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># 原子操作/钩子操作</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>repaint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># 原子操作/钩子操作</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># 原子操作/钩子操作</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        模板方法(具体方法)，这个大逻辑就不需要自己写了
</span></span></span><span class=line><span class=cl><span class=s2>        :return:
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>repaint</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyWindow</span><span class=p>(</span><span class=n>Window</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>msg</span> <span class=o>=</span> <span class=n>msg</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;窗口开始运行！&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;窗口停止运行！&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>repaint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MyWindow</span><span class=p>(</span><span class=s2>&#34;Hello...&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 模板方法适用的场景：一次性实现一个算法的不变部分，各个子类中的公共行为应该被提取出来并集中到一个公共父类中以避免代码重复；控制子类扩展。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-06-14 09:56:49">更新于 2023-06-14</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/python/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0/ data-title="设计模式 Python 实现" data-hashtags=设计模式><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/python/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0/ data-hashtag=设计模式><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/python/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-python-%E5%AE%9E%E7%8E%B0/ data-title="设计模式 Python 实现"><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/python/%E7%89%B9%E6%80%A7/ class=prev rel=prev title="Python 特性"><i class="fa-solid fa-angle-left fa-fw"></i>Python 特性</a>
<a href=/Notes/posts/%E5%88%B7%E9%A2%98/array/2.-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/ class=next rel=next title="2. 两数相加">2. 两数相加<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022 - 2023</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>