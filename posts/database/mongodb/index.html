<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>MongoDB - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="MongoDB 认识 MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统 一些概念 QL术"><meta name=keywords content="数据库,快速入门"><meta itemprop=name content="MongoDB"><meta itemprop=description content="MongoDB 认识 MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统 一些概念 QL术"><meta itemprop=datePublished content="2021-10-23T00:00:00+00:00"><meta itemprop=dateModified content="2022-11-26T05:25:16+00:00"><meta itemprop=wordCount content="6548"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="数据库,快速入门,"><meta property="og:title" content="MongoDB"><meta property="og:description" content="MongoDB 认识 MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统 一些概念 QL术"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/database/mongodb/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-26T05:25:16+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="MongoDB"><meta name=twitter:description content="MongoDB 认识 MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统 一些概念 QL术"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/database/mongodb/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/protobuf/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/python/crawler/regularexpression/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"MongoDB","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/database\/mongodb\/"},"genre":"posts","keywords":"数据库, 快速入门","wordcount":6548,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/database\/mongodb\/","datePublished":"2021-10-23T00:00:00+00:00","dateModified":"2022-11-26T05:25:16+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>MongoDB</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;数据库</a></span></div><div class=post-meta-line><span title="2021-10-23 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-10-23>2021-10-23</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 6548 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 14 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#认识>认识</a><ul><li><a href=#一些概念>一些概念</a><ul><li><a href=#数据库>数据库</a></li><li><a href=#文档>文档</a></li><li><a href=#集合>集合</a></li><li><a href=#数据类型>数据类型</a></li></ul></li><li><a href=#mongo-shell-常用命令>Mongo Shell 常用命令</a></li><li><a href=#安装>安装</a><ul><li><a href=#ubuntu>ubuntu</a></li></ul></li></ul></li><li><a href=#数据库-1>数据库</a><ul><li><a href=#创建数据库>创建数据库</a></li><li><a href=#删除数据库>删除数据库</a></li></ul></li><li><a href=#集合-1>集合</a><ul><li><a href=#创建集合>创建集合</a></li><li><a href=#删除>删除</a><ul><li><a href=#删除集合>删除集合</a></li><li><a href=#清空集合>清空集合</a></li></ul></li><li><a href=#查看现有集合>查看现有集合</a></li></ul></li><li><a href=#文档-1>文档</a><ul><li><a href=#插入>插入</a><ul><li><a href=#插入单个文档>插入单个文档</a></li><li><a href=#插入多个文档>插入多个文档</a></li></ul></li><li><a href=#删除-1>删除</a><ul><li><a href=#删除所有文档>删除所有文档</a></li><li><a href=#删除符合条件的文档>删除符合条件的文档</a></li></ul></li><li><a href=#查询>查询</a><ul><li><a href=#选择集合中的所有文档>选择集合中的所有文档</a></li><li><a href=#仅返回指定的字段和_id字段>仅返回指定的字段（和_id字段）</a></li><li><a href=#返回除了被排除的字段之外的所有字段>返回除了被排除的字段之外的所有字段</a></li><li><a href=#条件操作符>条件操作符</a></li><li><a href=#type-操作符><code>$type</code> 操作符</a></li><li><a href=#查询数组>查询数组</a><ul><li><a href=#查询指定数组匹配的文档>查询指定数组匹配的文档</a></li><li><a href=#查询包含指定元素的数组匹配的文档>查询包含指定元素的数组匹配的文档</a></li><li><a href=#查询包含指定元素集合的数组匹配的文档>查询包含指定元素集合的数组匹配的文档</a></li><li><a href=#使用复合条件查询>使用复合条件查询</a></li><li><a href=#通过数组索引位置查询>通过数组索引位置查询</a></li><li><a href=#通过数组长度查询数组>通过数组长度查询数组</a></li></ul></li><li><a href=#查询嵌入文档>查询嵌入文档</a><ul><li><a href=#精准查询>精准查询</a></li></ul></li><li><a href=#部分查询>部分查询</a></li><li><a href=#查询嵌入式文档数组>查询嵌入式文档数组</a><ul><li><a href=#查询指定数组所属文档>查询指定数组所属文档</a></li><li><a href=#在数组的字段上指定查询条件>在数组的字段上指定查询条件</a></li><li><a href=#使用数组索引来查询字段>使用数组索引来查询字段</a></li><li><a href=#为数组指定多个条件>为数组指定多个条件</a></li><li><a href=#元素组合满足标准>元素组合满足标准</a></li></ul></li><li><a href=#查询空字段或缺少字段>查询空字段或缺少字段</a><ul><li><a href=#平等过滤器>平等过滤器</a></li><li><a href=#类型检查>类型检查</a></li><li><a href=#存在检查>存在检查</a></li></ul></li></ul></li><li><a href=#更新>更新</a><ul><li><a href=#更新单个文档>更新单个文档</a></li><li><a href=#更新多个文档>更新多个文档</a></li><li><a href=#更换整个文档>更换整个文档</a></li></ul></li></ul></li><li><a href=#pymongo>PyMongo</a><ul><li><a href=#连接>连接</a><ul><li><a href=#连接数据库>连接数据库</a></li><li><a href=#获取-database-和-collection>获取 Database 和 Collection</a></li></ul></li><li><a href=#插入-1>插入</a><ul><li><a href=#插入单条数据>插入单条数据</a></li><li><a href=#插入多条数据>插入多条数据</a></li></ul></li><li><a href=#删除-2>删除</a><ul><li><a href=#删除单条数据>删除单条数据</a></li><li><a href=#删除多条数据>删除多条数据</a></li></ul></li><li><a href=#更新-1>更新</a><ul><li><a href=#更新单条数据>更新单条数据</a></li><li><a href=#更新多条数据>更新多条数据</a></li></ul></li><li><a href=#查询-1>查询</a><ul><li><a href=#查询一条数据>查询一条数据</a></li><li><a href=#查询多条数据>查询多条数据</a></li><li><a href=#查询一条数据同时删除>查询一条数据同时删除</a></li><li><a href=#排序>排序</a></li></ul></li><li><a href=#其他操作>其他操作</a><ul><li><a href=#计数>计数</a></li><li><a href=#获取索引信息>获取索引信息</a></li><li><a href=#删除集合-1>删除集合</a></li><li><a href=#查看数据库下的所有集合名>查看数据库下的所有集合名</a></li></ul></li><li><a href=#常用操作>常用操作</a></li></ul></li><li><a href=#未归档>未归档</a><ul><li><a href=#mongodump-和-mongorestore>mongodump 和 mongorestore</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=mongodb>MongoDB</h1><h2 id=认识>认识</h2><p>MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统</p><h3 id=一些概念>一些概念</h3><table><thead><tr><th style=text-align:left>QL术语/概念</th><th style=text-align:left>MongoDB术语/概念</th><th style=text-align:left>解释/说明</th></tr></thead><tbody><tr><td style=text-align:left>database</td><td style=text-align:left>database</td><td style=text-align:left>数据库</td></tr><tr><td style=text-align:left>table</td><td style=text-align:left>collection</td><td style=text-align:left>数据库表/集合</td></tr><tr><td style=text-align:left>row</td><td style=text-align:left>document</td><td style=text-align:left>数据记录行/文档</td></tr><tr><td style=text-align:left>column</td><td style=text-align:left>field</td><td style=text-align:left>数据字段/域</td></tr><tr><td style=text-align:left>index</td><td style=text-align:left>index</td><td style=text-align:left>索引</td></tr><tr><td style=text-align:left>table joins</td><td style=text-align:left></td><td style=text-align:left>表连接，MongoDB 不支持</td></tr><tr><td style=text-align:left>primary key</td><td style=text-align:left>primary key</td><td style=text-align:left>主键，MongoDB 自动将 _id 字段设置为主键</td></tr></tbody></table><h4 id=数据库>数据库</h4><p>数据库名可以是满足以下条件的任意 UTF-8 字符串。</p><ul><li>不能是空字符串 <code>""</code></li><li>不得含有 &rsquo; &lsquo;（空格)、.、$、/、\和\0 (空字符)</li><li>应全部小写</li><li>最多 64 字节</li></ul><p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</p><ul><li><strong>admin</strong>：从权限的角度来看，这是 &ldquo;root&rdquo; 数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</li><li><strong>local:</strong> 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li><li><strong>config</strong>: 当 Mongo 用于分片设置时，config 数据库在内部使用，用于保存分片的相关信息。</li></ul><h4 id=文档>文档</h4><p>（Document）</p><p>文档是一组键值 (key-value) 对 (即 BSON)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p><p><strong>注意</strong></p><ol><li>文档中的键 / 值对是有序的。</li><li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li><li>MongoDB 区分类型和大小写。</li><li>文档不能有重复的键。</li><li>文档的键是字符串。除了少数例外情况，键可以使用任意 UTF-8 字符。</li></ol><p><strong>命名规范</strong></p><ul><li>键不能含有 <code>\0</code> (空字符)。这个字符用来表示键的结尾。</li><li><code>.</code> 和 <code>$</code> 有特别的意义，只有在特定环境下才能使用。</li><li>以下划线 <code>_</code> 开头的键是保留的 (不严格要求)。</li></ul><h4 id=集合>集合</h4><p>（Collections）</p><p>集合就是 MongoDB <strong>文档组</strong>，类似于 RDBMS （关系数据库管理系统：Relational Database Management System) 中的<strong>表格</strong>。</p><p>集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性</p><h4 id=数据类型>数据类型</h4><table><thead><tr><th style=text-align:left>数据类型</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left>String</td><td style=text-align:left>字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。</td></tr><tr><td style=text-align:left>Integer</td><td style=text-align:left>整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。</td></tr><tr><td style=text-align:left>Boolean</td><td style=text-align:left>布尔值。用于存储布尔值（真/假）。</td></tr><tr><td style=text-align:left>Double</td><td style=text-align:left>双精度浮点值。用于存储浮点值。</td></tr><tr><td style=text-align:left>Min/Max keys</td><td style=text-align:left>将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。</td></tr><tr><td style=text-align:left>Array</td><td style=text-align:left>用于将数组或列表或多个值存储为一个键。</td></tr><tr><td style=text-align:left>Timestamp</td><td style=text-align:left>时间戳。记录文档修改或添加的具体时间。</td></tr><tr><td style=text-align:left>Object</td><td style=text-align:left>用于内嵌文档。</td></tr><tr><td style=text-align:left>Null</td><td style=text-align:left>用于创建空值。</td></tr><tr><td style=text-align:left>Symbol</td><td style=text-align:left>符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。</td></tr><tr><td style=text-align:left>Date</td><td style=text-align:left>日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。</td></tr><tr><td style=text-align:left><strong>Object ID</strong></td><td style=text-align:left>对象 ID。用于创建文档的 ID。</td></tr><tr><td style=text-align:left>Binary Data</td><td style=text-align:left>二进制数据。用于存储二进制数据。</td></tr><tr><td style=text-align:left>Code</td><td style=text-align:left>代码类型。用于在文档中存储 JavaScript 代码。</td></tr><tr><td style=text-align:left>Regular expression</td><td style=text-align:left>正则表达式类型。用于存储正则表达式。</td></tr></tbody></table><h3 id=mongo-shell-常用命令>Mongo Shell 常用命令</h3><ul><li><p>显示所有数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>show dbs
</span></span></code></pre></td></tr></table></div></div></li><li><p>显示当前数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db
</span></span></code></pre></td></tr></table></div></div></li><li><p>连接到指定数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>use DB_NAME
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=安装>安装</h3><h4 id=ubuntu>ubuntu</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/5.0 multiverse&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list
</span></span><span class=line><span class=cl>sudo apt-get update -y
</span></span><span class=line><span class=cl>sudo apt-get install -y mongodb-org-tools
</span></span></code></pre></td></tr></table></div></div><h2 id=数据库-1>数据库</h2><h3 id=创建数据库>创建数据库</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>use DATABASE_NAME
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在 MongoDB 中，集合只有在内容插入后才会创建! 也就是说，创建集合 (数据表) 后要再插入一个文档 (记录)，集合才会真正创建。</p></blockquote><h3 id=删除数据库>删除数据库</h3><p>必须先用 <code>use</code> 命令选择要删除的数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.dropDatabase<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>删除当前数据库，默认为 test</p><h2 id=集合-1>集合</h2><h3 id=创建集合>创建集合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.createCollection<span class=o>(</span>name, options<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>name: 要创建的集合名称</p></li><li><p>options: 可选参数，指定有关内存大小及索引的选项</p><table><thead><tr><th style=text-align:left>字段</th><th style=text-align:left>类型</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left>capped</td><td style=text-align:left>布尔</td><td style=text-align:left>（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 <strong>当该值为 true 时，必须指定 size 参数。</strong></td></tr><tr><td style=text-align:left>autoIndexId</td><td style=text-align:left>布尔</td><td style=text-align:left>3.2 之后不再支持该参数。（可选）如为 true，自动在 _id 字段创建索引。默认为 false。</td></tr><tr><td style=text-align:left>size</td><td style=text-align:left>数值</td><td style=text-align:left>（可选）为固定集合指定一个最大值，即字节数。 <strong>如果 capped 为 true，也需要指定该字段。</strong></td></tr><tr><td style=text-align:left>max</td><td style=text-align:left>数值</td><td style=text-align:left>（可选）指定固定集合中包含文档的最大数量。</td></tr></tbody></table></li></ul><h3 id=删除>删除</h3><h4 id=删除集合>删除集合</h4><p>必须要先用 <code>use</code> 命令选择待删除集合的数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.drop<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>如</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.createCollection<span class=o>(</span><span class=s2>&#34;mycol&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>db.createCollection<span class=o>(</span><span class=s2>&#34;mycol&#34;</span>, <span class=o>{</span> capped : true, autoIndexId : true, size : 
</span></span><span class=line><span class=cl>   6142800, max : <span class=m>10000</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>在 MongoDB 中，你不需要创建集合。当你插入一些文档时，MongoDB 会自动创建集合。</p><h4 id=清空集合>清空集合</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.remove<span class=o>({})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=查看现有集合>查看现有集合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>show collections
</span></span></code></pre></td></tr></table></div></div><h2 id=文档-1>文档</h2><h3 id=插入>插入</h3><h4 id=插入单个文档>插入单个文档</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.insertOne<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>返回一个文档，其中包含新插入的文档的_id 字段值</li><li>如果文档未指定 <strong>_id</strong> 字段，则 MongoDB 将具有 <strong>ObjectId</strong> 值的 <strong>_id</strong> 字段添加到新文档中</li></ul><p>参数</p><ul><li>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。</li></ul><p>例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertOne<span class=o>(</span>  
</span></span><span class=line><span class=cl>        <span class=o>{</span> item: <span class=s2>&#34;canvas&#34;</span>, qty: 100, tags: <span class=o>[</span><span class=s2>&#34;cotton&#34;</span><span class=o>]</span>, size: <span class=o>{</span> h: 28, w: 35.5, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=插入多个文档>插入多个文档</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.insertMany<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>参数</p><ul><li>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。</li><li>ordered：指定是否按顺序写入，默认 true，按顺序写入。</li></ul><p>例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>([</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, qty: 25, tags: <span class=o>[</span><span class=s2>&#34;blank&#34;</span>, <span class=s2>&#34;red&#34;</span><span class=o>]</span>, size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span> <span class=o>}</span>, 
</span></span><span class=line><span class=cl>        <span class=o>{</span> item: <span class=s2>&#34;mat&#34;</span>, qty: 85, tags: <span class=o>[</span><span class=s2>&#34;gray&#34;</span><span class=o>]</span>, size: <span class=o>{</span> h: 27.9, w: 35.5, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=o>{</span> item: <span class=s2>&#34;mousepad&#34;</span>, qty: 25, tags: <span class=o>[</span><span class=s2>&#34;gel&#34;</span>, <span class=s2>&#34;blue&#34;</span><span class=o>]</span>, size: <span class=o>{</span> h: 19, w: 22.85, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>])</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>如果欲插入到的集合当前不存在，则插入操作将创建该集合。</p></blockquote><h3 id=删除-1>删除</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.deleteMany<span class=o>()</span>
</span></span><span class=line><span class=cl>db.collection.deleteOne<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>(</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, qty: 25, size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;notebook&#34;</span>, qty: 50, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;P&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, qty: 100, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;planner&#34;</span>, qty: 75, size: <span class=o>{</span> h: 22.85, w: 30, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;postcard&#34;</span>, qty: 45, size: <span class=o>{</span> h: 10, w: 15.25, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl><span class=o>]</span> <span class=o>)</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=删除所有文档>删除所有文档</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.deleteMany<span class=o>({})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=删除符合条件的文档>删除符合条件的文档</h4><p>指定标准或过滤器，以标识要删除的文档：使用 <code>&lt;field>:&lt;value></code> 表达式</p><p>以下示例从状态字段等于 “A” 的 inventory 集合中删除<strong>所有</strong>文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.deleteMany<span class=o>({</span> status : <span class=s2>&#34;A&#34;</span> <span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><p>下面的示例删除状态为 “D” 的<strong>第一个</strong>文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.deleteOne<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=查询>查询</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bd.collectionName.find<span class=o>(</span>query, projection<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>query</strong> ：可选，使用查询操作符指定查询条件</li><li><strong>projection</strong> ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值，只需省略该参数即可（默认省略）</li></ul><p>若要以易读的方式读取数据，可以用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.find<span class=o>()</span>.pretty<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=选择集合中的所有文档>选择集合中的所有文档</h4><p>将空文档作为查询过滤器参数传递给 <code>find</code> 方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.find<span class=o>(</span> <span class=o>{}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>对应于</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>collectionName</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=仅返回指定的字段和_id字段>仅返回指定的字段（和_id字段）</h4><p>将投影文档中的 <code>&lt;field></code> 设置为 1</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.find<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>, <span class=o>{</span> item: 1, status: <span class=m>1</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>对应于</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>SELECT _id, item, status from collectionName WHERE <span class=nv>status</span> <span class=o>=</span> <span class=s2>&#34;A&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>若要禁止返回默认的 <code>_id_</code>，添加 <code>_id: 0</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.find<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>, <span class=o>{</span> item: 1, status: 1, _id: <span class=m>0</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=返回除了被排除的字段之外的所有字段>返回除了被排除的字段之外的所有字段</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collectionName.find<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>, <span class=o>{</span> status: 0, instock: <span class=m>0</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用 projection 来排除特定的字段，而不是列出要在匹配的文档中返回的字段</p><h4 id=条件操作符>条件操作符</h4><table><thead><tr><th style=text-align:left>操作</th><th style=text-align:left>格式</th><th style=text-align:left>范例</th><th style=text-align:left>RDBMS中的类似语句</th></tr></thead><tbody><tr><td style=text-align:left>等于</td><td style=text-align:left><code>{&lt;key>:&lt;value></code>}</td><td style=text-align:left><code>db.col.find({"name":"Loulou"})</code></td><td style=text-align:left><code>where by = 'name'</code></td></tr><tr><td style=text-align:left>小于</td><td style=text-align:left><code>{&lt;key>:{$lt:&lt;value>}}</code></td><td style=text-align:left><code>db.col.find({"likes":{$lt:50}})</code></td><td style=text-align:left><code>where likes &lt; 50</code></td></tr><tr><td style=text-align:left>小于或等于</td><td style=text-align:left><code>{&lt;key>:{$lte:&lt;value>}}</code></td><td style=text-align:left><code>db.col.find({"likes":{$lte:50}})</code></td><td style=text-align:left><code>where likes &lt;= 50</code></td></tr><tr><td style=text-align:left>大于</td><td style=text-align:left><code>{&lt;key>:{$gt:&lt;value>}}</code></td><td style=text-align:left><code>db.col.find({"likes":{$gt:50}})</code></td><td style=text-align:left><code>where likes > 50</code></td></tr><tr><td style=text-align:left>大于或等于</td><td style=text-align:left><code>{&lt;key>:{$gte:&lt;value>}}</code></td><td style=text-align:left><code>db.col.find({"likes":{$gte:50}})</code></td><td style=text-align:left><code>where likes >= 50</code></td></tr><tr><td style=text-align:left>不等于</td><td style=text-align:left><code>{&lt;key>:{$ne:&lt;value>}}</code></td><td style=text-align:left><code>db.col.find({"likes":{$ne:50}})</code></td><td style=text-align:left><code>where likes != 50</code></td></tr></tbody></table><ul><li>AND 条件：条件间以逗号隔开即可</li><li>OR 条件：使用关键字 <strong>$or</strong></li></ul><p>例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> status: <span class=o>{</span> <span class=nv>$in</span>: <span class=o>[</span> <span class=s2>&#34;A&#34;</span>, <span class=s2>&#34;D&#34;</span> <span class=o>]</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> status: <span class=s2>&#34;A&#34;</span>, qty: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>30</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=nv>$or</span>: <span class=o>[</span> <span class=o>{</span> status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>, <span class=o>{</span> qty: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>30</span> <span class=o>}</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>     status: <span class=s2>&#34;A&#34;</span>,
</span></span><span class=line><span class=cl>     <span class=nv>$or</span>: <span class=o>[</span> <span class=o>{</span> qty: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>30</span> <span class=o>}</span> <span class=o>}</span>, <span class=o>{</span> item: /^p/ <span class=o>}</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=type-操作符><code>$type</code> 操作符</h4><table><thead><tr><th style=text-align:left><strong>类型</strong></th><th style=text-align:left><strong>数字</strong></th><th style=text-align:left><strong>备注</strong></th></tr></thead><tbody><tr><td style=text-align:left>Double</td><td style=text-align:left>1</td><td style=text-align:left></td></tr><tr><td style=text-align:left>String</td><td style=text-align:left>2</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Object</td><td style=text-align:left>3</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Array</td><td style=text-align:left>4</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Binary data</td><td style=text-align:left>5</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Undefined</td><td style=text-align:left>6</td><td style=text-align:left>已废弃。</td></tr><tr><td style=text-align:left>Object id</td><td style=text-align:left>7</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Boolean</td><td style=text-align:left>8</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Date</td><td style=text-align:left>9</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Null</td><td style=text-align:left>10</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Regular Expression</td><td style=text-align:left>11</td><td style=text-align:left></td></tr><tr><td style=text-align:left>JavaScript</td><td style=text-align:left>13</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Symbol</td><td style=text-align:left>14</td><td style=text-align:left></td></tr><tr><td style=text-align:left>JavaScript (with scope)</td><td style=text-align:left>15</td><td style=text-align:left></td></tr><tr><td style=text-align:left>32-bit integer</td><td style=text-align:left>16</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Timestamp</td><td style=text-align:left>17</td><td style=text-align:left></td></tr><tr><td style=text-align:left>64-bit integer</td><td style=text-align:left>18</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Min key</td><td style=text-align:left>255</td><td style=text-align:left>Query with <code>-1</code>.</td></tr><tr><td style=text-align:left>Max key</td><td style=text-align:left>127</td><td style=text-align:left></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.find<span class=o>({</span><span class=s2>&#34;title&#34;</span> : <span class=o>{</span><span class=nv>$type</span> : 2<span class=o>}})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询数组>查询数组</h4><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>([</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, qty: 25, tags: <span class=o>[</span><span class=s2>&#34;blank&#34;</span>, <span class=s2>&#34;red&#34;</span><span class=o>]</span>, dim_cm: <span class=o>[</span> 14, <span class=m>21</span> <span class=o>]</span> <span class=o>}</span>, 
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;notebook&#34;</span>, qty: 50, tags: <span class=o>[</span><span class=s2>&#34;red&#34;</span>, <span class=s2>&#34;blank&#34;</span><span class=o>]</span>, dim_cm: <span class=o>[</span> 14, <span class=m>21</span> <span class=o>]</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, qty: 100, tags: <span class=o>[</span><span class=s2>&#34;red&#34;</span>, <span class=s2>&#34;blank&#34;</span>, <span class=s2>&#34;plain&#34;</span><span class=o>]</span>, dim_cm: <span class=o>[</span> 14, <span class=m>21</span> <span class=o>]</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;planner&#34;</span>, qty: 75, tags: <span class=o>[</span><span class=s2>&#34;blank&#34;</span>, <span class=s2>&#34;red&#34;</span><span class=o>]</span>, dim_cm: <span class=o>[</span> 22.85, <span class=m>30</span> <span class=o>]</span> <span class=o>}</span>,  
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;postcard&#34;</span>, qty: 45, tags: <span class=o>[</span><span class=s2>&#34;blue&#34;</span><span class=o>]</span>, dim_cm: <span class=o>[</span> 10, 15.25 <span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>])</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=查询指定数组匹配的文档>查询指定数组匹配的文档</h5><p>使用查询文档 <code>{&lt;field>：&lt;value>}</code>，其中 <code>value</code> 为要匹配的<strong>精确数组</strong>（元素顺序也要一致）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> tags: <span class=o>[</span><span class=s2>&#34;red&#34;</span>, <span class=s2>&#34;blank&#34;</span><span class=o>]</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=查询包含指定元素的数组匹配的文档>查询包含指定元素的数组匹配的文档</h5><p>此时查询数组字段是否包含<strong>至少一个</strong>具有指定值的元素</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> tags: <span class=s2>&#34;red&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> dim_cm: <span class=o>{</span> <span class=nv>$gt</span>: <span class=m>25</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=查询包含指定元素集合的数组匹配的文档>查询包含指定元素集合的数组匹配的文档</h5><p>使用 <code>$all</code> 运算符，此时无需考虑元素顺序</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> tags: <span class=o>{</span> <span class=nv>$all</span>: <span class=o>[</span><span class=s2>&#34;red&#34;</span>, <span class=s2>&#34;blank&#34;</span><span class=o>]</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=使用复合条件查询>使用复合条件查询</h5><p>下面的示例查询一个元素可以满足大于 <strong>15</strong> 的条件，而另一个元素可以满足小于 <strong>20</strong> 的条件，或者单个元素可以满足以下两个条件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> dim_cm: <span class=o>{</span> <span class=nv>$gt</span>: 15, <span class=nv>$lt</span>: <span class=m>20</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>另外，使用 <code>$elemMatch</code> 运算符可在数组的元素上指定多个条件，以使至少一个数组元素满足所有指定的条件</p><p>以下示例查询在 dim_cm 数组中包含至少一个同时大于 22 和小于 30 的元素的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> dim_cm: <span class=o>{</span> <span class=nv>$elemMatch</span>: <span class=o>{</span> <span class=nv>$gt</span>: 22, <span class=nv>$lt</span>: <span class=m>30</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=通过数组索引位置查询>通过数组索引位置查询</h5><p>使用<strong>点表示法</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;dim_cm.1&#34;</span>: <span class=o>{</span> <span class=nv>$gt</span>: <span class=m>25</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>使用点符号查询时，字段和嵌套字段必须在引号内</p></blockquote><h5 id=通过数组长度查询数组>通过数组长度查询数组</h5><p>使用 <code>$size</code> 运算符可按元素数量查询数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;tags&#34;</span>: <span class=o>{</span> <span class=nv>$size</span>: <span class=m>3</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询嵌入文档>查询嵌入文档</h4><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>(</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, qty: 25, size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;notebook&#34;</span>, qty: 50, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, qty: 100, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;planner&#34;</span>, qty: 75, size: <span class=o>{</span> h: 22.85, w: 30, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;postcard&#34;</span>, qty: 45, size: <span class=o>{</span> h: 10, w: 15.25, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>])</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=精准查询>精准查询</h5><p>请使用查询筛选文档 <code>{&lt;field>：&lt;value>}</code></p><p>例如，以下查询选择字段大小等于文档 <strong>{h：14，w：21，uom：“ cm”}</strong> 的所有文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=部分查询>部分查询</h4><p>要在嵌套文档中的字段上指定查询条件，请使用点符号（<strong>“ field.nestedField”</strong>）</p><p>以下示例选择嵌套在 <strong>size</strong> 字段中的 <strong>uom</strong> 字段等于 <strong>“in”</strong> 的所有文档：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;size.uom&#34;</span>: <span class=s2>&#34;in&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>使用点符号查询时，字段和嵌套字段必须在引号内</p></blockquote><p>以下查询在 **size **字段中嵌入的字段 h 上使用小于运算符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;size.h&#34;</span>: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>15</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>以下查询选择嵌套字段 <strong>h</strong> 小于 <strong>15</strong>，嵌套字段 <strong>uom</strong> 等于 <strong>“in”</strong>，状态字段等于 <strong>“D”</strong> 的所有文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;size.h&#34;</span>: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>15</span> <span class=o>}</span>, <span class=s2>&#34;size.uom&#34;</span>: <span class=s2>&#34;in&#34;</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询嵌入式文档数组>查询嵌入式文档数组</h4><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>(</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;A&#34;</span>, qty: <span class=m>5</span> <span class=o>}</span>, <span class=o>{</span> warehouse: <span class=s2>&#34;C&#34;</span>, qty: <span class=m>15</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>,  
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;notebook&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;C&#34;</span>, qty: <span class=m>5</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;A&#34;</span>, qty: <span class=m>60</span> <span class=o>}</span>, <span class=o>{</span> warehouse: <span class=s2>&#34;B&#34;</span>, qty: <span class=m>15</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;planner&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;A&#34;</span>, qty: <span class=m>40</span> <span class=o>}</span>, <span class=o>{</span> warehouse: <span class=s2>&#34;B&#34;</span>, qty: <span class=m>5</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>, 
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;postcard&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;B&#34;</span>, qty: <span class=m>15</span> <span class=o>}</span>, <span class=o>{</span> warehouse: <span class=s2>&#34;C&#34;</span>, qty: <span class=m>35</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>])</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=查询指定数组所属文档>查询指定数组所属文档</h5><p>下面的示例选择<strong>包含指定元素</strong>的数组所属的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;instock&#34;</span>: <span class=o>{</span> warehouse: <span class=s2>&#34;A&#34;</span>, qty: <span class=m>5</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>字段顺序也要匹配！</p></blockquote><h5 id=在数组的字段上指定查询条件>在数组的字段上指定查询条件</h5><p>如果<strong>不知道嵌套在数组中的文档的索引位置</strong>，使用点 <code>.</code> 和嵌套文档中的字段名称（称为点表示法）来连接数组字段的名称。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s1>&#39;instock.qty&#39;</span>: <span class=o>{</span> <span class=nv>$lte</span>: <span class=m>20</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>使用点表示法查询时，字段和索引必须在引号内</p></blockquote><h5 id=使用数组索引来查询字段>使用数组索引来查询字段</h5><p>下面的例子选择了所有 <strong>instock</strong> 数组的第一个元素是一个包含值小于或等于 <strong>20</strong> 的字段 <strong>qty</strong> 的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s1>&#39;instock.0.qty&#39;</span>: <span class=o>{</span> <span class=nv>$lte</span>: <span class=m>20</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=为数组指定多个条件>为数组指定多个条件</h5><p>使用 <code>$elemMatch</code> 运算符可在一组嵌入式文档上指定多个条件，以使至少一个嵌入式文档满足所有指定条件。</p><p>下面的示例查询 <strong>instock</strong> 数组中至少有一个嵌入式文档的文档，包含数量等于 5 的字段和数量等于 A 的字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;instock&#34;</span>: <span class=o>{</span> <span class=nv>$elemMatch</span>: <span class=o>{</span> qty: 5, warehouse: <span class=s2>&#34;A&#34;</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>下面的示例查询 <strong>instock</strong> 数组中至少有一个嵌入式文档的文档，该嵌入式文档的 <strong>qty</strong> 字段大于 10 且小于或等于 20 的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;instock&#34;</span>: <span class=o>{</span> <span class=nv>$elemMatch</span>: <span class=o>{</span> qty: <span class=o>{</span> <span class=nv>$gt</span>: 10, <span class=nv>$lte</span>: <span class=m>20</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=元素组合满足标准>元素组合满足标准</h5><p>如果数组字段上的复合查询条件未使用 <code>$elemMatch</code> 运算符，则查询将选择其数组包含满足条件的元素的<strong>任意组合</strong>的那些文档</p><p>下面的示例查询在 <strong>instock</strong> 阵列中的任何文档的数量字段大于 10，并且阵列中任何文档的数量字段小于或等于 20 的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;instock.qty&#34;</span>: <span class=o>{</span> <span class=nv>$gt</span>: 10,  <span class=nv>$lte</span>: <span class=m>20</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>下面的示例查询在 <strong>instock</strong> 数组中至少有一个包含数量等于 <strong>5</strong> 的嵌入式文档和至少一有个包含等于 <strong>A</strong> 的字段仓库的嵌入式文档的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> <span class=s2>&#34;instock.qty&#34;</span>: 5, <span class=s2>&#34;instock.warehouse&#34;</span>: <span class=s2>&#34;A&#34;</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询空字段或缺少字段>查询空字段或缺少字段</h4><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>([</span>
</span></span><span class=line><span class=cl>   <span class=o>{</span> _id: 1, item: null <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> _id: <span class=m>2</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>])</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=平等过滤器>平等过滤器</h5><p><strong>{item：null}</strong> 查询匹配包含值是 <strong>null</strong> 的 <strong>item</strong> 字段或不包含 <strong>item</strong> 字段的文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> item: null <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=类型检查>类型检查</h5><p>{<strong>item：{$ type：10}</strong>} 查询只匹配包含 <strong>item</strong> 字段值为 <strong>null</strong> 的文档；</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> item : <span class=o>{</span> <span class=nv>$type</span>: <span class=m>10</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=存在检查>存在检查</h5><p>{<strong>item：{$ exists：false}</strong>} 查询与不包含 <strong>item</strong> 字段的文档匹配</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.find<span class=o>(</span> <span class=o>{</span> item : <span class=o>{</span> <span class=nv>$exists</span>: <span class=nb>false</span> <span class=o>}</span> <span class=o>}</span> <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=更新>更新</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.updateOne<span class=o>(</span>&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;<span class=sb>`</span><span class=o>)</span>
</span></span><span class=line><span class=cl>db.collection.updateMany<span class=o>(</span>&lt;filter&gt;, &lt;update&gt;,&lt;options&gt;<span class=sb>`</span><span class=o>)</span>
</span></span><span class=line><span class=cl>db.collection.replaceOne<span class=o>(</span>&lt;filter&gt;, &lt;update&gt;, guo<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>有例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.insertMany<span class=o>(</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;canvas&#34;</span>, qty: 100, size: <span class=o>{</span> h: 28, w: 35.5, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;journal&#34;</span>, qty: 25, size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;mat&#34;</span>, qty: 85, size: <span class=o>{</span> h: 27.9, w: 35.5, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;mousepad&#34;</span>, qty: 25, size: <span class=o>{</span> h: 19, w: 22.85, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;P&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;notebook&#34;</span>, qty: 50, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;P&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, qty: 100, size: <span class=o>{</span> h: 8.5, w: 11, uom: <span class=s2>&#34;in&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;planner&#34;</span>, qty: 75, size: <span class=o>{</span> h: 22.85, w: 30, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;D&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;postcard&#34;</span>, qty: 45, size: <span class=o>{</span> h: 10, w: 15.25, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;sketchbook&#34;</span>, qty: 80, size: <span class=o>{</span> h: 14, w: 21, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;sketch pad&#34;</span>, qty: 95, size: <span class=o>{</span> h: 22.85, w: 30.5, uom: <span class=s2>&#34;cm&#34;</span> <span class=o>}</span>, status: <span class=s2>&#34;A&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span> <span class=o>)</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=更新单个文档>更新单个文档</h4><p><em><strong>db.inventory.updateOne()</strong></em></p><p>下面的示例下面的示例在 <strong>inventory</strong> 集合上更新项目等于 “<strong>paper</strong>” 的<strong>第一个</strong>文档</p><ul><li>使用 <code>$set</code> 运算符将 <strong>size.uom</strong> 字段的值更新为 “<strong>cm</strong>”，将状态字段的值更新为 “<strong>P</strong>”，</li><li>使用 <code>$currentDate</code> 运算符将 <strong>lastModified</strong> 字段的值更新为当前日期。 如果 <strong>lastModified</strong> 字段不存在，则 <code>$currentDate</code> 将创建该字段。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.updateOne<span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$set</span>: <span class=o>{</span> <span class=s2>&#34;size.uom&#34;</span>: <span class=s2>&#34;cm&#34;</span>, status: <span class=s2>&#34;P&#34;</span> <span class=o>}</span>, 
</span></span><span class=line><span class=cl>        <span class=nv>$currentDate</span>: <span class=o>{</span> lastModified: <span class=nb>true</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=更新多个文档>更新多个文档</h4><p><em><strong>db.inventory.updateMany()</strong></em></p><p>以下示例更新数量小于 50 的所有文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>  db.inventory.updateMany<span class=o>(</span> 
</span></span><span class=line><span class=cl>      <span class=o>{</span> <span class=s2>&#34;qty&#34;</span>: <span class=o>{</span> <span class=nv>$lt</span>: <span class=m>50</span> <span class=o>}</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>      <span class=o>{</span>  
</span></span><span class=line><span class=cl>          <span class=nv>$set</span>: <span class=o>{</span> <span class=s2>&#34;size.uom&#34;</span>: <span class=s2>&#34;in&#34;</span>, status: <span class=s2>&#34;P&#34;</span> <span class=o>}</span>, 
</span></span><span class=line><span class=cl>          <span class=nv>$currentDate</span>: <span class=o>{</span> lastModified: <span class=nb>true</span> <span class=o>}</span>  
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=更换整个文档>更换整个文档</h4><p>要替换 <strong>_id</strong> 字段以外的文档的全部内容，将一个全新的文档作为第二参数传递给 <code>db.collection.replaceOne()</code></p><p>当替换一个文档时，替换文档必须只包含字段 / 值对，即不包括更新操作符表达式</p><p>下面的示例替换了 <strong>inventory</strong> 集合中的第一个文件，其中项为 <strong>&ldquo;paper&rdquo;</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.inventory.replaceOne<span class=o>(</span>
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span> item: <span class=s2>&#34;paper&#34;</span>, instock: <span class=o>[</span> <span class=o>{</span> warehouse: <span class=s2>&#34;A&#34;</span>, qty: <span class=m>60</span> <span class=o>}</span>, <span class=o>{</span> warehouse: <span class=s2>&#34;B&#34;</span>, qty: <span class=m>40</span> <span class=o>}</span> <span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pymongo>PyMongo</h2><h3 id=连接>连接</h3><h4 id=连接数据库>连接数据库</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pymongo</span>  
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>MongoClient</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>27017</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>MongoClient</span><span class=p>(</span><span class=s1>&#39;mongodb://localhost:27017/&#39;</span><span class=p>)</span> 
</span></span></code></pre></td></tr></table></div></div><p>有密码连接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pymongo</span>
</span></span><span class=line><span class=cl><span class=n>mongo_client</span> <span class=o>=</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>MongoClient</span><span class=p>(</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span> <span class=mi>26666</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>mongo_auth</span> <span class=o>=</span> <span class=n>mongo_client</span><span class=o>.</span><span class=n>admin</span> <span class=c1># admin 为 authenticationDatabase</span>
</span></span><span class=line><span class=cl><span class=c1># or mongo_client[&#39;admin&#39;] </span>
</span></span><span class=line><span class=cl><span class=n>mongo_auth</span><span class=o>.</span><span class=n>authenticate</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>判断是否连接成功：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>mongo_client</span><span class=o>.</span><span class=n>server_info</span><span class=p>())</span> <span class=c1># 判断是否连接成功</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取-database-和-collection>获取 Database 和 Collection</h4><p>如果没有会自动创建</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mongo_db</span> <span class=o>=</span> <span class=n>mongo_client</span><span class=p>[</span><span class=s1>&#39;db_name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span> <span class=o>=</span> <span class=n>mongo_db</span><span class=p>[</span><span class=s1>&#39;your_collection&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=n>mongo_db</span> <span class=o>=</span> <span class=n>mongo_client</span><span class=o>.</span><span class=n>db_name</span>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span> <span class=o>=</span> <span class=n>mongo_db</span><span class=o>.</span><span class=n>your_collection</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=插入-1>插入</h3><h4 id=插入单条数据>插入单条数据</h4><p><em><strong>insert_one()</strong></em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=n>info</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;Inserting a Document&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span> <span class=p>:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span> <span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>insert_one</span><span class=p>(</span><span class=n>info</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=插入多条数据>插入多条数据</h4><p><em><strong>insert_many()</strong></em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=n>info_1</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;Inserting a Document&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span> <span class=p>:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span> <span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>info_2</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;Inserting a Document&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span> <span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span> <span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>insert_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>info_1</span><span class=p>,</span> <span class=n>info_2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>insert_many</span><span class=p>(</span><span class=n>insert_list</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>插入字符串时间时，mongodb 自动将其转成了 ISOdate 类型，若需要时间在 mongdb 也是字符串类型，只需这样操作即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=删除-2>删除</h3><h4 id=删除单条数据>删除单条数据</h4><p><em><strong>delete_one()</strong></em></p><p>若删除条件相同匹配到多条数据，默认删除第一条</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>delete_one</span><span class=p>({</span><span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;a&#39;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=删除多条数据>删除多条数据</h4><p><em><strong>delete_many()</strong></em></p><p>删除满足条件的所有数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>delete_many</span><span class=p>({</span><span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;a&#39;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=更新-1>更新</h3><h4 id=更新单条数据>更新单条数据</h4><p><em><strong>update_one(filter,update,upsert=False)</strong></em></p><p>更新满足条件的第一条数据</p><ul><li>filter：更新的条件</li><li>update ： 更新的内容，必须用 <code>$</code> 操作符</li><li>upsert ： 默认 False。若为 True，更新条件没找到的情况会插入更新的内容</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>info</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;桃子 &#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span><span class=p>:</span> <span class=s1>&#39;peach&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>update_condition</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_2&#39;</span><span class=p>}</span> <span class=c1># 更新的条件，也可以为多个条件</span>
</span></span><span class=line><span class=cl><span class=c1># 更新条件多个时，需要同时满足时才会更新</span>
</span></span><span class=line><span class=cl><span class=c1># update_condition = {&#39;name&#39; : &#39;Pear&#39;,</span>
</span></span><span class=line><span class=cl><span class=c1>#                     &#39;text&#39; : &#39;梨子&#39;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>update_one</span><span class=p>(</span><span class=n>update_condition</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;$set&#39;</span> <span class=p>:</span> <span class=n>info</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=更新多条数据>更新多条数据</h4><p><em><strong>update_many(filter,update,upsert=False)</strong></em></p><ul><li>filter：更新的条件</li><li>update ： 更新的内容，必须用 <code>$</code> 操作符</li><li>upsert ： 默认 False。若为 True，更新条件没找到的情况会插入更新的内容</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>info</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Zarten&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span><span class=p>:</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>update_condition</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;a&#39;</span><span class=p>}</span> <span class=c1># 更新的条件</span>
</span></span><span class=line><span class=cl><span class=c1># 更新条件多个时，需要同时满足时才会更新</span>
</span></span><span class=line><span class=cl><span class=c1># update_condition = {&#39;name&#39; : &#39;Pear&#39;,</span>
</span></span><span class=line><span class=cl><span class=c1>#                     &#39;text&#39; : &#39;梨子&#39;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>update_many</span><span class=p>(</span><span class=n>update_condition</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;$set&#39;</span> <span class=p>:</span> <span class=n>info</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=查询-1>查询</h3><h4 id=查询一条数据>查询一条数据</h4><p><em><strong>find_one()</strong></em></p><p>匹配第一条满足的条件的结果，这条结果以 <code>dict</code> 字典形式返回，若没有查询到，则返回 <code>None</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Banana&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;peach&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>find_result</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>可以通过 <code>projection</code> 参数来指定需要查询的字段，包括是否显示 <code>_id</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>select_item</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span><span class=n>find_condition</span><span class=p>,</span> <span class=n>projection</span><span class=o>=</span> <span class=p>{</span><span class=s1>&#39;_id&#39;</span><span class=p>:</span><span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span><span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;num&#39;</span><span class=p>:</span><span class=kc>True</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>select_item</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>可以指定查询范围</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;date&#39;</span> <span class=p>:</span> <span class=p>{</span><span class=s1>&#39;$gte&#39;</span><span class=p>:</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2018</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span> <span class=s1>&#39;$lt&#39;</span><span class=p>:</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2018</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>3</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>select_item</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>select_item</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询多条数据>查询多条数据</h4><p><em><strong>find()</strong></em></p><p>返回满足条件的所有结果，返回类型为 <code>Cursor</code> ，通过迭代获取每个查询结果，每个结果类型为 <code>dict</code> 字典</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Banana&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span> <span class=p>:</span> <span class=s1>&#39;香蕉&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>find_result_cursor</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>find_result</span> <span class=ow>in</span> <span class=n>find_result_cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>find_result</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>插入文档时会返回一个 <code>_id</code> ，是 <code>ObjectId</code> 类型，可以通过它来查询</p><p>若 <code>_id</code> 提供的是 <code>str</code> 类型的，我们需要转成 <code>ObjectId</code> 类型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bson.objectid</span> <span class=kn>import</span> <span class=n>ObjectId</span>
</span></span><span class=line><span class=cl><span class=n>query_id_str</span> <span class=o>=</span> <span class=s1>&#39;5c00f60b20b531196c02d657&#39;</span>
</span></span><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;_id&#39;</span> <span class=p>:</span> <span class=n>ObjectId</span><span class=p>(</span><span class=n>query_id_str</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>find_result</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>find_result</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查询一条数据同时删除>查询一条数据同时删除</h4><p><em><strong>find_one_and_delete( filter,projection=None,sort=None )</strong></em></p><ul><li>filter：查询条件</li><li>projection：选择返回和不返回的字段</li><li>sort：<code>list</code> 类型，当查询匹配到多条数据时，根据某个条件排序，函数返回时返回第一条数据</li></ul><p>以字典形式返回被删除的信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Banana&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>deleted_item</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one_and_delete</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>deleted_item</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>有选择地返回某条数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>deleted_item</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>find_one_and_delete</span><span class=p>(</span><span class=n>find_condition</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span> <span class=p>[(</span><span class=s1>&#39;num&#39;</span><span class=p>,</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>DESCENDING</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>deleted_item</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=排序>排序</h4><p><em><strong>find().sort().skip().limit()</strong></em></p><p>直接调用 <code>sort()</code> 方法，并在其中传入排序的字段及升降序标志</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>ASCENDING</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>([</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>])</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 偏移2，即忽略前两个元素，得到第三个及以后的元素</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>ASCENDING</span><span class=p>)</span><span class=o>.</span><span class=n>skip</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>([</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>])</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 用limit()方法指定要取的结果个数</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>ASCENDING</span><span class=p>)</span><span class=o>.</span><span class=n>skip</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>([</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>])</span> 
</span></span></code></pre></td></tr></table></div></div><h3 id=其他操作>其他操作</h3><h4 id=计数>计数</h4><p><em><strong>count_documents()</strong></em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>find_condition</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=p>:</span> <span class=s1>&#39;Zarten_1&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>select_count</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>count_documents</span><span class=p>(</span><span class=n>find_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>select_count</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取索引信息>获取索引信息</h4><p><em><strong>list_indexes()</strong></em></p><p><em><strong>index_information()</strong></em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># list_indexs = mongo_collection.list_indexes()</span>
</span></span><span class=line><span class=cl><span class=c1># for index in list_indexs:</span>
</span></span><span class=line><span class=cl><span class=c1>#     print(index)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index_info</span> <span class=o>=</span> <span class=n>mongo_collection</span><span class=o>.</span><span class=n>index_information</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>index_info</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=删除集合-1>删除集合</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mongo_collection</span><span class=o>.</span><span class=n>drop</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查看数据库下的所有集合名>查看数据库下的所有集合名</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>collection_names</span><span class=p>()</span> 
</span></span></code></pre></td></tr></table></div></div><h3 id=常用操作>常用操作</h3><p><strong>根据 <code>_id</code> 查询数据插入时间排序</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>col</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=s1>&#39;_id&#39;</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 根据插入时间降序</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根据 <code>_id</code> 查询某个日期插入的数据</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 查询今天插入的所有数据</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bson.objectid</span> <span class=kn>import</span> <span class=n>ObjectId</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>today_zero</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span> <span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>dummy_id</span> <span class=o>=</span> <span class=n>ObjectId</span><span class=o>.</span><span class=n>from_datetime</span><span class=p>(</span><span class=n>today_zero</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>col</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&#34;_id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;$gte&#34;</span><span class=p>:</span> <span class=n>dummy_id</span><span class=p>}})</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查询15天前的那天日期的所有插入数据</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bson.objectid</span> <span class=kn>import</span> <span class=n>ObjectId</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_day_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span> <span class=o>-</span> <span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_day_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span> <span class=o>-</span> <span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_day_zero</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>start_day_time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span> <span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_day_zero</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>end_day_time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span> <span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_dummy_id</span> <span class=o>=</span> <span class=n>ObjectId</span><span class=o>.</span><span class=n>from_datetime</span><span class=p>(</span><span class=n>start_day_zero</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_dummy_id</span> <span class=o>=</span> <span class=n>ObjectId</span><span class=o>.</span><span class=n>from_datetime</span><span class=p>(</span><span class=n>end_day_zero</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results_count</span> <span class=o>=</span> <span class=n>col</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&#34;_id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;$gte&#34;</span><span class=p>:</span> <span class=n>start_dummy_id</span><span class=p>,</span><span class=s2>&#34;$lte&#34;</span><span class=p>:</span><span class=n>end_dummy_id</span><span class=p>}})</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>results_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查询昨天插入数据</span>
</span></span><span class=line><span class=cl><span class=n>start_day_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span> <span class=o>-</span> <span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_day_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span> <span class=o>-</span> <span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_day_zero</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>start_day_time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span> <span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_day_zero</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>end_day_time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span> <span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_dummy_id</span> <span class=o>=</span> <span class=n>ObjectId</span><span class=o>.</span><span class=n>from_datetime</span><span class=p>(</span><span class=n>start_day_zero</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>end_dummy_id</span> <span class=o>=</span> <span class=n>ObjectId</span><span class=o>.</span><span class=n>from_datetime</span><span class=p>(</span><span class=n>end_day_zero</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results_count</span> <span class=o>=</span> <span class=n>col</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&#34;_id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;$gte&#34;</span><span class=p>:</span> <span class=n>start_dummy_id</span><span class=p>,</span><span class=s2>&#34;$lte&#34;</span><span class=p>:</span><span class=n>end_dummy_id</span><span class=p>}})</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>results_count</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=未归档>未归档</h2><h3 id=mongodump-和-mongorestore>mongodump 和 mongorestore</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mongodump --uri<span class=o>=</span><span class=s2>&#34;mongodb+srv://&lt;username&gt;:&lt;password&gt;@&lt;host:ip&gt;/&lt;dbname&gt;&#34;</span> -o &lt;output dir name&gt; --authenticationDatabase admin
</span></span></code></pre></td></tr></table></div></div><p><code>+srv</code> 适用于需要 srv 认证的域名，没有的话就省去</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mongorestore --uri<span class=o>=</span><span class=s2>&#34;mongodb://&lt;username&gt;:&lt;password&gt;@&lt;host:ip&gt;/&lt;dbname&gt;&#34;</span> &lt;output dir name/dbname&gt; --authenticationDatabase admin
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-11-26 05:25:16">更新于 2022-11-26</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/database/mongodb/ data-title=MongoDB data-hashtags=数据库,快速入门><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/database/mongodb/ data-hashtag=数据库><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/database/mongodb/ data-title=MongoDB><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>,&nbsp;<a href=/Notes/tags/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/>快速入门</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/%E5%B7%A5%E5%85%B7/protobuf/ class=prev rel=prev title=protobuf><i class="fa-solid fa-angle-left fa-fw"></i>protobuf</a>
<a href=/Notes/posts/python/crawler/regularexpression/ class=next rel=next title=正则表达式>正则表达式<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>