<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>关于 MySQL 的一些笔记 - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="MySQL 学习笔记 登录和退出 MySQL 服务器 1 2 3 4 5 6 7 8 # 登录MySQL mysql -u [username] -p[password] # 远程连接 mysql"><meta name=keywords content="数据库,快速入门,MySQL"><meta itemprop=name content="关于 MySQL 的一些笔记"><meta itemprop=description content="MySQL 学习笔记 登录和退出 MySQL 服务器 1 2 3 4 5 6 7 8 # 登录MySQL mysql -u [username] -p[password] # 远程连接 mysql"><meta itemprop=datePublished content="2021-12-23T00:00:00+00:00"><meta itemprop=dateModified content="2022-08-31T15:21:18+00:00"><meta itemprop=wordCount content="34663"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="数据库,快速入门,MySQL,"><meta property="og:title" content="关于 MySQL 的一些笔记"><meta property="og:description" content="MySQL 学习笔记 登录和退出 MySQL 服务器 1 2 3 4 5 6 7 8 # 登录MySQL mysql -u [username] -p[password] # 远程连接 mysql"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/database/mysql/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-31T15:21:18+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="关于 MySQL 的一些笔记"><meta name=twitter:description content="MySQL 学习笔记 登录和退出 MySQL 服务器 1 2 3 4 5 6 7 8 # 登录MySQL mysql -u [username] -p[password] # 远程连接 mysql"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/database/mysql/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/python/crawler/beautifulsoup4/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/python/basicgrammar/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"关于 MySQL 的一些笔记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/database\/mysql\/"},"genre":"posts","keywords":"数据库, 快速入门, MySQL","wordcount":34663,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/database\/mysql\/","datePublished":"2021-12-23T00:00:00+00:00","dateModified":"2022-08-31T15:21:18+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>关于 MySQL 的一些笔记</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;数据库</a></span></div><div class=post-meta-line><span title="2021-12-23 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-12-23>2021-12-23</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 34663 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 70 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#登录和退出-mysql-服务器>登录和退出 MySQL 服务器</a></li><li><a href=#基本语法>基本语法</a></li><li><a href=#建表约束>建表约束</a><ul><li><a href=#主键约束>主键约束</a></li><li><a href=#唯一约束>唯一约束</a></li><li><a href=#非空约束>非空约束</a></li><li><a href=#默认约束>默认约束</a></li><li><a href=#外键约束>外键约束</a></li></ul></li><li><a href=#数据库的三大设计范式>数据库的三大设计范式</a><ul><li><a href=#1nf>1NF</a></li><li><a href=#2nf>2NF</a></li><li><a href=#3nf>3NF</a></li></ul></li><li><a href=#查询练习>查询练习</a><ul><li><a href=#准备数据>准备数据</a></li><li><a href=#1-到-10>1 到 10</a></li><li><a href=#分组计算平均成绩>分组计算平均成绩</a></li><li><a href=#分组条件与模糊查询>分组条件与模糊查询</a></li><li><a href=#多表查询---1>多表查询 - 1</a></li><li><a href=#多表查询---2>多表查询 - 2</a></li><li><a href=#三表关联查询>三表关联查询</a></li><li><a href=#子查询加分组求平均分>子查询加分组求平均分</a></li><li><a href=#子查询---1>子查询 - 1</a></li><li><a href=#子查询---2>子查询 - 2</a></li><li><a href=#year-函数与带-in-关键字查询>YEAR 函数与带 IN 关键字查询</a></li><li><a href=#多层嵌套子查询>多层嵌套子查询</a></li><li><a href=#多表查询>多表查询</a></li><li><a href=#子查询---3>子查询 - 3</a></li><li><a href=#union-和-notin-的使用>UNION 和 NOTIN 的使用</a></li><li><a href=#any-表示至少一个---desc--降序->ANY 表示至少一个 - DESC ( 降序 )</a></li><li><a href=#表示所有的-all>表示所有的 ALL</a></li><li><a href=#复制表的数据作为条件查询>复制表的数据作为条件查询</a></li><li><a href=#子查询---4>子查询 - 4</a></li><li><a href=#条件加组筛选>条件加组筛选</a></li><li><a href=#notlike-模糊查询取反>NOTLIKE 模糊查询取反</a></li><li><a href=#year-与-now-函数>YEAR 与 NOW 函数</a></li><li><a href=#max-与-min-函数>MAX 与 MIN 函数</a></li><li><a href=#多段排序>多段排序</a></li><li><a href=#子查询---5>子查询 - 5</a></li><li><a href=#max-函数与子查询>MAX 函数与子查询</a></li><li><a href=#子查询---6>子查询 - 6</a></li><li><a href=#子查询---7>子查询 - 7</a></li><li><a href=#子查询---8>子查询 - 8</a></li><li><a href=#按等级查询>按等级查询</a></li><li><a href=#连接查询>连接查询</a><ul><li><a href=#内连接>内连接</a></li><li><a href=#左外连接>左外连接</a></li><li><a href=#右外链接>右外链接</a></li><li><a href=#全外链接>全外链接</a></li></ul></li></ul></li><li><a href=#事务>事务</a><ul><li><a href=#如何控制事务---commit--rollback>如何控制事务 - COMMIT / ROLLBACK</a></li><li><a href=#手动开启事务---begin--start-transaction>手动开启事务 - BEGIN / START TRANSACTION</a></li><li><a href=#事务的-acid-特征与使用>事务的 ACID 特征与使用</a></li><li><a href=#事务的隔离性>事务的隔离性</a><ul><li><a href=#脏读>脏读</a></li><li><a href=#读取已提交>读取已提交</a></li><li><a href=#幻读>幻读</a></li><li><a href=#串行化>串行化</a></li></ul></li></ul></li><li><a href=#索引>索引</a><ul><li><a href=#索引的优缺点>索引的优缺点</a></li><li><a href=#什么情况下需要建索引>什么情况下需要建索引</a></li><li><a href=#什么情况下不建索引>什么情况下不建索引</a></li><li><a href=#索引的数据结构>索引的数据结构</a><ul><li><a href=#b-树索引>B+ 树索引</a></li><li><a href=#哈希索引>哈希索引</a></li><li><a href=#hash-索引和-b-树索引的区别>Hash 索引和 B+ 树索引的区别？</a></li><li><a href=#为什么-b-树比-b-树更适合实现数据库索引>为什么 B+ 树比 B 树更适合实现数据库索引？</a></li></ul></li><li><a href=#索引的类型>索引的类型</a></li><li><a href=#索引的设计原则>索引的设计原则</a></li><li><a href=#索引什么时候会失效>索引什么时候会失效</a></li><li><a href=#索引的相关操作>索引的相关操作</a><ul><li><a href=#索引的创建><strong>索引的创建</strong></a><ul><li><a href=#alter-table><code>ALTER TABLE</code></a></li><li><a href=#create-index><code>CREATE INDEX</code></a></li></ul></li><li><a href=#索引的删除>索引的删除</a></li><li><a href=#索引的查看>索引的查看</a></li><li><a href=#索引的更改>索引的更改</a></li></ul></li><li><a href=#组合索引>组合索引</a><ul><li><a href=#最左匹配原则>最左匹配原则</a><ul><li><a href=#范围查询后停止匹配>范围查询后停止匹配</a></li><li><a href=#例>例</a></li></ul></li></ul></li><li><a href=#聚集索引>聚集索引</a></li><li><a href=#覆盖索引>覆盖索引</a><ul><li><a href=#语法>语法</a></li></ul></li><li><a href=#前缀索引><strong>前缀索引</strong></a></li></ul></li><li><a href=#常见的存储引擎>常见的存储引擎</a><ul><li><a href=#innodb-存储引擎>InnoDB 存储引擎</a></li><li><a href=#myisam-存储引擎>MyISAM 存储引擎</a></li><li><a href=#memory-存储引擎>MEMORY 存储引擎</a></li><li><a href=#archive-存储引擎>ARCHIVE 存储引擎</a></li><li><a href=#myisam-和-innodb-的区别>MyISAM 和 InnoDB 的区别</a></li></ul></li><li><a href=#mvcc>MVCC</a><ul><li><a href=#innodb-与-mvcc>InnoDB 与 MVCC</a></li><li><a href=#mvcc-实现原理>MVCC 实现原理</a><ul><li><a href=#版本链>版本链</a></li></ul></li><li><a href=#read-view-快照>read view 快照</a><ul><li><a href=#read-view-的记录筛选方式>read view 的记录筛选方式</a></li></ul></li><li><a href=#举例>举例</a></li></ul></li><li><a href=#快照读和当前读>快照读和当前读</a></li><li><a href=#锁机制>锁机制</a><ul><li><a href=#数据库锁与隔离级别的关系>数据库锁与隔离级别的关系、</a></li><li><a href=#数据库锁的类型>数据库锁的类型</a></li><li><a href=#innodb-的行锁实现>InnoDB 的行锁实现</a></li></ul></li><li><a href=#bin-log--redo-log--undo-log>bin log / redo log / undo log</a><ul><li><a href=#bin-log><strong>bin log</strong></a></li><li><a href=#redo-log><strong>redo log</strong></a></li><li><a href=#undo-log><strong>undo log</strong></a></li><li><a href=#bin-log-和-redo-log-有什么区别>bin log 和 redo log 有什么区别？</a></li></ul></li><li><a href=#mysql-架构>MySQL 架构</a></li><li><a href=#分库分表>分库分表</a><ul><li><a href=#两种方式>两种方式</a><ul><li><a href=#垂直划分>垂直划分</a></li><li><a href=#水平划分>水平划分</a></li></ul></li><li><a href=#分区表>分区表</a></li><li><a href=#分区表类型>分区表类型</a><ul><li><a href=#range-分区>range 分区</a></li><li><a href=#list-分区>list 分区</a></li><li><a href=#hash-分区>hash 分区</a></li></ul></li><li><a href=#分区的问题>分区的问题</a></li></ul></li><li><a href=#主从同步>主从同步</a><ul><li><a href=#定义>定义</a><ul><li><a href=#什么是主从同步>什么是主从同步</a></li><li><a href=#为什么要做主从同步>为什么要做主从同步</a></li><li><a href=#读写分离>读写分离</a></li></ul></li><li><a href=#主从复制的实现>主从复制的实现</a></li><li><a href=#乐观锁和悲观锁>乐观锁和悲观锁</a></li></ul></li><li><a href=#其他八股>其他八股</a><ul><li><a href=#事务的四大特性-acid>事务的四大特性 ACID</a></li><li><a href=#数据库的三大范式>数据库的三大范式</a></li><li><a href=#事务隔离级别>事务隔离级别</a></li><li><a href=#生产环境数据库一般用的什么隔离级别>生产环境数据库一般用的什么隔离级别</a></li><li><a href=#查询语句执行流程>查询语句执行流程</a></li><li><a href=#更新语句执行过程>更新语句执行过程</a></li><li><a href=#exist-和-in-的区别>exist 和 in 的区别</a></li><li><a href=#mysql-中-int10-和-char10-的区别>MySQL 中 int(10) 和 char(10) 的区别</a></li><li><a href=#truncatedelete-与-drop-区别>truncate、delete 与 drop 区别？</a></li><li><a href=#having-和-where区别>having 和 where区别？</a></li><li><a href=#查询-limit-100010-和-limit-10-速度一样快吗>查询 <code>limit 1000,10</code> 和 <code>limit 10</code> 速度一样快吗？</a></li><li><a href=#深分页怎么优化>深分页怎么优化？</a></li><li><a href=#高度为-3-的-b-树可以存放多少数据>高度为 3 的 B+ 树，可以存放多少数据</a></li><li><a href=#单表多大进行分库分表>单表多大进行分库分表</a></li><li><a href=#大表查询慢怎么优化>大表查询慢怎么优化</a></li><li><a href=#什么是临时表>什么是临时表</a></li><li><a href=#主键一般用自增-id-还是-uuid>主键一般用自增 ID 还是 UUID</a></li><li><a href=#字段为什么要设置成-not-null>字段为什么要设置成 not null</a></li><li><a href=#如何优化-where-子句>如何优化 WHERE 子句</a></li><li><a href=#sql-语句的执行顺序>SQL 语句的执行顺序</a></li><li><a href=#分库分表后id-键如何处理>分库分表后，ID 键如何处理</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=mysql-学习笔记>MySQL 学习笔记</h1><h2 id=登录和退出-mysql-服务器>登录和退出 MySQL 服务器</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 登录MySQL</span>
</span></span><span class=line><span class=cl>mysql -u <span class=o>[</span>username<span class=o>]</span> -p<span class=o>[</span>password<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 远程连接</span>
</span></span><span class=line><span class=cl>mysql -h <span class=o>[</span>host<span class=o>]</span> -P <span class=o>[</span>port<span class=o>]</span> -u <span class=o>[</span>username<span class=o>]</span> -p<span class=o>[</span>password<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 退出MySQL数据库服务器</span>
</span></span><span class=line><span class=cl>exit<span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=基本语法>基本语法</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 显示所有数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=k>databases</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 切换数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>use</span><span class=w> </span><span class=n>test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 显示数据库中的所有表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=kp>tables</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建数据表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>pet</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>owner</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>species</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sex</span><span class=w> </span><span class=kt>CHAR</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>birth</span><span class=w> </span><span class=kt>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>death</span><span class=w> </span><span class=kt>DATE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查看数据表结构
</span></span></span><span class=line><span class=cl><span class=c1>-- describe pet;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>desc</span><span class=w> </span><span class=n>pet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>pet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>pet</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;puffball&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Diane&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hamster&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1990-03-30&#39;</span><span class=p>,</span><span class=w> </span><span class=no>NULL</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 修改数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>pet</span><span class=w> </span><span class=kt>SET</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;squirrel&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>owner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Diane&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 删除数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pet</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;squirrel&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 删除表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>myorder</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=建表约束>建表约束</h2><h3 id=主键约束>主键约束</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 主键约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 使某个字段不重复且不得为空，确保表内所有数据的唯一性。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 联合主键
</span></span></span><span class=line><span class=cl><span class=c1>-- 联合主键中的每个字段都不能为空，并且加起来不能和已设置的联合主键重复。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>password</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 自增约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 自增约束的主键由系统自动递增分配。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=kp>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加主键约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 如果忘记设置主键，还可以通过SQL语句设置（两种方式）：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>MODIFY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 删除主键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=唯一约束>唯一约束</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 建表时创建唯一约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UNIQUE</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加唯一约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 如果建表时没有设置唯一约束，还可以通过SQL语句设置（两种方式）：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>MODIFY</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 删除唯一约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=非空约束>非空约束</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 建表时添加非空约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 约束某个字段不能为空
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 移除非空约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>MODIFY</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=默认约束>默认约束</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 建表时添加默认约束
</span></span></span><span class=line><span class=cl><span class=c1>-- 约束某个字段的默认值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>user2</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>age</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 移除非空约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>MODIFY</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=kt>INT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=外键约束>外键约束</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 班级
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>classes</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 学生表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>students</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 这里的 class_id 要和 classes 中的 id 字段相关联
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>class_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 表示 class_id 的值必须来自于 classes 中的 id 字段值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>class_id</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=nf>classes</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 1. 主表（父表）classes 中没有的数据值，在副表（子表）students 中，是不可以使用的；
</span></span></span><span class=line><span class=cl><span class=c1>-- 2. 主表中的记录被副表引用时，主表不可以被删除。
</span></span></span></code></pre></td></tr></table></div></div><h2 id=数据库的三大设计范式>数据库的三大设计范式</h2><h3 id=1nf>1NF</h3><p>所有字段值都是不可再分的原子值</p><p>只要字段值还可以继续拆分，就不满足第一范式。</p><p>范式设计得越详细，对某些实际操作可能会更好，但并非都有好处，需要对项目的实际情况进行设定。</p><h3 id=2nf>2NF</h3><p>在满足第一范式的前提下，<strong>其他列都必须完全依赖于主键列</strong>。如果出现不完全依赖，只可能发生在联合主键的情况下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 订单表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>myorder</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>customer_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>实际上，在这张订单表中，<code>product_name</code> 只依赖于 <code>product_id</code> ，<code>customer_name</code> 只依赖于 <code>customer_id</code> 。也就是说，<code>product_name</code> 和 <code>customer_id</code> 是没用关系的，<code>customer_name</code> 和 <code>product_id</code> 也是没有关系的。</p><p>这就不满足第二范式：其他列都必须完全依赖于主键列！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>myorder</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=kt>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>product</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>customer</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>拆分之后，<code>myorder</code> 表中的 <code>product_id</code> 和 <code>customer_id</code> 完全依赖于 <code>order_id</code> 主键，而 <code>product</code> 和 <code>customer</code> 表中的其他字段又完全依赖于主键。满足了第二范式的设计！</p><h3 id=3nf>3NF</h3><p>在满足第二范式的前提下，<strong>除了主键列之外，其他列之间不能有传递依赖关系</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>myorder</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_phone</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>表中的 <code>customer_phone</code> 有可能依赖于 <code>order_id</code> 、 <code>customer_id</code> 两列，也就不满足了第三范式的设计：其他列之间不能有传递依赖关系。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>myorder</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=kt>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>customer</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>phone</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>修改后就不存在其他列之间的传递依赖关系，其他列都只依赖于主键列，满足了第三范式的设计！</p><h2 id=查询练习>查询练习</h2><h3 id=准备数据>准备数据</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 创建数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>select_test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 切换数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>USE</span><span class=w> </span><span class=n>select_test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建学生表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>student</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sex</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>birthday</span><span class=w> </span><span class=kt>DATE</span><span class=p>,</span><span class=w> </span><span class=c1>-- 生日
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>class</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=c1>-- 所在班级
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建教师表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>teacher</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sex</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>birthday</span><span class=w> </span><span class=kt>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>profession</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 职称
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>department</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=c1>-- 部门
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建课程表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>course</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>t_no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 教师编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>-- 表示该 tno 来自于 teacher 表中的 no 字段值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>t_no</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=nf>teacher</span><span class=p>(</span><span class=n>no</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 成绩表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>score</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>s_no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 学生编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>c_no</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=no>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 课程号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>degree</span><span class=w> </span><span class=kt>DECIMAL</span><span class=p>,</span><span class=w>	</span><span class=c1>-- 成绩
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>-- 表示该 s_no, c_no 分别来自于 student, course 表中的 no 字段值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>s_no</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=nf>student</span><span class=p>(</span><span class=n>no</span><span class=p>),</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>c_no</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=nf>course</span><span class=p>(</span><span class=n>no</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 设置 s_no, c_no 为联合主键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查看所有表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=kp>TABLES</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加学生表数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;101&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;曾华&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1977-09-01&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95033&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;102&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;匡明&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1975-10-02&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;103&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王丽&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1976-01-23&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95033&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;104&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;李军&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1976-02-20&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95033&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王芳&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1975-02-10&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;106&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;陆军&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1974-06-03&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;107&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王尼玛&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1976-02-20&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95033&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;108&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;张全蛋&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1975-02-10&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;109&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;赵铁柱&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1974-06-03&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加教师表数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;804&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;李诚&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1958-12-02&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;副教授&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;856&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;张旭&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1969-03-12&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;讲师&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;电子工程系&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;825&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王萍&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1972-05-05&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;助教&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;831&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;刘冰&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1977-08-14&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;助教&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;电子工程系&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加课程表数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;计算机导论&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;825&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;3-245&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;操作系统&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;804&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;6-166&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;数字电路&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;856&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;9-888&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;高等数学&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;831&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 添加添加成绩表数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;103&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;92&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;103&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;86&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;103&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;6-166&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;85&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;88&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;75&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;6-166&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;79&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;109&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;76&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;109&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;68&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;109&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;6-166&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;81&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查看表结构
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=1-到-10>1 到 10</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 查询 student 表的所有行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 student 表中的 name、sex 和 class 字段的所有行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>sex</span><span class=p>,</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 teacher 表中不重复的 department 列
</span></span></span><span class=line><span class=cl><span class=c1>-- department: 去重查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 score 表中成绩在60-80之间的所有行（区间查询和运算符查询）
</span></span></span><span class=line><span class=cl><span class=c1>-- BETWEEN xx AND xx: 查询区间, AND 表示 &#34;并且&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>60</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=mi>80</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>60</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>80</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 score 表中成绩为 85, 86 或 88 的行
</span></span></span><span class=line><span class=cl><span class=c1>-- IN: 查询规定中的多个值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=mi>85</span><span class=p>,</span><span class=w> </span><span class=mi>86</span><span class=p>,</span><span class=w> </span><span class=mi>88</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 student 表中 &#39;95031&#39; 班或性别为 &#39;女&#39; 的所有行
</span></span></span><span class=line><span class=cl><span class=c1>-- or: 表示或者关系
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 以 class 降序的方式查询 student 表的所有行
</span></span></span><span class=line><span class=cl><span class=c1>-- DESC: 降序，从高到低
</span></span></span><span class=line><span class=cl><span class=c1>-- ASC（默认）: 升序，从低到高
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>ASC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 以 c_no 升序、degree 降序查询 score 表的所有行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>ASC</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 &#34;95031&#34; 班的学生人数
</span></span></span><span class=line><span class=cl><span class=c1>-- COUNT: 统计
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 score 表中的最高分的学生学号和课程编号（子查询或排序查询）。
</span></span></span><span class=line><span class=cl><span class=c1>-- (SELECT MAX(degree) FROM score): 子查询，算出最高分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=nf>MAX</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--  排序查询
</span></span></span><span class=line><span class=cl><span class=c1>-- LIMIT r, n: 表示从第r行开始，查询n条数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=分组计算平均成绩>分组计算平均成绩</h3><p><strong>查询每门课的平均成绩。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- AVG: 平均值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;6-166&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- GROUP BY: 分组查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=分组条件与模糊查询>分组条件与模糊查询</h3><p><strong>查询 <code>score</code> 表中至少有 2 名学生选修，并以 3 开头的课程的平均分数。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- c_no 课程编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>分析表发现，至少有 2 名学生选修的课程是 <code>3-105</code> 、<code>3-245</code> 、<code>6-166</code> ，以 3 开头的课程是 <code>3-105</code> 、<code>3-245</code> 。也就是说，我们要查询所有 <code>3-105</code> 和 <code>3-245</code> 的 <code>degree</code> 平均分。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 首先把 c_no, AVG(degree) 通过分组查询出来
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=p>.</span><span class=mi>3333</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=p>.</span><span class=mi>3333</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=p>.</span><span class=mi>6667</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 再查询出至少有 2 名学生选修的课程
</span></span></span><span class=line><span class=cl><span class=c1>-- HAVING: 表示持有
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=n>c_no</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 并且是以 3 开头的课程
</span></span></span><span class=line><span class=cl><span class=c1>-- LIKE 表示模糊查询，&#34;%&#34; 是一个通配符，匹配 &#34;3&#34; 后面的任意字符。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>AND</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;3%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 把前面的SQL语句拼接起来，
</span></span></span><span class=line><span class=cl><span class=c1>-- 后面加上一个 COUNT(*)，表示将每个分组的个数也查询出来。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>),</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=n>c_no</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;3%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=p>.</span><span class=mi>3333</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=p>.</span><span class=mi>3333</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+----------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=多表查询---1>多表查询 - 1</h3><p><strong>查询所有学生的 <code>name</code>，以及该学生在 <code>score</code> 表中对应的 <code>c_no</code> 和 <code>degree</code> 。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>106</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>107</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>108</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>通过分析可以发现，只要把 <code>score</code> 表中的 <code>s_no</code> 字段值替换成 <code>student</code> 表中对应的 <code>name</code> 字段值就可以了，如何做呢？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- FROM...: 表示从 student, score 表中查询
</span></span></span><span class=line><span class=cl><span class=c1>-- WHERE 的条件表示为，只有在 student.no 和 score.s_no 相等时才显示出来。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>score</span><span class=p>.</span><span class=n>s_no</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=多表查询---2>多表查询 - 2</h3><p><strong>查询所有学生的 <code>no</code> 、课程名称 ( <code>course</code> 表中的 <code>name</code> ) 和成绩 ( <code>score</code> 表中的 <code>degree</code> ) 列。</strong></p><p>只有 <code>score</code> 关联学生的 <code>no</code> ，因此只要查询 <code>score</code> 表，就能找出所有和学生相关的 <code>no</code> 和 <code>degree</code> ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>然后查询 <code>course</code> 表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>            </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>9</span><span class=o>-</span><span class=mi>888</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>高等数学</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>只要把 <code>score</code> 表中的 <code>c_no</code> 替换成 <code>course</code> 表中对应的 <code>name</code> 字段值就可以了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 增加一个查询字段 name，分别从 score、course 这两个表中查询。
</span></span></span><span class=line><span class=cl><span class=c1>-- as 表示取一个该字段的别名。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>c_name</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>course</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>score</span><span class=p>.</span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>course</span><span class=p>.</span><span class=n>no</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_name</span><span class=w>          </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=三表关联查询>三表关联查询</h3><p><strong>查询所有学生的 <code>name</code> 、课程名 ( <code>course</code> 表中的 <code>name</code> ) 和 <code>degree</code> 。</strong></p><p>只有 <code>score</code> 表中关联学生的学号和课堂号，我们只要围绕着 <code>score</code> 这张表查询就好了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>只要把 <code>s_no</code> 和 <code>c_no</code> 替换成 <code>student</code> 和 <code>srouse</code> 表中对应的 <code>name</code> 字段值就好了。</p><p>首先把 <code>s_no</code> 替换成 <code>student</code> 表中的 <code>name</code> 字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>score</span><span class=p>.</span><span class=n>s_no</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>再把 <code>c_no</code> 替换成 <code>course</code> 表中的 <code>name</code> 字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 课程表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>            </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>9</span><span class=o>-</span><span class=mi>888</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>高等数学</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 由于字段名存在重复，使用 &#34;表名.字段名 as 别名&#34; 代替。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>s_name</span><span class=p>,</span><span class=w> </span><span class=n>course</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>c_name</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>course</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>NO</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>score</span><span class=p>.</span><span class=n>s_no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>score</span><span class=p>.</span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>course</span><span class=p>.</span><span class=n>no</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询加分组求平均分>子查询加分组求平均分</h3><p><strong>查询 <code>95031</code> 班学生每门课程的平均成绩。</strong></p><p>在 <code>score</code> 表中根据 <code>student</code> 表的学生编号筛选出学生的课堂号和成绩：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- IN (..): 将筛选出的学生号当做 s_no 的条件查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这时只要将 <code>c_no</code> 分组一下就能得出 <code>95031</code> 班学生每门课的平均成绩：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95031&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>82</span><span class=p>.</span><span class=mi>0000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>71</span><span class=p>.</span><span class=mi>5000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>80</span><span class=p>.</span><span class=mi>0000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---1>子查询 - 1</h3><p><strong>查询在 <code>3-105</code> 课程中，所有成绩高于 <code>109</code> 号同学的记录。</strong></p><p>首先筛选出课堂号为 <code>3-105</code> ，在找出所有成绩高于 <code>109</code> 号同学的的行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;109&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---2>子查询 - 2</h3><p><strong>查询所有成绩高于 <code>109</code> 号同学的 <code>3-105</code> 课程成绩记录。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 不限制课程号，只要成绩大于109号同学的3-105课程成绩就可以。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;109&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=year-函数与带-in-关键字查询>YEAR 函数与带 IN 关键字查询</h3><p><strong>查询所有和 <code>101</code> 、<code>108</code> 号学生同年出生的 <code>no</code> 、<code>name</code> 、<code>birthday</code> 列。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- YEAR(..): 取出日期中的年份
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>birthday</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=kt>YEAR</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=kt>YEAR</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=mi>101</span><span class=p>,</span><span class=w> </span><span class=mi>108</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=多层嵌套子查询>多层嵌套子查询</h3><p><strong>查询 <code>'张旭'</code> 教师任课的学生成绩表。</strong></p><p>首先找到教师编号：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>NO</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;张旭&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>通过 <code>sourse</code> 表找到该教师课程号：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>NO</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>NO</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;张旭&#39;</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>通过筛选出的课程号查询成绩表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;张旭&#39;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=多表查询>多表查询</h3><p><strong>查询某选修课程多于5个同学的教师姓名。</strong></p><p>首先在 <code>teacher</code> 表中，根据 <code>no</code> 字段来判断该教师的同一门课程是否有至少 5 名学员选修：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 查询 teacher 表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>804</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李诚</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>825</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王萍</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>831</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>刘冰</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>856</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张旭</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 在这里找到对应的条件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>查看和教师编号有有关的表的信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- t_no: 教师编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>+-------+-----------------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>            </span><span class=o>|</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>计算机导论</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>825</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>804</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>856</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>9</span><span class=o>-</span><span class=mi>888</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>高等数学</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>831</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-----------------+------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>我们已经找到和教师编号有关的字段就在 <code>course</code> 表中，但是还无法知道哪门课程至少有 5 名学生选修，所以还需要根据 <code>score</code> 表来查询：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 在此之前向 score 插入一些数据，以便丰富查询条件。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;101&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;90&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;102&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;91&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;104&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;89&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 score 表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 在 score 表中将 c_no 作为分组，并且限制 c_no 持有至少 5 条数据。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>根据筛选出来的课程号，找出在某课程中，拥有至少 5 名学员的教师编号：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>825</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在 <code>teacher</code> 表中，根据筛选出来的教师编号找到教师姓名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 最终条件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---3>子查询 - 3</h3><p><strong>查询 “计算机系” 课程的成绩表。</strong></p><p>思路是，先找出 <code>course</code> 表中所有 <code>计算机系</code> 课程的编号，然后根据这个编号查询 <code>score</code> 表。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 通过 teacher 表查询所有 `计算机系` 的教师编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>department</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>804</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李诚</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>计算机系</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>825</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王萍</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>计算机系</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+--------+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 通过 course 表查询该教师的课程编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 根据筛选出来的课程号查询成绩表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=union-和-notin-的使用>UNION 和 NOTIN 的使用</h3><p><strong>查询 <code>计算机系</code> 与 <code>电子工程系</code> 中的不同职称的教师。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- NOT: 代表逻辑非
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>profession</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>profession</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;电子工程系&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 合并两个集
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;电子工程系&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>profession</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>profession</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机系&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=any-表示至少一个---desc--降序->ANY 表示至少一个 - DESC ( 降序 )</h3><p><strong>查询课程 <code>3-105</code> 且成绩 <u>至少</u> 高于 <code>3-245</code> 的 <code>score</code> 表。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ANY: 符合SQL语句中的任意条件。
</span></span></span><span class=line><span class=cl><span class=c1>-- 也就是说，在 3-105 成绩中，只要有一个大于从 3-245 筛选出来的任意行就符合条件，
</span></span></span><span class=line><span class=cl><span class=c1>-- 最后根据降序查询结果。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=nf>ANY</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=表示所有的-all>表示所有的 ALL</h3><p><strong>查询课程 <code>3-105</code> 且成绩高于 <code>3-245</code> 的 <code>score</code> 表。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 只需对上一道题稍作修改。
</span></span></span><span class=line><span class=cl><span class=c1>-- ALL: 符合SQL语句中的所有条件。
</span></span></span><span class=line><span class=cl><span class=c1>-- 也就是说，在 3-105 每一行成绩中，都要大于从 3-245 筛选出来全部行才算符合条件。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-105&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=k>ALL</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;3-245&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=复制表的数据作为条件查询>复制表的数据作为条件查询</h3><p><strong>查询某课程成绩比该课程平均成绩低的 <code>score</code> 表。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 查询平均分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>c_no</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>87</span><span class=p>.</span><span class=mi>6667</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=p>.</span><span class=mi>3333</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=p>.</span><span class=mi>6667</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+-------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询 score 表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>86</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>85</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>88</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 将表 b 作用于表 a 中查询数据
</span></span></span><span class=line><span class=cl><span class=c1>-- score a (b): 将表声明为 a (b)，
</span></span></span><span class=line><span class=cl><span class=c1>-- 如此就能用 a.c_no = b.c_no 作为条件执行查询了。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>c_no</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>75</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>68</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>81</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---4>子查询 - 4</h3><p><strong>查询所有任课 ( 在 <code>course</code> 表里有课程 ) 教师的 <code>name</code> 和 <code>department</code></strong> 。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>department</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>department</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+-----------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>李诚</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>计算机系</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王萍</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>计算机系</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>刘冰</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>电子工程系</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>张旭</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=err>电子工程系</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------+-----------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=条件加组筛选>条件加组筛选</h3><p><strong>查询 <code>student</code> 表中至少有 2 名男生的 <code>class</code> 。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 查看学生表信息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>birthday</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1977</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>01</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>女</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>23</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>女</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>106</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>107</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>108</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>110</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张飞</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95038</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 只查询性别为男，然后按 class 分组，并限制 class 行大于 1。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>HAVING</span><span class=w> </span><span class=nf>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=notlike-模糊查询取反>NOTLIKE 模糊查询取反</h3><p><strong>查询 <code>student</code> 表中不姓 &ldquo;王&rdquo; 的同学记录。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- NOT: 取反
</span></span></span><span class=line><span class=cl><span class=c1>-- LIKE: 模糊查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;王%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>birthday</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1977</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>01</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>106</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>108</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>110</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张飞</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95038</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=year-与-now-函数>YEAR 与 NOW 函数</h3><p><strong>查询 <code>student</code> 表中每个学生的姓名和年龄。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 使用函数 YEAR(NOW()) 计算出当前年份，减去出生年份后得出年龄。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=kt>YEAR</span><span class=p>(</span><span class=nf>NOW</span><span class=p>())</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=kt>YEAR</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>age</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>42</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>44</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>43</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>43</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>44</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>45</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>43</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>44</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>45</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>张飞</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>45</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=max-与-min-函数>MAX 与 MIN 函数</h3><p><strong>查询 <code>student</code> 表中最大和最小的 <code>birthday</code> 值。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=nf>MAX</span><span class=p>(</span><span class=n>birthday</span><span class=p>),</span><span class=w> </span><span class=nf>MIN</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------+---------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=nf>MAX</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nf>MIN</span><span class=p>(</span><span class=n>birthday</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------+---------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>1977</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>01</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------+---------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=多段排序>多段排序</h3><p><strong>以 <code>class</code> 和 <code>birthday</code> 从大到小的顺序查询 <code>student</code> 表。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>DESC</span><span class=p>,</span><span class=w> </span><span class=n>birthday</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>birthday</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>110</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张飞</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95038</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王丽</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>女</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>23</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>107</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1976</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1977</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>01</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>106</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1974</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王芳</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>女</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>108</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>1975</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>95031</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+-----------+-----+------------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---5>子查询 - 5</h3><p><strong>查询 &ldquo;男&rdquo; 教师及其所上的课程。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>teacher</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+--------------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>no</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>t_no</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+--------------+------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>操作系统</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>804</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>数字电路</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>856</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------+--------------+------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=max-函数与子查询>MAX 函数与子查询</h3><p><strong>查询最高分同学的 <code>score</code> 表。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 找出最高成绩（该查询只能有一个结果）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nf>MAX</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 根据上面的条件筛选出所有最高成绩表，
</span></span></span><span class=line><span class=cl><span class=c1>-- 该查询可能有多个结果，假设 degree 值多次符合条件。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=nf>MAX</span><span class=p>(</span><span class=n>degree</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>92</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---6>子查询 - 6</h3><p><strong>查询和 &ldquo;李军&rdquo; 同性别的所有同学 <code>name</code> 。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 首先将李军的性别作为条件取出来
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;李军&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 根据性别查询 name 和 sex
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;李军&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>匡明</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>陆军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>张全蛋</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>赵铁柱</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>张飞</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---7>子查询 - 7</h3><p><strong>查询和 &ldquo;李军&rdquo; 同性别且同班的同学 <code>name</code> 。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>sex</span><span class=p>,</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;李军&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;李军&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>class</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>曾华</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>李军</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>王尼玛</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=err>男</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>95033</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-----------+-----+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=子查询---8>子查询 - 8</h3><p><strong>查询所有选修 &ldquo;计算机导论&rdquo; 课程的 &ldquo;男&rdquo; 同学成绩表。</strong></p><p>需要的 &ldquo;计算机导论&rdquo; 和性别为 &ldquo;男&rdquo; 的编号可以在 <code>course</code> 和 <code>student</code> 表中找到。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>c_no</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>course</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;计算机导论&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;男&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>91</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>76</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=按等级查询>按等级查询</h3><p>建立一个 <code>grade</code> 表代表学生的成绩等级，并插入数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>grade</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>low</span><span class=w> </span><span class=kt>INT</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>upp</span><span class=w> </span><span class=kt>INT</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>grade</span><span class=w> </span><span class=kt>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>90</span><span class=p>,</span><span class=w> </span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>80</span><span class=p>,</span><span class=w> </span><span class=mi>89</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;B&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>70</span><span class=p>,</span><span class=w> </span><span class=mi>79</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;C&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>60</span><span class=p>,</span><span class=w> </span><span class=mi>69</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;D&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>59</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;E&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>grade</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>low</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>upp</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=mi>90</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=mi>100</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>A</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=mi>80</span><span class=w> </span><span class=o>|</span><span class=w>   </span><span class=mi>89</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=mi>70</span><span class=w> </span><span class=o>|</span><span class=w>   </span><span class=mi>79</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>C</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=mi>60</span><span class=w> </span><span class=o>|</span><span class=w>   </span><span class=mi>69</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>D</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>0</span><span class=w> </span><span class=o>|</span><span class=w>   </span><span class=mi>59</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>E</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>查询所有学生的 <code>s_no</code> 、<code>c_no</code> 和 <code>grade</code> 列。</strong></p><p>思路是，使用区间 ( <code>BETWEEN</code> ) 查询，判断学生的成绩 ( <code>degree</code> ) 在 <code>grade</code> 表的 <code>low</code> 和 <code>upp</code> 之间。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>s_no</span><span class=p>,</span><span class=w> </span><span class=n>c_no</span><span class=p>,</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>grade</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>degree</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=n>low</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>upp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>s_no</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c_no</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>grade</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>101</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>A</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>102</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>A</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>A</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>103</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>104</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>C</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>105</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>C</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>105</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>C</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=o>-</span><span class=mi>245</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>D</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>109</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=o>-</span><span class=mi>166</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>B</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=连接查询>连接查询</h3><p>准备用于测试连接查询的数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>testJoin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>cardId</span><span class=w> </span><span class=kt>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=nf>card</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;饭卡&#39;</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;建行卡&#39;</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;农行卡&#39;</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;工商卡&#39;</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;邮政卡&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>card</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>饭卡</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>建行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>农行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>工商卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>邮政卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;张三&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;李四&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王五&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cardId</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张三</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李四</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王五</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>6</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>分析两张表发现，<code>person</code> 表并没有为 <code>cardId</code> 字段设置一个在 <code>card</code> 表中对应的 <code>id</code> 外键。如果设置了的话，<code>person</code> 中 <code>cardId</code> 字段值为 <code>6</code> 的行就插不进去，因为该 <code>cardId</code> 值在 <code>card</code> 表中并没有。</p><h4 id=内连接>内连接</h4><p>要查询这两张表中有关系的数据，可以使用 <code>INNER JOIN</code> ( 内连接 ) 将它们连接在一起。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- INNER JOIN: 表示为内连接，将两张表拼接在一起。
</span></span></span><span class=line><span class=cl><span class=c1>-- on: 表示要执行某个条件。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>cardId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>card</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cardId</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张三</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>饭卡</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李四</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>农行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 将 INNER 关键字省略掉，结果也是一样的。
</span></span></span><span class=line><span class=cl><span class=c1>-- SELECT * FROM person JOIN card on person.cardId = card.id;
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：<code>card</code> 的整张表被连接到了右边。</p></blockquote><h4 id=左外连接>左外连接</h4><p>完整显示左边的表 ( <code>person</code> ) ，右边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- LEFT JOIN 也叫做 LEFT OUTER JOIN，用这两种方式的查询结果是一样的。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>cardId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>card</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cardId</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张三</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>饭卡</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李四</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>农行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王五</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>6</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=右外链接>右外链接</h4><p>完整显示右边的表 ( <code>card</code> ) ，左边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>RIGHT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>cardId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>card</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cardId</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张三</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>饭卡</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李四</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>农行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>建行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>工商卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>邮政卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=全外链接>全外链接</h4><p>完整显示两张表的全部数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- MySQL 不支持这种语法的全外连接
</span></span></span><span class=line><span class=cl><span class=c1>-- SELECT * FROM person FULL JOIN card on person.cardId = card.id;
</span></span></span><span class=line><span class=cl><span class=c1>-- 出现错误：
</span></span></span><span class=line><span class=cl><span class=c1>-- ERROR 1054 (42S22): Unknown column &#39;person.cardId&#39; in &#39;on clause&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- MySQL全连接语法，使用 UNION 将两张表合并在一起。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>cardId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>card</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>RIGHT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>card</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>cardId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>card</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cardId</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>张三</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>饭卡</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>李四</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>农行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>王五</span><span class=w>   </span><span class=o>|</span><span class=w>      </span><span class=mi>6</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>建行卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>工商卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>NULL</span><span class=w>   </span><span class=o>|</span><span class=w>   </span><span class=no>NULL</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>邮政卡</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------+--------+--------+------+-----------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=事务>事务</h2><p>在 MySQL 中，事务其实是一个最小的不可分割的工作单元。事务能够<strong>保证一个业务的完整性</strong>。</p><p>比如我们的银行转账：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- a -&gt; -100
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- b -&gt; +100
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在实际项目中，假设只有一条 SQL 语句执行成功，而另外一条执行失败了，就会出现数据前后不一致。</p><p>因此，在执行多条有关联 SQL 语句时，<strong>事务</strong>可能会要求这些 SQL 语句要么同时执行成功，要么就都执行失败。</p><h3 id=如何控制事务---commit--rollback>如何控制事务 - COMMIT / ROLLBACK</h3><p>在 MySQL 中，事务的<strong>自动提交</strong>状态默认是开启的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 查询事务的自动提交状态
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>AUTOCOMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>AUTOCOMMIT</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>            </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>自动提交的作用</strong>：当我们执行一条 SQL 语句的时候，其产生的效果就会立即体现出来，且不能<strong>回滚</strong>。</p><p>什么是回滚？举个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>bank</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>USE</span><span class=w> </span><span class=n>bank</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=kt>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>money</span><span class=w> </span><span class=kt>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以看到，在执行插入语句后数据立刻生效，原因是 MySQL 中的事务自动将它<strong>提交</strong>到了数据库中。那么所谓<strong>回滚</strong>的意思就是，撤销执行过的所有 SQL 语句，使其回滚到<strong>最后一次提交</strong>数据时的状态。</p><p>在 MySQL 中使用 <code>ROLLBACK</code> 执行回滚：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 回滚到最后一次提交
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>由于所有执行过的 SQL 语句都已经被提交过了，所以数据并没有发生回滚。那如何让数据可以发生回滚？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 关闭自动提交
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>SET</span><span class=w> </span><span class=n>AUTOCOMMIT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询自动提交状态
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>AUTOCOMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>AUTOCOMMIT</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>            </span><span class=mi>0</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>将自动提交关闭后，测试数据回滚：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 关闭 AUTOCOMMIT 后，数据的变化是在一张虚拟的临时数据表中展示，
</span></span></span><span class=line><span class=cl><span class=c1>-- 发生变化的数据并没有真正插入到数据表中。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 数据表中的真实数据其实还是：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 由于数据还没有真正提交，可以使用回滚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 再次查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>那如何将虚拟的数据真正提交到数据库中？使用 <code>COMMIT</code> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 手动提交数据（持久性），
</span></span></span><span class=line><span class=cl><span class=c1>-- 将数据真正提交到数据库中，执行后不能再回滚提交过的数据。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 提交后测试回滚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 再次查询（回滚无效了）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>总结</strong></p><ol><li><p><strong>自动提交</strong></p><ul><li><p>查看自动提交状态：<code>SELECT @@AUTOCOMMIT</code> ；</p></li><li><p>设置自动提交状态：<code>SET AUTOCOMMIT = 0</code> 。</p></li></ul></li><li><p><strong>手动提交</strong></p><p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>COMMIT</code> 命令提交事务。</p></li><li><p><strong>事务回滚</strong></p><p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>ROLLBACK</code> 命令回滚事务。</p></li></ol></blockquote><p><strong>事务的实际应用</strong>，让我们再回到银行转账项目：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 转账
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 到账
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这时假设在转账时发生了意外，就可以使用 <code>ROLLBACK</code> 回滚到最后一次提交的状态：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 假设转账发生了意外，需要回滚。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这时我们又回到了发生意外之前的状态，也就是说，事务给我们提供了一个可以反悔的机会。假设数据没有发生意外，这时可以手动将数据真正提交到数据表中：<code>COMMIT</code> 。</p><h3 id=手动开启事务---begin--start-transaction>手动开启事务 - BEGIN / START TRANSACTION</h3><p>事务的默认提交被开启 ( <code>@@AUTOCOMMIT = 1</code> ) 后，此时就不能使用事务回滚了。但是我们还可以手动开启一个事务处理事件，使其可以发生回滚：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 使用 BEGIN 或者 START TRANSACTION 手动开启一个事务
</span></span></span><span class=line><span class=cl><span class=c1>-- START TRANSACTION;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 由于手动开启的事务没有开启自动提交，
</span></span></span><span class=line><span class=cl><span class=c1>-- 此时发生变化的数据仍然是被保存在一张临时表中。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 测试回滚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>仍然使用 <code>COMMIT</code> 提交数据，提交后无法再发生本次事务的回滚。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 提交数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 测试回滚（无效，因为表的数据已经被提交）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=事务的-acid-特征与使用>事务的 ACID 特征与使用</h3><p><strong>事务的四大特征：</strong></p><ul><li><strong>A 原子性</strong>：事务是最小的单位，不可以再分割；</li><li><strong>C 一致性</strong>：要求同一事务中的 SQL 语句，必须保证同时成功或者失败；</li><li><strong>I 隔离性</strong>：事务 1 和 事务 2 之间是具有隔离性的；</li><li><strong>D 持久性</strong>：事务一旦结束 ( <code>COMMIT</code> ) ，就不可以再返回了 ( <code>ROLLBACK</code> ) 。</li></ul><h3 id=事务的隔离性>事务的隔离性</h3><p><strong>事务的隔离性可分为四种 ( 性能从低到高 )</strong> ：</p><ol><li><p><strong>READ UNCOMMITTED ( 读取未提交 )</strong></p><p>如果有多个事务，那么任意事务都可以看见其他事务的<strong>未提交数据</strong>。</p></li><li><p><strong>READ COMMITTED ( 读取已提交 )</strong></p><p>只能读取到其他事务<strong>已经提交的数据</strong>。</p></li><li><p><strong>REPEATABLE READ ( 可被重复读 )</strong></p><p>如果有多个连接都开启了事务，那么事务之间不能共享数据记录，否则只能共享已提交的记录。</p></li><li><p><strong>SERIALIZABLE ( 串行化 )</strong></p><p>所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong>。</p></li></ol><p>查看当前数据库的默认隔离级别：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- MySQL 8.x, GLOBAL 表示系统级别，不加表示会话级别。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>REPEATABLE</span><span class=o>-</span><span class=k>READ</span><span class=w>                </span><span class=o>|</span><span class=w> </span><span class=c1>-- MySQL的默认隔离级别，可以重复读。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- MySQL 5.x
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TX_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>TX_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>修改隔离级别：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 设置系统隔离级别，LEVEL 后面表示要设置的隔离级别 (READ UNCOMMITTED)。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>SET</span><span class=w> </span><span class=n>GLOBAL</span><span class=w> </span><span class=n>TRANSACTION</span><span class=w> </span><span class=n>ISOLATION</span><span class=w> </span><span class=n>LEVEL</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=n>UNCOMMITTED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 查询系统隔离级别，发现已经被修改。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>READ</span><span class=o>-</span><span class=n>UNCOMMITTED</span><span class=w>               </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=脏读>脏读</h4><p>测试 <strong>READ UNCOMMITTED ( 读取未提交 )</strong> 的隔离性：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;小明&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;淘宝店&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 开启一个事务操作数据
</span></span></span><span class=line><span class=cl><span class=c1>-- 假设小明在淘宝店买了一双800块钱的鞋子：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>SET</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>800</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;小明&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>SET</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>800</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;淘宝店&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 然后淘宝店在另一方查询结果，发现钱已到账。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>200</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1800</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>由于小明的转账是在新开启的事务上进行操作的，而该操作的结果是可以被其他事务（另一方的淘宝店）看见的，因此淘宝店的查询结果是正确的，淘宝店确认到账。但就在这时，如果小明在它所处的事务上又执行了 <code>ROLLBACK</code> 命令，会发生什么？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 小明所处的事务
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 此时无论对方是谁，如果再去查询结果就会发现：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这就是所谓的<strong>脏读</strong>，一个事务读取到另外一个事务还未提交的数据。这在实际开发中是不允许出现的。</p><h4 id=读取已提交>读取已提交</h4><p>把隔离级别设置为 <strong>READ COMMITTED</strong> ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=kt>SET</span><span class=w> </span><span class=n>GLOBAL</span><span class=w> </span><span class=n>TRANSACTION</span><span class=w> </span><span class=n>ISOLATION</span><span class=w> </span><span class=n>LEVEL</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=n>COMMITTED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>READ</span><span class=o>-</span><span class=n>COMMITTED</span><span class=w>                 </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这样，再有新的事务连接进来时，它们就只能查询到已经提交过的事务数据了。但是对于当前事务来说，它们看到的还是未提交的数据，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 正在操作数据事务（当前事务）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>SET</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>800</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;小明&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>SET</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>800</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;淘宝店&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 虽然隔离级别被设置为了 READ COMMITTED，但在当前事务中，
</span></span></span><span class=line><span class=cl><span class=c1>-- 它看到的仍然是数据表中临时改变数据，而不是真正提交过的数据。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>200</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1800</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 假设此时在远程开启了一个新事务，连接到数据库。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>$</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>-</span><span class=n>p12345612</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 此时远程连接查询到的数据只能是已经提交过的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>但是这样还有问题，那就是假设一个事务在操作数据时，其他事务干扰了这个事务的数据。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 小张在查询数据的时候发现：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>   </span><span class=mi>200</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1800</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 在小张求表的 money 平均值之前，小王做了一个操作：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;c&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>100</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 此时表的真实数据是：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 这时小张再求平均值的时候，就会出现计算不相符合的情况：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>money</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=nf>AVG</span><span class=p>(</span><span class=n>money</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>820</span><span class=p>.</span><span class=mi>0000</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>虽然 <strong>READ COMMITTED</strong> 让我们只能读取到其他事务已经提交的数据，但还是会出现问题，就是<strong>在读取同一个表的数据时，可能会发生前后不一致的情况。<strong>这被称为</strong>不可重复读现象 ( READ COMMITTED )</strong> 。</p><h4 id=幻读>幻读</h4><p>将隔离级别设置为 <strong>REPEATABLE READ ( 可被重复读取 )</strong> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=kt>SET</span><span class=w> </span><span class=n>GLOBAL</span><span class=w> </span><span class=n>TRANSACTION</span><span class=w> </span><span class=n>ISOLATION</span><span class=w> </span><span class=n>LEVEL</span><span class=w> </span><span class=n>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>REPEATABLE</span><span class=o>-</span><span class=k>READ</span><span class=w>                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>测试 <strong>REPEATABLE READ</strong> ，假设在两个不同的连接上分别执行 <code>START TRANSACTION</code> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 小张 - 成都
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 小王 - 北京
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 小张 - 成都
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>当前事务开启后，没提交之前，查询不到，提交后可以被查询到。但是，在提交之前其他事务被开启了，那么在这条事务线上，就不会查询到当前有操作事务的连接。相当于开辟出一条单独的线程。</p><p>无论小张是否执行过 <code>COMMIT</code> ，在小王这边，都不会查询到小张的事务记录，而是只会查询到自己所处事务的记录：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-----------+-------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-----------+-------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>c</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-----------+-------+
</span></span></span></code></pre></td></tr></table></div></div><p>这是<strong>因为小王在此之前开启了一个新的事务 ( <code>START TRANSACTION</code> ) <strong>，那么</strong>在他的这条新事务的线上，跟其他事务是没有联系的</strong>，也就是说，此时如果其他事务正在操作数据，它是不知道的。</p><p>然而事实是，在真实的数据表中，小张已经插入了一条数据。但是小王此时并不知道，也插入了同一条数据，会发生什么呢？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ERROR 1062 (23000): Duplicate entry &#39;6&#39; for key &#39;PRIMARY&#39;
</span></span></span></code></pre></td></tr></table></div></div><p>报错了，操作被告知已存在主键为 <code>6</code> 的字段。这种现象也被称为<strong>幻读，一个事务提交的数据，不能被其他事务读取到</strong>。</p><h4 id=串行化>串行化</h4><p>顾名思义，就是所有事务的<strong>写入操作</strong>全都是串行化的。什么意思？把隔离级别修改成 <strong>SERIALIZABLE</strong> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=kt>SET</span><span class=w> </span><span class=n>GLOBAL</span><span class=w> </span><span class=n>TRANSACTION</span><span class=w> </span><span class=n>ISOLATION</span><span class=w> </span><span class=n>LEVEL</span><span class=w> </span><span class=n>SERIALIZABLE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>GLOBAL</span><span class=p>.</span><span class=n>TRANSACTION_ISOLATION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>SERIALIZABLE</span><span class=w>                   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+--------------------------------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>还是拿小张和小王来举例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1>-- 小张 - 成都
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 小王 - 北京
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 开启事务之前先查询表，准备操作数据。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>money</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>a</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>900</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>b</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>小明</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>淘宝店</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>c</span><span class=w>         </span><span class=o>|</span><span class=w>   </span><span class=mi>100</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>6</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>d</span><span class=w>         </span><span class=o>|</span><span class=w>  </span><span class=mi>1000</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+----+-----------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 发现没有 7 号王小花，于是插入一条数据：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;王小花&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>此时会发生什么呢？由于现在的隔离级别是 <strong>SERIALIZABLE ( 串行化 )</strong> ，串行化的意思就是：假设把所有的事务都放在一个串行的队列中，那么所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong> ( <strong>这意味着队列中同时只能执行一个事务的写入操作</strong> ) 。</p><p>根据这个解释，小王在插入数据时，会出现等待状态，直到小张执行 <code>COMMIT</code> 结束它所处的事务，或者出现等待超时。</p><h2 id=索引>索引</h2><p>索引是存储引擎用于提高数据库表的访问速度的一种<strong>数据结构</strong>，它为特定的 mysql 字段进行一些<strong>特定的算法排序</strong>，比如二叉树的算法和哈希算法</p><ul><li>哈希算法是通过建立特征值，然后根据特征值来快速查找。</li><li>而用的最多，并且是 mysql 默认的就是二叉树算法 BTREE，通过 BTREE 算法建立索引的字段，比如扫描 20 行就能得到未使用 BTREE 前扫描了 2^20^ 行的结果。</li></ul><h3 id=索引的优缺点>索引的优缺点</h3><p>优点</p><ul><li><strong>加快数据查找的速度</strong></li><li>为用来排序或者是分组的字段添加索引，可以加快分组和排序的速度</li><li>加快表与表之间的连接</li></ul><p>缺点</p><ul><li>建立索引需要<strong>占用物理空间</strong></li><li>会降低表的增删改的效率，因为每次对表记录进行增删改，需要进行<strong>动态维护索引</strong>，导致增删改时间变长</li></ul><h3 id=什么情况下需要建索引>什么情况下需要建索引</h3><ol><li>经常用于<strong>查询</strong>的字段</li><li>经常用于<strong>连接</strong>的字段建立索引，可以加快连接的速度</li><li>经常需要<strong>排序</strong>的字段建立索引，因为索引已经排好序，可以加快排序查询速度</li></ol><h3 id=什么情况下不建索引>什么情况下不建索引</h3><ol><li><code>where</code> 条件中用不到的字段不适合建立索引</li><li><strong>表记录较少</strong>。比如只有几百条数据，没必要加索引。</li><li>需要<strong>经常增删改</strong>。需要评估是否适合加索引</li><li><strong>参与列计算</strong>的列不适合建索引</li><li><strong>区分度不高</strong>的字段不适合建立索引，如性别，只有男/女/未知三个值。加了索引，查询效率也不会提高。</li></ol><h3 id=索引的数据结构>索引的数据结构</h3><h4 id=b-树索引>B+ 树索引</h4><p>B+ 树是<strong>基于 B 树和叶子节点顺序访问指针</strong>进行实现，它具有 B 树的平衡性，并且通过顺序访问指针来提高区间查询的性能。</p><p>在 B+ 树中，节点中的 <code>key</code> 从左到右递增排列，如果某个指针的左右相邻 <code>key</code> 分别是 key~i~ 和 key~i+1~，则该指针指向节点的所有 <code>key</code> 大于等于 key~i~ 且小于等于 key~i+1~。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-2b6d28e258f4fe43acd500f32331fcd3_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-2b6d28e258f4fe43acd500f32331fcd3_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-2b6d28e258f4fe43acd500f32331fcd3_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-2b6d28e258f4fe43acd500f32331fcd3_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-2b6d28e258f4fe43acd500f32331fcd3_1440w.jpg title=img></p><p>进行查找操作时，首先在根节点进行<strong>二分查找</strong>，找到 <code>key</code> 所在的指针，然后递归地在指针所指向的节点进行查找。直到查找到叶子节点，然后在叶子节点上进行二分查找，找出 <code>key</code> 所对应的数据项。</p><p>MySQL 数据库使用最多的索引类型是 <code>BTREE</code> 索引，底层基于 B+ 树数据结构来实现。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>blog</span><span class=err>\</span><span class=n>G</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>***************************</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=n>row</span><span class=w> </span><span class=o>***************************</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Table</span><span class=p>:</span><span class=w> </span><span class=n>blog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Non_unique</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>Key_name</span><span class=p>:</span><span class=w> </span><span class=k>PRIMARY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Seq_in_index</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Column_name</span><span class=p>:</span><span class=w> </span><span class=n>blog_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Collation</span><span class=p>:</span><span class=w> </span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Cardinality</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>Sub_part</span><span class=p>:</span><span class=w> </span><span class=no>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>Packed</span><span class=p>:</span><span class=w> </span><span class=no>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=no>Null</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Index_type</span><span class=p>:</span><span class=w> </span><span class=n>BTREE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Comment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Index_comment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Visible</span><span class=p>:</span><span class=w> </span><span class=n>YES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Expression</span><span class=p>:</span><span class=w> </span><span class=no>NULL</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=哈希索引>哈希索引</h4><p>哈希索引是基于哈希表实现的，对于每一行数据，存储引擎会对索引列进行哈希计算得到哈希码，并且哈希算法要尽量保证不同的列值计算出的哈希码值是不同的</p><p>将哈希码的值作为哈希表的 key 值，将指向数据行的指针作为哈希表的 value 值。这样查找一个数据的时间复杂度就是 O(1)，一般多用于精确查找。</p><h4 id=hash-索引和-b-树索引的区别>Hash 索引和 B+ 树索引的区别？</h4><ul><li>哈希索引<strong>不支持排序</strong>，因为哈希表是无序的。</li><li>哈希索引<strong>不支持范围查找</strong>。</li><li>哈希索引<strong>不支持模糊查询</strong>及多列索引的最左前缀匹配。</li><li>因为哈希表中会<strong>存在哈希冲突</strong>，所以哈希索引的性能是不稳定的，而 B+ 树索引的性能是相对稳定的，每次查询都是从根节点到叶子节点。</li></ul><h4 id=为什么-b-树比-b-树更适合实现数据库索引>为什么 B+ 树比 B 树更适合实现数据库索引？</h4><ul><li>由于 B+ 树的数据都存储在叶子结点中，叶子结点均为索引，<strong>方便扫库</strong>，只需要扫一遍叶子结点即可，<ul><li>但是 B 树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫</li><li>所以 B+ 树<strong>更加适合在区间查询的情况</strong>，而在数据库中基于范围的查询是非常频繁的，所以通常 B+ 树用于数据库索引。</li></ul></li><li>B+ 树的节点只存储索引 key 值，具体信息的地址存在于叶子节点的地址中。这就使以页为单位的索引中可以存放更多的节点。减少更多的 I/O 支出。</li><li>B+ 树的<strong>查询效率更加稳定</strong>，任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</li></ul><h3 id=索引的类型>索引的类型</h3><p><strong>INDEX 普通索引</strong></p><ul><li>允许出现相同的索引内容。</li></ul><p><strong>UNIQUE KEY 唯一索引</strong></p><ul><li>唯一，允许出现空值</li><li>用途：唯一标识数据库表中的每条记录，主要是用来防止数据重复插入。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=k>constraint_name</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>column_1</span><span class=p>,</span><span class=n>column_2</span><span class=p>,...);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PRIMARY KEY 主键索引</strong></p><ul><li>唯一，非空</li></ul><p><strong>组合索引</strong></p><ul><li>在表中的多个字段组合上创建的索引</li><li>只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时需遵循<strong>最左前缀原则</strong>。</li></ul><p><strong>fulltext index 全文索引</strong></p><ul><li>上述三种索引都是针对列的值发挥作用，但全文索引，可以针对值中的某个单词，比如一篇文章中的某个词</li><li>只能在<code>CHAR</code>、<code>VARCHAR</code>和<code>TEXT</code>类型字段上使用全文索引</li><li>然而并没有什么卵用，因为只有 myisam 以及英文支持，并且效率让人不敢恭维</li></ul><h3 id=索引的设计原则>索引的设计原则</h3><ul><li>索引列的<strong>区分度越高</strong>，索引的效果越好。比如使用性别这种区分度很低的列作为索引，效果就会很差。<ul><li>话句话说，在维度高的列创建索引。</li></ul></li><li>尽量使用<strong>短索引</strong>，因为较小的索引涉及到的磁盘 I/O 较少，查询速度更快。<ul><li>对于较长的字符串进行索引时应该指定一个较短的前缀长度（<strong>前缀索引</strong>）</li></ul></li><li>索引不是越多越好，每个索引都需要额外的物理空间，维护也需要花费时间。<ul><li>对 where, on, group by, order by 中频繁出现的列使用索引。</li></ul></li><li>使用组合索引，可以减少文件索引大小，在使用时速度要优于多个单列索引。<ul><li>利用<strong>最左前缀原则</strong>。</li></ul></li></ul><h3 id=索引什么时候会失效>索引什么时候会失效</h3><p>导致索引失效的情况：</p><ul><li><p><strong>条件中有 <code>or</code></strong></p><ul><li>例如<code> select * from table_name where a = 1 or b = 3</code></li></ul></li><li><p><strong>在索引上进行计算</strong>会导致索引失效</p><ul><li>例如 <code>select * from table_name where a + 1 = 2</code></li></ul></li><li><p>在索引的类型上进行数据类型的<strong>隐式转换</strong>，会导致索引失效，</p><ul><li>例如字符串一定要加引号，假设 <code>select * from table_name where a = '1'</code> 会使用到索引，如果写成 <code>select * from table_name where a = 1</code> 则会导致索引失效。</li></ul></li><li><p>在索引中使用<strong>函数</strong>会导致索引失效</p><ul><li>例如 <code>select * from table_name where abs(a) = 1</code></li></ul></li><li><p>在使用 like 查询时<strong>以 % 开头</strong>会导致索引失效</p></li><li><p>索引上使用 ！、=、&lt;> 进行判断时会导致索引失效</p><ul><li>例如 <code>select * from table_name where a != 1</code></li></ul></li><li><p>索引字段上使用 is null/is not null 判断时会导致索引失效</p><ul><li>例如 <code>select * from table_name where a is null</code></li></ul></li></ul><h3 id=索引的相关操作>索引的相关操作</h3><h4 id=索引的创建><strong>索引的创建</strong></h4><h5 id=alter-table><code>ALTER TABLE</code></h5><p>适用于表创建完毕之后再添加。</p><p><code>ALTER TABLE 表名 ADD 索引类型 (unique,primary key,fulltext,index)[索引名](字段名)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=o>`</span><span class=n>index_name</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>column_list</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=c1>-- 索引名，可要可不要；如果不要，当前的索引名就是该字段名。 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>column_list</span><span class=o>`</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>column_list</span><span class=o>`</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=n>FULLTEXT</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>column_list</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=create-index><code>CREATE INDEX</code></h5><p>CREATE INDEX 可对表增加<strong>普通</strong>索引或 <strong>UNIQUE</strong> 索引。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--例：只能添加这两种索引 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=n>column_list</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=n>column_list</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>另外，还可以在建表时添加：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>smallint</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=w> </span><span class=n>UNSIGNED</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 注意，下面创建了主键索引，这里就不用创建了 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=o>`</span><span class=n>username</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>nickname</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;昵称/姓名&#39;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>intro</span><span class=o>`</span><span class=w> </span><span class=nb>text</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>unique1</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>username</span><span class=o>`</span><span class=p>),</span><span class=w> </span><span class=c1>-- 索引名称，可要可不要，不要就是和列名一样 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>index1</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>nickname</span><span class=o>`</span><span class=p>),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>FULLTEXT</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>intro</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>intro</span><span class=o>`</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>MyISAM</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>4</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=w> </span><span class=k>COMMENT</span><span class=o>=</span><span class=s1>&#39;后台用户表&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=索引的删除>索引的删除</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=o>`</span><span class=n>index_name</span><span class=o>`</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=o>`</span><span class=n>talbe_name</span><span class=o>`</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=o>`</span><span class=n>index_name</span><span class=o>`</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 这两句都是等价的,都是删除掉table_name中的索引index_name; 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=c1>-- 删除主键索引，注意主键索引只能用这种方式删除
</span></span></span></code></pre></td></tr></table></div></div><h4 id=索引的查看>索引的查看</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>show</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tablename</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=索引的更改>索引的更改</h4><p>更改个毛线，删掉重建一个既可</p><h3 id=组合索引>组合索引</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>myIndex</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=o>`</span><span class=n>name_city_age</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>vc_Name</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span><span class=n>vc_City</span><span class=p>,</span><span class=n>i_Age</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上述的步骤就是将 vc_Name,vc_City,i_Age 建到一个索引里</p><p>这样一来，在执行这条 SQL 查询语句时：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>`</span><span class=n>i_testID</span><span class=o>`</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=n>myIndex</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=o>`</span><span class=n>vc_Name</span><span class=o>`=</span><span class=s1>&#39;erquan&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=o>`</span><span class=n>vc_City</span><span class=o>`=</span><span class=s1>&#39;郑州&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=o>`</span><span class=n>i_Age</span><span class=o>`=</span><span class=mi>25</span><span class=p>;</span><span class=w> </span><span class=c1>-- 关联搜索;
</span></span></span></code></pre></td></tr></table></div></div><p>查询速度会比只建立某一个字段的单独索引要快得多</p><blockquote><p>如果分别在 vc_Name, vc_City, i_Age 上建立单列索引，让该表有 3 个单列索引，查询的速度将远远低于组合索引。</p><p>虽然此时有了三个索引，但 MySQL 只能用到其中的那个它认为似乎是<strong>最有效率</strong>的单列索引，另外两个是用不到的，也就是说还是一个全表扫描的过程。</p></blockquote><h4 id=最左匹配原则>最左匹配原则</h4><p>建立这样的组合索引，其实是相当于分别建立了：</p><ul><li><code>vc_Name, vc_City, i_Age</code></li><li><code>vc_Name, vc_City</code></li><li><code>vc_Name</code></li></ul><p>为什么没有 <code>vc_City, i_Age</code> 等这样的组合索引呢？这是因为 mysql 组合索引 “最左前缀” 的结果。简单的理解就是<strong>只从最左面的开始组合</strong>。并不是只要包含这三列的查询都会用到该组合索引，下面的几个 T-SQL 会用到：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>myIndex</span><span class=w> </span><span class=n>WHREE</span><span class=w> </span><span class=n>vc_Name</span><span class=o>=</span><span class=err>”</span><span class=n>erquan</span><span class=err>”</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>vc_City</span><span class=o>=</span><span class=err>”郑州”</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>myIndex</span><span class=w> </span><span class=n>WHREE</span><span class=w> </span><span class=n>vc_Name</span><span class=o>=</span><span class=err>”</span><span class=n>erquan</span><span class=err>”</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>而下面几个则不会用到：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>myIndex</span><span class=w> </span><span class=n>WHREE</span><span class=w> </span><span class=n>i_Age</span><span class=o>=</span><span class=mi>20</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>vc_City</span><span class=o>=</span><span class=err>”郑州”</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>myIndex</span><span class=w> </span><span class=n>WHREE</span><span class=w> </span><span class=n>vc_City</span><span class=o>=</span><span class=err>”郑州”</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>也就是，<code>name_city_age(vc_Name(10),vc_City,i_Age)</code> 会<strong>从左到右</strong>进行索引，如果没有左前索引，Mysql 不执行索引查询。</p><h5 id=范围查询后停止匹配>范围查询后停止匹配</h5><p>如果 SQL 语句中用到了组合索引中的最左边的索引，那么这条 SQL 语句就可以利用这个组合索引去进行匹配。</p><p><strong>当遇到范围查询 (<code>></code>、<code>&lt;</code>、<code>between</code>、<code>like</code>) 后就会停止匹配，后面的字段不会用到索引</strong>。</p><p>例</p><ul><li><p>对<code>(a,b,c)</code>建立索引，查询条件使用 a/ab/abc 会走索引，使用 bc 不会走索引。</p></li><li><p>对<code>(a,b,c,d)</code>建立索引，查询条件为<code>a = 1 and b = 2 and c > 3 and d = 4</code>，那么 a、b 和 c 三个字段能用到索引，而 d 无法使用索引。因为遇到了范围查询。</p></li></ul><p>如下图，对 (a, b) 建立索引，a 在索引树中是全局有序的，而 b 是全局无序，局部有序（当 a 相等时，会根据 b 进行排序）。直接执行 <code>b = 2</code> 这种查询条件无法使用索引。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-abcd73c11c1b363a704299fb0366a8a8_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-abcd73c11c1b363a704299fb0366a8a8_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-abcd73c11c1b363a704299fb0366a8a8_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-abcd73c11c1b363a704299fb0366a8a8_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-abcd73c11c1b363a704299fb0366a8a8_1440w.jpg title=img></p><p>当 a 的值确定的时候，b 是有序的。例如 <code>a = 1</code> 时，b 值为 1，2 是有序的状态。当 <code>a = 2</code> 时候，b 的值为 1，4 也是有序状态。 当执行 <code>a = 1 and b = 2</code> 时 a 和 b 字段能用到索引。而执行 <code>a > 1 and b = 2</code> 时，a 字段能用到索引，b 字段用不到索引。因为 a 的值此时是一个范围，不是固定的，在这个范围内 b 值不是有序的，因此 b 字段无法使用索引。</p><h5 id=例>例</h5><p>例如建立索引 (a,b,c)</p><p>第一种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上面两次查询过程中所有值都用到了索引，<strong>where 后面字段调换不会影响查询结果</strong>，因为 MySQL 中的优化器会自动优化查询顺序。</p><p>第二种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>答案是三个查询语句都用到了索引，因为三个语句都是从最左开始匹配的。</p><p>第三种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w>  </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w>  </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> 
</span></span></span></code></pre></td></tr></table></div></div><p>答案是这两个查询语句都没有用到索引，因为不是从最左边开始匹配的</p><p>第四种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这个查询语句只有 a 列用到了索引，c 列没有用到索引，因为中间跳过了 b 列，不是从最左开始连续匹配的。</p><p>第五种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w>  </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这个查询中只有 a 列和 b 列使用到了索引，而 c 列没有使用索引，因为根据最左匹配查询原则，遇到范围查询会停止。</p><p>第六种</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;ab%&#39;</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w>  </span><span class=n>a</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;%ab&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w>  </span><span class=n>a</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;%ab%&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于列为字符串的情况，只有前缀匹配可以使用索引，中缀匹配和后缀匹配只能进行全表扫描。</p><h3 id=聚集索引>聚集索引</h3><p><code>InnoDB</code> 使用表的主键构造主键索引树，同时叶子节点中存放的即为整张表的记录数据，这就是聚集索引 / 聚簇索引（Cluster Index）</p><p>聚集索引叶子节点的存储是逻辑上连续的，使用双向链表连接，叶子节点按照主键的顺序排序，因此对于主键的排序查找和范围查找速度比较快。</p><p><strong>聚集索引的叶子节点就是整张表的行记录</strong>。InnoDB 主键使用的就是聚集索引。聚集索引要比非聚集索引查询效率高很多。</p><p>对于 <code>InnoDB</code> 来说，聚集索引一般是表中的主键索引</p><ul><li>如果表中没有显式地指定主键，则会选择表中的第一个不允许为 <code>NULL</code> 的唯一索引。</li><li>如果没有主键也没有合适的唯一索引，那么<code>InnoDB</code>内部会生成一个<strong>隐藏的主键</strong>作为聚集索引，这个隐藏的主键长度为 6 个字节，它的值会随着数据的插入自增。</li></ul><p>除了 Cluster Index 外的索引是 <strong>Secondary Index (辅助索引或二级索引)</strong>。辅助索引中的叶子节点保存的是聚簇索引的叶子节点的值。</p><h3 id=覆盖索引>覆盖索引</h3><p><strong>如果一个索引包含（或者说覆盖）所有需要查询的字段的值，我们就称之为“覆盖索引”。</strong></p><p>换句话说，<strong>覆盖索引即需要查询的字段正好是索引的字段，那么直接根据该索引，就可以查到数据了， 而无需回表查询。</strong></p><p>对于 <code>innodb</code> 表的二级索引，如果索引能覆盖到查询的列，那么就可以避免对主键索引的二次查询。</p><blockquote><p>不是所有类型的索引都可以成为覆盖索引。覆盖索引要存储索引列的值，而哈希索引、全文索引不存储索引列的值，所以 MySQL 使用 b+ 树索引做覆盖索引。</p></blockquote><h4 id=语法>语法</h4><p>对于使用了覆盖索引的查询，在查询前面使用 <code>explain</code>，输出的 extra 列会显示为 <code>using index</code>。</p><p>比如 <code>user_like</code> 用户点赞表，组合索引为 <code>(user_id, blog_id)</code>，<code>user_id</code> 和 <code>blog_id</code> 都不为 <code>null</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>explain</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>blog_id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>user_like</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>13</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>explain</code> 结果的 <code>Extra</code> 列为 <code>Using index</code>，<strong>查询的列被索引覆盖</strong>，并且 where 筛选条件符合最左前缀原则，通过<strong>索引查找</strong>就能直接找到符合条件的数据，不需要回表查询数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>explain</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>user_like</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>blog_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>explain</code> 结果的 <code>Extra</code> 列为 <code>Using where; Using index</code>， 查询的列被索引覆盖，where 筛选条件不符合最左前缀原则，无法通过索引查找找到符合条件的数据，但可以通过<strong>索引扫描</strong>找到符合条件的数据，也不需要回表查询数据。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-7eb2565360584ef8dda13da503f96137_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-7eb2565360584ef8dda13da503f96137_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-7eb2565360584ef8dda13da503f96137_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-7eb2565360584ef8dda13da503f96137_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-7eb2565360584ef8dda13da503f96137_1440w.jpg title=img></p><h3 id=前缀索引><strong>前缀索引</strong></h3><p>前缀索引是指对文本或者字符串的前几个字符建立索引，这样索引的长度更短，查询速度更快。</p><p>如果索引列长度过长，这种列索引时将会产生很大的索引文件，不便于操作，可以使用前缀索引方式进行索引前缀索引应该控制在一个合适的点，控制在 0.31 黄金值即可（大于这个值就可以创建）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=k>DISTINCT</span><span class=p>(</span><span class=k>LEFT</span><span class=p>(</span><span class=o>`</span><span class=n>title</span><span class=o>`</span><span class=p>,</span><span class=mi>10</span><span class=p>)))</span><span class=o>/</span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Arctic</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这个值大于 0.31 就可以创建前缀索引，Distinct 去重复</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=o>`</span><span class=n>uname</span><span class=o>`</span><span class=p>(</span><span class=n>title</span><span class=p>(</span><span class=mi>10</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>增加前缀索引 SQL，将人名的索引建立在 10，这样可以减少索引文件大小，加快索引查询速度。</p><p>建立前缀索引的方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=n>email列创建前缀索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=k>column_name</span><span class=p>(</span><span class=n>prefix_length</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=常见的存储引擎>常见的存储引擎</h2><p>MySQL 中常用的四种存储引擎分别是： <strong>MyISAM</strong>、<strong>InnoDB</strong>、<strong>MEMORY</strong>、<strong>ARCHIVE</strong>。MySQL 5.5 版本后默认的存储引擎为 <code>InnoDB</code>。</p><h3 id=innodb-存储引擎>InnoDB 存储引擎</h3><p>InnoDB 是 MySQL <strong>默认的事务型存储引擎</strong>，使用最广泛，基于聚簇索引建立的。InnoDB 内部做了很多优化，如能够自动在内存中创建自适应 hash 索引，以加速读操作。</p><p><strong>优点</strong>：支持事务和崩溃修复能力；引入了行级锁和外键约束。</p><p><strong>缺点</strong>：占用的数据空间相对较大。</p><p><strong>适用场景</strong>：需要事务支持，并且有较高的并发读写频率。</p><h3 id=myisam-存储引擎>MyISAM 存储引擎</h3><p>数据以紧密格式存储。对于只读数据，或者表比较小、可以容忍修复操作，可以使用 MyISAM 引擎。MyISAM 会将表存储在两个文件中，数据文件 <code>.MYD</code> 和索引文件 <code>.MYI</code>。</p><p><strong>优点</strong>：访问速度快。</p><p><strong>缺点</strong>：MyISAM 不支持事务和行级锁，不支持崩溃后的安全恢复，也不支持外键。</p><p><strong>适用场景</strong>：对事务完整性没有要求；表的数据都会只读的。</p><h3 id=memory-存储引擎>MEMORY 存储引擎</h3><p>MEMORY 引擎将数据全部放在内存中，访问速度较快，但是一旦系统奔溃的话，数据都会丢失。</p><p>MEMORY 引擎默认使用哈希索引，将键的哈希值和指向数据行的指针保存在哈希索引中。</p><p><strong>优点</strong>：访问速度较快。</p><p><strong>缺点</strong>：</p><ol><li>哈希索引数据不是按照索引值顺序存储，无法用于排序。</li><li>不支持部分索引匹配查找，因为哈希索引是使用索引列的全部内容来计算哈希值的。</li><li>只支持等值比较，不支持范围查询。</li><li>当出现哈希冲突时，存储引擎需要遍历链表中所有的行指针，逐行进行比较，直到找到符合条件的行。</li></ol><h3 id=archive-存储引擎>ARCHIVE 存储引擎</h3><p>ARCHIVE 存储引擎非常适合存储大量独立的、作为历史记录的数据。ARCHIVE 提供了压缩功能，拥有高效的插入速度，但是这种引擎不支持索引，所以查询性能较差。</p><h3 id=myisam-和-innodb-的区别>MyISAM 和 InnoDB 的区别</h3><ol><li><strong>是否支持行级锁</strong> : <code>MyISAM</code> 只有表级锁，而 <code>InnoDB</code> 支持行级锁和表级锁，默认为行级锁。</li><li><strong>是否支持事务和崩溃后的安全恢复</strong>： <code>MyISAM</code> 不提供事务支持。而 <code>InnoDB</code> 提供事务支持，具有事务、回滚和崩溃修复能力。</li><li><strong>是否支持外键：</strong><code>MyISAM</code> 不支持，而 <code>InnoDB</code> 支持。</li><li><strong>是否支持MVCC</strong> ：<code>MyISAM</code> 不支持，<code>InnoDB</code> 支持。应对高并发事务，MVCC 比单纯的加锁更高效。</li><li><code>MyISAM</code> 不支持聚集索引，<code>InnoDB</code> 支持聚集索引。</li></ol><h2 id=mvcc>MVCC</h2><p><strong>多版本并发控制</strong> MVCC (<code>Multiversion concurrency control</code>) 就是同一份数据保留多版本的一种方式，进而实现并发控制。在查询的时候，通过 <code>read view</code> 和版本链找到对应版本的数据。</p><p>为什么需要 MVCC 呢？</p><ul><li>数据库通常使用锁来实现隔离性。最原生的锁，锁住一个资源后会禁止其他任何线程访问同一个资源。<ul><li>但是很多应用的一个特点都是读多写少的场景，很多数据的读取次数远大于修改的次数，而读取数据间互相排斥显得不是很必要。</li><li>所以就使用了一种读写锁的方法，读锁和读锁之间不互斥，而写锁和写锁、读锁都互斥。这样就很大提升了系统的并发能力。</li></ul></li><li>之后人们发现并发读还是不够，又提出了能不能让读写之间也不冲突的方法，就是读取数据时通过一种类似<strong>快照</strong>的方式将数据保存下来，这样读锁就和写锁不冲突了，不同的事务 session 会看到自己特定版本的数据。<ul><li>当然快照是一种概念模型，不同的数据库可能用不同的方式来实现这种功能。</li></ul></li></ul><p>作用</p><ul><li>在不加锁的情况下，解决数据库读写冲突问题，并且解决脏读、幻读、不可重复读等问题，但是不能解决丢失修改问题。</li><li>提升并发性能。对于高并发场景，MVCC 比行级锁开销更小</li></ul><h3 id=innodb-与-mvcc>InnoDB 与 MVCC</h3><p>MVCC 只在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下工作。其他两个隔离级别够和 MVCC 不兼容，因为 READ UNCOMMITTED 总是读取最新的数据行, 而不是符合当前事务版本的数据行。而 SERIALIZABLE 则会对所有读取的行都加锁。</p><h3 id=mvcc-实现原理>MVCC 实现原理</h3><h4 id=版本链>版本链</h4><p>MVCC 的实现依赖于<strong>版本链</strong>，版本链是通过表的三个隐藏字段实现。</p><ul><li><code>DB_TRX_ID</code>：当前事务 id，通过事务 id 的大小判断事务的时间顺序。</li><li><code>DB_ROLL_PTR</code>：回滚指针，指向当前行记录的上一个版本，通过这个指针将数据的多个版本连接在一起构成 <code>undo log</code> 版本链。</li><li><code>DB_ROW_ID</code>：主键，如果数据表没有主键，InnoDB 会自动生成主键。</li></ul><p>每条表记录大概是这样的：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-3f2f8eaa0fc8e9b04300f0510fd729dd_1440w.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-3f2f8eaa0fc8e9b04300f0510fd729dd_1440w.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-3f2f8eaa0fc8e9b04300f0510fd729dd_1440w.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-3f2f8eaa0fc8e9b04300f0510fd729dd_1440w.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-3f2f8eaa0fc8e9b04300f0510fd729dd_1440w.png title=img></p><p>MVCC 做使用到的快照会存储在 Undo 日志中，该日志通过回滚指针将一个一个数据行的所有快照连接起来。</p><p><strong>使用事务更新行记录</strong>的时候，就会生成版本链，执行过程如下：</p><ol><li>用排他锁锁住该行；</li><li>将该行原本的值拷贝到 <code>undo log</code>，作为旧版本用于回滚；</li><li>修改当前行的值，生成一个新版本，更新事务 id，使回滚指针指向旧版本的记录，这样就形成一条版本链。</li></ol><p>下面举个例子方便大家理解。</p><p>1、初始数据如下，其中 <code>DB_ROW_ID</code> 和 <code>DB_ROLL_PTR</code> 为空。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d2b36b948324e799ad4aebb500b67bf5_1440w.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d2b36b948324e799ad4aebb500b67bf5_1440w.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d2b36b948324e799ad4aebb500b67bf5_1440w.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d2b36b948324e799ad4aebb500b67bf5_1440w.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d2b36b948324e799ad4aebb500b67bf5_1440w.png title=img></p><p>2、事务 A 对该行数据做了修改，将 <code>age</code> 修改为 12，效果如下：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-6d0a605471a5b9352e45fa30283c8b18_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-6d0a605471a5b9352e45fa30283c8b18_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-6d0a605471a5b9352e45fa30283c8b18_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-6d0a605471a5b9352e45fa30283c8b18_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-6d0a605471a5b9352e45fa30283c8b18_1440w.jpg title=img></p><p>3、之后事务 B 也对该行记录做了修改，将 <code>age</code> 修改为 8，效果如下：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-66a5a2a01161dc3a8e34ca8629606b71_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-66a5a2a01161dc3a8e34ca8629606b71_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-66a5a2a01161dc3a8e34ca8629606b71_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-66a5a2a01161dc3a8e34ca8629606b71_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-66a5a2a01161dc3a8e34ca8629606b71_1440w.jpg title=img></p><p>4、此时 undo log 有两行记录，并且通过回滚指针连在一起。</p><h3 id=read-view-快照>read view 快照</h3><p><code>read view</code> 可以理解成将数据在每个时刻的状态拍成 “照片” 记录下来。在获取某时刻 t 的数据时，到 t 时间点拍的 “照片” 上取数据。</p><p><code>read view</code> 中主要就是<strong>有个列表来存储我们系统中当前活跃着的读写事务</strong>，也就是 begin 了还未提交的事务。通过这个列表来判断记录的某个版本是否对当前事务可见。</p><p>在 <code>read view</code> 内部维护一个活跃事务链表，表示生成 <code>read view</code> 的时候还在活跃的事务。这个链表包含在创建 <code>read view</code> 之前还未提交的事务，不包含创建 <code>read view</code> 之后提交的事务。</p><p>不同隔离级别创建 read view 的时机不同。</p><ul><li>read committed：每次执行 select 都会创建新的 read_view，保证能读取到其他事务已经提交的修改。</li><li>repeatable read：在一个事务范围内，第一次 select 时更新这个 read_view，以后不会再更新，后续所有的 select 都是复用之前的 read_view。这样可以保证事务范围内每次读取的内容都一样，即可重复读。</li></ul><h4 id=read-view-的记录筛选方式>read view 的记录筛选方式</h4><ul><li><code>trx_ids</code>: 当前系统活跃 (<code>未提交</code>) 事务版本号集合</li><li><code>up_limit_id</code>：表示创建当前快照中的最先开始的事务；</li><li><code>low_limit_id</code> 表示当前快照中的最慢开始的事务，即最后一个事务。</li></ul><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-fef7954f5e3c7713f48b35597e7f9fb8_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-fef7954f5e3c7713f48b35597e7f9fb8_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-fef7954f5e3c7713f48b35597e7f9fb8_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-fef7954f5e3c7713f48b35597e7f9fb8_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-fef7954f5e3c7713f48b35597e7f9fb8_1440w.jpg title=img></p><h3 id=举例>举例</h3><p>比如我们有如下表：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9fa606c971981ff9986534f957172972_1440w.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9fa606c971981ff9986534f957172972_1440w.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9fa606c971981ff9986534f957172972_1440w.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9fa606c971981ff9986534f957172972_1440w.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9fa606c971981ff9986534f957172972_1440w.png title=img></p><p>现在有一个事务 id 是 60 的执行如下语句并提交：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;强哥1&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>此时 undo log 存在版本链如下：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1bede18add6acd88fbc4fb0c50db2606_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1bede18add6acd88fbc4fb0c50db2606_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1bede18add6acd88fbc4fb0c50db2606_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1bede18add6acd88fbc4fb0c50db2606_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1bede18add6acd88fbc4fb0c50db2606_1440w.jpg title=img></p><p>提交事务 id 是 60 的记录后，接着有一个事务 id 为 100 的事务，修改 name=强哥 2，但是事务还没提交。则此时的版本链是：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-cd43dd12a224c36984bd4c12188a2835_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-cd43dd12a224c36984bd4c12188a2835_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-cd43dd12a224c36984bd4c12188a2835_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-cd43dd12a224c36984bd4c12188a2835_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-cd43dd12a224c36984bd4c12188a2835_1440w.jpg title=img></p><p>此时另一个事务发起 select 语句查询 id=1 的记录，因为 trx_ids 当前只有事务 id 为 100 的，所以该条记录不可见，继续查询下一条，发现 trx_id=60 的事务号小于 up_limit_id，则可见，直接返回结果强哥 1。</p><p>那这时候我们把事务 id 为 100 的事务提交了，并且新建了一个事务 id 为 110 也修改 id 为 1 的记录 name=强哥 3，并且不提交事务。这时候版本链就是：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-dc6fa9d9b0db63312160fb61ca464dfd_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-dc6fa9d9b0db63312160fb61ca464dfd_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-dc6fa9d9b0db63312160fb61ca464dfd_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-dc6fa9d9b0db63312160fb61ca464dfd_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-dc6fa9d9b0db63312160fb61ca464dfd_1440w.jpg title=img></p><p>这时候之前那个 select 事务又执行了一次查询,要查询 id 为 1 的记录。</p><ul><li><p>如果你是已提交读隔离级别 READ_COMMITED，这时候你会重新一个 ReadView，那你的活动事务列表中的值就变了，变成了 [110]。按照上的说法，你去版本链通过 trx_id 对比查找到合适的结果就是强哥 2。</p></li><li><p>如果你是可重复读隔离级别 REPEATABLE_READ，这时候你的 ReadView 还是第一次 select 时候生成的 ReadView,也就是列表的值还是 [100]。所以 select 的结果是强哥 1。所以第二次 select 结果和第一次一样，所以叫可重复读！</p></li></ul><p>也就是说已提交读隔离级别下的事务在每次查询的开始都会生成一个独立的 ReadView,而可重复读隔离级别则在第一次读的时候生成一个 ReadView，之后的读都复用之前的 ReadView。</p><p>这就是 Mysql 的 MVCC；通过版本链，实现多版本，可并发读 - 写，写 - 读。通过 ReadView 生成策略的不同实现不同的隔离级别。</p><p><strong>总结</strong>：InnoDB 的 <code>MVCC</code> 是通过 <code>read view</code> 和版本链实现的，版本链保存有历史版本记录，通过 <code>read view</code> 判断当前版本的数据是否可见，如果不可见，再从版本链中找到上一个版本，继续进行判断，直到找到一个可见的版本。</p><h2 id=快照读和当前读>快照读和当前读</h2><p>表记录有两种读取方式。</p><ul><li><p>快照读：读取的是快照版本。通过 mvcc 来进行并发控制的，不用加锁。</p><ul><li><strong>普通的 <code>SELECT</code> 就是快照读</strong>。</li></ul></li><li><p>当前读：读取的是最新版本。需要加锁</p><ul><li><strong><code>UPDATE、DELETE、INSERT、SELECT … LOCK IN SHARE MODE、SELECT … FOR UPDATE</code> 是当前读</strong>。</li></ul></li></ul><p>快照读情况下，InnoDB 通过 <code>mvcc</code> 机制避免了幻读现象。而 <code>mvcc</code> 机制无法避免当前读情况下出现的幻读现象。因为当前读每次读取的都是最新数据，这时如果两次查询中间有其它事务插入数据，就会产生幻读。</p><p>下面举个例子说明下：</p><p>1、首先，user 表只有两条记录，具体如下：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-0a1b094961545351dab266afc9771490_1440w.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-0a1b094961545351dab266afc9771490_1440w.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-0a1b094961545351dab266afc9771490_1440w.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-0a1b094961545351dab266afc9771490_1440w.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-0a1b094961545351dab266afc9771490_1440w.png title=img></p><p>2、事务 a 和事务 b 同时开启事务 <code>start transaction</code>；</p><p>3、事务 a 插入数据然后提交；</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=k>user</span><span class=p>(</span><span class=n>user_name</span><span class=p>,</span><span class=w> </span><span class=n>user_password</span><span class=p>,</span><span class=w> </span><span class=n>user_mail</span><span class=p>,</span><span class=w> </span><span class=n>user_state</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=s1>&#39;tyson&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>4、事务 b 执行全表的 update；</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>user_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>5、事务 b 然后执行查询，查到了事务 a 中插入的数据。（下图左边是事务 b，右边是事务 a。事务开始之前只有两条记录，事务 a 插入一条数据之后，事务 b 查询出来是三条数据）</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d29cd6193625c5f0691ce921c47822b1_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d29cd6193625c5f0691ce921c47822b1_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d29cd6193625c5f0691ce921c47822b1_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d29cd6193625c5f0691ce921c47822b1_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-d29cd6193625c5f0691ce921c47822b1_1440w.jpg title=img></p><p>以上就是当前读出现的幻读现象。</p><p><strong>那么 MySQL 是如何避免幻读的？</strong></p><ul><li>在快照读情况下，MySQL 通过 <code>mvcc</code> 来避免幻读。</li><li>在当前读情况下，MySQL 通过 <code>next-key</code> 来避免幻读（加行锁和间隙锁来实现的）。</li></ul><p>next-key 包括两部分：行锁和间隙锁。行锁是加在索引上的锁，间隙锁是加在索引之间的。</p><p><code>Serializable</code> 隔离级别也可以避免幻读，会锁住整张表，并发性极低，一般不会使用。</p><h2 id=锁机制>锁机制</h2><h3 id=数据库锁与隔离级别的关系>数据库锁与隔离级别的关系、</h3><table><thead><tr><th>隔离级别</th><th>实现方式</th></tr></thead><tbody><tr><td>读未提交</td><td>总是读取最新的数据，无需加锁</td></tr><tr><td>读已提交</td><td>读取数据时加共享锁，读取数据后释放共享锁</td></tr><tr><td>可重复读</td><td>读取数据时加共享锁，事务结束后释放共享锁</td></tr><tr><td>串行化</td><td>锁定整个范围的键，一直持有锁直到事务结束</td></tr></tbody></table><h3 id=数据库锁的类型>数据库锁的类型</h3><p>按照锁的粒度可以将 MySQL 锁分为三种：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220819134320945.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220819134320945.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220819134320945.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220819134320945.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220819134320945.png title=image-20220819134320945></p><p>MyISAM 默认采用表级锁，InnoDB 默认采用行级锁。</p><p>从锁的类别上区别可以分为共享锁和排他锁</p><ul><li><p>共享锁：<strong>共享锁又称读锁</strong>，简写为 S 锁</p><ul><li>一个事务对一个数据对象加了 S 锁，可以对这个数据对象进行读取操作，但不能进行更新操作。</li><li>并且在加锁期间其他事务只能对这个数据对象加 S 锁，不能加 X 锁。</li></ul></li><li><p>排他锁：<strong>排他锁又称为写锁</strong>，简写为 X 锁</p><ul><li>一个事务对一个数据对象加了 X 锁，可以对这个对象进行读取和更新操作</li><li>加锁期间，其他事务不能对该数据对象进行加 X 锁或 S 锁。</li></ul></li></ul><h3 id=innodb-的行锁实现>InnoDB 的行锁实现</h3><p>行锁实现方式：InnoDB 的行锁是通过给索引上的索引项加锁实现的，如果没有索引，InnoDB 将通过隐藏的聚簇索引来对记录进行加锁。</p><p>InnoDB 行锁主要分三种情况：</p><ul><li>Record lock：对索引项加锁</li><li>Grap lock：对索引之间的“间隙”、第一条记录前的“间隙”或最后一条后的间隙加锁。</li><li>Next-key lock：前两种放入组合，对记录及前面的间隙加锁。</li></ul><p>InnoDB 行锁的特性：如果不通过索引条件检索数据，那么 InnoDB 将对表中所有记录加锁，实际产生的效果和表锁是一样的。</p><p>MVCC 不能解决幻读问题，在可重复读隔离级别下，使用 MVCC + Next-Key Locks 可以解决幻读问题。</p><h2 id=bin-log--redo-log--undo-log>bin log / redo log / undo log</h2><p>MySQL 日志主要包括查询日志、慢查询日志、事务日志、错误日志、二进制日志等。其中比较重要的是 <code>bin log</code>（二进制日志）和 <code>redo log</code>（重做日志）和 <code>undo log</code>（回滚日志）。</p><h3 id=bin-log><strong>bin log</strong></h3><p><code>bin log</code> 是 MySQL <strong>数据库级别</strong>的文件，记录对 MySQL 数据库执行修改的所有操作，不会记录 select 和 show 语句，主要用于恢复数据库和同步数据库。</p><h3 id=redo-log><strong>redo log</strong></h3><p><code>redo log</code> 是 innodb <strong>引擎级别</strong>，用来记录 innodb 存储引擎的事务日志，不管事务是否提交都会记录下来，用于数据恢复。</p><p>当数据库发生故障，innoDB 存储引擎会使用 <code>redo log</code> 恢复到发生故障前的时刻，以此来保证数据的完整性。将参数 <code>innodb_flush_log_at_tx_commit</code> 设置为 1，那么在执行 commit 时会将 <code>redo log</code> 同步写到磁盘。</p><h3 id=undo-log><strong>undo log</strong></h3><p>除了记录 <code>redo log</code> 外，当进行数据修改时还会记录 <code>undo log</code>，<code>undo log</code> 用于数据的<strong>撤回</strong>操作，它保留了记录修改前的内容。</p><p>通过 <code>undo log</code> 可以<strong>实现事务回滚</strong>，并且可以根据 <code>undo log</code> 回溯到某个特定的版本的数据，<strong>实现 MVCC</strong>。</p><h3 id=bin-log-和-redo-log-有什么区别>bin log 和 redo log 有什么区别？</h3><ol><li><code>bin log</code> 会记录所有日志记录，包括 InnoDB、MyISAM 等存储引擎的日志；<code>redo log</code> 只记录 innoDB 自身的事务日志。</li><li><code>bin log</code> 只在事务提交前写入到磁盘，一个事务只写一次；而在事务进行过程，会有 <code>redo log</code> 不断写入磁盘。</li><li><code>bin log</code> 是逻辑日志，记录的是 SQL 语句的原始逻辑；<code>redo log</code> 是物理日志，记录的是在某个数据页上做了什么修改。</li></ol><h2 id=mysql-架构>MySQL 架构</h2><p>MySQL 主要分为 Server 层和存储引擎层：</p><ul><li><strong>Server 层</strong>：主要包括连接器、查询缓存、分析器、优化器、执行器等，所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图，函数等，还有一个通用的日志模块 binglog 日志模块。<ul><li><strong>连接器：</strong> 当客户端连接 MySQL 时，server 层会对其进行身份认证和权限校验。</li><li><strong>查询缓存:</strong> 执行查询语句的时候，会先查询缓存，先校验这个 sql 是否执行过，如果有缓存这个 sql，就会直接返回给客户端，如果没有命中，就会执行后续的操作。</li><li>**分析器：**没有命中缓存的话，SQL 语句就会经过分析器，主要分为两步，词法分析和语法分析，先看 SQL 语句要做什么，再检查 SQL 语句语法是否正确。</li><li><strong>优化器：</strong> 优化器对查询进行优化，包括重写查询、决定表的读写顺序以及选择合适的索引等，生成执行计划。</li><li><strong>执行器：</strong> 首先执行前会校验该用户有没有权限，如果没有权限，就会返回错误信息，如果有权限，就会根据执行计划去调用引擎的接口，返回结果。</li></ul></li><li><strong>存储引擎层</strong>： 主要负责数据的存储和读取。server 层通过 api 与存储引擎进行通信。</li></ul><h2 id=分库分表>分库分表</h2><p>当单表的数据量达到 1000W 或 100G 以后，优化索引、添加从库等可能对数据库性能提升效果不明显，此时就要考虑对其进行切分了。切分的目的就在于减少数据库的负担，缩短查询的时间。</p><p>数据切分可以分为两种方式：垂直划分和水平划分。</p><h3 id=两种方式>两种方式</h3><h4 id=垂直划分>垂直划分</h4><p>垂直划分数据库是根据业务进行划分，例如购物场景，可以将库中涉及商品、订单、用户的表分别划分出成一个库，通过降低单库的大小来提高性能。同样的，分表的情况就是将一个大表根据业务功能拆分成一个个子表，例如商品基本信息和商品描述，商品基本信息一般会展示在商品列表，商品描述在商品详情页，可以将商品基本信息和商品描述拆分成两张表。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1a3cfa1645cb5c1812e1d2d0a713835e_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1a3cfa1645cb5c1812e1d2d0a713835e_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1a3cfa1645cb5c1812e1d2d0a713835e_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1a3cfa1645cb5c1812e1d2d0a713835e_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-1a3cfa1645cb5c1812e1d2d0a713835e_1440w.jpg title=img></p><p><strong>优点</strong>：行记录变小，数据页可以存放更多记录，在查询时减少 I/O 次数。</p><p><strong>缺点</strong>：</p><ul><li>主键出现冗余，需要管理冗余列；</li><li>会引起表连接 JOIN 操作，可以通过在业务服务器上进行 join 来减少数据库压力；</li><li>依然存在单表数据量过大的问题。</li></ul><h4 id=水平划分>水平划分</h4><p>水平划分是根据一定规则，例如时间或 id 序列值等进行数据的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据得以拆分，从而提升性能。</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-406d883a97128e9e4b1ea6f97afd1108_1440w.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-406d883a97128e9e4b1ea6f97afd1108_1440w.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-406d883a97128e9e4b1ea6f97afd1108_1440w.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-406d883a97128e9e4b1ea6f97afd1108_1440w.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-406d883a97128e9e4b1ea6f97afd1108_1440w.jpg title=img></p><p><strong>优点</strong>：单库（表）的数据量得以减少，提高性能；切分出的表结构相同，程序改动较少。</p><p><strong>缺点</strong>：</p><ul><li>分片事务一致性难以解决</li><li>跨节点 <code>join</code> 性能差，逻辑复杂</li><li>数据分片在扩容时需要迁移</li></ul><h3 id=分区表>分区表</h3><p>分区是把一张表的数据分成 N 多个区块。<strong>分区表是一个独立的逻辑表，但是底层由多个物理子表组成。</strong></p><p>当查询条件的数据分布在某一个分区的时候，查询引擎只会去某一个分区查询，而不是遍历整个表。在管理层面，如果需要删除某一个分区的数据，只需要删除对应的分区即可。</p><p>分区一般都是放在单机里的，用的比较多的是时间范围分区，方便归档。只不过<strong>分库分表需要代码实现，分区则是 mysql 内部实现。分库分表和分区并不冲突，可以结合使用。</strong></p><h3 id=分区表类型>分区表类型</h3><h4 id=range-分区>range 分区</h4><p>按照范围分区。比如按照时间范围分区</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>test_range_partition</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=n>auto_increment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>createdate</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>createdate</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>RANGE</span><span class=w> </span><span class=p>(</span><span class=n>TO_DAYS</span><span class=p>(</span><span class=n>createdate</span><span class=p>)</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201801</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180201&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201802</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180301&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201803</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180401&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201804</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180501&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201805</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180601&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201806</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180701&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201807</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180801&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201808</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20180901&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201809</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20181001&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201810</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20181101&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201811</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20181201&#39;</span><span class=p>)</span><span class=w> </span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p201812</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>TO_DAYS</span><span class=p>(</span><span class=s1>&#39;20190101&#39;</span><span class=p>)</span><span class=w> </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在 <code>/var/lib/mysql/data/</code> 可以找到对应的数据文件，每个分区表都有一个使用 <code>#</code> 分隔命名的表文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>   </span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=c1>----- 1 MySQL MySQL    65 Mar 14 21:47 db.opt
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>   </span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=c1>----- 1 MySQL MySQL  8598 Mar 14 21:50 test_range_partition.frm
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>   </span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=c1>----- 1 MySQL MySQL 98304 Mar 14 21:50 test_range_partition#P#p201801.ibd
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>   </span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=c1>----- 1 MySQL MySQL 98304 Mar 14 21:50 test_range_partition#P#p201802.ibd
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>   </span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=c1>----- 1 MySQL MySQL 98304 Mar 14 21:50 test_range_partition#P#p201803.ibd
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=list-分区>list 分区</h4><p>list 分区和 range 分区相似，主要区别在于 list 是枚举值（离散）列表的集合，range 是连续的区间值的集合。</p><p>对于 list 分区，分区字段必须是<strong>已知</strong>的，如果插入的字段不在分区时的枚举值中，将无法插入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test_list_partiotion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>id</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=n>auto_increment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>data_type</span><span class=w> </span><span class=n>tinyint</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>data_type</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>)</span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>list</span><span class=p>(</span><span class=n>data_type</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>partition</span><span class=w> </span><span class=n>p0</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>partition</span><span class=w> </span><span class=n>p1</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>partition</span><span class=w> </span><span class=n>p2</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=mi>16</span><span class=p>,</span><span class=mi>17</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=hash-分区>hash 分区</h4><p>可以将数据均匀地分布到预先定义的分区中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test_hash_partiotion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>id</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=n>auto_increment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>create_date</span><span class=w> </span><span class=n>datetime</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>create_date</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>)</span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>hash</span><span class=p>(</span><span class=k>year</span><span class=p>(</span><span class=n>create_date</span><span class=p>))</span><span class=w> </span><span class=n>partitions</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=分区的问题>分区的问题</h3><ol><li>打开和锁住所有底层表的成本可能很高。当查询访问分区表时，MySQL 需要打开并锁住所有的底层表，这个操作在分区过滤之前发生，所以无法通过分区过滤来降低此开销，会影响到查询速度。可以通过批量操作来降低此类开销，比如批量插入、<code>LOAD DATA INFILE</code> 和一次删除多行数据。</li><li>维护分区的成本可能很高。例如重组分区，会先创建一个临时分区，然后将数据复制到其中，最后再删除原分区。</li><li>所有分区必须使用相同的存储引擎。</li></ol><h2 id=主从同步>主从同步</h2><h3 id=定义>定义</h3><h4 id=什么是主从同步>什么是主从同步</h4><p>主从同步 / 主从复制使得<strong>数据可以从一个数据库服务器复制到其他服务器上</strong>，在复制数据时，一个服务器充当主服务器（<code>master</code>），其余的服务器充当从服务器（<code>slave</code>）。</p><p>因为复制是异步进行的，所以从服务器不需要一直连接着主服务器，从服务器甚至可以通过拨号断断续续地连接主服务器。通过配置文件，可以指定复制所有的数据库，某个数据库，甚至是某个数据库上的某个表。</p><h4 id=为什么要做主从同步>为什么要做主从同步</h4><ol><li>读写分离，使数据库能支撑更大的并发。</li><li>在主服务器上生成实时数据，而在从服务器上分析这些数据，从而提高主服务器的性能。</li><li>数据备份，保证数据的安全。</li></ol><h4 id=读写分离>读写分离</h4><p>读写分离主要依赖于主从复制，主从复制为读写分离服务。</p><p>读写分离的优势：</p><ul><li>主服务器负责写，从服务器负责读，<strong>缓解了锁的竞争</strong></li><li><strong>从服务器可以使用 MyISAM</strong>，提升查询性能及节约系统开销</li><li><strong>增加冗余</strong>，提高可用性</li></ul><h3 id=主从复制的实现>主从复制的实现</h3><p>为保证主服务器和从服务器的数据一致性，在向主服务器插入数据后，从服务器会自动将主服务器中修改的数据同步过来。</p><p>主从复制主要有三个线程：binlog 线程，I/O 线程，SQL 线程。</p><ul><li>binlog 线程：负责将主服务器上的数据更改写入到二进制日志（Binary log）中</li><li>I/O 线程：负责从主服务器上读取 bin log，并写入从服务器的中继日志（Relay log）中</li><li>SQL 线程：负责读取中继日志，解析出主服务器中已经执行的数据更改并在从服务器中重放</li></ul><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/cfc5c1bd741803f8ce6208cb8666657a.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/cfc5c1bd741803f8ce6208cb8666657a.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/cfc5c1bd741803f8ce6208cb8666657a.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/cfc5c1bd741803f8ce6208cb8666657a.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/cfc5c1bd741803f8ce6208cb8666657a.png title=图片></p><ul><li><p>Master 在每个事务更新数据完成之前，将操作记录写入到 bin log 中。</p></li><li><p>Slave 从库连接 Master 主库，并且 Master 有多少个 Slave 就会创建多少个 binlog dump 线程。当 Master 节点的 binlog 发生变化时，binlog dump 会通知所有的 Slave，并将相应的 binlog 发送给 Slave。</p></li><li><p>I/O 线程接收到 bin log 内容后，将其写入到中继日志（Relay log）中。</p></li><li><p>SQL 线程读取中继日志，并在从服务器中重放。</p></li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/092506ce418ae6bc3bcccc9e34739092.png alt=图片 style=zoom:50%><h3 id=乐观锁和悲观锁>乐观锁和悲观锁</h3><p>数据库中的并发控制是确保在多个事务同时存取数据库中同一数据时不破坏事务的隔离性和统一性以及数据库的统一性。乐观锁和悲观锁是并发控制主要采用的技术手段。</p><ul><li><strong>悲观锁</strong><ul><li>假定会发生并发冲突，会对操作的数据进行加锁，直到提交事务，才会释放锁，其他事务才能进行修改。实现方式：使用数据库中的锁机制。</li></ul></li><li><strong>乐观锁</strong><ul><li>假设不会发生并发冲突，只在提交操作时检查是否数据是否被修改过。给表增加<code>version</code>字段，在修改提交之前检查<code>version</code>与原来取到的<code>version</code>值是否相等，若相等，表示数据没有被修改，可以更新，否则，数据为脏数据，不能更新。实现方式：乐观锁一般使用版本号机制或<code>CAS</code>算法实现。</li></ul></li></ul><h2 id=其他八股>其他八股</h2><h3 id=事务的四大特性-acid>事务的四大特性 ACID</h3><p><strong>事务特性 ACID</strong>：<strong>原子性</strong>（<code>Atomicity</code>）、<strong>一致性</strong>（<code>Consistency</code>）、<strong>隔离性</strong>（<code>Isolation</code>）、<strong>持久性</strong>（<code>Durability</code>）。</p><ul><li><strong>原子性</strong>是指事务是最小的单位，不可以再分割；同一事务中的 SQL 语句，必须保证同时完成</li><li><strong>一致性</strong>是指一个事务执行之前和执行之后都必须处于一致性状态。比如 a 与 b 账户共有 1000 块，两人之间转账之后无论成功还是失败，它们的账户总和还是 1000。</li><li><strong>隔离性</strong>。跟隔离级别相关，如 <code>read committed</code>，一个事务只能读到已经提交的修改。</li><li><strong>持久性</strong>是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。</li></ul><h3 id=数据库的三大范式>数据库的三大范式</h3><p><strong>第一范式 1NF</strong></p><p>确保数据库表字段的原子性。</p><p>比如字段 <code>userInfo</code>: <code>广东省 10086'</code> ，依照第一范式必须拆分成 <code>userInfo</code>: <code>广东省</code> <code>userTel</code>:<code>10086</code>两个字段。</p><p><strong>第二范式 2NF</strong></p><p>首先要满足第一范式，另外包含两部分内容：</p><ul><li>表必须有一个主键；</li><li>非主键列必须<strong>完全依赖</strong>于主键，而不能只依赖于主键的一部分。</li></ul><p>举个例子。假定选课关系表为 <code>student_course</code>(student_no, student_name, age, course_name, grade, credit)，主键为 (student_no, course_name)。其中学分完全依赖于课程名称，姓名年龄完全依赖学号，不符合第二范式，会导致<strong>数据冗余</strong>（学生选 n 门课，姓名年龄有 n 条记录）、<strong>插入异常</strong>（插入一门新课，因为没有学号，无法保存新课记录）等问题。</p><p>应该拆分成三个表：学生：<code>student</code>(stuent_no, student_name, 年龄)；课程：<code>course</code>(course_name, credit)；选课关系：<code>student_course_relation</code>(student_no, course_name, grade)。</p><p><strong>第三范式 3NF</strong></p><p>首先要满足第二范式，另外<strong>非主键列必须直接依赖于主键，不能存在传递依赖</strong>。</p><p>即不能存在：非主键列 A 依赖于非主键列 B，非主键列 B 依赖于主键的情况。</p><p>假定学生关系表为 Student(student_no, student_name, age, academy_id, academy_telephone)，主键为"学号"，其中学院 id 依赖于学号，而学院地点和学院电话依赖于学院 id，存在传递依赖，不符合第三范式。</p><p>可以把学生关系表分为如下两个表：学生：(student_no, student_name, age, academy_id)；学院：(academy_id, academy_telephone)。</p><p><strong>2NF 和 3NF的区别？</strong></p><ul><li>2NF 依据是非主键列是否<strong>完全依赖</strong>于主键，还是依赖于主键的一部分。</li><li>3NF 依据是非主键列是否直接依赖于主键，即有无<strong>传递依赖</strong>的情况发生</li></ul><h3 id=事务隔离级别>事务隔离级别</h3><p>先了解下几个概念：脏读、不可重复读、幻读。</p><ul><li><strong>脏读</strong>：在一个事务处理过程里读取了另一个<strong>未提交</strong>的事务中的数据。</li><li><strong>不可重复读</strong>：在对于数据库中的某行记录，一个事务范围内<strong>多次查询却返回了不同的数据值</strong>，这是由于在查询间隔，<strong>另一个事务修改了数据并提交了</strong>。</li><li><strong>幻读</strong>：某个事务在读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录。<ul><li>另一种解释：在两个连续的查找之间一个并发的修改事务修改了查询的数据集，导致这两个查询返回了不同的结果</li><li>对幻读的正确理解是<strong>一个事务内的读取操作的结论不能支撑之后业务的执行</strong>。（因为有并发写的情况出现）<ul><li>假设事务要新增一条记录，主键为 id，在新增之前执行了 select，没有发现 id 为 xxx 的记录，但插入时出现主键冲突，这就属于幻读</li><li>读取不到记录却发现主键冲突是因为记录实际上已经被其他的事务插入了，但当前事务不可见。</li></ul></li></ul></li></ul><p>不可重复读和脏读的区别是，脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。</p><p>不可重复度和幻读看的区别是：在不可重复读中，发现数据不一致主要是数据被<strong>更新</strong>了。在幻读中，发现数据不一致主要是数据<strong>增多或者减少</strong>了</p><p>事务隔离就是为了解决上面提到的脏读、不可重复读、幻读这几个问题。</p><p>MySQL 数据库为我们提供的<strong>四种隔离级别</strong>：</p><ul><li><p><strong>Read uncommitted</strong> (<strong>读未提交</strong>)</p><ul><li>所有事务都可以看到其他未提交事务的执行结果。</li></ul></li><li><p><strong>Read committed</strong> (<strong>读已提交</strong>)</p><ul><li>一个事务只能看见已经提交事务所做的改变。可避免脏读的发生。</li></ul></li><li><p><strong>Repeatable read</strong> (<strong>可重复读</strong>)</p><ul><li>在同一个事务中多次读取到的数据是一致的。</li><li>MySQL 的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行</li><li>事务 A 只能在事务 B 修改过数据并提交后，自己也提交事务后，才能读取到事务 B 修改的数据。</li><li>解决了不可重复读的问题。</li></ul></li><li><p><strong>Serializable</strong> (<strong>串行化</strong>)</p><ul><li>通过强制事务串行执行，使之不可能相互冲突，从而解决幻读问题。</li><li>通过加锁实现（读锁和写锁）</li></ul></li></ul><p>查看隔离级别：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>transaction_isolation</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>设置隔离级别：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=kt>set</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=n>isolation</span><span class=w> </span><span class=n>level</span><span class=w> </span><span class=k>read</span><span class=w> </span><span class=n>uncommitted</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>事务的隔离机制主要是依靠<strong>锁机制</strong>和 <strong>MVCC</strong> (多版本并发控制)实现的，提交读和可重复读可以通过 MVCC 实现，串行化可以通过锁机制实现。</p><h3 id=生产环境数据库一般用的什么隔离级别>生产环境数据库一般用的什么隔离级别</h3><p><strong>生产环境大多使用 RC</strong>。为什么不是 RR 呢？</p><blockquote><p>可重复读 (Repeatable Read)，简称为 RR</p><p>读已提交 (Read Commited)，简称为 RC</p></blockquote><p>缘由一：在 RR 隔离级别下，存在间隙锁，导致出现死锁的几率比 RC 大的多</p><p>缘由二：在 RR 隔离级别下，条件列未命中索引会<strong>锁表</strong>！而在 RC 隔离级别下，只<strong>锁行</strong>!</p><p>也就是说，RC 的并发性高于 RR。</p><p>并且大部分场景下，不可重复读问题是可以接受的。毕竟数据都已经提交了，读出来本身就没有太大问题！</p><p><a href=https://zhuanlan.zhihu.com/p/59061106 target=_blank rel="external nofollow noopener noreferrer">互联网项目中 mysql 应该选什么事务隔离级别</a></p><h3 id=查询语句执行流程>查询语句执行流程</h3><p>查询语句的执行流程如下：权限校验、查询缓存、分析器、优化器、权限校验、执行器、引擎。</p><p>举个例子，查询语句如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;大彬&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li>首先检查权限，没有权限则返回错误；</li><li>MySQL8.0 以前会查询缓存，缓存命中则直接返回，没有则执行下一步；</li><li>词法分析和语法分析。提取表名、查询条件，检查语法是否有错误；</li><li>两种执行方案，先查 <code>id > 1</code> 还是 <code>name = '大彬'</code>，优化器根据自己的优化算法选择执行效率最好的方案；</li><li>校验权限，有权限就调用数据库引擎接口，返回引擎的执行结果。</li></ol><h3 id=更新语句执行过程>更新语句执行过程</h3><p>更新语句执行流程如下：分析器、权限校验、执行器、引擎、<code>redo log</code>（<code>prepare</code> 状态）、<code>bin log</code>、<code>redo log</code>（<code>commit</code> 状态）</p><p>举个例子，更新语句如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;大彬&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li>先查询到 id 为 1 的记录，有缓存会使用缓存。</li><li>拿到查询结果，将 name 更新为大彬，然后调用引擎接口，写入更新数据，innodb 引擎将数据保存在内存中，同时记录 <code>redo log</code>，此时 <code>redo log</code>进入 <code>prepare</code> 状态。</li><li>执行器收到通知后记录 <code>bin log</code>，然后调用引擎接口，提交 <code>redo log</code> 为 <code>commit</code> 状态。</li><li>更新完成。</li></ol><p>为什么记录完 <code>redo log</code>，不直接提交，而是先进入 <code>prepare</code> 状态？</p><p>假设先写 <code>redo log</code> 直接提交，然后写 <code>bin log</code>，写完<code>redo log</code>后，机器挂了，<code>bin log</code> 日志没有被写入，那么机器重启后，这台机器会通过 <code>redo log</code> 恢复数据，但是这个时候 <code>bin log</code> 并没有记录该数据，后续进行机器备份的时候，就会丢失这一条数据，同时主从同步也会丢失这一条数据。</p><h3 id=exist-和-in-的区别>exist 和 in 的区别</h3><p><code>exists</code> 用于对外表记录做筛选。<code>exists</code> 会<strong>遍历外表</strong>，将外查询表的每一行，代入内查询进行判断。</p><ul><li>当 <code>exists</code> 里的条件语句能够返回记录行时，条件就为真，返回外表当前记录。</li><li>反之如果 <code>exists</code> 里的条件语句不能返回记录行，条件为假，则外表当前记录被丢弃。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>b</span><span class=p>.</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>in</code> 是<strong>先把后边的语句查出来</strong>放到临时表中，然后<strong>遍历临时表</strong>，将临时表的每一行，代入外查询去查找。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>子查询的表比较大的时候</strong>，使用 <code>exists</code> 可以有效减少总的循环次数来提升速度；<strong>当外查询的表比较大的时候</strong>，使用 <code>in</code> 可以有效减少对外查询表循环遍历来提升速度。</p><p>总结：<code>exists</code> 遍历外表，<code>in</code> 遍历子表</p><h3 id=mysql-中-int10-和-char10-的区别>MySQL 中 int(10) 和 char(10) 的区别</h3><p>int(10) 中的 10 表示的是显示数据的长度，而 char(10) 表示的是存储数据的长度</p><h3 id=truncatedelete-与-drop-区别>truncate、delete 与 drop 区别？</h3><p><strong>相同点：</strong></p><ol><li><code>truncate</code> 和不带 <code>where</code> 子句的 <code>delete</code>、以及 <code>drop</code> 都会删除表内的数据。</li><li><code>drop</code>、<code>truncate</code> 都是 <code>DDL</code> 语句（数据定义语言），执行后会自动提交。</li></ol><p><strong>不同点：</strong></p><ol><li>truncate 和 delete 只删除数据不删除表的结构；drop 语句将删除表的结构被依赖的约束、触发器、索引；</li><li>一般来说，执行速度: drop > truncate > delete。</li></ol><h3 id=having-和-where区别>having 和 where区别？</h3><ul><li>二者<strong>作用的对象不同</strong>，<code>where</code> 子句作用于表和视图，<code>having</code> 作用于组。</li><li><code>where</code> 在数据分组前进行过滤，<code>having</code> 在数据分组后进行过滤。</li></ul><h3 id=查询-limit-100010-和-limit-10-速度一样快吗>查询 <code>limit 1000,10</code> 和 <code>limit 10</code> 速度一样快吗？</h3><p>两种查询方式。对应 <code>limit offset, size</code> 和 <code>limit size</code> 两种方式。</p><p>而其实 <code>limit size</code> ，相当于 <code>limit 0, size</code>。也就是从 0 开始取 size 条数据。</p><p>也就是说，两种方式的<strong>区别在于 offset 是否为 0。</strong></p><p>先来看下 limit sql 的内部执行逻辑。</p><p>MySQL 内部分为 <strong>server 层</strong>和<strong>存储引擎层</strong>。一般情况下存储引擎都用 innodb。</p><p>server 层有很多模块，其中需要关注的是<strong>执行器</strong>是用于跟存储引擎打交道的组件。</p><p>执行器可以通过调用存储引擎提供的接口，将一行行数据取出，当这些数据完全符合要求（比如满足其他 where 条件），则会放到<strong>结果集</strong>中，最后返回给调用 mysql 的<strong>客户端</strong>。</p><p>以主键索引的 limit 执行过程为例：</p><ul><li>执行 <code>select * from xxx order by id limit 0, 10;</code>，select 后面带的是<strong>星号</strong>，也就是要求获得行数据的<strong>所有字段信息。</strong><ul><li>server 层会调用 innodb 的接口，在 innodb 里的主键索引中获取到第 0 到 10 条<strong>完整行数据</strong>，依次返回给 server 层，并放到 server 层的结果集中，返回给客户端。</li></ul></li><li>把 offset 搞大点，比如执行的是：<code>select * from xxx order by id limit 500000, 10;</code><ul><li>server 层会调用 innodb 的接口，由于这次的 offset=500000，会在 innodb 里的主键索引中获取到第 0 到（500000 + 10）条<strong>完整行数据</strong>，<strong>返回给 server 层之后根据 offset 的值挨个抛弃，最后只留下最后面的 size 条</strong>，也就是 10 条数据，放到 server 层的结果集中，返回给客户端。</li></ul></li></ul><p>可以看出，当 offset 非 0 时，server 层会从引擎层获取到<strong>很多无用的数据</strong>，而获取的这些无用数据都是要耗时的。</p><p>因此，mysql 查询中 <code>limit 1000,10</code> 会比 <code>limit 10</code> 更慢。原因是 <strong><code>limit 1000,10</code> 会取出 1000+10 条数据，并抛弃前 1000 条，这部分耗时更大。</strong></p><p>好笨</p><h3 id=深分页怎么优化>深分页怎么优化？</h3><p>还是以上面的 SQL 为空：<code>select * from xxx order by id limit 500000, 10;</code></p><p><strong>方法一</strong>：</p><p>从上面的分析可以看出，当 offset 非常大时，server 层会从引擎层获取到很多无用的数据，而当 select 后面是 * 号时，就需要拷贝完整的行信息，<strong>拷贝完整数据相比只拷贝行数据里的其中一两个列字段更耗费时间</strong>。</p><p>因为前面的 offset 条数据最后都是不要的，没有必要拷贝完整字段，所以可以将 sql 语句修改成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>xxx</span><span class=w>  </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>xxx</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>500000</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>先执行子查询 <code>select id from xxx by id limit 500000, 1</code>, 这个操作，其实也是将在 innodb 中的主键索引中获取到 <code>500000+1</code> 条数据，然后 server 层会抛弃前 500000 条，只保留最后一条数据的 id。</p><p>但不同的地方在于，在返回 server 层的过程中，只会拷贝数据行内的 id 这一列，而不会拷贝数据行的所有列，当数据量较大时，这部分的耗时还是比较明显的。</p><p>在拿到了上面的 id 之后，假设这个 id 正好等于 500000，那 sql 就变成了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>xxx</span><span class=w>  </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;=</span><span class=mi>500000</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这样 innodb 再走一次<strong>主键索引</strong>，通过 B+ 树快速定位到 id=500000 的行数据，时间复杂度是 lg(n)，然后向后取 10 条数据。</p><p><strong>方法二：</strong></p><p>将所有的数据<strong>根据 id 主键进行排序</strong>，然后分批次取，将当前批次的最大 id 作为下次筛选的条件进行查询。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>xxx</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>start_id</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>通过主键索引，每次定位到 start_id 的位置，然后往后遍历 10 个数据，这样不管数据多大，查询性能都较为稳定。</p><h3 id=高度为-3-的-b-树可以存放多少数据>高度为 3 的 B+ 树，可以存放多少数据</h3><p>InnoDB 存储引擎有自己的最小储存单元——页（Page）。</p><p>查询 InnoDB 页大小的命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>global</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;innodb_page_size&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------------+-------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Innodb_page_size</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>16384</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+------------------+-------+</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以看出 innodb 默认的一页大小为 16384B = 16384/1024 = 16kb。</p><p>在 MySQL 中，B+ 树一个节点的大小设为一页或页的倍数最为合适。因为如果一个节点的大小 &lt; 1 页，那么读取这个节点的时候其实读取的还是一页，这样就造成了资源的浪费。</p><p>B+ 树中<strong>非叶子节点存的是 key + 指针</strong>；<strong>叶子节点存的是数据行</strong>。</p><p>对于叶子节点，如果一行数据大小为 1k，那么一页就能存 16 条数据。</p><p>对于非叶子节点，如果 key 使用的是 bigint，则为 8 字节，指针在 MySQL 中为 6 字节，一共是 14 字节，则 16k 能存放 16 * 1024 / 14 = 1170 个索引指针。</p><p>于是可以算出，对于一颗高度为 2 的 B+ 树，根节点存储索引指针节点，那么它有 1170 个叶子节点存储数据，每个叶子节点可以存储 16 条数据，一共 1170 x 16 = 18720 条数据。而对于高度为 3 的 B+ 树，就可以存放 1170 x 1170 x 16 = 21902400 条数据（<strong>两千多万条数据</strong>），也就是对于两千多万条的数据，我们只需要<strong>高度为 3</strong> 的 B+ 树就可以完成，通过主键查询只需要 3 次 IO 操作就能查到对应数据。</p><p>所以在 InnoDB 中 B+ 树高度一般为 3 层时，就能满足千万级的数据存储。</p><h3 id=单表多大进行分库分表>单表多大进行分库分表</h3><p>目前主流的有两种说法：</p><ol><li>MySQL 单表数据量大于 2000 万行，性能会明显下降，考虑进行分库分表。</li><li>阿里巴巴《Java 开发手册》提出单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</li></ol><p>事实上，这个数值和实际记录的条数无关，而<strong>与 MySQL 的配置以及机器的硬件有关</strong>。因为 MySQL 为了提高性能，会将表的索引装载到内存中。在 InnoDB buffer size 足够的情况下，其能完成全加载进内存，查询不会有问题。但是，当单表数据库到达某个量级的上限时，导致内存无法存储其索引，使得之后的 SQL 查询会产生磁盘 IO，从而导致性能下降。当然，这个还有具体的表结构的设计有关，最终导致的问题都是内存限制。</p><p>因此，对于分库分表，需要结合实际需求，不宜过度设计，在项目一开始不采用分库与分表设计，而是随着业务的增长，在无法继续优化的情况下，再考虑分库与分表提高系统的性能。对此，阿里巴巴《Java 开发手册》补充到：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</p><p>至于 MySQL 单表多大进行分库分表，应当根据机器资源进行评估。</p><h3 id=大表查询慢怎么优化>大表查询慢怎么优化</h3><p>某个表有近千万数据，查询比较慢，如何优化？</p><p>当 MySQL 单表记录数过大时，数据库的性能会明显下降，一些常见的优化措施如下：</p><ul><li>合理建立索引。在合适的字段上建立索引，例如在 WHERE 和 ORDER BY 命令上涉及的列建立索引，可根据 EXPLAIN 来查看是否用了索引还是全表扫描</li><li>建立分区。对关键字段建立水平分区，比如时间字段，若查询条件往往通过时间范围来进行查询，能提升不少性能</li><li>利用缓存。利用 Redis 等缓存热点数据，提高查询效率</li><li>限定数据的范围。比如：用户在查询历史信息的时候，可以控制在一个月的时间范围内</li><li>读写分离。经典的数据库拆分方案，主库负责写，从库负责读</li><li>通过分库分表的方式进行优化，主要有垂直拆分和水平拆分</li></ul><h3 id=什么是临时表>什么是临时表</h3><p>MySQL 在执行 SQL 语句的时候会临时创建一些存储中间结果集的表，这种表被称为临时表，临时表只对当前连接可见，在连接关闭后，临时表会被删除并释放空间。</p><p>临时表主要分为内存临时表和磁盘临时表两种</p><ul><li>内存临时表使用的是 MEMORY 存储引擎</li><li>磁盘临时表使用的是 MyISAM 存储引擎。</li></ul><p>一般在以下几种情况中会使用到临时表：</p><ul><li>FROM 中的子查询</li><li>DISTINCT 查询并加上 ORDER BY</li><li>ORDER BY 和 GROUP BY 的子句不一样时会产生临时表</li><li>使用 UNION 查询会产生临时表</li></ul><h3 id=主键一般用自增-id-还是-uuid>主键一般用自增 ID 还是 UUID</h3><p>使用自增 ID 的好处：</p><ul><li><p>字段长度较 uuid 会小很多。</p></li><li><p>数据库自动编号，按顺序存放，利于检索</p></li><li><p>无需担心主键重复问题</p></li></ul><p>使用自增 ID 的缺点：</p><ul><li><p>因为是自增，在某些业务场景下，容易被其他人查到业务量。</p></li><li><p>发生数据迁移时，或者表合并时会非常麻烦</p></li><li><p>在高并发的场景下，竞争自增锁会降低数据库的吞吐能力</p></li></ul><p>UUID：通用唯一标识码，UUID 是基于当前时间、计数器和硬件标识等数据计算生成的。</p><p>使用 UUID 的优点：</p><ul><li><p>唯一标识，不会考虑重复问题，在数据拆分、合并时也能达到全局的唯一性。</p></li><li><p><strong>可以在应用层生成</strong>，提高数据库的吞吐能力。</p></li><li><p>无需担心业务量泄露的问题。</p></li></ul><p>使用 UUID 的缺点：</p><ul><li><p>因为 UUID 是随机生成的，所以会发生<strong>随机 IO</strong>，影响插入速度，并且会造成硬盘的使用率较低。</p></li><li><p>UUID 占用空间较大，建立的索引越多，造成的影响越大。</p></li><li><p>UUID 之间比较大小较自增 ID 慢不少，影响查询速度。</p></li></ul><p>最后说下结论，一般情况 MySQL 推荐使用自增 ID。因为在 MySQL 的 InnoDB 存储引擎中，主键索引是一种聚簇索引，主键索引的 B+ 树的叶子节点按照顺序存储了主键值及数据</p><ul><li><p>如果主键索引是自增 ID，只需要按顺序往后排列即可，</p></li><li><p>如果是 UUID，ID 是随机生成的，<strong>在数据插入时会造成大量的数据移动</strong>，产生大量的内存碎片，造成插入性能的下降。</p></li></ul><h3 id=字段为什么要设置成-not-null>字段为什么要设置成 not null</h3><p>首先说一点，NULL 和空值是不一样的，空值是不占用空间的，而 <strong>NULL 是占用空间的</strong>，所以字段设为 NOT NULL 后仍然可以插入空值。</p><p>字段设置成 not null 主要有以下几点原因：</p><p>NULL 值会影响一些函数的统计，如 count，遇到 NULL 值，这条记录不会统计在内。</p><p>B 树不存储 NULL，所以索引用不到 NULL，会造成第一点中说的统计不到的问题。</p><p><strong>NOT IN 子查询在有 NULL 值的情况下返回的结果都是空值</strong>。</p><p>例如 user 表如下</p><table><thead><tr><th>id</th><th>username</th></tr></thead><tbody><tr><td>0</td><td>zhangsan</td></tr><tr><td>1</td><td>lisi</td></tr><tr><td>2</td><td>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这条查询语句应该查到 zhangsan 这条数据，但是结果显示为 null</p><p>MySQL 在进行比较的时候，NULL 会参与字段的比较，因为 NULL 是一种比较特殊的数据类型，数据库在处理时需要进行特殊处理，增加了数据库处理记录的复杂性。</p><h3 id=如何优化-where-子句>如何优化 WHERE 子句</h3><ul><li><p>不要在 where 子句中使用 != 和 &lt;> 进行<strong>不等于判断</strong>，这样会导致<strong>放弃索引进行全表扫描</strong>。</p></li><li><p>不要在 where 子句中使用 null 或空值判断，尽量设置字段为 not null</p></li><li><p>尽量使用 union all 代替 or</p></li><li><p>在 where 和 order by 涉及的列建立索引</p></li><li><p>尽量减少使用 in 或者 not in，会进行全表扫描</p></li><li><p>在 where 子句中使用参数会导致全表扫描</p></li><li><p>避免在 where 子句中对字段及进行表达式或者函数操作会导致存储引擎放弃索引进而全表扫描</p></li></ul><h3 id=sql-语句的执行顺序>SQL 语句的执行顺序</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>select_list</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>left_table</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>right_table</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>join_condition</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>where_condition</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>group_by_list</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>having_condition</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>order_by_condition</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/11d8f5cf351d7387c01a2759b65f5609.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/11d8f5cf351d7387c01a2759b65f5609.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/11d8f5cf351d7387c01a2759b65f5609.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/11d8f5cf351d7387c01a2759b65f5609.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/11d8f5cf351d7387c01a2759b65f5609.png title=图片></p><ul><li><p>FROM：对 SQL 语句执行查询时，首先对关键字两边的表以笛卡尔积的形式执行连接，并产生一个虚表 V1。虚表就是视图，数据会来自多张表的执行结果。</p></li><li><p>ON：对 FROM 连接的结果进行 ON 过滤,并创建虚表 V2</p></li><li><p>JOIN：将 ON 过滤后的左表添加进来，并创建新的虚拟表 V3</p></li><li><p>WHERE：对虚拟表 V3 进行 WHERE 筛选，创建虚拟表 V4</p></li><li><p>GROUP BY：对 V4 中的记录进行分组操作，创建虚拟表 V5</p></li><li><p>HAVING：对 V5 进行过滤，创建虚拟表 V6</p></li><li><p>SELECT：将 V6 中的结果按照 SELECT 进行筛选，创建虚拟表 V7</p></li><li><p>DISTINCT：对 V7 表中的结果进行去重操作，创建虚拟表 V8</p><ul><li>如果使用了 GROUP BY 子句则无需使用 DISTINCT，因为分组的时候是将列中唯一的值分成一组，并且每组只返回一行记录，所以所有的记录都是不同的。</li></ul></li><li><p>ORDER BY：对 V8 表中的结果进行排序。</p></li></ul><h3 id=分库分表后id-键如何处理>分库分表后，ID 键如何处理</h3><p>分库分表后不能每个表的 ID 都是从 1 开始，所以需要一个全局 ID</p><p>设置全局 ID 主要有以下几种方法：</p><ul><li><p>UUID</p><ul><li>优点：本地生成 ID，不需要远程调用；全局唯一不重复</li><li>缺点：占用空间大；不适合作为索引。</li></ul></li><li><p>数据库自增 ID：在分库分表表后使用数据库自增 ID，需要一个<strong>专门用于生成主键的库</strong>，每次服务接收到请求，先向这个库中插入一条没有意义的数据，获取一个数据库自增的 ID，利用这个 ID 去分库分表中写数据。</p><ul><li>优点：简单易实现。</li><li>缺点：在高并发下存在瓶颈。）</li></ul></li></ul><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/3ce2984ba84782dd28e80c70bb008871.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/3ce2984ba84782dd28e80c70bb008871.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/3ce2984ba84782dd28e80c70bb008871.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/3ce2984ba84782dd28e80c70bb008871.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/3ce2984ba84782dd28e80c70bb008871.png title=图片></p><ul><li><p>Redis 生成 ID</p><ul><li>优点：不依赖数据库，性能比较好。</li><li>缺点：引入新的组件会使得系统复杂度增加</li></ul></li><li><p>Twitter 的 snowflake 算法：是一个 64 位的 long 型的 ID，其中有 1bit 是不用的，41bit 作为毫秒数，10bit 作为工作机器 ID，12bit 作为序列号。</p><ul><li><p>1bit：第一个 bit 默认为 0，因为二进制中第一个 bit 为 1 的话为负数，但是 ID 不能为负数.</p></li><li><p>41bit：表示的是时间戳，单位是毫秒。</p></li><li><p>10bit：记录工作机器 ID，其中 5 个 bit 表示机房 ID，5 个 bit 表示机器 ID。</p></li><li><p>12bit：用来记录同一毫秒内产生的不同 ID。</p></li></ul></li><li><p>美团的 Leaf 分布式 ID 生成系统，美团点评分布式 ID 生成系统</p></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-08-31 15:21:18">更新于 2022-08-31</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/database/mysql/ data-title="关于 MySQL 的一些笔记" data-hashtags=数据库,快速入门,MySQL><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/database/mysql/ data-hashtag=数据库><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/database/mysql/ data-title="关于 MySQL 的一些笔记"><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>,&nbsp;<a href=/Notes/tags/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/>快速入门</a>,&nbsp;<a href=/Notes/tags/mysql/>MySQL</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/python/crawler/beautifulsoup4/ class=prev rel=prev title=BeautifulSoup4><i class="fa-solid fa-angle-left fa-fw"></i>BeautifulSoup4</a>
<a href=/Notes/posts/python/basicgrammar/ class=next rel=next title="Python 基础语法">Python 基础语法<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>