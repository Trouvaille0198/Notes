<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>- 伤心肠粉的酱油碟子</title><meta name=Description content><meta property="og:title" content><meta property="og:description" content="实验三 请求页式存储管理 实验目的与要求 目的 近年来，由于大规模集成电路（LSI）和超"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/homework/os/semester2/ex3/"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2022-04-26T03:52:34+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="实验三 请求页式存储管理 实验目的与要求 目的 近年来，由于大规模集成电路（LSI）和超"><meta name=application-name content="伤心肠粉的酱油碟子"><meta name=apple-mobile-web-app-title content="伤心肠粉的酱油碟子"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/homework/os/semester2/ex3/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/homework/os/semester2/ex4/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/homework/os/semester2/ex2/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/homework\/os\/semester2\/ex3\/"},"genre":"posts","wordcount":2377,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/homework\/os\/semester2\/ex3\/","datePublished":"2022-02-25T20:42:10+08:00","dateModified":"2022-04-26T03:52:34+00:00","publisher":{"@type":"Organization","name":"作者"},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":''==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:''==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子>伤心肠粉</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/Notes/categories/>分类 </a><a class=menu-item href=/Notes/tags/>标签 </a><a class=menu-item href=/Notes/posts/>文章 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子>伤心肠粉</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/Notes/categories/ title>分类</a><a class=menu-item href=/Notes/tags/ title>标签</a><a class=menu-item href=/Notes/posts/ title>文章</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX"></h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/Notes/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>作者</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=0001-01-01>0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2377 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#实验目的与要求>实验目的与要求</a><ul><li><a href=#目的>目的</a></li><li><a href=#要求>要求</a></li></ul></li><li><a href=#实验环境>实验环境</a></li><li><a href=#实验内容及其设计与实现>实验内容及其设计与实现</a><ul><li><a href=#指令地址流生成>指令地址流生成</a><ul><li><a href=#模拟生成>模拟生成</a></li><li><a href=#使用真实地址流>使用真实地址流</a></li></ul></li><li><a href=#页面置换算法>页面置换算法</a><ul><li><a href=#事先准备>事先准备</a></li><li><a href=#opt-算法>OPT 算法</a></li><li><a href=#lru-算法>LRU 算法</a></li><li><a href=#fifo-算法>FIFO 算法</a></li></ul></li><li><a href=#算法命中率比较>算法命中率比较</a></li></ul></li><li><a href=#收获与体会>收获与体会</a></li></ul></nav></div></div><div class=content id=content><h1 id=实验三-请求页式存储管理>实验三 请求页式存储管理</h1><h2 id=实验目的与要求>实验目的与要求</h2><h3 id=目的>目的</h3><p>近年来，由于大规模集成电路（LSI）和超大规模集成电路（VLSI）技术的发展，使存储器的容量不断扩大，
价格大幅度下降。但从使用角度看，存储器的容量和成本总受到一定的限制。</p><p>所以，提高存储器的效率始终是操作 系统研究的重要课题之一。虚拟存储技术是用来扩大内存容量的一种重要方法。学生应独立地用高级语言编写几个常用的存储分配算法，并设计一个存储管理的模拟程序，对各种算法进行分析比较，评测其性能优劣，从而加深对 这些算法的了解。</p><h3 id=要求>要求</h3><p>为了比较真实地模拟存储管理，可预先生成一个大致符合实际情况的指令地址流。然后模拟这样一种指令序列的执行来计算和分析各种算法的访问命中率。</p><h2 id=实验环境>实验环境</h2><ul><li>操作系统：windows 10</li><li>编程语言：GoLang 1.17.5</li><li>IDE：JetBrain GoLand 2021.3.1</li></ul><h2 id=实验内容及其设计与实现>实验内容及其设计与实现</h2><h3 id=指令地址流生成>指令地址流生成</h3><h4 id=模拟生成>模拟生成</h4><p>按以下规则模拟真实情况的指令地址流：</p><ul><li>50% 的指令顺序执行。</li><li>25% 的指令均匀散布在前地址部分。</li><li>25% 的指令均匀散布在后地址部分</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>//  getWeightedChooser
</span></span></span><span class=line><span class=cl><span class=c1>//  @Description: 获取指令地址分布权重表
</span></span></span><span class=line><span class=cl><span class=c1>//  @return *utils.Chooser
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getWeightedChooser</span><span class=p>()</span> <span class=o>*</span><span class=nx>utils</span><span class=p>.</span><span class=nx>Chooser</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>chooser</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>NewChooser</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>utils</span><span class=p>.</span><span class=nf>NewChoice</span><span class=p>(</span><span class=s>&#34;front&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>utils</span><span class=p>.</span><span class=nf>NewChoice</span><span class=p>(</span><span class=s>&#34;end&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>utils</span><span class=p>.</span><span class=nf>NewChoice</span><span class=p>(</span><span class=s>&#34;prev&#34;</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=nx>chooser</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// AddressStream
</span></span></span><span class=line><span class=cl><span class=c1>// @description 地址流
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>AddressStream</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>length</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>   <span class=nx>addresses</span> <span class=p>[]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewAddressStream
</span></span></span><span class=line><span class=cl><span class=c1>// @param addressNum 指令个数
</span></span></span><span class=line><span class=cl><span class=c1>// @param virtualMemorySize 虚存大小 以k为单位
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewAddressStream</span><span class=p>(</span><span class=nx>addressNum</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>virtualMemorySize</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>AddressStream</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>virtualMemorySize</span> <span class=o>*=</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl>   <span class=nx>rs</span> <span class=o>:=</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nf>NewSource</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>UTC</span><span class=p>().</span><span class=nf>UnixNano</span><span class=p>()))</span> <span class=c1>// 随机数种子
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nx>addresses</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>addressNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=nx>chooser</span> <span class=o>:=</span> <span class=nf>getWeightedChooser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nx>addresses</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=p>=</span> <span class=nx>rs</span><span class=p>.</span><span class=nf>Intn</span><span class=p>(</span><span class=nx>virtualMemorySize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>addressNum</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>initForm</span> <span class=o>:=</span> <span class=nx>chooser</span><span class=p>.</span><span class=nf>PickSource</span><span class=p>(</span><span class=nx>rs</span><span class=p>)</span> <span class=c1>// 按照权重选择一项生成策略
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>switch</span> <span class=nx>initForm</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;front&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=nx>randAddress</span> <span class=o>:=</span> <span class=nx>rs</span><span class=p>.</span><span class=nf>Intn</span><span class=p>(</span><span class=nx>virtualMemorySize</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=nx>addresses</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>randAddress</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;end&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=nx>randAddress</span> <span class=o>:=</span> <span class=nx>rs</span><span class=p>.</span><span class=nf>Intn</span><span class=p>(</span><span class=nx>virtualMemorySize</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=nx>virtualMemorySize</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>         <span class=nx>addresses</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>randAddress</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;prev&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=nx>addresses</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>addresses</span><span class=p>[</span><span class=nx>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=o>&amp;</span><span class=nx>AddressStream</span><span class=p>{</span><span class=nx>length</span><span class=p>:</span> <span class=nx>addressNum</span><span class=p>,</span> <span class=nx>addresses</span><span class=p>:</span> <span class=nx>addresses</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GetAddressPages
</span></span></span><span class=line><span class=cl><span class=c1>// @description 获取指令地址对应的页号
</span></span></span><span class=line><span class=cl><span class=c1>// @receiver a
</span></span></span><span class=line><span class=cl><span class=c1>// @param pageSize 页大小 以k为单位
</span></span></span><span class=line><span class=cl><span class=c1>// @return []int 指令的页号列表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>AddressStream</span><span class=p>)</span> <span class=nf>GetAddressPages</span><span class=p>(</span><span class=nx>pageSize</span> <span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>addressPages</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>addresses</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>address</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>a</span><span class=p>.</span><span class=nx>addresses</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>addressPages</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>address</span><span class=o>/</span><span class=p>(</span><span class=nx>pageSize</span><span class=o>*</span><span class=mi>1024</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>addressPages</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>顺序生成的指令地址流，大都处于同一页中，符合现实情况</p><h4 id=使用真实地址流>使用真实地址流</h4><p>为了体现局部性原理，我们编写了 python 脚本，获取计算机中真实运行的进程地址</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># made by 王启隆</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psutil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 统计某一个进程名所占用的内存，同一个进程名，可能有多个进程</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>countProcessMemoey</span><span class=p>(</span><span class=n>processName</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;([^\s]+)\s+(\d+)\s.*\s([^\s]+\sK)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=s1>&#39;tasklist /fi &#34;imagename eq &#39;</span> <span class=o>+</span> <span class=n>processName</span> <span class=o>+</span> \
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#34;&#39;</span> <span class=o>+</span> <span class=s1>&#39; | findstr.exe &#39;</span> <span class=o>+</span> <span class=s1>&#39;&#34;&#39;</span> <span class=o>+</span> <span class=n>processName</span> <span class=o>+</span> <span class=s1>&#39;&#34;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># findstr后面的程序名加上引号防止出现程序带有空格</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>resultList</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>srcLine</span> <span class=ow>in</span> <span class=n>resultList</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>srcLine</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>srcLine</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>srcLine</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>srcLine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>m</span> <span class=o>==</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=c1># 由于是查看python进程所占内存，因此通过pid将本程序过滤掉</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getpid</span><span class=p>())</span> <span class=o>==</span> <span class=n>m</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=n>ori_mem</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ori_mem</span> <span class=o>=</span> <span class=n>ori_mem</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39; K&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ori_mem</span> <span class=o>=</span> <span class=n>ori_mem</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\sK&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>memEach</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ori_mem</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pids</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>lis</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>pids</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>pids</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pid</span> <span class=ow>in</span> <span class=n>pids</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>pid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>lis</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>name</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>lis</span><span class=p>[:</span><span class=mi>50</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>ProcessName</span> <span class=o>=</span> <span class=n>i</span>  <span class=c1># 进程名</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>countProcessMemoey</span><span class=p>(</span><span class=n>ProcessName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./addrs.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f_b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f_b</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>results</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>脚本最终将进程地址流保存到文件里，以便在 Go 中读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 采用真实地址流
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>f</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ioutil</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=s>&#34;./as.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=o>&amp;</span><span class=nx>AddressStream</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>addr</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>f</span><span class=p>),</span> <span class=s>&#34;,&#34;</span><span class=p>)[:</span><span class=nx>addressNum</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>addresses</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>panic</span><span class=p>(</span><span class=s>&#34;error when reading address file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=页面置换算法>页面置换算法</h3><h4 id=事先准备>事先准备</h4><p>定义一个页式管理器，接收指定的指令个数、虚存大小、页大小和内存容量，生成指令地址流</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// PageReplacer
</span></span></span><span class=line><span class=cl><span class=c1>// @description 请求页式管理 其中实现了多种页面置换算法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PageReplacer</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>pageSize</span>     <span class=kt>int</span>
</span></span><span class=line><span class=cl>   <span class=nx>internalSize</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>   <span class=nx>addressPage</span>  <span class=p>[]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewPageReplacer
</span></span></span><span class=line><span class=cl><span class=c1>// @param addressNum 指令个数
</span></span></span><span class=line><span class=cl><span class=c1>// @param virtualMemorySize 虚存大小 以k为单位
</span></span></span><span class=line><span class=cl><span class=c1>// @param pageSize 页大小 以k为单位
</span></span></span><span class=line><span class=cl><span class=c1>// @param internalSize 内存能容纳页的个数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewPageReplacer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>   <span class=nx>addressNum</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>virtualMemorySize</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>pageSize</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>internalSize</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>PageReplacer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>addressStream</span> <span class=o>:=</span> <span class=nf>NewAddressStream</span><span class=p>(</span><span class=nx>addressNum</span><span class=p>,</span> <span class=nx>virtualMemorySize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=nx>addressPage</span> <span class=o>:=</span> <span class=nx>addressStream</span><span class=p>.</span><span class=nf>GetAddressPages</span><span class=p>(</span><span class=nx>pageSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=o>&amp;</span><span class=nx>PageReplacer</span><span class=p>{</span><span class=nx>pageSize</span><span class=p>:</span> <span class=nx>pageSize</span><span class=p>,</span> <span class=nx>addressPage</span><span class=p>:</span> <span class=nx>addressPage</span><span class=p>,</span> <span class=nx>internalSize</span><span class=p>:</span> <span class=nx>internalSize</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=opt-算法>OPT 算法</h4><p>最佳置换算法，发生缺页时，淘汰以后永不使用或是在未来最迟被访问到的页面。OPT 算法要求事先知晓未来所有的指令流顺序，是一种最优算法，但是在实际情况中不可能实现。</p><p>模拟实现下，发生缺页且内存已满时，程序将遍历之后的地址流，在驻留内存页号中选择一个于未来最迟被访问（或永不访问）的页号，将其置换出内存。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>PageReplacer</span><span class=p>)</span> <span class=nf>OPT</span><span class=p>()</span> <span class=kt>float32</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>internalPages</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=c1>// 记录内存中的页面
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>failCount</span> <span class=o>:=</span> <span class=mi>0</span>                  <span class=c1>// 未命中次数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>pageNo</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>utils</span><span class=p>.</span><span class=nf>IsContainInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 未命中
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>failCount</span><span class=o>++</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>)</span> <span class=o>==</span> <span class=nx>r</span><span class=p>.</span><span class=nx>internalSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// 内存已满 欲淘汰一页
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nx>latestPageIndex</span> <span class=o>:=</span> <span class=o>-</span><span class=mi>1</span> <span class=c1>// 记录内存页号列表中在未来最迟访问的页号索引
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>				<span class=nx>internalPagesCopy</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>internalSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=nb>copy</span><span class=p>(</span><span class=nx>internalPagesCopy</span><span class=p>,</span> <span class=nx>internalPages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>afterPageNo</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>IsContainInt</span><span class=p>(</span><span class=nx>internalPagesCopy</span><span class=p>,</span> <span class=nx>afterPageNo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>						<span class=nx>latestPageIndex</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>GetIndexInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>afterPageNo</span><span class=p>)</span> <span class=c1>// 记录当前最迟访问到的页号索引
</span></span></span><span class=line><span class=cl><span class=c1></span>						<span class=nx>internalPagesCopy</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByElemInt</span><span class=p>(</span><span class=nx>internalPagesCopy</span><span class=p>,</span> <span class=nx>afterPageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>internalPagesCopy</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=c1>// 内存中存在一页 其之后都不会被访问到
</span></span></span><span class=line><span class=cl><span class=c1></span>					<span class=nx>internalPages</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByElemInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>internalPagesCopy</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>internalPages</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByIndexInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>latestPageIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>internalPages</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>float32</span><span class=p>(</span><span class=nx>failCount</span><span class=p>)</span><span class=o>/</span><span class=nb>float32</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lru-算法>LRU 算法</h4><p>最近最久未使用算法，该算法选择最近最久未使用的页面予以淘汰。</p><p>模拟程序采用栈来实现页面的置换。命中时，将命中页从栈中移出（这显然不符合严格的栈操作），放入栈顶；当缺页发生且栈满时，将栈底页弹出，放入新页面至栈顶。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>PageReplacer</span><span class=p>)</span> <span class=nf>LRU</span><span class=p>()</span> <span class=kt>float32</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>internalPages</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=c1>// 记录内存中的页面
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>failCount</span> <span class=o>:=</span> <span class=mi>0</span>                  <span class=c1>// 未命中次数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>pageNo</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>utils</span><span class=p>.</span><span class=nf>IsContainInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 未命中
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>failCount</span><span class=o>++</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>)</span> <span class=o>==</span> <span class=nx>r</span><span class=p>.</span><span class=nx>internalSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// 内存已满 将栈底页面淘汰
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nx>internalPages</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByIndexInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>internalPages</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 命中 将命中页面提升至栈顶
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>internalPages</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByElemInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>internalPages</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>float32</span><span class=p>(</span><span class=nx>failCount</span><span class=p>)</span><span class=o>/</span><span class=nb>float32</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=fifo-算法>FIFO 算法</h4><p>先进先出方法，比较简单，使用队列实现即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>PageReplacer</span><span class=p>)</span> <span class=nf>FIFO</span><span class=p>()</span> <span class=kt>float32</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>internalPages</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=c1>// 记录内存中的页面
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>failCount</span> <span class=o>:=</span> <span class=mi>0</span>                  <span class=c1>// 未命中次数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>pageNo</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>utils</span><span class=p>.</span><span class=nf>IsContainInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 未命中
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>failCount</span><span class=o>++</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>)</span> <span class=o>==</span> <span class=nx>r</span><span class=p>.</span><span class=nx>internalSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// 内存已满 将队头页面淘汰
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nx>internalPages</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>DeleteByIndexInt</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>internalPages</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>internalPages</span><span class=p>,</span> <span class=nx>pageNo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>float32</span><span class=p>(</span><span class=nx>failCount</span><span class=p>)</span><span class=o>/</span><span class=nb>float32</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>addressPage</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=算法命中率比较>算法命中率比较</h3><p>内存容量从 4 页到 32 页，页面尺寸从 1k 到 8k，模拟页面置换的过程，得出三种算法的命中率</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestAlphaReader</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>virtualMemorySize</span> <span class=o>:=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>   <span class=nx>addressNum</span> <span class=o>:=</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>   <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;%-10s %-12s %-10s %-10s %-10s \n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;PageSize&#34;</span><span class=p>,</span> <span class=s>&#34;MemorySize&#34;</span><span class=p>,</span> <span class=s>&#34;OPT&#34;</span><span class=p>,</span> <span class=s>&#34;LRU&#34;</span><span class=p>,</span> <span class=s>&#34;FIFO&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>7</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>internalSize</span> <span class=o>:=</span> <span class=p>(</span><span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> <span class=c1>// 每次翻四倍
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=nx>pageSize</span> <span class=o>:=</span> <span class=nx>j</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>         <span class=nx>r</span> <span class=o>:=</span> <span class=nf>NewPageReplacer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>addressNum</span><span class=p>,</span> <span class=nx>virtualMemorySize</span><span class=p>,</span> <span class=nx>pageSize</span><span class=p>,</span> <span class=nx>internalSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=nx>r</span><span class=p>.</span><span class=nf>DisplayResult</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162505095.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162505095.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162505095.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162505095.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162505095.png title=image-20211224162505095></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162528844.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162528844.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162528844.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162528844.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162528844.png title=image-20211224162528844></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162534586.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162534586.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162534586.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162534586.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162534586.png title=image-20211224162534586></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162541724.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162541724.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162541724.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162541724.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211224162541724.png title=image-20211224162541724></p><p>可以看到，LRU 算法的命中率代表了算法上限，LRU 与 FIFO 算法效率相近。</p><p>随着内存容量和单页大小的增大，命中率通常也是越来越高的。</p><h2 id=收获与体会>收获与体会</h2><p>本次实验模拟了三种页面置换算法，我对请求页式管理的原理内容有了进一步的理解与体会。我首先使用 Python 编写程序，随后尝试使用 GoLang 重构代码。GoLang 相对来说更加精简，但是不那么“面向对象”，同时缺乏优质的语法糖，许多细节（如切片的查询、插入、删除，根据权重选择条目的算法）需要自己来实现，这花了我不少精力，这也对这门语言有了更深刻的理解。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-04-26</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/homework/os/semester2/ex4/ class=prev rel=prev title><i class="fas fa-angle-left fa-fw"></i></a>
<a href=/Notes/posts/homework/os/semester2/ex2/ class=next rel=next title><i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>酒困路长惟欲睡，日高人渴漫思茶</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><script type=text/javascript src=/Notes/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/Notes/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:45},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js></script></body></html>