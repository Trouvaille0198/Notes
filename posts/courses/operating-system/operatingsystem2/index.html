<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>操作系统（2） - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="操作系统二 判断 20*1 单选 20*1 填空 20*1 简答、综合 两个答题各有三个小题 共 4 存储器管理 40% 文件管"><meta name=keywords content="OS"><meta itemprop=name content="操作系统（2）"><meta itemprop=description content="操作系统二 判断 20*1 单选 20*1 填空 20*1 简答、综合 两个答题各有三个小题 共 4 存储器管理 40% 文件管"><meta itemprop=datePublished content="2022-02-03T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-13T09:00:31+00:00"><meta itemprop=wordCount content="13029"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="OS,"><meta property="og:title" content="操作系统（2）"><meta property="og:description" content="操作系统二 判断 20*1 单选 20*1 填空 20*1 简答、综合 两个答题各有三个小题 共 4 存储器管理 40% 文件管"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem2/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-13T09:00:31+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="操作系统（2）"><meta name=twitter:description content="操作系统二 判断 20*1 单选 20*1 填空 20*1 简答、综合 两个答题各有三个小题 共 4 存储器管理 40% 文件管"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem2/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem1/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"操作系统（2）","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/courses\/operating-system\/operatingsystem2\/"},"genre":"posts","keywords":"OS","wordcount":13029,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/courses\/operating-system\/operatingsystem2\/","datePublished":"2022-02-03T00:00:00+00:00","dateModified":"2023-01-13T09:00:31+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>操作系统（2）</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/%E4%B8%93%E4%B8%9A%E8%AF%BE/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;专业课</a></span></div><div class=post-meta-line><span title="2022-02-03 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-02-03>2022-02-03</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 13029 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 27 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#第四章-存储器管理>第四章 存储器管理</a><ul><li><a href=#存储器的层次结构>存储器的层次结构</a><ul><li><a href=#多结构的存储器系统>多结构的存储器系统</a></li><li><a href=#主存储器与寄存器>主存储器与寄存器</a></li><li><a href=#高速缓存与磁盘缓存>高速缓存与磁盘缓存</a></li></ul></li><li><a href=#程序的装入和链接>程序的装入和链接</a><ul><li><a href=#程序的链接>程序的链接</a><ul><li><a href=#静态链接方式><strong>静态链接方式</strong></a></li><li><a href=#装入时动态链接><strong>装入时动态链接</strong></a></li><li><a href=#运行时动态链接><strong>运行时动态链接</strong></a></li></ul></li><li><a href=#程序的装入>程序的装入</a><ul><li><a href=#绝对装入方式><strong>绝对装入方式</strong></a></li><li><a href=#可重定位装入方式><strong>可重定位装入方式</strong></a></li><li><a href=#动态运行时装入方式><strong>动态运行时装入方式</strong></a></li></ul></li></ul></li><li><a href=#连续分配存储管理方式>连续分配存储管理方式</a><ul><li><a href=#单一连续分配>单一连续分配</a></li><li><a href=#固定分区分配><strong>固定分区分配</strong></a><ul><li><a href=#划分分区的方法>划分分区的方法</a></li><li><a href=#内存分配>内存分配</a></li></ul></li><li><a href=#动态分区分配>动态分区分配</a><ul><li><a href=#分配中的数据结构>分配中的数据结构</a></li><li><a href=#分区分配操作>分区分配操作</a></li></ul></li><li><a href=#基于顺序搜索的动态分区分配算法-><strong>基于顺序搜索的动态分区分配算法</strong> ☆</a><ul><li><a href=#首次适应><strong>首次适应</strong></a></li><li><a href=#循环首次适应><strong>循环首次适应</strong></a></li><li><a href=#最佳适应><strong>最佳适应</strong></a></li><li><a href=#最坏适应><strong>最坏适应</strong></a></li></ul></li><li><a href=#基于索引搜索的动态分区分配算法><strong>基于索引搜索的动态分区分配算法</strong></a><ul><li><a href=#快速适应><strong>快速适应</strong></a></li><li><a href=#伙伴系统-><strong>伙伴系统</strong> ☆</a></li><li><a href=#哈希算法><strong>哈希算法</strong></a></li></ul></li><li><a href=#动态可重定位分区分配算法><strong>动态可重定位分区分配算法</strong></a></li></ul></li><li><a href=#对换技术>对换技术</a><ul><li><a href=#对换类型>对换类型</a></li><li><a href=#对换空间的管理>对换空间的管理</a></li><li><a href=#进程的换入换出>进程的换入换出</a></li></ul></li><li><a href=#分页存储管理方式>分页存储管理方式</a><ul><li><a href=#页面与物理块页框>页面与物理块（页框）</a><ul><li><a href=#页面>页面</a></li><li><a href=#物理块>物理块</a></li><li><a href=#地址结构><strong>地址结构</strong></a></li><li><a href=#页表>页表</a></li></ul></li><li><a href=#地址变换机构>地址变换机构</a><ul><li><a href=#基本的地址变换机构>基本的地址变换机构</a></li><li><a href=#具有快表的地址变换机构>具有快表的地址变换机构</a></li><li><a href=#一些计算>一些计算</a><ul><li><a href=#已知逻辑地址和页面大小求其页号和页内地址>已知逻辑地址和页面大小，求其页号和页内地址</a></li><li><a href=#逻辑地址到物理地址>逻辑地址到物理地址</a></li></ul></li></ul></li><li><a href=#内存访问的有效时间>内存访问的有效时间</a></li><li><a href=#两级和多级页表>两级和多级页表</a></li><li><a href=#反置页表><strong>反置页表</strong></a></li><li><a href=#例>例</a></li></ul></li><li><a href=#分段存储管理方式>分段存储管理方式</a><ul><li><a href=#引入>引入</a><ul><li><a href=#分页的意义><strong>分页的意义</strong></a></li><li><a href=#分段的意义><strong>分段的意义</strong></a></li></ul></li><li><a href=#分段基本原理>分段基本原理</a></li><li><a href=#分页和分段的区别>分页和分段的区别</a></li><li><a href=#信息共享>信息共享</a></li></ul></li><li><a href=#段页式存储管理方式>段页式存储管理方式</a><ul><li><a href=#基本原理>基本原理</a></li><li><a href=#地址变换过程><strong>地址变换过程</strong></a></li></ul></li><li><a href=#本章结构>本章结构</a></li></ul></li><li><a href=#第五章-虚拟存储器>第五章 虚拟存储器</a><ul><li><a href=#虚拟存储器概述>虚拟存储器概述</a><ul><li><a href=#局部性原理>局部性原理</a></li><li><a href=#传统存储器的特征>传统存储器的特征</a></li></ul></li><li><a href=#虚拟存储器的定义和特征>虚拟存储器的定义和特征</a></li><li><a href=#请求分页存储管理方式>请求分页存储管理方式</a><ul><li><a href=#硬件支持>硬件支持</a><ul><li><a href=#请求分页的页表机制>请求分页的页表机制</a></li><li><a href=#缺页中断机构>缺页中断机构</a></li><li><a href=#地址变换机构-1>地址变换机构</a></li></ul></li><li><a href=#请求分页中的内存分配>请求分页中的内存分配</a><ul><li><a href=#最小物理块数确定>最小物理块数确定</a></li><li><a href=#内存分配策略>内存分配策略</a></li><li><a href=#物理块分配算法>物理块分配算法</a></li></ul></li><li><a href=#页面调入策略>页面调入策略</a><ul><li><a href=#何时调入>何时调入</a></li><li><a href=#何处调入>何处调入</a></li><li><a href=#调入过程>调入过程</a></li><li><a href=#缺页率>缺页率</a></li></ul></li></ul></li><li><a href=#页面置换算法->页面置换算法 ⭐</a><ul><li><a href=#最佳置换算法-opt>最佳置换算法 OPT</a></li><li><a href=#先进先出置换-fifo>先进先出置换 FIFO</a></li><li><a href=#最近最久未使用-lru>最近最久未使用 LRU</a><ul><li><a href=#硬件支持-1>硬件支持</a><ul><li><a href=#寄存器>寄存器</a></li><li><a href=#栈>栈</a></li></ul></li></ul></li><li><a href=#最少使用-lfu>最少使用 LFU</a></li><li><a href=#最近未使用-nru简单-clock-置换>最近未使用 NRU（简单 CLOCK 置换）</a></li><li><a href=#改进-clock-置换>改进 CLOCK 置换</a></li><li><a href=#页面缓冲算法-pba>页面缓冲算法 PBA</a></li><li><a href=#访问内存的有效时间>访问内存的有效时间</a></li></ul></li><li><a href=#抖动和工作集>抖动和工作集</a><ul><li><a href=#多道程序度与抖动>多道程序度与抖动</a></li><li><a href=#工作集>工作集</a></li><li><a href=#预防抖动的办法>预防抖动的办法</a><ul><li><a href=#局部置换>局部置换</a></li><li><a href=#引入工作集算法>引入工作集算法</a></li><li><a href=#l--s-准则>L = S 准则</a></li><li><a href=#挂起>挂起</a></li></ul></li></ul></li><li><a href=#请求分段存储管理方式>请求分段存储管理方式</a><ul><li><a href=#请求分段中的硬件支持>请求分段中的硬件支持</a></li><li><a href=#分段的共享与保护>分段的共享与保护</a></li></ul></li></ul></li><li><a href=#第六章-输入输出系统>第六章 输入输出系统</a><ul><li><a href=#io-系统的功能模型接口>IO 系统的功能、模型、接口</a><ul><li><a href=#io-系统的基本功能>IO 系统的基本功能</a></li><li><a href=#io-系统的层次结构>IO 系统的层次结构</a></li><li><a href=#io-系统接口>IO 系统接口</a></li></ul></li><li><a href=#设备控制器和-io-设备>设备控制器和 IO 设备</a><ul><li><a href=#io-设备类型>IO 设备类型</a></li><li><a href=#io-设备与设备控制器的接口>IO 设备与设备控制器的接口</a></li><li><a href=#设备控制器>设备控制器</a><ul><li><a href=#功能>功能</a></li><li><a href=#组成>组成</a></li></ul></li><li><a href=#内存映像-io>内存映像 IO</a></li><li><a href=#io-通道>IO 通道</a><ul><li><a href=#通道类型>通道类型</a></li><li><a href=#io-通道的瓶颈问题>IO 通道的瓶颈问题</a></li></ul></li></ul></li><li><a href=#中断处理程序和中断机构>中断处理程序和中断机构</a><ul><li><a href=#中断简介>中断简介</a></li><li><a href=#中断处理程序>中断处理程序</a></li></ul></li><li><a href=#设备驱动程序>设备驱动程序</a><ul><li><a href=#对-io-设备的控制方式>对 IO 设备的控制方式</a><ul><li><a href=#轮询程序-io-方式>（轮询）程序 IO 方式</a></li><li><a href=#中断驱动-io-方式>中断驱动 IO 方式</a></li><li><a href=#dma-方式>DMA 方式</a></li><li><a href=#io-通道方式>IO 通道方式</a></li></ul></li></ul></li><li><a href=#设备独立性软件>设备独立性软件</a><ul><li><a href=#设备独立性软件的主要任务>设备独立性软件的主要任务</a></li><li><a href=#设备分配>设备分配</a><ul><li><a href=#设备分配中的数据结构>设备分配中的数据结构</a></li><li><a href=#设备分配考虑的因素><strong>设备分配考虑的因素</strong>：</a></li></ul></li></ul></li><li><a href=#用户层的-io-软件>用户层的 IO 软件</a><ul><li><a href=#系统调用和库函数>系统调用和库函数</a></li><li><a href=#假脱机系统-spooling>假脱机系统 Spooling</a><ul><li><a href=#组成-1>组成</a></li><li><a href=#特点>特点</a></li></ul></li></ul></li><li><a href=#缓冲区管理>缓冲区管理</a></li><li><a href=#磁盘存储器的性能和调度>磁盘存储器的性能和调度</a><ul><li><a href=#磁盘访问时间>磁盘访问时间</a></li><li><a href=#磁盘调度算法>磁盘调度算法</a><ul><li><a href=#先来先服务-fcfs>先来先服务 FCFS</a></li><li><a href=#最短寻道时间优先-sstf>最短寻道时间优先 SSTF</a></li><li><a href=#扫描算法电梯调度scan>扫描算法（电梯调度）SCAN</a></li><li><a href=#循环扫描-cscan>循环扫描 CSCAN</a></li><li><a href=#nstepscan>NStepSCAN</a></li><li><a href=#fscan>FSCAN</a></li></ul></li></ul></li></ul></li><li><a href=#第七章-文件管理>第七章 文件管理</a><ul><li><a href=#文件和文件系统>文件和文件系统</a><ul><li><a href=#数据的组成部分数据项记录文件>数据的组成部分：数据项、记录、文件</a></li><li><a href=#文件系统的层次结构>文件系统的层次结构</a></li><li><a href=#文件操作>文件操作</a><ul><li><a href=#基本文件操作>基本文件操作</a></li><li><a href=#打开和关闭操作>打开和关闭操作</a></li><li><a href=#其他文件操作>其他文件操作</a></li></ul></li></ul></li><li><a href=#文件的逻辑结构>文件的逻辑结构</a><ul><li><a href=#按结构分类>按<strong>结构</strong>分类</a></li><li><a href=#按组织方式分类>按<strong>组织方式</strong>分类</a></li></ul></li><li><a href=#文件目录>文件目录</a><ul><li><a href=#文件控制块-fcb>文件控制块 FCB</a></li><li><a href=#索引节点-inode>索引节点 inode</a></li><li><a href=#目录结构><strong>目录结构</strong></a><ul><li><a href=#单级目录结构>单级目录结构</a></li><li><a href=#两级目录结构>两级目录结构</a></li><li><a href=#树形目录结构>树形目录结构</a></li></ul></li><li><a href=#目录查询技术>目录查询技术</a></li></ul></li><li><a href=#文件共享>文件共享</a></li><li><a href=#文件保护>文件保护</a></li></ul></li><li><a href=#第八章-磁盘存储器管理>第八章 磁盘存储器管理</a><ul><li><a href=#外存的组织方式>外存的组织方式</a><ul><li><a href=#连续组织方式>连续组织方式</a></li><li><a href=#链接组织方式>链接组织方式</a><ul><li><a href=#隐式链接><strong>隐式链接</strong></a></li><li><a href=#显式链接>显式链接</a></li></ul></li><li><a href=#索引组织方式>索引组织方式</a></li></ul></li><li><a href=#文件存储空间管理>文件存储空间管理</a><ul><li><a href=#空闲表法>空闲表法</a></li><li><a href=#空闲链表法>空闲链表法</a></li><li><a href=#位示图法>位示图法</a></li><li><a href=#成组链接法>成组链接法</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=操作系统二>操作系统二</h1><p>判断 20*1</p><p>单选 20*1</p><p>填空 20*1</p><p>简答、综合 两个答题各有三个小题 共 4</p><p>存储器管理 40%</p><p>文件管理（含实验，命令 + 系统调用部分） 35%</p><ul><li>命令在上学期实验里，也要看</li></ul><h2 id=第四章-存储器管理>第四章 存储器管理</h2><p>（内存分配：分配和去配，地址映射：抽象和映射，内存保护：隔离和共享，内存扩充：存储扩充）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203080528359.png alt=image-20211203080528359 style=zoom:50%><p>1、3、5 <strong>重要</strong>，2、4 自学</p><h3 id=存储器的层次结构>存储器的层次结构</h3><h4 id=多结构的存储器系统>多结构的存储器系统</h4><p><strong>存储器的六层结构</strong></p><ul><li>CPU 寄存器</li><li>主存储器：<strong>高速缓存</strong>、主存储器、<strong>磁盘缓存（内存中，不是个独立的设备）</strong></li><li>辅存储器：固定磁盘、可移动磁盘</li></ul><p><strong>可执行存储器</strong>：寄存器 + 主存储器</p><blockquote><p>辅存属于设备管理和文件管理范畴</p></blockquote><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129084150116.png alt=image-20211129084150116 style=zoom:50%><h4 id=主存储器与寄存器>主存储器与寄存器</h4><p><strong>主存储器</strong>：保存进程运行时的程序和数据</p><p><strong>寄存器</strong>：存放处理运行时的数据</p><h4 id=高速缓存与磁盘缓存>高速缓存与磁盘缓存</h4><p><strong>高速缓存</strong>：备份主存中较常用的数据，减少处理机对主存的访问次数</p><p><strong>磁盘缓存</strong>：暂时存放频繁使用的一部分磁盘数据和信息，以减少访问磁盘的次数</p><h3 id=程序的装入和链接>程序的装入和链接</h3><blockquote><p>自学</p></blockquote><p>程序在系统中运行，需要先装入内存，然后经过以下过程：</p><ul><li><strong>编译</strong>：由编译程序编译形成若干个目标模块（将高级语言翻译为机器语言）</li><li><strong>链接</strong>：将模块与库函数链接在一起，形成完整的<strong>装入模块</strong></li><li><strong>装入</strong>：由装入程序将装入模块装入内存</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129090852499.png alt=image-20211129090852499 style=zoom:50%><h4 id=程序的链接>程序的链接</h4><p>重点：何时完成模块的调入</p><h5 id=静态链接方式><strong>静态链接方式</strong></h5><ul><li>在程序运行前完整链接。需要拷贝全部模块。</li><li>在<strong>外存</strong>完成链接</li><li>需要解决的问题<ul><li>对每个模块相对地址进行修改</li><li>变换外部调用符号</li></ul></li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129092229980.png alt=image-20211129092229980 style=zoom:50%><h5 id=装入时动态链接><strong>装入时动态链接</strong></h5><ul><li>边装入边链接（装入时，当发生外部模块调用事件时才去调入）</li><li>在<strong>内存</strong>完成链接</li><li>优点<ul><li>便于修改和更新（修改模块时不需要重新打开装入模块）</li><li>便于实现模块的共享（时分复用）</li></ul></li></ul><h5 id=运行时动态链接><strong>运行时动态链接</strong></h5><blockquote><p>Run-time Dynamic Linking</p></blockquote><ul><li>对某些模块的链接推迟到<strong>执行时</strong>链接</li><li>链接实际运行用到的模块，节省内存（因为并不是所有模块都会被运行，如错误处理模块）</li></ul><h4 id=程序的装入>程序的装入</h4><p>重点：何时完成逻辑地址到物理地址的转换</p><p><strong>术语</strong></p><ul><li><p>逻辑地址：装入程序的地址都是从 0 开始</p></li><li><p>物理地址：主存中一系列存储信息的物理单元的地址</p></li><li><p><strong>重定位</strong>：逻辑地址（相对地址）到物理地址（绝对地址）的映射</p></li></ul><h5 id=绝对装入方式><strong>绝对装入方式</strong></h5><p>(Absolute Loading Mode)</p><ul><li>程序<strong>编译时</strong>直接产生物理地址</li><li>适用单道系统</li></ul><h5 id=可重定位装入方式><strong>可重定位装入方式</strong></h5><blockquote><p>也叫静态重定位 Relocation Loading Mode</p></blockquote><ul><li><strong>装入时</strong>根据内存情况对指令地址和数据地址进行相应<strong>偏移</strong>（加个偏移量）</li><li>地址变换在装入时一次完成，不再改变；要求一次性分配作业的全部内存空间；无需硬件支持</li><li>属于静态重定位</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129091928847.png alt=image-20211129091928847 style=zoom:50%><h5 id=动态运行时装入方式><strong>动态运行时装入方式</strong></h5><blockquote><p>Dynamic Run-time Loading</p></blockquote><ul><li>装入内存后仍然是逻辑地址，地址转换推迟到<strong>执行时</strong>进行</li><li>绝对地址的转换有<strong>硬件支持</strong>（重定位寄存器）</li><li>支持程序在内存中浮动；不要求占用连续空间</li></ul><h3 id=连续分配存储管理方式>连续分配存储管理方式</h3><h4 id=单一连续分配>单一连续分配</h4><p>为一个用户程序分配一个连续的内存空间</p><ul><li><p>用于<strong>单用户、单任务</strong>的操作系统中。</p></li><li><p>将内存划分为</p><ul><li>系统区</li><li>用户区</li></ul></li><li><p>用户区内存由一道程序独占</p></li><li><p>适合绝对装入方式</p></li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220417104839832.png alt=image-20220417104839832 style=zoom:50%><h4 id=固定分区分配><strong>固定分区分配</strong></h4><p>将用户内存划分多个分区，每个分区一道程序独占</p><h5 id=划分分区的方法>划分分区的方法</h5><ol><li><p>分区大小相等</p></li><li><p>分区大小不相等</p></li></ol><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220417110619438.png alt=image-20220417110619438 style=zoom:50%><h5 id=内存分配>内存分配</h5><p>将分区按大小排队（一般由小到大），建立<strong>分区使用表</strong>（起址、大小、状态）</p><p>程序装入时，由内存分配程序检索分区使用表，找到符合要求的分区，并进行标记</p><p><strong>特点</strong></p><ul><li><p>使用<strong>分区说明表</strong>标识分区分配状态</p></li><li><p>适合静态重定位装入方式</p></li><li><p>会造成<strong>内碎片</strong>（属于某程序但未被使用的碎片）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129093128125.png alt=image-20211129093128125 style=zoom:40%></li></ul><h4 id=动态分区分配>动态分区分配</h4><p>根据进程实际需要动态地分配内存</p><p>会存在<strong>外碎片</strong>（不属于任何程序的碎片）</p><h5 id=分配中的数据结构>分配中的数据结构</h5><ul><li><strong>空闲分区表</strong>：序号、起址、大小</li><li><strong>空闲分区链表</strong>：双向链表，状态信息、分区大小、指针</li></ul><p><strong>步骤</strong></p><ul><li>从空闲分区表中找一个足以容纳改作业的空闲区</li><li>若这个分区比较大，则一分为二</li><li>一部分分配给作业，另一部分仍作为空闲区留在表内</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211129093935054.png alt=image-20211129093935054 style=zoom:40%><h5 id=分区分配操作>分区分配操作</h5><p><strong>分配内存</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203084528415.png alt=image-20211203084528415 style=zoom:50%><p><strong>回收内存</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203084546713.png alt=image-20211203084546713 style=zoom:40%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203084606901.png alt=image-20211203084606901 style=zoom:40%><p><strong>碎片问题</strong></p><ul><li><p>不修改程序即可进行紧凑，需要硬件支持</p></li><li><p><strong>紧凑</strong>：通过移动内存中作业的位置，把多个小分区拼成大分区的方法</p></li><li><p>动态重定位及其分区分配算法</p></li></ul><blockquote><p>以下三节为连续分配存储管理方式的<strong>分配算法</strong></p></blockquote><h4 id=基于顺序搜索的动态分区分配算法-><strong>基于顺序搜索的动态分区分配算法</strong> ☆</h4><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203090529707.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203090529707.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203090529707.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203090529707.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203090529707.png title=image-20211203090529707></p><h5 id=首次适应><strong>首次适应</strong></h5><p>(first fit, FF)</p><ul><li>空闲分区按<strong>起址</strong>递增次序排列，从头开始直至找到<strong>第一个</strong>满足要求的空闲分区</li><li>内存低端会留下小的空闲区，高端有大的空闲区</li><li>优点：算法简单，保留高地址大空闲区</li><li>缺点：外碎片，查找效率低</li></ul><h5 id=循环首次适应><strong>循环首次适应</strong></h5><p>(下次适应，next fit, NF)</p><ul><li>从上次分配的位置之后开始查找</li><li>优点：减少查找开销，空闲分区分布均匀</li><li>缺点：缺乏大空闲分区</li></ul><h5 id=最佳适应><strong>最佳适应</strong></h5><p>(best fit, BF)</p><ul><li>搜索整个序列，找到适合条件的<strong>最小</strong>的分区进行分配</li><li>优点：保留大空闲分区</li><li>缺点：留下大量难以利用的外碎片；查找效率低</li></ul><h5 id=最坏适应><strong>最坏适应</strong></h5><p>(worst fit, WF)</p><ul><li>空闲分区按大小从大到小的次序排列，最前面的<strong>最大</strong>的空闲分区就是找到的分区</li><li>优点：分割后空闲块仍为较大空块，剩余空间最大化；不会出现太小的外碎片</li><li>缺点：缺乏大空闲分区，一段时间后就不能满足对于较大空闲区的分配要求</li></ul><h4 id=基于索引搜索的动态分区分配算法><strong>基于索引搜索的动态分区分配算法</strong></h4><h5 id=快速适应><strong>快速适应</strong></h5><p>(quick fit)</p><p><strong>步骤</strong></p><ul><li>空闲分区按容量大小进行分类</li><li>对于每一类具有相同容量的所有空闲空间分区，单独设立一个空闲分区链表</li><li>系统中存在多个空闲分区链表</li><li>在内存中设立一张管理索引表<ul><li>每个表项对应一种空闲分区类型</li><li>记录了空闲分区链表的表头指针</li></ul></li><li>在进行空闲分区分配时，不会对任何分区产生分割；仅需要根据进程的长度，寻找到能容纳它的最小空闲区链表，并取下第一块进行分配即可</li></ul><p>优点</p><ul><li>查找效率高，O(1)</li><li>保留大分区</li><li>无外碎片</li></ul><p>缺点</p><ul><li>归还时算法复杂，系统开销大</li><li>仍有一定空间浪费</li></ul><h5 id=伙伴系统-><strong>伙伴系统</strong> ☆</h5><blockquote><p>buddy system</p></blockquote><p>将内存按 2 的幂次划分，组成若干空闲块链表；查找该链表找到能满足进程需求的最佳匹配快。适用离散分配方式</p><blockquote><p>分配原则：比一半大，又占不满整块；否则一分为二</p></blockquote><p><strong>步骤</strong></p><ul><li>对不连续的空闲分区，按分区大小进行分类。对具有相同大小的所有空闲分区，单独设立一个空闲分区双向链表，即会存在 k 个空闲分区链表</li><li><strong>分配时</strong><ul><li>设需分配长度为 n，找 2^i^ 分区链的分区，使 2^i-1^ &lt; n &lt; 2^i^</li><li>若无，找 2^i+1^ 且把它均分两块，称为伙伴；一个加入 2^i^ 分区链，一个分配</li></ul></li><li><strong>回收时</strong>，若已存在 2^i^ 空闲分区，则将其于伙伴合并为 2^i+1^ 分区，&mldr;..</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203092647294.png alt=image-20211203092647294 style=zoom:60%>
$$
buddy_k(x)= \begin{cases}
\ x+2^k \ (if \ x \ MOD \ 2^{k+1}=0)
\\ x-2^k \ (if \ x \ MOD \ 2^{k+1}=2^k)
\end{cases}
$$<p><strong>优点</strong></p><ul><li><p>查找效率高</p></li><li><p>能保留大的分区</p></li></ul><p>其性能取决于查找空闲分区的位置和分割、合并的时间。 时间上不及快速适应算法，但空闲分区的使用率高</p><h5 id=哈希算法><strong>哈希算法</strong></h5><blockquote><p>实现快速查找</p></blockquote><p>unordered_map&lt;分区大小, 空闲分区链表></p><p>利用哈希快速查找的优点，以及空闲分区在可利用空闲区表中的分布规律，建立哈希函数。</p><p>构造一张以空闲分区大小为关键字的哈希表，该表的每一个表项记录了一个对应的空闲分区链表。</p><p>分配时，根据所需空闲分区大小，通过哈希函数计算，即得到在哈希表中的位置，找到对应的空闲分区表。</p><p>优点：查找快速，减少了查询索引表表项的时间开销</p><h4 id=动态可重定位分区分配算法><strong>动态可重定位分区分配算法</strong></h4><blockquote><p>不重要</p></blockquote><p>空闲分区总和大于需求但无法找到单一连续可用区间时，进行<strong>紧凑</strong></p><p>动态重定位分区分配算法与动态分区分配算法基本相同，差别在于增加了紧凑的功能</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211203093750007.png alt=image-20211203093750007 style=zoom:40%><h3 id=对换技术>对换技术</h3><blockquote><p>贮存不足的存储管理技术有：移动（紧凑）、对换、覆盖</p></blockquote><p><strong>对换</strong> (swapping)：将内存中不能运行的进程或暂时不用的程序和数据换出到外存上，以便腾出足够的内存空间，再把具备运行条件的进程和数据换入内存，也称交换。</p><blockquote><p>对换是改善内存利用率的有效措施，实际上就是被挂起</p></blockquote><h4 id=对换类型>对换类型</h4><ul><li>整体对换：即处理机低级调度（进程调度），上下文切换，以进程为单位</li><li>页面（分段）对换：按页或段进行对换，是请求分页、请求分段存储管理的基础</li></ul><h4 id=对换空间的管理>对换空间的管理</h4><ul><li><p>外存的划分：文件区、对换区</p></li><li><p>管理方式：空闲分区表、空闲分区链</p></li><li><p>分配算法：首次适应法、循环首次适应法、最佳适应法</p></li></ul><h4 id=进程的换入换出>进程的换入换出</h4><ul><li><p><strong>换出</strong></p><ul><li>选择处于阻塞状态且优先级最低的进程</li><li>将该进程的程序和数据传送到磁盘的<strong>对换区</strong>上</li><li>回收内存空间，修改该进程的 PCB</li></ul></li><li><p><strong>换入</strong></p><ul><li>定时查看进程状态，选择就绪的换出进程</li><li>将处于就绪态的，换出时间最久的进程换入内存</li></ul></li></ul><h3 id=分页存储管理方式>分页存储管理方式</h3><blockquote><p>连续分配方式的不足，促使人们产生了离散分配的管理思想。从而引入了“分页”分配管理的管理方式。分为：基本分页（纯分页）和支持虚存管理的请求分页管理</p></blockquote><p><strong>连续内存分配方式</strong>：单一连续分配、固定分区分配、动态分区分配、动态可重定位分区分配</p><p><strong>离散内存分配方式</strong>：分页存储管理方式、分段存储管理方式、段页式存储管理方式</p><h4 id=页面与物理块页框>页面与物理块（页框）</h4><p>分页存储管理器<strong>将逻辑地址按页分割</strong>，<strong>将物理地址按块分割</strong>；</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206090147618.png alt=image-20211206090147618 style=zoom:50%><h5 id=页面>页面</h5><ul><li><p>将一个进程的逻辑地址空间分成若干个大小相等的区域，称为<strong>页面</strong>或<strong>页</strong>，并加以编号，从 0 开始；页内地址从 0 开始编址</p></li><li><p>页的大小一般为 2 的整数次幂</p><ul><li>页面大小<ul><li>过小，减小内存碎片；同时页表过长，降低页面换进换出的效率</li><li>过大，可以减少页表长度，提高页面换进换出效率；页面碎片增多</li></ul></li></ul></li></ul><h5 id=物理块>物理块</h5><p>将内存的物理空间分成若干个块</p><p>在为进程分配内存时，以块为单位，将进程的若干个页装入不相邻（离散）的物理块中。（会产生页内碎片）</p><h5 id=地址结构><strong>地址结构</strong></h5><p>将逻辑地址分为：<code>页号 P | 位移量 W</code>（位移量即页内偏移地址）</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091010914.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091010914.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091010914.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091010914.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091010914.png title=image-20211206091010914></p><h5 id=页表>页表</h5><p>分页系统中，将进程的每一页离散地址存储在内存的任一物理块中；系统<strong>为每个进程设立一张页表</strong>。</p><p>✔️ <strong>页表实现从页号到物理块号的映射</strong></p><p>页表存放在<strong>内存</strong>中</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206092231273.png alt=image-20211206092231273 style=zoom:50%><blockquote><p>实际上，页表<strong>并没有页号项</strong>，因为它是递增的，不需要记录</p><p>页表的表项有：物理块号（表现为指向页框的指针）和存取控制字段</p><p>每一个表目称为页描述子</p></blockquote><h4 id=地址变换机构>地址变换机构</h4><p>作用：实现从逻辑地址到物理地址的转换</p><h5 id=基本的地址变换机构>基本的地址变换机构</h5><p>页表设置一个<strong>页表寄存器</strong>（PTR），存放：</p><ul><li>页表在内存中的始址（用来找到页表）</li><li>页表的长度（即页的个数，用来判断越界中断）</li></ul><p>过程</p><ol><li>逻辑地址分割后产生<strong>页号</strong>和<strong>偏移量</strong></li><li>通过页表寄存器中<strong>页表长度</strong>和目标页号的比较，判断<strong>是否越界中断</strong></li><li>如无中断则通过<strong>页表始址</strong>查询页表得到<strong>物理块号</strong><ul><li>页号 * 页表项长度 + 页表始址 = 该页号在页表中的位置（存储着对应的物理块号）</li></ul></li><li>结合偏移量得到<strong>物理地址</strong></li></ol><p>每次存 / 取要<strong>两次访问内存</strong>（访问页表、访问内存找到物理地址）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206093439140.png alt=image-20211206093439140 style=zoom:50%><h5 id=具有快表的地址变换机构>具有快表的地址变换机构</h5><p><strong>联想寄存器 / 快表 / TLB</strong>：一个具有并行查询能力的特殊高速缓冲寄存器（不在内存）</p><p>过程：先查快表再查页表</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206094025706.png alt=image-20211206094025706 style=zoom:50%><h5 id=一些计算>一些计算</h5><h6 id=已知逻辑地址和页面大小求其页号和页内地址>已知逻辑地址和页面大小，求其页号和页内地址</h6><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211206091247071.png alt=image-20211206091247071 style=zoom:50%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301135756734.png alt=image-20220301135756734 style=zoom:30%><h6 id=逻辑地址到物理地址>逻辑地址到物理地址</h6><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151659838.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151659838.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151659838.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151659838.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151659838.png title=image-20220301151659838></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151859742.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151859742.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151859742.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151859742.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301151859742.png title=image-20220301151859742></p><h4 id=内存访问的有效时间>内存访问的有效时间</h4><p>设访问内存时间为 t ，快表查询时间为 λ ，命中率为 a ：</p><ul><li>不使用快表：$EAT=t+t=2t$</li><li>使用快表： $EAT=aλ+(1−a)(λ+t)+t$</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213081519016.png alt=image-20211213081519016 style=zoom:40%><h4 id=两级和多级页表>两级和多级页表</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213082030654.png alt=image-20211213082030654 style=zoom:40%><ul><li>多级页表直将需要的页表调入内存</li><li>不同被调入的页表离散存储在内存空间中</li><li>外层页表偏移页号指向内层页表地址，最后指向内存空间</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213082229767.png alt=image-20211213082229767 style=zoom:50%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213082330064.png alt=image-20211213082330064 style=zoom:50%><h4 id=反置页表><strong>反置页表</strong></h4><p>存<strong>进程标识</strong>和<strong>页号</strong>，以物理块号为下标的顺序表</p><p>逻辑地址：PID + 页号 + 页内偏移</p><p>内存中只有一张表</p><p>现代计算机系统允许一个进程逻辑地址空间远大于分配的内存空间。此时采用物理块号向页号反向查表更能节省页表的占用空间。在整个反置页表检索进程标识符和页号，找到匹配的页表项则将该项的物理块号（即下标）和页偏移地址合并作为物理地址。如果查不到，则表明该页号缺页，需要检索外部页表，并进行调页。</p><h4 id=例>例</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153243692.png alt=image-20220301153243692 style=zoom:30%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153303294.png alt=image-20220301153303294 style=zoom:33%><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153526655.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153526655.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153526655.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153526655.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153526655.png title=image-20220301153526655></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153622169.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153622169.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153622169.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153622169.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301153622169.png title=image-20220301153622169></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301204749540.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301204749540.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301204749540.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301204749540.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301204749540.png title=image-20220301204749540></p><h3 id=分段存储管理方式>分段存储管理方式</h3><p>程序按照逻辑关系天然地划分为段</p><h4 id=引入>引入</h4><h5 id=分页的意义><strong>分页的意义</strong></h5><p>使内存的离散分配成为可能，提高内存利用率</p><h5 id=分段的意义><strong>分段的意义</strong></h5><ul><li>方便编程：每个段始址为 0，转移直观</li><li>信息共享：段可以包含完整逻辑，方便共享</li><li>信息保护：段整体作为保护对象</li><li>动态增长：数据段的动态增加</li><li>动态链接：分段是动态链接的前提</li></ul><h4 id=分段基本原理>分段基本原理</h4><p><strong>分段</strong>：分段地址划分决定了段的最大个数和每个段的最大内存长度（参考子网划分）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213084133308.png alt=image-20211213084133308 style=zoom:50%><p><strong>段表</strong>：记录<strong>段长</strong>和<strong>基址</strong>（在内存中的起始地址）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213084219295.png alt=image-20211213084219295 style=zoom:40%><p><strong>地址变换机构</strong>：同分页地址变换机构</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213084250317.png alt=image-20211213084250317 style=zoom:50%><h4 id=分页和分段的区别>分页和分段的区别</h4><ul><li>页是信息的物理单位，对用户透明；段是信息的逻辑单位，满足用户需要</li><li>页的大小由系统决定；段的大小由信息性质划分</li><li>分页的用户程序地址空间是一维的；分段的用户程序地址空间有二维（段页也是二维）</li></ul><h4 id=信息共享>信息共享</h4><p>分段易于实现程序和数据的共享</p><p>不同进程需要共享一个段（可重入代码），只需要相同基址即可</p><h3 id=段页式存储管理方式>段页式存储管理方式</h3><h4 id=基本原理>基本原理</h4><p>将用户程序分为若干个段，再把每个段分成若干个页</p><p><strong>逻辑地址</strong>：段号 | 段内页号 | 页内地址</p><p><strong>段表</strong>：存放页表大小和页表始址</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213090332596.png alt=image-20211213090332596 style=zoom:50%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213090352168.png alt=image-20211213090352168 style=zoom:50%><h4 id=地址变换过程><strong>地址变换过程</strong></h4><p>段页式存储管理方式中，访问一条指令或数据需要<strong>访问三次内存</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213090511884.png alt=image-20211213090511884 style=zoom:50%><h3 id=本章结构>本章结构</h3><p>存储器管理：</p><ul><li>连续分配方式：<ul><li>单一连续分配</li><li>分区式分配<ul><li>固定分区分配</li><li>动态分区分配<ul><li>基于顺序搜索的动态分区分配：FF、NF、BF、WF</li><li>基于索引搜索的动态分区分配：QF、Buddy、Hash</li><li>动态可重定位分区分配</li></ul></li></ul></li></ul></li><li>离散分配方式：虚拟的必要条件<ul><li>分页存储管理<ul><li>基本分页存储管理</li><li>请求分页存储管理（虚拟存储器）</li></ul></li><li>分段存储管理<ul><li>基本分段存储管理</li><li>请求分段存储管理（虚拟存储器）</li></ul></li><li>段页式存储管理</li></ul></li></ul><h2 id=第五章-虚拟存储器>第五章 虚拟存储器</h2><h3 id=虚拟存储器概述>虚拟存储器概述</h3><p>将一个作业完整地装入内存可能发生的情况：</p><ol><li>有的作业很大，其所要求的内存空间超过了内存总容量，作业不能全部被装入内存，致使该作业无法运行；</li><li>有大量作业要求运行，但由于内存容量不足以容纳所有这些作业，只能将少数作业装入内存让它们先运行，而将其它大量的作业留在外存上等待。</li></ol><p>虚存容量由主存辅存的容量之和确定</p><h4 id=局部性原理>局部性原理</h4><blockquote><p>局部性原理是虚拟内存有效性的前提</p></blockquote><ul><li>时间局部性（短时间多次访问同一处）</li><li>空间局部性（短时间访问临近地址）</li></ul><h4 id=传统存储器的特征>传统存储器的特征</h4><ul><li>一次性：作业一次性全部装入内存</li><li>驻留性：作业完整驻留在内存</li></ul><blockquote><p>虚存技术以 cpu 时间和外存空间换取昂贵的内存空间</p></blockquote><h3 id=虚拟存储器的定义和特征>虚拟存储器的定义和特征</h3><p><strong>定义</strong>：具有请求调入和置换功能，能从逻辑上对内存容量扩充的存储器系统</p><p><strong>特征</strong></p><ul><li>多次性：一个作业的程序和数据允许多次调入内存</li><li>对换性：允许作业的程序和数据在运行时被换进换出</li><li>虚拟性：能从逻辑上扩充内存容量</li></ul><h3 id=请求分页存储管理方式>请求分页存储管理方式</h3><p>分页请求系统 = 分页存储 + 请求调页 + 页面置换</p><h4 id=硬件支持>硬件支持</h4><h5 id=请求分页的页表机制>请求分页的页表机制</h5><ul><li><p><strong>页表</strong>项除了<strong>物理块号</strong>外，添加<strong>状态位</strong>、<strong>访问字段</strong>、<strong>修改位</strong>和<strong>外存地址</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213092726352.png alt=image-20211213092726352 style=zoom:40%></li></ul><h5 id=缺页中断机构>缺页中断机构</h5><p>（特殊的中断响应机构）</p><p>每当要访问的页面不在内存中时，就会产生一个缺页中断，请求系统将之调入内存</p><p>与一般中断的区别</p><ul><li><p>缺页中断发生在指令执行期并立即响应。普通中断在微操作内不响应</p></li><li><p>执行一条指令可能发生多次缺页中断 (copy A to B 最高可达六次)</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213093733717.png alt=image-20211213093733717 style=zoom:50%></li></ul><h5 id=地址变换机构-1>地址变换机构</h5><p>添加缺页中断、页面写入或置换的过程</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211213093508201.png alt=image-20211213093508201 style=zoom:50%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418140541385.png alt=image-20220418140541385 style=zoom:67%><h4 id=请求分页中的内存分配>请求分页中的内存分配</h4><h5 id=最小物理块数确定>最小物理块数确定</h5><p>保证进程正常运行所需的最小物理块数，与计算机的硬件结构有关，取决于指令的格式、功能和寻址方式</p><p>取决于一次指令最多发生的缺页中断数</p><h5 id=内存分配策略>内存分配策略</h5><p>分配策略：固定分配和可变分配</p><p>置换策略：全局置换和局部置换</p><ul><li><strong>固定分配局部置换</strong>：进程内存大小固定，置换被分配的页</li><li><strong>可变分配全局置换</strong>：缺页即获得新的页面，直至内存占满开始置换</li><li><strong>可变分配局部置换</strong>：置换被分配的页，若缺页太多增加内存大小</li></ul><h5 id=物理块分配算法>物理块分配算法</h5><ul><li>平均分配：进程平均分配内存</li><li>按比例分配：进程按需求占比分配</li><li>优先权分配：考虑紧迫程度（可分配内存分两部分，一部分按比例、，一部分按优先级）</li></ul><h4 id=页面调入策略>页面调入策略</h4><h5 id=何时调入>何时调入</h5><ul><li>预调页：一次性调入若干相邻的页</li><li>请求调页：一次只调入一页</li></ul><h5 id=何处调入>何处调入</h5><ul><li><p>有足够的对换区空间：全部从对换区调入，提高调页速度（需要提前将有关文件从文件去拷贝至对换区）</p></li><li><p>缺少足够的对换区空间</p><ul><li>不会修改的文件从文件区调入；</li><li>可能被修改的文件，在换出时放到对换区，之后调入都从对换区调入</li></ul></li><li><p>UNIX 方式</p><ul><li>未运行文件从文件区调入</li><li>曾运行过但被换出的文件被放入对换区，下次调入时从对换区调入</li><li>页面共享时无需从对换区调入</li></ul></li></ul><h5 id=调入过程>调入过程</h5><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220417150951039.png alt=image-20220417150951039 style=zoom:67%><h5 id=缺页率>缺页率</h5><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220417151124954.png alt=image-20220417151124954 style=zoom:67%><p><strong>影响缺页率的因素</strong></p><ul><li>页面大小</li><li>进程分配物理块数</li><li>页面置换算法</li><li>程序固有特性</li></ul><h3 id=页面置换算法->页面置换算法 ⭐</h3><h4 id=最佳置换算法-opt>最佳置换算法 OPT</h4><p>置换了 6 次，缺页了 9 次</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220082610088.png alt=image-20211220082610088 style=zoom:40%><h4 id=先进先出置换-fifo>先进先出置换 FIFO</h4><p>总是淘汰最先进入内存的页面；建立替换指针始终指向最老的页面</p><p>现象：页框数越多，缺页次数反而增加</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220083046921.png alt=image-20211220083046921 style=zoom:40%><h4 id=最近最久未使用-lru>最近最久未使用 LRU</h4><p>Least Rencently Used</p><p>移位寄存器值最小的被替换</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220085705853.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220085705853.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220085705853.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220085705853.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220085705853.png title=image-20211220085705853></p><h5 id=硬件支持-1>硬件支持</h5><h6 id=寄存器>寄存器</h6><p>具有最小值的寄存器所对应的页面，就是最近最久未使用的页面</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220090320038.png alt=image-20211220090320038 style=zoom:40%><h6 id=栈>栈</h6><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220090307512.png alt=image-20211220090307512 style=zoom:40%><h4 id=最少使用-lfu>最少使用 LFU</h4><p>移位寄存器 pop_count 最小的被替换</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220091017537.png alt=image-20211220091017537 style=zoom:40%><h4 id=最近未使用-nru简单-clock-置换>最近未使用 NRU（简单 CLOCK 置换）</h4><p>置换最近未使用的页面</p><p>页表设置访问位，指针连成<strong>循环链表</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220083902016.png alt=image-20211220083902016 style=zoom:40%><h4 id=改进-clock-置换>改进 CLOCK 置换</h4><p>页表设置<strong>访问位、修改位</strong>；访问位优先权高</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220084049835.png alt=image-20211220084049835 style=zoom:40%><h4 id=页面缓冲算法-pba>页面缓冲算法 PBA</h4><p>（不考）</p><p>Page Buffering Algorithm，是对 FIFO 的发展</p><p>影响请求分页存储管理的因素：页面置换算法，磁盘写回频率，内存读入频率</p><p>系统保留一片空闲物理块用以降低经常缺页的进程的缺页率：</p><ul><li><strong>空闲页面链表</strong>：将进程换下的未修改页面暂存。减少读入频率</li><li><strong>修改页面链表</strong>：将进程换下的修改页面暂存。减少读入频率；成批写入，减少写回频率</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220084554546.png alt=image-20211220084554546 style=zoom:40%><h4 id=访问内存的有效时间>访问内存的有效时间</h4><p>设访问/更新快表时间 λ，访问内存需要时间 t ，缺页中断时间 ε</p><ul><li>页面在快表中： EAT=λ+t（查快表 → 访内存查值）</li><li>页面在页表中： EAT=λ+t+λ+t（查快表 → 访内存查页表 → 更新快表 → 访内存查值）</li><li>缺页：EAT=λ+t+ε+λ+t（快表 → 页表 → 中断 → 更新快表 → 访内存查值）</li></ul><p>设命中率 a，缺页率 f ，则平均访问时间：</p><p>EAT=a(λ+t)+(1−a)((1−f)(2λ+2t)+f(2λ+2t+ε))=(2−a)(λ+t)+εf(1−a)EAT=a(λ+t)+(1−a)((1−f)(2λ+2t)+f(2λ+2t+ε))=(2−a)(λ+t)+εf(1−a)</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301202158988.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301202158988.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301202158988.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301202158988.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220301202158988.png title=image-20220301202158988></p><p>2，1，0，2</p><h3 id=抖动和工作集>抖动和工作集</h3><h4 id=多道程序度与抖动>多道程序度与抖动</h4><p><strong>抖动</strong>：在请求分页存储管理中，反复出现从主存中刚换出一页根据请求马上又换入的现象，调用页面时间甚至比程序实际运行的时间还多</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220091430189.png alt=image-20211220091430189 style=zoom:33%><p><strong>表现</strong>：随着进程数增多，处理机利用率先增大后减小</p><p><strong>产生原因</strong>：系统中运行进程太多，分配给每一个进程的物理块太少，进程内存分配无法满足正常运行的基本需求</p><h4 id=工作集>工作集</h4><p><strong>工作集</strong>：某段时间间隔 $\Delta$ 里进程实际要访问的<strong>页面集合</strong></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220092028361.png alt=image-20211220092028361 style=zoom:33%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220092218101.png alt=image-20211220092218101 style=zoom:40%><p>记录工作集，置换不在工作集内的页面，过去某时段内作为其将来时段的近似</p><h4 id=预防抖动的办法>预防抖动的办法</h4><h5 id=局部置换>局部置换</h5><p>不允许进程扩展页数，将抖动限制在一些进程上（效果差）</p><h5 id=引入工作集算法>引入工作集算法</h5><p>比较各进程工作集大小和实际得到的内存，再决定是否增加进程</p><h5 id=l--s-准则>L = S 准则</h5><p>使缺页平均间隔 = 调页平均时间</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220092723154.png alt=image-20211220092723154 style=zoom:40%><h5 id=挂起>挂起</h5><p>选择进程暂停</p><h3 id=请求分段存储管理方式>请求分段存储管理方式</h3><h4 id=请求分段中的硬件支持>请求分段中的硬件支持</h4><p><strong>请求段表机制</strong></p><ul><li>段名、段长、段基址</li><li>存取方式：控制读写执行，实行逻辑保护</li><li>访问字段：访问频繁程度</li><li>修改位：是否被修改</li><li>存在位：是否在内存中</li><li>增补位：该段是否在运行中发生了动态增长</li><li>外存始址：盘块号</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093120604.png alt=image-20211220093120604 style=zoom:40%><p><strong>缺段中断机构</strong></p><p><strong>地址变换机构</strong></p><h4 id=分段的共享与保护>分段的共享与保护</h4><ul><li><p><strong>共享</strong></p><ul><li><p>段表中增加进程计数 count（参考 shared_ptr）</p></li><li><p>每个进程存取控制字段独立</p></li><li><p>每个进程使用自己的段号访问</p></li><li><p>共享：count++，增加表项；回收：count&ndash;，删除表项</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093252512.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093252512.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093252512.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093252512.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093252512.png title=image-20211220093252512></p></li></ul></li><li><p><strong>保护</strong></p><ul><li><p><strong>越界检查</strong>：检查段长</p></li><li><p><strong>存取控制检查</strong>：检查读写执行权限</p></li><li><p><strong>环保护机构</strong>：为段设置编号，高编号不允许调用低编号的段</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093451218.png alt=image-20211220093451218 style=zoom:40%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211220093503842.png alt=image-20211220093503842 style=zoom:40%></li></ul></li></ul><h2 id=第六章-输入输出系统>第六章 输入输出系统</h2><p>概念考核</p><h3 id=io-系统的功能模型接口>IO 系统的功能、模型、接口</h3><p>IO 系统：用于管理诸如打印机扫描仪等 IO 设备，和诸如磁盘驱动器等存储设备</p><h4 id=io-系统的基本功能>IO 系统的基本功能</h4><ul><li>方便用户使用（隐藏性）<ul><li><strong>隐藏物理设备细节</strong>：IO 设备是怎么进行读写的</li><li><strong>与设备的无关性</strong>：允许用户和 OS 适应不同的 IO 设备，即插即用</li></ul></li><li>提高 CPU 和 IO 设备利用率（效率）<ul><li><strong>提高 CPU 和 IO 设备利用率</strong>：设备间的独立性 ==> CPU-IO 并行、IO-IO 并行</li><li><strong>控制 IO 设备</strong>：独立进行 IO 而无需 CPU 干预，向上层提供统一接口</li></ul></li><li>方便用户共享，保证系统有条不紊运行（正确性）<ul><li><strong>确保对设备的正确共享</strong>：对独占设备（打印机）和共享设备（磁盘）的管理</li><li><strong>错误处理</strong>：处理电气偶然性错误</li></ul></li></ul><h4 id=io-系统的层次结构>IO 系统的层次结构</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221083853159.png alt=image-20220221083853159 style=zoom:40%><ul><li><strong>用户层软件</strong>：属于应用程序<ul><li>向用户提供交互接口、库函数</li><li>产生 IO 请求、格式化 IO、Spooling</li></ul></li><li><strong>设备独立性软件</strong>：属于 IO 系统<ul><li>实现用户程序和设备驱动程序的统一接口、设备命名保护分配释放、分配存储空间</li><li>映射、保护、分块、缓冲、分配</li></ul></li><li><strong>设备驱动程序</strong>：属于 IO 系统<ul><li>具体实现系统对设备发出的操作指令，驱动 IO 设备工作</li><li>设置设备<strong>寄存器</strong>、检查设备状态</li><li>将上层发来的 IO 请求转化为对 IO 设备的具体命令和参数</li></ul></li><li><strong>中断处理程序</strong>：属于 IO 系统<ul><li>用于保护被中断进程的 CPU 环境，在处理完毕后进行恢复</li><li>IO 系统最底层，直接与硬件交互</li></ul></li><li><strong>设备控制器</strong>：属于硬件<ul><li>执行 IO 操作</li></ul></li></ul><h4 id=io-系统接口>IO 系统接口</h4><p>位于用户层软件和设备独立性软件之间</p><ul><li>块设备接口：为磁盘等以块为基本单位提供数据传输的接口</li><li>流设备接口：为字符设备提供数据传输的接口</li><li>网络接口：为网络通信提供数据传输的接口</li></ul><p><strong>软硬件接口</strong>（RW/HW 接口）：位于中断处理控制器和设备控制器之间</p><h3 id=设备控制器和-io-设备>设备控制器和 IO 设备</h3><p><strong>IO 设备</strong>：执行 IO 操作的机械部分（IO 设备）+ 控制 IO 的电子部件（IO 设备控制器）</p><h4 id=io-设备类型>IO 设备类型</h4><ul><li><p>按使用特性分类</p><ul><li>存储设备</li><li>IO 设备（输入设备、输出设备、交互设备）</li></ul></li><li><p>按传输速率分类</p><ul><li>低速设备</li><li>中速设备（打印机）</li><li>高速设备</li></ul></li><li><p>按信息交换的单位分类</p><ul><li><strong>块设备</strong>（有结构、可寻址）</li><li><strong>字符设备</strong>（无结构、不可寻址）</li><li>网络设备</li></ul></li><li><p>按资源分配角度分类（共享属性）</p><ul><li>独占设备（打印机）</li><li>共享设备（磁盘）</li><li>虚拟设备（将独占变成共享）</li></ul></li></ul><h4 id=io-设备与设备控制器的接口>IO 设备与设备控制器的接口</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221092431842.png alt=image-20220221092431842 style=zoom:50%><ul><li>数据信号线：外部数据 ==> 转换器 ==> 缓冲器 ==> 数据信号线 ==> 设备控制器</li><li>控制信号线：规定设备即将执行的操作（读 / 写）</li><li>状态信号线：设备在读、在写、或准备完成</li></ul><h4 id=设备控制器>设备控制器</h4><h5 id=功能>功能</h5><ul><li>接收和识别命令（控制寄存器接受并译码）</li><li>CPU、设备控制器与 IO 设备之间的<strong>数据交换</strong></li><li>识别和报告设备状态（状态寄存器）</li><li>地址识别（地址译码器）</li><li>数据缓冲</li><li>差错控制</li></ul><h5 id=组成>组成</h5><ul><li>设备控制器与处理机的接口</li><li>设备控制器与设备的接口</li><li>IO 逻辑</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221092711338.png alt=image-20220221092711338 style=zoom:50%><h4 id=内存映像-io>内存映像 IO</h4><p>内存地址和设备寄存器地址合并编址，简化设备控制器地址识别</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221092922750.png alt=image-20220221092922750 style=zoom:50%><h4 id=io-通道>IO 通道</h4><p>一种只具备 IO 处理能力的特殊处理机，减轻 CPU 负担</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093054085.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093054085.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093054085.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093054085.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093054085.png title=image-20220221093054085></p><h5 id=通道类型>通道类型</h5><ul><li><strong>字节多路通道</strong>：多个设备以字节为单位轮转。适合低速设备<ul><li><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093131199.png alt=image-20220221093131199 style=zoom:33%></li></ul></li><li><strong>数组选择通道</strong>：一次只允许一个设备工作。适合高速设备</li><li><strong>数组多路通道</strong>：两者结合</li></ul><h5 id=io-通道的瓶颈问题>IO 通道的瓶颈问题</h5><p>由于通道昂贵，独占性且数量较少，造成其为系统吞吐量的瓶颈。</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093438585.png alt=image-20220221093438585 style=zoom:33%><p>解决方法：复联增加设备到主机间的通路而不增加通道</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093455587.png alt=image-20220221093455587 style=zoom:33%><h3 id=中断处理程序和中断机构>中断处理程序和中断机构</h3><h4 id=中断简介>中断简介</h4><p>中断是 CPU 对 IO 设备发来的中断信号的一种响应</p><p>中断是设备管理的基础：</p><ul><li>外中断（广义上的中断）：CPU 暂停正在执行的程序，而执行 IO 设备的中断处理程序，事后恢复</li><li>内中断（陷入）：计算故障、非法指令等，来源为 CPU 内部</li></ul><p>中断向量表：为每种设备配备中断处理程序，将程序入口地址存放在中断向量表中</p><p>中断优先级：多中断源处理方式：屏蔽中断、嵌套中断</p><p><strong>对多中断源的处理方式</strong></p><ul><li>屏蔽（禁止）中断<ul><li><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093858380.png alt=image-20220221093858380 style=zoom:40%></li></ul></li><li>嵌套中断<ul><li><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093923659.png alt=image-20220221093923659 style=zoom:40%></li></ul></li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220221093943571.png alt=image-20220221093943571 style=zoom:40%><h4 id=中断处理程序>中断处理程序</h4><p>进行上下文切换、对中断信号源测试、读取设备状态、修改进程状态</p><p><strong>中断过程</strong>：</p><ul><li>测定是否有未响应中断信号</li><li>保护被中断进程的 CPU 环境</li><li>查询中断向量表，转入相应的设备处理程序</li><li>进行中断处理</li><li>恢复 CPU 现场</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418142816014.png alt=image-20220418142816014 style=zoom:67%><h3 id=设备驱动程序>设备驱动程序</h3><p>主要任务：抽象</p><ul><li>接收上层发来的抽象 IO 请求并转化为具体请求发送给设备控制器进行数据传送</li><li>检查 IO 请求合法性，了解 IO 设备状态，传递操作参数</li><li>对空闲的 IO 设备发出 IO 命令，或将请求挂在等待队列中</li><li>相应设备控制器的中断请求，并根据类型处理</li></ul><h4 id=对-io-设备的控制方式>对 IO 设备的控制方式</h4><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145851798.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145851798.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145851798.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145851798.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145851798.png title=image-20220418145851798></p><h5 id=轮询程序-io-方式>（轮询）程序 IO 方式</h5><p>CPU 不断查询 IO 状态直至设备空闲允许 IO</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145620658.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145620658.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145620658.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145620658.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145620658.png title=image-20220418145620658></p><h5 id=中断驱动-io-方式>中断驱动 IO 方式</h5><p>设备控制器完成一字符 IO 后发送中断请求（CPU、IO 并行）</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145509327.png alt=image-20220418145509327 style=zoom:67%><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145520550.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145520550.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145520550.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145520550.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145520550.png title=image-20220418145520550></p><h5 id=dma-方式>DMA 方式</h5><p>一批连续数据块全部传送结束时才中断 CPU</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145557335.png alt=image-20220418145557335 style=zoom:50%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145723607.png alt=image-20220418145723607 style=zoom:50%><h5 id=io-通道方式>IO 通道方式</h5><p>控制多台设备与内存数据交换，完全接管 CPU</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145800846.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145800846.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145800846.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145800846.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418145800846.png title=image-20220418145800846></p><h3 id=设备独立性软件>设备独立性软件</h3><p>(Device Independence，也叫设备独立性软件)</p><p><strong>设备独立性</strong>：应用程序中所用的设备，不局限于使用具体某个物理设备</p><h4 id=设备独立性软件的主要任务>设备独立性软件的主要任务</h4><p>实现 OS 的物理设备独立性，可适应性和可扩展性</p><ul><li>提供设备驱动程序的统一接口</li><li>缓冲管理：单缓冲、双缓冲、循环缓冲、公用缓冲池</li><li>差错控制：重试暂时性错误、记录永久性错误</li><li>对独立设备的分配和回收</li><li>独立于设备的逻辑数据块</li></ul><h4 id=设备分配>设备分配</h4><h5 id=设备分配中的数据结构>设备分配中的数据结构</h5><ul><li>设备控制表 DCT：类似 PCB，记录设备基本信息和当前状态</li><li>控制器控制表 COCT：记录设备控制器的基本信息和当前状态</li><li>通道控制表 CHCT：记录通道的基本信息和当前状态</li><li>系统设置表 SDT：记录系统中所有设备类型和 DCT 入口等信息</li></ul><h5 id=设备分配考虑的因素><strong>设备分配考虑的因素</strong>：</h5><ul><li>设备固有属性：独占、共享、虚拟（独占设备改造成可共享的虚拟设备）</li><li>设备分配算法：FCFS、高优先级优先</li><li>安全性问题：可能造成死锁</li></ul><h3 id=用户层的-io-软件>用户层的 IO 软件</h3><h4 id=系统调用和库函数>系统调用和库函数</h4><ul><li>系统调用：应用程序取得 OS 任何服务的唯一途径，汇编级</li><li>库函数：对系统调用的进一步封装</li></ul><h4 id=假脱机系统-spooling>假脱机系统 Spooling</h4><p>作用：将一台物理 IO 设备虚拟为多台逻辑 IO 设备，从而允许多个用户共享</p><p>多道程序系统使用若干个进程接管 IO 设备的 IO，使用磁盘进行数据暂存</p><h5 id=组成-1>组成</h5><ul><li>输入输出井：磁盘上开辟的区域，用于接收和传输数据</li><li>输入输出缓冲区：内存上开辟的区域，用于缓冲 CPU 和磁盘速度差异</li><li>输入输出进程：管理 IO 设备、缓冲区和输入输出井的数据流动</li><li>井管理程序：井的创建和取消</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418153049368.png alt=image-20220418153049368 style=zoom:67%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418153055539.png alt=image-20220418153055539 style=zoom:67%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418153049368.png alt=image-20220418153040832 style=zoom:67%><h5 id=特点>特点</h5><ul><li>提高了 IO 速度：使用磁盘缓解了 CPU 和低速 IO 设备的速度差异</li><li>独占设备改造为共享设备：多个进程共享独占设备（如打印机）</li><li>实现了虚拟设备功能：多个进程认为独占了设备</li></ul><h3 id=缓冲区管理>缓冲区管理</h3><p><strong>缓冲区</strong>：用内存或硬件组成的小的存储区域（一般是内存）</p><ul><li>缓和 CPU 和 IO 设备速度不匹配的矛盾</li><li>减少 CPU 中断频率</li><li>解决数据粒度不匹配问题</li><li>提高 CPU 和 IO 设备之间的并行性</li></ul><p><strong>缓冲区管理</strong>：组织好缓冲区，并提供获得和释放缓冲区的手段</p><ul><li>单缓冲区：缓冲区被填满后需要被取用才能继续填写</li><li>双缓冲区（缓冲对换）：第二块缓冲区填满后才被阻塞；或同时允许输入输出的双向操作</li><li>环形缓冲区：n 缓冲区，采用队列的数组存储形式</li><li>缓冲池：缓冲池公用缓冲区以减少不同 IO 进程对内存的浪费<ul><li>缓冲池组成：空白缓冲队列 emq、输入队列 inq、输出队列 outq</li><li>缓冲区工作方式：hin 收容输入、sin 提取输出、hout 收容输出、sout 提取输出</li></ul></li></ul><h3 id=磁盘存储器的性能和调度>磁盘存储器的性能和调度</h3><p>数据的组织格式：</p><ul><li>盘片 ≠ 盘面：1 磁盘片有 1-2 个磁盘面</li><li>磁道 = 柱面：传统磁盘中内磁道存储密度高</li><li>扇区 = 盘块：一条磁道由若干扇区组成</li></ul><p>磁盘类型：固定磁头磁盘（快），移动磁头磁盘（慢）</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302134021857.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302134021857.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302134021857.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302134021857.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302134021857.png title=image-20220302134021857></p><h4 id=磁盘访问时间>磁盘访问时间</h4><p>磁盘访问时间 = 寻道时间 + 旋转延迟时间 + 平均访问时间</p><ul><li><strong>寻道时间</strong>： $T_s=m×n+s$（将磁头定位到<strong>目标磁道</strong>所需的时间）</li><li><strong>旋转延迟时间</strong>（平均）： $T_τ=\frac{1}{2r}$（将磁头定位到<strong>目标扇区</strong>所需的时间）</li><li><strong>传输时间</strong>： $T_t=\frac{b}{rN}$（读取一个扇区的时间）</li></ul><p>平均访问时间： $T_a=T_s+T_τ+T_t$</p><blockquote><p>$r$：转速，转/分</p><p>$b$：每次读/写的字节数</p><p>$N$：一条磁道上的字节数</p><p>$s$：启动磁头臂的时间（固定）</p><p>$m\times n$：跨越一个磁道的耗时 × 磁道数</p></blockquote><h4 id=磁盘调度算法>磁盘调度算法</h4><h5 id=先来先服务-fcfs>先来先服务 FCFS</h5><p>效果很差，未优化，平均寻道时间长</p><h5 id=最短寻道时间优先-sstf>最短寻道时间优先 SSTF</h5><p>要求访问的磁道离当前磁头所在磁道最近</p><p>产生饥饿现象</p><h5 id=扫描算法电梯调度scan>扫描算法（电梯调度）SCAN</h5><p>磁头由外而内扫描再由内而外扫描</p><p>同方向距离最近的优先扫描</p><h5 id=循环扫描-cscan>循环扫描 CSCAN</h5><p>一直同向循环扫描，避免极端情况等待时间过长</p><h5 id=nstepscan>NStepSCAN</h5><p>N 个队列间 FCFS，队列内 SCAN。解决高密度磁盘磁壁粘着现象（磁臂停留在某处不动）</p><h5 id=fscan>FSCAN</h5><p>N=2 的 NStepSCAN，当前队列和新增需求队列</p><h2 id=第七章-文件管理>第七章 文件管理</h2><p>前三节重要</p><h3 id=文件和文件系统>文件和文件系统</h3><p>文件系统：操作系统中与管理文件有关的软件和数据。</p><h4 id=数据的组成部分数据项记录文件>数据的组成部分：数据项、记录、文件</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220418162149121.png alt=image-20220418162149121 style=zoom:67%><ul><li><strong>数据项</strong>：最低级的数据组织方式<ul><li>基本数据项：用于描述一个对象的某种属性</li><li>组合数据项：基本数据项的组合</li></ul></li><li><strong>记录</strong>：一组相关数据项的组合，用于描述对象的某方面属性</li><li><strong>文件</strong>：文件系统最大的数据单位，描述一个对象集<ul><li>有结构文件：记录项的集合</li><li>无结构文件：字符流</li><li>文件属性：类型、长度、物理位置、建立时间</li><li>文件名和扩展名</li><li>文件类型：<ul><li>用途（系统、用户）</li><li>数据形式（源、目标、可执行）</li><li>存取属性（只执行、只读、读写）</li><li>组织方式（普通、目录、特殊）</li></ul></li></ul></li></ul><h4 id=文件系统的层次结构>文件系统的层次结构</h4><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227083118315.png alt=image-20211227083118315 style=zoom:50%><ul><li><p><strong>对象及其属性</strong>（底层）：管理文件及其物理地址</p></li><li><p><strong>对对象操纵和管理的软件集合</strong>（中间层）：管理存储，权限，共享，逻辑 → 物理转化</p><ul><li><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227083156350.png alt=image-20211227083156350 style=zoom:40%></li></ul></li><li><p><strong>文件系统的接口</strong>（最高层）：向用户提供命令接口和程序接口</p></li></ul><h4 id=文件操作>文件操作</h4><h5 id=基本文件操作>基本文件操作</h5><ul><li>创建：分配外存空间，父目录创建目录项，目录项记录文件名和外存地址等属性</li><li>删除：删除父目录下对应目录项，回收外存空间</li><li>读：根据文件名查找目录得到外存位置</li><li>写：根据文件名查找目录得到外存位置</li><li>设置文件读写位置：文件目录项中存有读写指针</li></ul><h5 id=打开和关闭操作>打开和关闭操作</h5><p>避免在多次读写时重复检索目录</p><ul><li>打开：将文件的属性从外存拷贝到内存的文件打开表表项中，并将编号返回用户</li><li>关闭：把文件从文件打开表表目中删除</li></ul><h5 id=其他文件操作>其他文件操作</h5><ul><li>修改文件属性：改变文件名、拥有者、权限，查询文件状态等</li><li>目录操作：创建目录，删除目录，更改工作目录</li><li>实现文件共享，对文件进行系统操作</li></ul><h3 id=文件的逻辑结构>文件的逻辑结构</h3><p>文件的逻辑结构：区别于文件的物理结构，是从用户角度出发所观察到的文件组织形式。</p><p>文件的逻辑结构管理的是记录。</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302142837786.png alt=image-20220302142837786 style=zoom:33%><h4 id=按结构分类>按<strong>结构</strong>分类</h4><ul><li><p>有结构文件（记录式文件）：定长记录、不定长记录（记录长度而非文件长度）</p></li><li><p>无结构文件（流式文件）：长度以字节为单位</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227083519285.png alt=image-20211227083519285 style=zoom:40%></li></ul><h4 id=按组织方式分类>按<strong>组织方式</strong>分类</h4><p>在用户看来，文件是什么结构</p><ul><li><strong>顺序文件</strong>：按某种顺序排列保存；定长随机访问<ul><li>不定长查找一条记录平均检索 $\frac{N}{2}$ 次，适合定长文件</li><li>分类<ul><li>串结构：按存入时间先后排序</li><li>顺序结构：指定某个关键字</li></ul></li><li>缺点<ul><li>查找修改慢</li><li>增删操作困难</li></ul></li></ul></li><li><strong>索引文件</strong>：针对不定长记录建立索引表，以根据索引进行折半查找，索引速度快，适合索引文件<ul><li>索引本身是个定长的顺序文件</li><li>一级索引 $\sqrt{N}$ 组，每组 $\sqrt{N}$ 条记录，平均查找次数为 $\sqrt{N}$</li></ul></li><li><strong>索引顺序文件</strong>：最常见，u 级顺序索引平均检索 u2N−−√uu2Nu 次<ul><li>将记录分组，组间顺序，组内索引</li></ul></li><li><em>直接文件、哈希文件</em></li></ul><h3 id=文件目录>文件目录</h3><p><strong>文件目录</strong>：文件控制块的有序集合</p><p><strong>目录文件</strong>：存放文件目录的文件（一般，一个文件目录被称为一个目录文件）</p><p>目录管理：实现按名存取、提高目录检索速度、文件共享、允许不同用户的文件重名</p><h4 id=文件控制块-fcb>文件控制块 FCB</h4><p>用于描述和控制文件的数据结构，一般放在磁盘上</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302145945321.png alt=image-20220302145945321 style=zoom:40%><ul><li><strong>基本信息</strong>：文件名、物理位置、逻辑结构、物理结构</li><li><strong>存取控制信息</strong>：拥有者、核准用户、一般用户的读写执行权限</li><li><strong>使用信息</strong>：建立日期、修改日期、打开状态、状态信息</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227090209329.png alt=image-20211227090209329 style=zoom:50%><h4 id=索引节点-inode>索引节点 inode</h4><p>减少目录文件占用的盘块数，加快检索</p><p>使用了 inode 后的文件目录只存储文件名和 <strong>inode 编号</strong>（指向索引节点的指针），通过 inode 编号可以在 inode 区找到具体的文件信息</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110082731542.png alt=image-20220110082731542 style=zoom:50%><p><em>磁盘索引节点和内存索引节点</em></p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110082811386.png alt=image-20220110082811386 style=zoom:40%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110082819830.png alt=image-20220110082819830 style=zoom:40%><h4 id=目录结构><strong>目录结构</strong></h4><p>重点是多级目录结构</p><h5 id=单级目录结构>单级目录结构</h5><p>整个文件系统就一张目录表，每个文件占一项</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110083520434.png alt=image-20220110083520434 style=zoom:40%><h5 id=两级目录结构>两级目录结构</h5><p>主目录 MFD 记录每个用户文件目录 UFD 的信息</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110083552853.png alt=image-20220110083552853 style=zoom:33%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110083608741.png alt=image-20220110083608741 style=zoom:40%><h5 id=树形目录结构>树形目录结构</h5><p>主目录为根目录，数据为树叶，目录项可能是<strong>数据文件的 FCB 或目录文件的 FCB</strong></p><ul><li>路径名：从根目录到目标文件的路径</li><li>当前目录：工作目录</li><li>相对路径：从当前目录到目标文件的路径</li><li>绝对路径：从根目录到目标文件的路径</li><li>目录操作：创建、删除（空/非空）、改变当前目录、移动目录、链接、查找</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110083638752.png alt=image-20220110083638752 style=zoom:40%><h4 id=目录查询技术>目录查询技术</h4><ul><li><p>线性检索法：在每个文件目录中顺序查找目录项</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110091458140.png alt=image-20220110091458140 style=zoom:40%></li><li><p><strong>Hash</strong> 方法：文件名变换为文件目录的索引值</p></li></ul><h3 id=文件共享>文件共享</h3><p>文件共享：允许多个用户（进程）共享同一份文件而只保留一份副本。</p><ul><li>基于 DAG 的文件共享：拷贝文件的物理地址（拷贝 FCB）</li><li>硬链接：文件目录存同一份 inode 编号，inode 进行链接计数。删除一份不会消失</li><li>软链接（符号链接）：建立 LINK 文件储存被共享文件路径</li></ul><h3 id=文件保护>文件保护</h3><ul><li>保护域</li><li>访问矩阵<ul><li>访问控制表</li><li>访问权限表</li></ul></li></ul><h2 id=第八章-磁盘存储器管理>第八章 磁盘存储器管理</h2><p>第八章</p><h3 id=外存的组织方式>外存的组织方式</h3><p>外存的组织方式：决定了文件的物理结构</p><h4 id=连续组织方式>连续组织方式</h4><p>（连续）每个文件分配一片连续的盘块</p><ul><li>文件目录项存储第一个盘块和长度</li><li>优点：便于顺序访问，速度快，支持定长记录文件随机存取</li><li>缺点：盘块连续，预知文件大小，增删记录慢，不能动态增长，需要紧凑</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227091021057.png alt=image-20211227091021057 style=zoom:40%><h4 id=链接组织方式>链接组织方式</h4><p>（离散）将文件存储到离散的盘块中</p><h5 id=隐式链接><strong>隐式链接</strong></h5><p><strong>每个盘块存储下一个盘块的指针</strong></p><ul><li>文件目录项存储第一个盘块和最后一个盘块的指针</li><li>优点：离散存储，便于顺序访问</li><li>缺点：随机存取效率低，必须顺序存取，不支持随机查找</li><li>改进：多个连续盘块形成一个簇，减少指针开销并提高检索速度</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227091405400.png alt=image-20211227091405400 style=zoom:40%><h5 id=显式链接>显式链接</h5><p>在内存中建长度为物理块数的 FAT 表，表项存放下一盘块指针，而凡是某个文件的起始盘块号都存放在文件 FCB 的“物理地址字段”中</p><ul><li>优点：<strong>查找记录在内存中进行</strong>，大量减少磁盘访问，检索速度快</li><li>缺点：FAT 很大，占用内存空间，仍然不支持随机存储</li><li>FAT 与 NTFS 的概念</li><li>优点：消除外碎片，支持文件动态增长，适合增删改</li><li>缺点：只适合顺序存储，可靠性差，读取时寻道次数多，额外存储空间开销大</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227091428014.png alt=image-20211227091428014 style=zoom:50%><blockquote><p>为了地址转换的方便，FAT 表项的大小通常取半个字节的整数倍</p><p>MS-DOS 采用此方法</p></blockquote><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302160351967.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302160351967.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302160351967.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302160351967.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302160351967.png title=image-20220302160351967></p><h4 id=索引组织方式>索引组织方式</h4><p>（离散）为每个文件分配索引块（一盘块），顺序存储全部盘块号（相当于一个索引表）</p><ul><li><p><strong>单级索引组织</strong>：索引块顺序存储各盘块号，文件容量较小</p><ul><li>最大文件大小计算：一个盘块块能存储的最大盘号数 × 一个盘块的大小</li></ul><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227092059625.png alt=image-20211227092059625 style=zoom:40%></li><li><p><strong>多级索引组织</strong>：一级索引块存储二级索引盘块号，小容量文件浪费存储空间</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227092147002.png alt=image-20211227092147002 style=zoom:40%></li><li><p><strong>增量索引式组织</strong></p><ul><li><p>混合索引，全面照顾大中小型文件（考大题）</p><ul><li>索引结点有 13 个地址项</li><li>直接地址 10 个</li><li>一次间址、二次间址、三次间址各 1 个</li></ul></li><li><p>UNIX 使用此种方式</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20211227093523178.png alt=image-20211227093523178 style=zoom:40%></li></ul></li></ul><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302152607526.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302152607526.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302152607526.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302152607526.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302152607526.png title=image-20220302152607526></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153220954.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153220954.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153220954.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153220954.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153220954.png title=image-20220302153220954></p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153232462.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153232462.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153232462.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153232462.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220302153232462.png title=image-20220302153232462></p><h3 id=文件存储空间管理>文件存储空间管理</h3><p>任何文件组织方式都必须要为文件分配盘块，需要知道磁盘中哪些盘块是可供分配的。</p><h4 id=空闲表法>空闲表法</h4><p>（连续）存第一块空闲盘号和盘块数 → 4.3</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110091708112.png alt=image-20220110091708112 style=zoom:40%><h4 id=空闲链表法>空闲链表法</h4><ul><li>空闲盘块链：（离散）将空闲盘块组成链表，效率很低</li><li>空闲盘区链：（连续）将连续的盘块组成盘区，记录块首地址、盘块数、双向链表</li></ul><h4 id=位示图法>位示图法</h4><p>使用 1bit 标识盘块使用情况，本质是一个二维数组</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110091727432.png alt=image-20220110091727432 style=zoom:40%><h4 id=成组链接法>成组链接法</h4><p><a href=https://blog.csdn.net/qq_45744501/article/details/116953538 target=_blank rel="external nofollow noopener noreferrer">https://blog.csdn.net/qq_45744501/article/details/116953538</a></p><p>（大型系统）内存常驻空闲盘块号栈（记录栈和栈顶指针，栈内存空闲盘块号）。分配到最后一个时取出栈底盘块中的有用信息替换栈后再分配；回收满了则将栈信息存入当前回收的盘块并将当前回收盘块作为新栈底。</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110091820213.png alt=image-20220110091820213 style=zoom:40%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110092412038.png alt=image-20220110092412038 style=zoom:40%>
<img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20220110092424143.png alt=image-20220110092424143 style=zoom:40%><p><em>8.3</em> <em>提高磁盘 IO 速度的途径</em></p><p><em>8.4</em> <em>提高磁盘可靠性的技术</em></p><p><em>8.5</em> <em>数据一致性控制</em></p><p>（事务）</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-01-13 09:00:31">更新于 2023-01-13</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem2/ data-title=操作系统（2） data-hashtags=OS><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem2/ data-hashtag=OS><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/courses/operating-system/operatingsystem2/ data-title=操作系统（2）><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/os/>OS</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/%E5%B7%A5%E5%85%B7/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka/ class=prev rel=prev title=kafka><i class="fa-solid fa-angle-left fa-fw"></i>kafka</a>
<a href=/Notes/posts/courses/operating-system/operatingsystem1/ class=next rel=next title=操作系统（1）>操作系统（1）<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022 - 2023</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>