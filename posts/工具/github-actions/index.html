<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Github Actions - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="Github Actions 介绍 Github Action 是 Github 推出的持续集成 (CI) 工具 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22"><meta name=keywords content="Theme,Hugo"><meta itemprop=name content="Github Actions"><meta itemprop=description content="Github Actions 介绍 Github Action 是 Github 推出的持续集成 (CI) 工具 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22"><meta itemprop=datePublished content="2022-05-12T00:00:00+00:00"><meta itemprop=dateModified content="2023-06-14T10:39:34+00:00"><meta itemprop=wordCount content="6602"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content><meta property="og:title" content="Github Actions"><meta property="og:description" content="Github Actions 介绍 Github Action 是 Github 推出的持续集成 (CI) 工具 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/github-actions/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-14T10:39:34+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="Github Actions"><meta name=twitter:description content="Github Actions 介绍 Github Action 是 Github 推出的持续集成 (CI) 工具 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/github-actions/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/golang/%E5%B8%B8%E7%94%A8%E5%BA%93/viper/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/template/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Github Actions","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/%E5%B7%A5%E5%85%B7\/github-actions\/"},"genre":"posts","wordcount":6602,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/%E5%B7%A5%E5%85%B7\/github-actions\/","datePublished":"2022-05-12T00:00:00+00:00","dateModified":"2023-06-14T10:39:34+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Github Actions</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/%E5%B7%A5%E5%85%B7/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;工具</a></span></div><div class=post-meta-line><span title="2022-05-12 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-05-12>2022-05-12</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 6602 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 14 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#介绍>介绍</a></li><li><a href=#workflow>Workflow</a><ul><li><a href=#名字>名字</a></li><li><a href=#触发器>触发器</a><ul><li><a href=#活动类型和筛选器>活动类型和筛选器</a></li></ul></li></ul></li><li><a href=#job>job</a><ul><li><a href=#定义>定义</a></li><li><a href=#命名>命名</a></li><li><a href=#依赖>依赖</a></li><li><a href=#输出>输出</a></li><li><a href=#运行环境>运行环境</a></li><li><a href=#环境变量>环境变量</a></li><li><a href=#job-间共享数据>job 间共享数据</a></li></ul></li><li><a href=#step>step</a><ul><li><a href=#使用-action>使用 action</a></li><li><a href=#运行命令行命令>运行命令行命令</a><ul><li><a href=#运行多命令>运行多命令</a></li><li><a href=#指定命令运行的位置>指定命令运行的位置</a></li></ul></li><li><a href=#指定-shell-的类型>指定 shell 的类型</a></li></ul></li><li><a href=#表达式>表达式</a><ul><li><a href=#文字>文字</a></li><li><a href=#运算符>运算符</a></li><li><a href=#函数>函数</a><ul><li><a href=#contains>contains</a></li><li><a href=#startswith>startsWith</a></li><li><a href=#endswith>endsWith</a></li><li><a href=#format>format</a></li></ul></li><li><a href=#状态检查函数>状态检查函数</a><ul><li><a href=#success>success</a></li><li><a href=#always>always</a></li><li><a href=#cancelled>cancelled</a></li><li><a href=#failure>failure</a></li><li><a href=#显式评估状态>显式评估状态</a><ul><li><a href=#workflow--step-示例>workflow step 示例</a></li><li><a href=#复合-action--step-的示例>复合 action step 的示例</a></li></ul></li></ul></li></ul></li><li><a href=#上下文>上下文</a><ul><li><a href=#一些小栗子>一些小栗子</a></li></ul></li><li><a href=#环境变量-1>环境变量</a><ul><li><a href=#使用上下文访问环境变量值>使用上下文访问环境变量值</a></li><li><a href=#默认的环境变量>默认的环境变量</a></li></ul></li><li><a href=#矩阵>矩阵</a></li><li><a href=#一些通用的属性>一些通用的属性</a><ul><li><a href=#if>if</a><ul><li><a href=#in-job>in job</a></li><li><a href=#in-step>in step</a></li></ul></li></ul></li><li><a href=#on-详解>on 详解</a></li><li><a href=#action>action</a><ul><li><a href=#添加-action>添加 action</a><ul><li><a href=#从相同仓库添加>从相同仓库添加</a></li><li><a href=#从不同仓库添加-action>从不同仓库添加 action</a></li><li><a href=#引用-docker-hub-上的容器>引用 Docker Hub 上的容器</a></li></ul></li><li><a href=#一些有用的-action>一些有用的 action</a><ul><li><a href=#checkout>checkout</a></li><li><a href=#node-和-npm>node 和 npm</a></li><li><a href=#artifact>artifact</a></li><li><a href=#python>Python</a></li><li><a href=#go>Go</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=github-actions>Github Actions</h1><h2 id=介绍>介绍</h2><p>Github Action 是 Github 推出的持续集成 (CI) 工具</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># 定义 Workflow 的名字</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Greeting from Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 定义 Workflow 的触发器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 定义 Workflow 的 job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 定义 job 的 id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 定义 job 的 name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 定义 job 的运行环境</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 定义 job 的运行 step </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 定义 step 的名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print a greeting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 定义 step 的环境变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>MY_VAR</span><span class=p>:</span><span class=w> </span><span class=l>Hi there! My name is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>FIRST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>MIDDLE_NAME</span><span class=p>:</span><span class=w> </span><span class=l>The</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>LAST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>Octocat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 运行指令：输出环境变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.</span><span class=w>        
</span></span></span></code></pre></td></tr></table></div></div><h2 id=workflow>Workflow</h2><p>Workflow 是由一个或多个 job 组成的可配置的自动化过程。我们通过创建 YAML 文件来创建 Workflow 配置。</p><h3 id=名字>名字</h3><blockquote><p>name</p></blockquote><p>Workflow 的名称，Github 在存储库的 Action 页面上显示 Workflow 的名称。</p><p>如果我们省略 name，则 Github 会将其设置为工作流文件名。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Greeting from Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=触发器>触发器</h3><blockquote><p>on</p></blockquote><p>触发 Workflow 执行的 event 名称</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># 单个事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 多个事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push,pull_request]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>详见：https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#about-workflow-events</p><h4 id=活动类型和筛选器>活动类型和筛选器</h4><p>必须为所有事件附加冒号 (<code>:</code>)，包括没有配置的事件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>label</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>created</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>page_build</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=job>job</h2><p>job 是一次持续集成的运行，可以完成多个任务。一个 Workflow 由一个或多个 jobs 构成</p><p>默认情况下，作业没有依赖关系，并且彼此并行运行。 当一个作业依赖于另一个作业时，它将等待从属作业完成，然后才能运行。</p><h3 id=定义>定义</h3><blockquote><p>jobs.&lt;job_id></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my_first_job</span><span class=p>:</span><span class=w> </span><span class=c># job id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My first job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my_second_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My second job</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上面的 my_first_job 和 my_second_job 就是 job_id</p><p>job 通过 id 被定义。</p><h3 id=命名>命名</h3><blockquote><p>jobs.&lt;job_id>.name</p></blockquote><p>name 会显示在 Github 上</p><h3 id=依赖>依赖</h3><blockquote><p>jobs.&lt;job_id>.needs</p></blockquote><p>needs 可以标识 job 是否依赖于别的 job</p><p>如果某一 job 失败，则会跳过所有需要该 job 的 job。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>job1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>job1, job2]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=输出>输出</h3><blockquote><p>jobs.&lt;jobs_id>.outputs</p></blockquote><p>outputs 用于和 needs 打配合，outputs 输出 → needs 输入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Map a step output to a job output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>outputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output1</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.step1.outputs.test }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output2</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.step2.outputs.test }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>step1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;::set-output name=test::hello&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>step2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;::set-output name=test::world&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>job1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo ${{needs.job1.outputs.output1}} ${{needs.job1.outputs.output2}}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=运行环境>运行环境</h3><blockquote><p>jobs.&lt;job_id>.runs-on</p></blockquote><p>runs-on 指定运行 job 的运行环境，Github 上可用的运行器为：</p><ul><li>windows-2019</li><li>ubuntu-20.04</li><li>ubuntu-18.04</li><li>ubuntu-16.04</li><li>macos-10.15</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>macos-10.15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>windows-2019</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>一般都写 ubuntu-latest</p></blockquote><h3 id=环境变量>环境变量</h3><blockquote><p>jobs.&lt;jobs_id>.env</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>FIRST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=job-间共享数据>job 间共享数据</h3><blockquote><p>artifact</p></blockquote><p>如果 job 生成您要与同一 workflow 中的另一个 job 共享的文件，或者您要保存这些文件供以后参考，可以将它们作为 artifact 存储在 GitHub 中。</p><p>artifact 是创建并测试代码时所创建的文件，它可以是二进制或包文件、测试结果、屏幕截图或日志文件。</p><p>artifact 可被另一个 job 使用。 在运行中调用的所有 action 和 workflow 都具有对该 artifact 的写入权限。</p><p>例如，你可以创建一个文件，然后将其作为构件上传。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Save output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>bash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          expr 1 + 1 &gt; output.log</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload output file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-log-file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>output.log</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>要从另一个 workflow 运行下载构件，您可以使用 <code>actions/download-artifact</code> action 。 例如，您可以下载名为 <code>output-log-file</code> 的构件。（猜想：相同仓库下的一个 workflow 应该可以下载到另一个 workflow 上传的 artifact）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Download a single artifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/download-artifact@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-log-file</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>⭐ 要从同一 workflow 运行中下载构件，下载 job 应指定 <code>needs: upload-job-name</code>，使其在上传 job 完成之前不会开始。</p></blockquote><h2 id=step>step</h2><p>每个 job 由多个 step 构成，它会从上至下依次执行。</p><p>step 可以运行</p><ol><li><strong>commands</strong>：命令行命令</li><li><strong>setup tasks</strong>：环境配置命令（比如安装个 Node 环境、安装个 Python 环境）</li><li><strong>action</strong>：一段 action</li></ol><p>每个 step 都在自己的运行器环境中运行，并且可以访问工作空间和文件系统</p><p>step 之间不会保留对环境变量的更改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 定义 step 的名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print a greeting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 定义 step 的环境变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>MY_VAR</span><span class=p>:</span><span class=w> </span><span class=l>Hi there! My name is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FIRST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>MIDDLE_NAME</span><span class=p>:</span><span class=w> </span><span class=l>The</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>LAST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>Octocat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 运行指令：输出环境变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.</span><span class=w>    
</span></span></span></code></pre></td></tr></table></div></div><h3 id=使用-action>使用 action</h3><blockquote><p>jobs.&lt;job_id>.steps.uses</p></blockquote><p>check-out 仓库中最新的代码到 Workflow 的工作区：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果是 node 项目，可以安装 Node.js 与 NPM：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v2-beta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;12&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>with</p></blockquote><p>action 的配置参数</p><h3 id=运行命令行命令>运行命令行命令</h3><blockquote><p>jobs.&lt;job_id>.steps.run</p></blockquote><p>上文说到，steps 可以运行：action 和 command-line programs。</p><p>run 命令在默认状态下会启动一个没有登录的 shell 来作为命令输入器。</p><h4 id=运行多命令>运行多命令</h4><p>每个 run 命令都会启动一个新的 shell，所以我们执行多行连续命令的时候需要写在同一个 run 下：</p><ul><li><strong>单行命令</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Dependencies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npm install</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>多行命令</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Clean install dependencies and build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>run： |</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>npm ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>npm run build</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=指定命令运行的位置>指定命令运行的位置</h4><blockquote><p>jobs.&lt;job_id>.steps.working-directory</p></blockquote><p>working-directory 可以用来指定 command 的运行位置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Clean temp directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>rm -rf *</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=l>./temp</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=指定-shell-的类型>指定 shell 的类型</h3><blockquote><p>jobs.&lt;job_id>.steps.shell</p></blockquote><p>shell 可以用来来指定特定的 shell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Display the path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo $PATH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>bash</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9283bfe170157cf550cbc86c36fa28c5_b.jpg data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9283bfe170157cf550cbc86c36fa28c5_b.jpg, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9283bfe170157cf550cbc86c36fa28c5_b.jpg 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9283bfe170157cf550cbc86c36fa28c5_b.jpg 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/v2-9283bfe170157cf550cbc86c36fa28c5_b.jpg title=img></p><h2 id=表达式>表达式</h2><blockquote><p>expressions</p></blockquote><p>详见 <a href=https://docs.github.com/cn/actions/learn-github-actions/expressions target=_blank rel="external nofollow noopener noreferrer">https://docs.github.com/cn/actions/learn-github-actions/expressions</a></p><p>你可以使用表达式程序化设置 workflow 文件中的环境变量和访问上下文。</p><p>表达式可以是文字值、上下文引用或函数的任意组合。 您可以使用运算符组合文字、上下文引用和函数。</p><p>表达式通常在 workflow 文件中与条件性 <code>if</code> 关键词一起用来确定 step 是否应该运行。 当 <code>if</code> 条件为 <code>true</code> 时， step 将会运行。</p><p>使用特定语法指示 GitHub 对表达式求值，而不是将其视为字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>${{ &lt;expression&gt; }}
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在 <code>if</code> 条件下使用表达式时，可以省略表达式语法 (<code>${{ }}</code>)，因为 GitHub 会自动将 <code>if</code> 条件作为表达式求值</p></blockquote><h3 id=文字>文字</h3><p>使用 <code>boolean</code>、<code>null</code>、<code>number</code> 或 <code>string</code> 数据类型。</p><table><thead><tr><th style=text-align:left>数据类型</th><th style=text-align:left>文字值</th></tr></thead><tbody><tr><td style=text-align:left><code>布尔值</code></td><td style=text-align:left><code>true</code> 或 <code>false</code></td></tr><tr><td style=text-align:left><code>null</code></td><td style=text-align:left><code>null</code></td></tr><tr><td style=text-align:left><code>number</code></td><td style=text-align:left>JSON 支持的任何数字格式。</td></tr><tr><td style=text-align:left><code>字符串</code></td><td style=text-align:left>您不需要将字符串括在 <code>${{</code> 和 <code>}}</code> 中。 如果这样做，则必须在字符串两边使用单引号 (<code>'</code>)。 要使用单引号，请使用额外的单引号来转义 (<code>''</code>)。 用双引号 (<code>"</code>) 会引发错误。</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myNull</span><span class=p>:</span><span class=w> </span><span class=l>${{ null }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myBoolean</span><span class=p>:</span><span class=w> </span><span class=l>${{ false }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myIntegerNumber</span><span class=p>:</span><span class=w> </span><span class=l>${{ 711 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myFloatNumber</span><span class=p>:</span><span class=w> </span><span class=l>${{ -9.2 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myHexNumber</span><span class=p>:</span><span class=w> </span><span class=l>${{ 0xff }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myExponentialNumber</span><span class=p>:</span><span class=w> </span><span class=l>${{ -2.99-e2 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myString</span><span class=p>:</span><span class=w> </span><span class=l>Mona the Octocat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>myStringInBraces</span><span class=p>:</span><span class=w> </span><span class=l>${{ &#39;It&#39;&#39;s open source!&#39; }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=运算符>运算符</h3><table><thead><tr><th style=text-align:left>运算符</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>( )</code></td><td style=text-align:left>逻辑分组</td></tr><tr><td style=text-align:left><code>[ ]</code></td><td style=text-align:left>索引</td></tr><tr><td style=text-align:left><code>.</code></td><td style=text-align:left>属性取消引用</td></tr><tr><td style=text-align:left><code>!</code></td><td style=text-align:left>非</td></tr><tr><td style=text-align:left><code>&lt;</code></td><td style=text-align:left>小于</td></tr><tr><td style=text-align:left><code>&lt;=</code></td><td style=text-align:left>小于或等于</td></tr><tr><td style=text-align:left><code>></code></td><td style=text-align:left>大于</td></tr><tr><td style=text-align:left><code>>=</code></td><td style=text-align:left>大于或等于</td></tr><tr><td style=text-align:left><code>==</code></td><td style=text-align:left>等于</td></tr><tr><td style=text-align:left><code>!=</code></td><td style=text-align:left>不等于</td></tr><tr><td style=text-align:left><code>&&</code></td><td style=text-align:left>和</td></tr><tr><td style=text-align:left>`</td><td style=text-align:left></td></tr></tbody></table><p>等式比较条件宽松</p><ul><li><p>如果类型不匹配，会强制转换类型为数字：</p><table><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>结果</th></tr></thead><tbody><tr><td style=text-align:left>Null</td><td style=text-align:left><code>0</code></td></tr><tr><td style=text-align:left>布尔值</td><td style=text-align:left><code>true</code> 返回 <code>1</code> <code>false</code> 返回 <code>0</code></td></tr><tr><td style=text-align:left>字符串</td><td style=text-align:left>从任何合法 JSON 数字格式剖析，否则为 <code>NaN</code>。 注：空字符串返回 <code>0</code>。</td></tr><tr><td style=text-align:left>数组</td><td style=text-align:left><code>NaN</code></td></tr><tr><td style=text-align:left>对象</td><td style=text-align:left><code>NaN</code></td></tr></tbody></table></li><li><p>一个 <code>NaN</code> 与另一个 <code>NaN</code> 的比较不会产生 <code>true</code>。</p></li><li><p>GitHub 在比较字符串时<strong>忽略大小写</strong>。</p></li><li><p>对象和数组仅在为同一实例时才视为相等。（不懂）</p></li></ul><h3 id=函数>函数</h3><p>GitHub 提供一组内置的函数，可用于表达式。 有些函数抛出值到字符串以进行比较。 GitHub 使用这些转换将数据类型转换为字符串：</p><table><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>结果</th></tr></thead><tbody><tr><td style=text-align:left>Null</td><td style=text-align:left><code>''</code></td></tr><tr><td style=text-align:left>布尔值</td><td style=text-align:left><code>'true'</code> 或 <code>'false'</code></td></tr><tr><td style=text-align:left>数字</td><td style=text-align:left>十进制格式，对大数字使用指数</td></tr><tr><td style=text-align:left>数组</td><td style=text-align:left>数组不转换为字符串</td></tr><tr><td style=text-align:left>对象</td><td style=text-align:left>对象不转换为字符串</td></tr></tbody></table><h4 id=contains>contains</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>contains( search, item )
</span></span></code></pre></td></tr></table></div></div><ul><li><p>如果 <code>search</code> 包含 <code>item</code>，则返回 <code>true</code>。</p></li><li><p>如果 <code>search</code> 为数组，<code>item</code> 为数组中的元素时返回 <code>true</code>。</p></li><li><p>如果 <code>search</code> 为字符串，<code>item</code> 为 <code>search</code> 的子字符串时返回 <code>true</code>。</p></li></ul><p>此函数不区分大小写。 抛出值到字符串。</p><p><strong>如：</strong></p><p><code>contains(github.event.issue.labels.*.name, 'bug')</code></p><p>返回与事件相关的议题（是一个数组）是否带有标签 &ldquo;bug&rdquo;。</p><p><code>contains('Hello world', 'llo')</code></p><p>返回 <code>true</code>.</p><h4 id=startswith>startsWith</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>startsWith( searchString, searchValue )
</span></span></code></pre></td></tr></table></div></div><p>当 <code>searchString</code> 以 <code>searchValue</code> 开头时返回 <code>true</code>。</p><p>此函数不区分大小写。 抛出值到字符串。</p><p><strong>如：</strong></p><p><code>startsWith('Hello world', 'He')</code></p><p>返回 <code>true</code>.</p><h4 id=endswith>endsWith</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>endsWith( searchString, searchValue )
</span></span></code></pre></td></tr></table></div></div><p>当 <code>searchString</code> 以 <code>searchValue</code> 结尾时返回 <code>true</code>。</p><p>此函数不区分大小写。 抛出值到字符串。</p><p><strong>如：</strong></p><p><code>endsWith('Hello world', 'ld')</code> 返回 <code>true</code>.</p><h4 id=format>format</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>format( string, replaceValue0, replaceValue1, ..., replaceValueN)
</span></span></code></pre></td></tr></table></div></div><p>将 <code>string</code> 中的值替换为变量 <code>replaceValueN</code>。</p><p><code>string</code> 中的变量使用 <code>{N}</code> 语法指定，其中 <code>N</code> 为整数。</p><p>必须指定至少一个 <code>replaceValue</code> 和 <code>string</code>。 可以使用变量 (<code>replaceValueN</code>) 数没有上限。</p><p>使用双小括号逸出大括号（？</p><p><strong>如：</strong></p><p><code>format('Hello {0} {1} {2}', 'Mona', 'the', 'Octocat')</code></p><p>返回 &lsquo;Hello Mona the Octocat&rsquo;.</p><p><code>format('{{Hello {0} {1} {2}!}}', 'Mona', 'the', 'Octocat')</code></p><p>返回 &lsquo;{Hello Mona the Octocat!}&rsquo;.</p><h3 id=状态检查函数>状态检查函数</h3><p>您可以使用以下状态检查函数作为 <code>if</code> 条件中的表达式。</p><p>除非您包含其中一个函数，否则 <code>success()</code> 的默认状态检查将会应用。</p><h4 id=success>success</h4><p>当前面的 step 没有失败或取消时返回 <code>true</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>The job has succeeded</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ success() }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=always>always</h4><p>导致该 step 总是执行，并返回 <code>true</code>，即使取消也一样。</p><p>job 或 step 在重大故障阻止任务运行时不会运行。 例如，如果获取来源失败。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ always() }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=cancelled>cancelled</h4><p>在 workflow 取消时返回 <code>true</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ cancelled() }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=failure>failure</h4><p>在 job 的任何之前一步失败时返回 <code>true</code>。 如果您有相依 job 链，<code>failure()</code> 在任何上层节点 job 失败时返回 <code>true</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>The job has failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ failure() }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=显式评估状态>显式评估状态</h4><p>您可以直接评估执行 step 的 job 或复合 action 的状态，而不是使用上述方法之一：</p><h5 id=workflow--step-示例>workflow step 示例</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>The job has failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ job.status == &#39;failure&#39; }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这与在 job step 中使用 <code>if: failure()</code> 相同。</p><h5 id=复合-action--step-的示例>复合 action step 的示例</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>The composite action has failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.action_status == &#39;failure&#39; }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这与在复合 action step 中使用 <code>if: failure()</code> 相同。</p><h2 id=上下文>上下文</h2><blockquote><p>context</p></blockquote><p>详见 <a href=https://docs.github.com/en/actions/learn-github-actions/contexts target=_blank rel="external nofollow noopener noreferrer">https://docs.github.com/en/actions/learn-github-actions/contexts</a></p><p>上下文是一种访问 workflow 运行、运行器环境、 job 及 step 相关信息的方式。 每个上下文都是一个包含属性的对象，属性可以是字符串或其他对象。</p><p>使用表达式语法访问上下文：<code>${{ &lt;context> }}</code></p><table><thead><tr><th style=text-align:left>上下文名称</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>github</code></td><td style=text-align:left>workflow 运行的相关信息</td></tr><tr><td style=text-align:left><code>env</code></td><td style=text-align:left>包含 workflow、job 或 step 中设置的环境变量</td></tr><tr><td style=text-align:left><code>job</code></td><td style=text-align:left>有关当前运行的 job 的信息</td></tr><tr><td style=text-align:left><code>steps</code></td><td style=text-align:left>有关当前 job 中已运行的 step 的信息</td></tr><tr><td style=text-align:left><code>runner</code></td><td style=text-align:left>运行当前 job 的运行程序相关信息</td></tr><tr><td style=text-align:left><code>secrets</code></td><td style=text-align:left>包含可用于 workflow 运行的<strong>机密</strong>的名称和值</td></tr><tr><td style=text-align:left><code>strategy</code></td><td style=text-align:left>有关当前 job 的 matrix <strong>执行策略</strong>的信息</td></tr><tr><td style=text-align:left><code>matrix</code></td><td style=text-align:left>包含在 workflow 中定义的应用于当前 job 的<strong>矩阵</strong>属性。</td></tr><tr><td style=text-align:left><code>needs</code></td><td style=text-align:left>包含定义为当前 job <strong>依赖项</strong>的所有 job 的输出</td></tr><tr><td style=text-align:left><code>inputs</code></td><td style=text-align:left>包含可重用 workflow 的<strong>输入</strong></td></tr></tbody></table><p>作为表达式的一部分，您可以使用以下两种语法之一访问上下文信息。</p><ul><li>索引语法：<code>github['sha']</code></li><li>属性解除参考语法：<code>github.sha</code></li></ul><h3 id=一些小栗子>一些小栗子</h3><p>将上下文信息打印到日志， 需要 <code>toJSON</code> 函数才能将 JSON 对象打印到日志中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Context testing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dump_contexts_to_log</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump GitHub context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>github_context_step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(github) }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump job context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(job) }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump steps context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(steps) }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump runner context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(runner) }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump strategy context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(strategy) }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Dump matrix context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;${{ toJSON(matrix) }}&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>拿到触发 workflow 的事件名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run CI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push, pull_request]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>normal_ci</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run normal CI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./run-tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pull_request_ci</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event_name == &#39;pull_request&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run PR CI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./run-additional-pr-ci</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>env</code> 上下文</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Hi Mascot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mascot</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>super_duper_var</span><span class=p>:</span><span class=w> </span><span class=l>totally_awesome</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>windows_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>windows-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;Hi ${{ env.mascot }}&#39; </span><span class=w> </span><span class=c># Hi Mona</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;Hi ${{ env.mascot }}&#39; </span><span class=w> </span><span class=c># Hi Octocat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mascot</span><span class=p>:</span><span class=w> </span><span class=l>Octocat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>linux_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mascot</span><span class=p>:</span><span class=w> </span><span class=l>Tux</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;Hi ${{ env.mascot }}&#39; </span><span class=w> </span><span class=c># Hi Tux</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>拿到上一个 step 的 output</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Generate random failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>randomly-failing-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Generate 0 or 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>generate_number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w>  </span><span class=l>echo &#34;::set-output name=random_number::$(($RANDOM % 2))&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Pass or fail</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          if [[ ${{ steps.generate_number.outputs.random_number }} == 0 ]]; then exit 0; else exit 1; fi</span><span class=w>          
</span></span></span></code></pre></td></tr></table></div></div><p>此示例工作流程有三个 job：</p><ol><li>执行生成的 <code>build</code> 作业</li><li>需要 <code>build</code> 作业的 <code>deploy</code> 作业</li><li>以及需要 <code>build</code> 和 <code>deploy</code> 作业并且仅工作流程中出现失败时运行的 <code>debug</code> 作业。</li></ol><p><code>deploy</code> 作业还使用 <code>needs</code> 上下文来访问 <code>build</code> 作业的输出。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>outputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>build_id</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.build_step.outputs.build_id }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>build_step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          ./build
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;::set-output name=build_id::$BUILD_ID&#34; </span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./deploy --build ${{ needs.build.outputs.build_id }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>build, deploy]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ failure() }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./debug</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>此可重用工作流程示例使用 <code>inputs</code> 上下文来获取从调用方工作流传递到可重用工作流的 <code>build_id</code> 的值和 <code>deploy_target</code> 输入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reusable deploy workflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_call</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>build_id</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>deploy_target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>perform_deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>boolean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ inputs.perform_deploy == &#39;true&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy build to target</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>deploy --build ${{ inputs.build_id }} --target ${{ inputs.deploy_target }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=环境变量-1>环境变量</h2><blockquote><p>Environment variables</p></blockquote><p>您可以使用环境变量来存储要在工作流程中引用的信息。 您可以在工作流程步骤或操作中引用环境变量，这些变量将在运行工作流程的运行器计算机上插值。 在操作或工作流程步骤中运行的命令可以创建、读取和修改环境变量。</p><p>您可以设置自己的自定义环境变量，可以使用 GitHub 自动设置的默认环境变量，还可以使用在运行器上的工作环境中设置的任何其他环境变量。 环境变量区分大小写。</p><p>要设置自定义环境变量，必须在工作流程文件中定义它。 自定义环境变量的作用域仅限于在其中定义它的元素。 您可以定义作用域如下的环境变量：</p><ul><li>整个 workflow，通过使用 <a href=https://docs.github.com/cn/actions/using-workflows/workflow-syntax-for-github-actions#env target=_blank rel="external nofollow noopener noreferrer"><code>env</code></a> 工作流程文件的顶级来定义。</li><li>工作流程中 job 的内容，通过使用 <a href=https://docs.github.com/cn/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idenv target=_blank rel="external nofollow noopener noreferrer"><code>jobs..env</code></a> 来定义。</li><li>作业中的特定 step，通过使用 <a href=https://docs.github.com/cn/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsenv target=_blank rel="external nofollow noopener noreferrer"><code>jobs..steps[*\].env</code></a> 来定义。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Greeting on variable day</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>workflow_dispatch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DAY_OF_WEEK</span><span class=p>:</span><span class=w> </span><span class=l>Monday</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>greeting_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>Greeting</span><span class=p>:</span><span class=w> </span><span class=l>Hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Say Hello Mona it&#39;s Monday&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;$Greeting $First_Name. Today is $DAY_OF_WEEK!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>First_Name</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>注意：</p><ul><li>设置自定义环境变量时，不能使用任何默认环境变量名称。</li></ul><h3 id=使用上下文访问环境变量值>使用上下文访问环境变量值</h3><p>除了环境变量之外，GitHub Actions 还允许您使用上下文设置和读取值。 环境变量和上下文旨在用于工作流程中的不同点。</p><p>环境变量始终在虚拟机运行器上插值。 但是，工作流程的某些部分由 GitHub Actions 处理，不会发送到运行器。 不能在工作流程文件的这些部分中使用环境变量。 相反，您可以使用上下文。</p><p>例如，<code>if</code> 条件（确定作业或步骤是否发送到运行器）始终由 GitHub Actions 处理。 可以在 <code>if</code> 条件语句中使用上下文访问环境变量的值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DAY_OF_WEEK</span><span class=p>:</span><span class=w> </span><span class=l>Monday</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>greeting_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>Greeting</span><span class=p>:</span><span class=w> </span><span class=l>Hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Say Hello Mona it&#39;s Monday&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ env.DAY_OF_WEEK == &#39;Monday&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;$Greeting $First_Name. Today is $DAY_OF_WEEK!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>First_Name</span><span class=p>:</span><span class=w> </span><span class=l>Mona</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>您通常使用 <code>env</code> 或 <code>github</code> 上下文来访问工作流程部分中的环境变量值，这些值在作业发送给运行器之前处理。</p><table><thead><tr><th style=text-align:left>上下文</th><th style=text-align:left>用例</th><th style=text-align:left>示例</th></tr></thead><tbody><tr><td style=text-align:left><code>env</code></td><td style=text-align:left>引用工作流中定义的自定义环境变量。</td><td style=text-align:left><code>${{ env.MY_VARIABLE }}</code></td></tr><tr><td style=text-align:left><code>github</code></td><td style=text-align:left>引用有关工作流程运行的信息和触发运行的事件。</td><td style=text-align:left><code>${{ github.repository }}</code></td></tr></tbody></table><p><strong>使用上下文访问环境变量更有泛用性</strong></p><h3 id=默认的环境变量>默认的环境变量</h3><p>详见：https://docs.github.com/cn/actions/learn-github-actions/environment-variables#default-environment-variables</p><p>GitHub 设置的默认环境变量可用于工作流程中的每个步骤。</p><p>强烈建议操作使用环境变量访问文件系统，而非使用硬编码的文件路径。 GitHub 设置供操作用于所有运行器环境中的环境变量。</p><table><thead><tr><th style=text-align:left>环境变量</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>CI</code></td><td style=text-align:left>始终设置为 <code>true</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_ACTOR</code></td><td style=text-align:left>发起工作流程的个人或应用程序的名称。 例如 <code>octocat</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_BASE_REF</code></td><td style=text-align:left>工作流程运行中拉取请求的基本引用或目标分支的名称。 这仅在触发工作流运行的事件 <code>pull_request</code> 或 <code>pull_request_target</code> 时才会设置。 例如 <code>main</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_ENV</code></td><td style=text-align:left>运行器上从工作流程命令到设置环境变量的文件路径。 此文件对于当前步骤是唯一的，并且会针对作业中的每个步骤进行更改。 例如，<code>/home/runner/work/_temp/_runner_file_commands/set_env_87406d6e-4979-4d42-98e1-3dab1f48b13a</code>。 更多信息请参阅“<a href=https://docs.github.com/cn/actions/using-workflows/workflow-commands-for-github-actions#setting-an-environment-variable target=_blank rel="external nofollow noopener noreferrer">GitHub Actions 的工作流程命令</a>”。</td></tr><tr><td style=text-align:left><code>GITHUB_EVENT_NAME</code></td><td style=text-align:left>触发工作流程的事件的名称。 例如，<code>workflow_dispatch</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_JOB</code></td><td style=text-align:left>当前作业的 <a href=https://docs.github.com/cn/actions/reference/workflow-syntax-for-github-actions#jobsjob_id target=_blank rel="external nofollow noopener noreferrer">job_id</a>。 例如，<code>greeting_job</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_PATH</code></td><td style=text-align:left>运行器上从工作流程命令到设置系统 <code>PATH</code> 变量的文件路径。 此文件对于当前步骤是唯一的，并且会针对作业中的每个步骤进行更改。 例如 <code>/home/runner/work/_temp/_runner_file_commands/add_path_899b9445-ad4a-400c-aa89-249f18632cf5</code>。 更多信息请参阅“<a href=https://docs.github.com/cn/actions/using-workflows/workflow-commands-for-github-actions#adding-a-system-path target=_blank rel="external nofollow noopener noreferrer">GitHub Actions 的工作流程命令</a>”。</td></tr><tr><td style=text-align:left><code>GITHUB_REF_NAME</code></td><td style=text-align:left>触发工作流程的分支或标记名</td></tr><tr><td style=text-align:left><code>GITHUB_REPOSITORY</code></td><td style=text-align:left>所有者和存储库名称。 例如 <code>octocat/Hello-World</code>。</td></tr><tr><td style=text-align:left><code>GITHUB_WORKFLOW</code></td><td style=text-align:left>工作流程的名称。 例如 <code>My test workflow</code>。 如果工作流程文件未指定<code>名称</code>，则此变量的值是存储库中工作流程文件的完整路径。</td></tr></tbody></table><h2 id=矩阵>矩阵</h2><blockquote><p>matrix</p></blockquote><p>一般定义在 job 中</p><p>有时候，我们的代码可能编译环境有多个。比如 electron 的程序，我们需要在 macos 上编译 dmg 压缩包，在 windows 上编译 exe 可执行文件</p><p>这种时候，我们使用矩阵就可以啦~</p><p>比如下面的代码，我们使用了矩阵指定了：2 个 action 系统，3 个 node 版本。</p><p>这时候下面这段代码就会执行 6 次：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>${{ matrix.os }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ubuntu-16.04, ubuntu-18.04]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=m>8</span><span class=p>,</span><span class=w> </span><span class=m>10</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=l>${{ matrix.node }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=一些通用的属性>一些通用的属性</h2><blockquote><p>相对于 workflow, job, step 来讲</p></blockquote><h3 id=if>if</h3><h4 id=in-job>in job</h4><blockquote><p>jobs.&lt;job_id>.if</p></blockquote><p><strong>示例：只在特定的仓库下运行</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-workflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>production-deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.repository == &#39;octo-org/octo-repo-prod&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;14&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npm install -g bats</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=in-step>in step</h4><blockquote><p>jobs.&lt;job_id>.steps[*].if</p></blockquote><p><strong>示例：使用上下文</strong></p><p>此步骤仅在事件类型为 <code>pull_request</code> 并且事件操作为 <code>unassigned</code> 时运行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My first step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event_name == &#39;pull_request&#39; &amp;&amp; github.event.action == &#39;unassigned&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo This event is a pull request that had an assignee removed.</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>示例：使用状态检查功能</strong></p><p><code>my backup step</code> 仅在作业的上一步失败时运行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My first step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>octo-org/action-name@main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My backup step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ failure() }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/heroku@1.0.0</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>示例：使用机密</strong></p><p>无法直接在 <code>if:</code> 条件中引用机密。 而应考虑将机密设置为作业级环境变量，然后引用环境变量以有条件地运行作业中的步骤。</p><p>如果尚未设置机密，则引用该机密的表达式（例如示例中的 <code>${{ secrets.SuperSecret }}</code>）的返回值将为空字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run a step if a secret has been set</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my-jobname</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>super_secret</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SuperSecret }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ env.super_secret != &#39;&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;This step will only run if the secret has a value set.&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ env.super_secret == &#39;&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;This step will only run if the secret does not have a value set.&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=on-详解>on 详解</h2><p>详见：https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows</p><h2 id=action>action</h2><h3 id=添加-action>添加 action</h3><h4 id=从相同仓库添加>从相同仓库添加</h4><p>通过 ‌<code>{owner}/{repo}@{ref}</code> 或 <code>./path/to/dir</code> 语法引用 action 。</p><p>示例 repo 文件结构：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>|-- hello-world (repository)
</span></span><span class=line><span class=cl>|   |__ .github
</span></span><span class=line><span class=cl>|       └── workflows
</span></span><span class=line><span class=cl>|           └── my-first-workflow.yml
</span></span><span class=line><span class=cl>|       └── actions
</span></span><span class=line><span class=cl>|           |__ hello-world-action
</span></span><span class=line><span class=cl>|               └── action.yml
</span></span></code></pre></td></tr></table></div></div><p>示例 workflow 文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># This step checks out a copy of your repository.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># This step references the directory that contains the action.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>./.github/actions/hello-world-action</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=从不同仓库添加-action>从不同仓库添加 action</h4><p>一般是从 marketplace 中找到相关用法，直接粘贴</p><p>使用 <code>{owner}/{repo}@{ref}</code> 语法引用该 action 。</p><p>该 action 必须存储在公共（public）仓库。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my_first_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My first step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=引用-docker-hub-上的容器>引用 Docker Hub 上的容器</h4><p>通过 <code>docker://{image}:{tag}</code> 语法引用 action 。</p><p>为保护代码和数据，强烈建议先验证 Docker Hub 中 Docker 容器图像的完整性后再将其用于 workflow 。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my_first_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>My first step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker://alpine:3.8</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=一些有用的-action>一些有用的 action</h3><h4 id=checkout>checkout</h4><p>check-out 仓库中最新的代码到 Workflow 的工作区：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=node-和-npm>node 和 npm</h4><p>如果是 node 项目，可以安装 Node.js 与 NPM：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v2-beta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;12&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=artifact>artifact</h4><p><strong>上传</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Save output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>bash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          expr 1 + 1 &gt; output.log</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload output file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-log-file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>output.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>retention-days</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w> </span><span class=c># 保留时间</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>下载</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Download a single artifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/download-artifact@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-log-file</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>不指定 name 时，默认下载所有 artifact</p><h4 id=python>Python</h4><h4 id=go>Go</h4></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-06-14 10:39:34">更新于 2023-06-14</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/github-actions/ data-title="Github Actions"><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/github-actions/><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/%E5%B7%A5%E5%85%B7/github-actions/ data-title="Github Actions"><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/golang/%E5%B8%B8%E7%94%A8%E5%BA%93/viper/ class=prev rel=prev title="Go Viper 库"><i class="fa-solid fa-angle-left fa-fw"></i>Go Viper 库</a>
<a href=/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/template/ class=next rel=next title=text/template>text/template<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022 - 2023</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"7I9AMOLA4S",algoliaIndex:"Notes",algoliaSearchKey:"3c1638dfe9f4d49a59d81ff6943416b8",highlightTag:"em",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>