<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>Go strconv 标准库 - 伤心肠粉的酱油碟子</title><meta name=Description content><meta property="og:title" content="Go strconv 标准库">
<meta property="og:description" content="strconv 这个包实现了字符串和基本数据类型之间转换 这里的基本数据类型包括：布尔、整型（包括有 / 无符号、二进制、八进制、十进制和十六进制）和浮点型等。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/strconv/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-15T00:00:00+00:00">
<meta property="article:modified_time" content="2022-03-07T15:08:52+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Go strconv 标准库">
<meta name=twitter:description content="strconv 这个包实现了字符串和基本数据类型之间转换 这里的基本数据类型包括：布尔、整型（包括有 / 无符号、二进制、八进制、十进制和十六进制）和浮点型等。">
<meta name=application-name content="伤心肠粉的酱油碟子">
<meta name=apple-mobile-web-app-title content="伤心肠粉的酱油碟子"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/strconv/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/unicode/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/container/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go strconv 标准库","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/%E6%A0%87%E5%87%86%E5%BA%93\/%E6%96%87%E6%9C%AC\/strconv\/"},"genre":"posts","keywords":"Go 库","wordcount":2580,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/%E6%A0%87%E5%87%86%E5%BA%93\/%E6%96%87%E6%9C%AC\/strconv\/","datePublished":"2021-12-15T00:00:00+00:00","dateModified":"2022-03-07T15:08:52+00:00","publisher":{"@type":"Organization","name":"MelonCholi"},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":''==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:''==="dark")&&document.body.setAttribute("theme","dark")</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/Notes/ title=伤心肠粉的酱油碟子>伤心肠粉</a>
</div><div class=menu>
<div class=menu-inner><a class=menu-item href=/Notes/posts/> 文章 </a><a class=menu-item href=/Notes/tags/> 标签 </a><a class=menu-item href=/Notes/categories/> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a>
</div></div></div></header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/Notes/ title=伤心肠粉的酱油碟子>伤心肠粉</a>
</div><div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div></div><div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
取消
</a>
</div><a class=menu-item href=/Notes/posts/ title>文章</a><a class=menu-item href=/Notes/tags/ title>标签</a><a class=menu-item href=/Notes/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a></div></div></header><div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div></div><main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Go strconv 标准库</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=/Notes/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>MelonCholi</a></span>&nbsp;<span class=post-category>收录于 <a href=/Notes/categories/golang/><i class="far fa-folder fa-fw"></i>Golang</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-12-15>2021-12-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2580 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#strconv-包转换错误处理>strconv 包转换错误处理</a></li><li><a href=#字符串和整型之间的转换>字符串和整型之间的转换</a>
<ul>
<li><a href=#字符串转为整型>字符串转为整型</a>
<ul>
<li><a href=#当-bitsize0-时的情况>当 bitSize==0 时的情况</a></li><li><a href=#超出-bitsize-的表示范围>超出 bitSize 的表示范围</a></li></ul></li><li><a href=#整型转为字符串>整型转为字符串</a></li></ul></li><li><a href=#字符串和布尔值之间的转换>字符串和布尔值之间的转换</a></li><li><a href=#字符串和浮点数之间的转换>字符串和浮点数之间的转换</a></li><li><a href=#其他导出的函数>其他导出的函数</a></li></ul></nav></div></div><div class=content id=content><h1 id=strconv>strconv</h1><p>这个包实现了字符串和基本数据类型之间转换</p><p>这里的基本数据类型包括：布尔、整型（包括有 / 无符号、二进制、八进制、十进制和十六进制）和浮点型等。</p><h2 id=strconv-包转换错误处理>strconv 包转换错误处理</h2><p>介绍具体的转换之前，先看看 <em>strconv</em> 中的错误处理。</p><p>由于将字符串转为其他数据类型可能会出错，<em>strconv</em> 包定义了两个 <em>error</em> 类型的变量：<em>ErrRange</em> 和 <em>ErrSyntax</em>。其中，<em>ErrRange</em> 表示值超过了类型能表示的最大范围，比如将 &ldquo;128&rdquo; 转为 int8 就会返回这个错误；<em>ErrSyntax</em> 表示语法错误，比如将 "" 转为 int 类型会返回这个错误。</p><p>然而，在返回错误的时候，不是直接将上面的变量值返回，而是通过构造一个 <em>NumError</em> 类型的 <em>error</em> 对象返回。<em>NumError</em> 结构的定义如下：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// A NumError records a failed conversion.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>NumError</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Func</span> <span class=kt>string</span> <span class=c1>// the failing function (ParseBool, ParseInt, ParseUint, ParseFloat)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Num</span>  <span class=kt>string</span> <span class=c1>// the input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Err</span>  <span class=kt>error</span>  <span class=c1>// the reason the conversion failed (ErrRange, ErrSyntax)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>可见，该结构记录了转换过程中发生的错误信息。该结构不仅包含了一个 <em>error</em> 类型的成员，记录具体的错误信息，而且它自己也实现了 <em>error</em> 接口：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>NumError</span><span class=p>)</span> <span class=nf>Error</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;strconv.&#34;</span> <span class=o>+</span> <span class=nx>e</span><span class=p>.</span><span class=nx>Func</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=s>&#34;parsing &#34;</span> <span class=o>+</span> <span class=nf>Quote</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>Num</span><span class=p>)</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=nx>e</span><span class=p>.</span><span class=nx>Err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>包的实现中，定义了两个便捷函数，用于构造 <em>NumError</em> 对象：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>syntaxError</span><span class=p>(</span><span class=nx>fn</span><span class=p>,</span> <span class=nx>str</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>NumError</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>NumError</span><span class=p>{</span><span class=nx>fn</span><span class=p>,</span> <span class=nx>str</span><span class=p>,</span> <span class=nx>ErrSyntax</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>rangeError</span><span class=p>(</span><span class=nx>fn</span><span class=p>,</span> <span class=nx>str</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>NumError</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>NumError</span><span class=p>{</span><span class=nx>fn</span><span class=p>,</span> <span class=nx>str</span><span class=p>,</span> <span class=nx>ErrRange</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在遇到 <em>ErrSyntax</em> 或 <em>ErrRange</em> 错误时，通过上面的函数构造 <em>NumError</em> 对象。</p><h2 id=字符串和整型之间的转换>字符串和整型之间的转换</h2><h3 id=字符串转为整型>字符串转为整型</h3><p>包括三个函数：ParseInt、ParseUint 和 Atoi，函数原型如下：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 转为有符号整型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseInt</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>base</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>bitSize</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>i</span> <span class=kt>int64</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 转为无符号整型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseUint</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>base</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>bitSize</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>n</span> <span class=kt>uint64</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 是 ParseInt 的便捷版，内部通过调用 *ParseInt(s, 10, 0)* 来实现的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Atoi</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>i</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>着重介绍 ParseInt。</p><ul>
<li>
<p>参数 <em>base</em> 代表字符串按照给定的进制进行解释。</p><ul>
<li>一般的，base 的取值为 2~36</li><li>如果 base 的值为 0，则会根据字符串的前缀来确定 base 的值：&ldquo;0x&rdquo; 表示 16 进制； &ldquo;0&rdquo; 表示 8 进制；否则就是 10 进制。</li></ul></li><li>
<p>参数 <em>bitSize</em> 表示的是整数取值范围，或者说整数的具体类型。取值 0、8、16、32 和 64 分别代表 int、int8、int16、int32 和 int64。</p></li></ul><h4 id=当-bitsize0-时的情况>当 bitSize==0 时的情况</h4><p>这里有必要说一下，当 bitSize==0 时的情况。</p><p>Go 中，int/uint 类型，不同系统能表示的范围是不一样的，目前的实现是，32 位系统占 4 个字节；64 位系统占 8 个字节。当 bitSize==0 时，应该表示 32 位还是 64 位呢？这里没有利用 <em>runtime.GOARCH</em> 之类的方式，而是巧妙的通过如下表达式确定 intSize：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>const intSize = 32 &lt;&lt; uint(^uint(0)&gt;&gt;63)
</span></span><span class=line><span class=cl>const IntSize = intSize // number of bits in int, uint (32 or 64)
</span></span></code></pre></td></tr></table></div></div><p>主要是 <em>^uint(0)&#187;63</em> 这个表达式。操作符 <em>^</em> 在这里是一元操作符 按位取反，而不是 按位异或。更多解释可以参考：<a href=http://studygolang.com/topics/303 target=_blank rel="noopener noreffer">Go 位运算：取反和异或</a>。</p><h4 id=超出-bitsize-的表示范围>超出 bitSize 的表示范围</h4><p>问题：下面的代码 n 和 err 的值分别是什么？</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseInt</span><span class=p>(</span><span class=s>&#34;128&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>在 <em>ParseInt/ParseUint</em> 的实现中，如果字符串表示的整数超过了 bitSize 参数能够表示的范围，则会返回 ErrRange，同时会返回 bitSize 能够表示的最大或最小值。因此，这里的 n 是 127。</p><p>另外，<em>ParseInt</em> 返回的是 int64，这是为了能够容纳所有的整型，在实际使用中，可以根据传递的 bitSize，然后将结果转为实际需要的类型。</p><p>转换的基本原理（以 &ldquo;128&rdquo; 转 为 10 进制 int 为例）：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;128&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>s</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>n</span> <span class=o>*=</span> <span class=mi>10</span>    <span class=o>+</span> <span class=nx>s</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>     <span class=c1>// base
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在循环处理的过程中，会检查数据的有效性和是否越界等。</p><h3 id=整型转为字符串>整型转为字符串</h3><p>实际应用中，我们经常会遇到需要将字符串和整型连接起来，在 Java 中，可以通过操作符 &ldquo;+&rdquo; 做到。不过，在 Go 语言中，你需要将整型转为字符串类型，然后才能进行连接。</p><p>这个时候，<em>strconv</em> 包中的整型转字符串的相关函数就派上用场了。这些函数签名如下：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 无符号整型转字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>FormatUint</span><span class=p>(</span><span class=nx>i</span> <span class=kt>uint64</span><span class=p>,</span> <span class=nx>base</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span>    
</span></span><span class=line><span class=cl><span class=c1>// 有符号整型转字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>FormatInt</span><span class=p>(</span><span class=nx>i</span> <span class=kt>int64</span><span class=p>,</span> <span class=nx>base</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span>  
</span></span><span class=line><span class=cl><span class=c1>// Itoa内部直接调用FormatInt(i, 10)实现
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Itoa</span><span class=p>(</span><span class=nx>i</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span>
</span></span></code></pre></td></tr></table></div></div><p>其中，base 参数可以取 2~36（0-9，a-z）。</p><p>标准库还提供了另外两个函数：<em><strong>AppendInt</strong></em> 和 <em><strong>AppendUint</strong></em>，这两个函数不是将整数转为字符串，而是将整数转为字符数组 append 到目标字符数组中。（最终，我们也可以通过返回的 []byte 得到字符串）</p><p>除了使用上述方法将整数转为字符串外，经常见到有人使用 <em>fmt</em> 包来做这件事。如：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=mi>127</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>那么，这两种方式我们该怎么选择呢？我们主要来考察一下性能。</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>startTime</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>   
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Sub</span><span class=p>(</span><span class=nx>startTime</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>startTime</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>strconv</span><span class=p>.</span><span class=nf>Itoa</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>   
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Sub</span><span class=p>(</span><span class=nx>startTime</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>我们分别循环转换了 10000 次。<em>Sprintf</em> 的时间是 3.549761ms，而 <em>Itoa</em> 的时间是 848.208us，相差 4 倍多。</p><p><em>Sprintf</em> 性能差些可以预见，因为它接收的是 interface，需要进行反射等操作。个人建议使用 <em>strconv</em> 包中的方法进行转换。</p><blockquote>
<p>注意：别想着通过 string(65) 这种方式将整数转为字符串，这样实际上得到的会是 ASCCII 值为 65 的字符，即 &lsquo;A&rsquo;。</p></blockquote><h2 id=字符串和布尔值之间的转换>字符串和布尔值之间的转换</h2><p>Go 中字符串和布尔值之间的转换比较简单，主要有三个函数：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 接受 1, t, T, TRUE, true, True, 0, f, F, FALSE, false, False 等字符串；
</span></span></span><span class=line><span class=cl><span class=c1>// 其他形式的字符串会返回错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseBool</span><span class=p>(</span><span class=nx>str</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>value</span> <span class=kt>bool</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 直接返回 &#34;true&#34; 或 &#34;false&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>FormatBool</span><span class=p>(</span><span class=nx>b</span> <span class=kt>bool</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将 &#34;true&#34; 或 &#34;false&#34; append 到 dst 中
</span></span></span><span class=line><span class=cl><span class=c1>// 这里用了一个 append 函数对于字符串的特殊形式：append(dst, &#34;true&#34;...)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>AppendBool</span><span class=p>(</span><span class=nx>dst</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>bool</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=字符串和浮点数之间的转换>字符串和浮点数之间的转换</h2><p>类似的，包含三个函数：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ParseFloat</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>bitSize</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>f</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>FormatFloat</span><span class=p>(</span><span class=nx>f</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>fmt</span> <span class=kt>byte</span><span class=p>,</span> <span class=nx>prec</span><span class=p>,</span> <span class=nx>bitSize</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>AppendFloat</span><span class=p>(</span><span class=nx>dst</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>f</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>fmt</span> <span class=kt>byte</span><span class=p>,</span> <span class=nx>prec</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>bitSize</span> <span class=kt>int</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>函数的命名和作用跟上面讲解的其他类型一致。</p><p>关于 <em>FormatFloat</em> 的 <em>fmt</em> 参数， 在格式化 IO 中有详细介绍。而 <em>prec</em> 表示有效数字（对 <em>fmt=&lsquo;b&rsquo;</em> 无效），对于 &rsquo;e&rsquo;, &lsquo;E&rsquo; 和 &lsquo;f&rsquo;，有效数字用于小数点之后的位数；对于 &lsquo;g&rsquo; 和 &lsquo;G&rsquo;，则是所有的有效数字。例如：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>strconv</span><span class=p>.</span><span class=nf>FormatFloat</span><span class=p>(</span><span class=mf>1223.13252</span><span class=p>,</span> <span class=sc>&#39;e&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>    <span class=c1>// 结果：1.223e+03
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>strconv</span><span class=p>.</span><span class=nf>FormatFloat</span><span class=p>(</span><span class=mf>1223.13252</span><span class=p>,</span> <span class=sc>&#39;g&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>    <span class=c1>// 结果：1.22e+03
</span></span></span></code></pre></td></tr></table></div></div><p>由于浮点数有精度的问题，精度不一样，ParseFloat 和 FormatFloat 可能达不到互逆的效果。如：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>FormatFloat</span><span class=p>(</span><span class=mf>1234.5678</span><span class=p>,</span> <span class=sc>&#39;g&#39;</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseFloat</span><span class=p>(</span><span class=nx>s</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>另外，fmt=&lsquo;b&rsquo; 时，得到的字符串是无法通过 <em>ParseFloat</em> 还原的。</p><p>特别地（不区分大小写），+inf/inf，+infinity/infinity，-inf/-infinity 和 nan 通过 ParseFloat 转换分别返回对应的值（在 math 包中定义）。</p><p>同样的，基于性能的考虑，应该使用 <em>FormatFloat</em> 而不是 <em>fmt.Sprintf</em>。</p><h2 id=其他导出的函数>其他导出的函数</h2><p>如果要输出这样一句话：<em>This is &ldquo;studygolang.com&rdquo; website</em>. 该如何做？</p><p>So easy:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>`This is &#34;studygolang.com&#34; website`</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>如果没有 <em>``</em> 符号，该怎么做？转义：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;This is \&#34;studygolang.com\&#34; website&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>除了这两种方法，<em>strconv</em> 包还提供了函数这做件事（Quote 函数）。我们称 &ldquo;studygolang.com&rdquo; 这种用双引号引起来的字符串为 <strong>Go 语言字面值字符串</strong>（Go string literal）。</p><p>上面的一句话可以这么做：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;This is&#34;</span><span class=p>,</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Quote</span><span class=p>(</span><span class=s>&#34;studygolang.com&#34;</span><span class=p>),</span> <span class=s>&#34;website&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>更新于 2022-03-07</span>
</div><div class=post-info-license></div></div><div class=post-info-line>
<div class=post-info-md></div><div class=post-info-share>
<span></span>
</div></div></div><div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/go-%E5%BA%93/>Go 库</a></section><section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span>
</section></div><div class=post-nav><a href=/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E6%9C%AC/unicode/ class=prev rel=prev title="Go Unicode 标准库"><i class="fas fa-angle-left fa-fw"></i>Go Unicode 标准库</a>
<a href=/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/container/ class=next rel=next title="Go container 标准库">Go container 标准库<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer>
<div class=footer-container><div class=footer-line>酒困路长惟欲睡，日高人渴漫思茶</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><script type=text/javascript src=/Notes/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/Notes/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:40},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50}}</script><script type=text/javascript src=/Notes/js/theme.min.js></script></body></html>