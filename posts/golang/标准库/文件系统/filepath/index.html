<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Go filepath 标准库 - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="filepath path/filepath 包涉及到路径操作时，路径分隔符使用 os.PathSeparator。 不同系统"><meta name=keywords content="Go 库"><meta itemprop=name content="Go filepath 标准库"><meta itemprop=description content="filepath path/filepath 包涉及到路径操作时，路径分隔符使用 os.PathSeparator。 不同系统"><meta itemprop=datePublished content="2021-12-16T00:00:00+00:00"><meta itemprop=dateModified content="2023-08-13T09:03:08+00:00"><meta itemprop=wordCount content="3511"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content="Go 库,"><meta property="og:title" content="Go filepath 标准库"><meta property="og:description" content="filepath path/filepath 包涉及到路径操作时，路径分隔符使用 os.PathSeparator。 不同系统"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/filepath/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-13T09:03:08+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="Go filepath 标准库"><meta name=twitter:description content="filepath path/filepath 包涉及到路径操作时，路径分隔符使用 os.PathSeparator。 不同系统"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/filepath/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/time/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/math/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go filepath 标准库","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/%E6%A0%87%E5%87%86%E5%BA%93\/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\/filepath\/"},"genre":"posts","keywords":"Go 库","wordcount":3511,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/%E6%A0%87%E5%87%86%E5%BA%93\/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\/filepath\/","datePublished":"2021-12-16T00:00:00+00:00","dateModified":"2023-08-13T09:03:08+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Go filepath 标准库</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/golang/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Golang</a></span></div><div class=post-meta-line><span title="2021-12-16 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-12-16>2021-12-16</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 3511 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#解析路径名字符串>解析路径名字符串</a><ul><li><a href=#dir-base>Dir Base</a></li><li><a href=#ext>Ext</a></li></ul></li><li><a href=#相对路径和绝对路径>相对路径和绝对路径</a></li><li><a href=#13-路径的切分和拼接>1.3. 路径的切分和拼接</a></li><li><a href=#14-规整化路径>1.4. 规整化路径</a></li><li><a href=#15-符号链接指向的路径名>1.5. 符号链接指向的路径名</a></li><li><a href=#16-文件路径匹配>1.6. 文件路径匹配</a></li><li><a href=#17-遍历目录>1.7. 遍历目录</a></li><li><a href=#18-windows-起作用的函数>1.8. Windows 起作用的函数</a></li><li><a href=#19-关于-path-包>1.9. 关于 path 包</a></li></ul></nav></div></div><div class=content id=content><h1 id=filepath>filepath</h1><p><code>path/filepath</code> 包涉及到路径操作时，路径分隔符使用 <code>os.PathSeparator</code>。</p><p>不同系统，路径表示方式有所不同，比如 Unix 和 Windows 差别很大。本包能够处理所有的文件路径，不管是什么系统。</p><blockquote><p>路径操作函数并不会校验路径是否真实存在。</p></blockquote><h2 id=解析路径名字符串>解析路径名字符串</h2><h3 id=dir-base>Dir Base</h3><p><code>Dir()</code> 和 <code>Base()</code> 函数将一个路径名字符串分解成目录和文件名两部分。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Dir</span><span class=p>(</span><span class=nx>path</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Base</span><span class=p>(</span><span class=nx>path</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Dir</code> 返回路径中除去最后一个路径元素的部分，即<strong>该路径最后一个元素所在的目录</strong>。</p><ul><li>在使用 <code>Split</code> 去掉最后一个元素后，会简化路径并去掉末尾的斜杠。</li><li>如果路径是空字符串，会返回 &ldquo;."；</li><li>如果路径由 1 到多个斜杠后跟 0 到多个非斜杠字符组成，会返回 &ldquo;/"；</li><li>其他任何情况下都不会返回以斜杠结尾的路径。</li></ul><p><code>Base</code> 函数<strong>返回路径的最后一个元素</strong>。</p><ul><li>在提取元素前会去掉末尾的斜杠。</li><li>如果路径是 &ldquo;"，会返回 &ldquo;."；</li><li>如果路径是只有一个斜杆构成的，会返回 &ldquo;/"。</li></ul><p>比如，给定路径名 <code>/home/polaris/studygolang.go</code>，<code>Dir</code> 返回 <code>/home/polaris</code>，而 <code>Base</code> 返回 <code>studygolang.go</code>。</p><p>如果给定路径名 <code>/home/polaris/studygolang/</code>，<code>Dir</code> 返回 <code>/home/polaris/studygolang</code>（这与 Unix 中的 dirname 不一致，dirname 会返回 /home/polaris），而 <code>Base</code> 返回 <code>studygolang</code>。</p><blockquote><p>有人提出此问题，不过官方认为这不是问题，如果需要和 <code>dirname</code> 一样的功能，应该自己处理，比如在调用 <code>Dir</code> 之前，先将末尾的 <code>/</code> 去掉。</p></blockquote><h3 id=ext>Ext</h3><p>此外，<code>Ext</code> 可以获得路径中，文件名的扩展名。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Ext</span><span class=p>(</span><span class=nx>path</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Ext</code> 函数返回 <code>path</code> 文件扩展名。扩展名是路径中最后一个从 <code>.</code> 开始的部分，包括 <code>.</code>。如果该元素没有 <code>.</code> 会返回空字符串。</p><h2 id=相对路径和绝对路径>相对路径和绝对路径</h2><p>某个进程都会有当前工作目录（进程相关章节会详细介绍），一般的相对路径，就是针对进程当前工作目录而言的。当然，可以针对某个目录指定相对路径。</p><p>绝对路径，在 Unix 中，以 <code>/</code> 开始；在 Windows 下以某个盘符开始，比如 <code>C:\Program Files</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func IsAbs(path string) bool
</span></span></code></pre></td></tr></table></div></div><p><code>IsAbs</code> 返回路径是否是一个绝对路径。而</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Abs(path string) (string, error)
</span></span></code></pre></td></tr></table></div></div><p><code>Abs</code> 函数返回 <code>path</code> 代表的绝对路径，如果 <code>path</code> 不是绝对路径，会加入当前工作目录以使之成为绝对路径。因为硬链接的存在，不能保证返回的绝对路径是唯一指向该地址的绝对路径。在 <code>os.Getwd</code> 出错时，<code>Abs</code> 会返回该错误，一般不会出错，如果路径名长度超过系统限制，则会报错。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Rel(basepath, targpath string) (string, error)
</span></span></code></pre></td></tr></table></div></div><p><code>Rel</code> 函数返回一个相对路径，将 <code>basepath</code> 和该路径用路径分隔符连起来的新路径在词法上等价于 <code>targpath</code>。也就是说，<code>Join(basepath, Rel(basepath, targpath))</code> 等价于 <code>targpath</code>。如果成功执行，返回值总是相对于 <code>basepath</code> 的，即使 <code>basepath</code> 和 <code>targpath</code> 没有共享的路径元素。如果两个参数一个是相对路径而另一个是绝对路径，或者 <code>targpath</code> 无法表示为相对于 <code>basepath</code> 的路径，将返回错误。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Rel</span><span class=p>(</span><span class=s>&#34;/home/polaris/studygolang&#34;</span><span class=p>,</span> <span class=s>&#34;/home/polaris/studygolang/src/logic/topic.go&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Rel</span><span class=p>(</span><span class=s>&#34;/home/polaris/studygolang&#34;</span><span class=p>,</span> <span class=s>&#34;/data/studygolang&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Output:
</span></span></span><span class=line><span class=cl><span class=c1>// src/logic/topic.go &lt;nil&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// ../../../data/studygolang &lt;nil&gt;
</span></span></span></code></pre></td></tr></table></div></div><h2 id=13-路径的切分和拼接>1.3. 路径的切分和拼接</h2><p>对于一个常规文件路径，我们可以通过 <code>Split</code> 函数得到它的目录路径和文件名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Split(path string) (dir, file string)
</span></span></code></pre></td></tr></table></div></div><p><code>Split</code> 函数根据最后一个路径分隔符将路径 <code>path</code> 分隔为目录和文件名两部分（<code>dir</code> 和 <code>file</code>）。如果路径中没有路径分隔符，函数返回值 <code>dir</code> 为空字符串，<code>file</code> 等于 <code>path</code>；反之，如果路径中最后一个字符是 <code>/</code>，则 <code>dir</code> 等于 <code>path</code>，<code>file</code> 为空字符串。返回值满足 <code>path == dir+file</code>。<code>dir</code> 非空时，最后一个字符总是 <code>/</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// dir == /home/polaris/，file == studygolang
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=s>&#34;/home/polaris/studygolang&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// dir == /home/polaris/studygolang/，file == &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=s>&#34;/home/polaris/studygolang/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// dir == &#34;&#34;，file == studygolang
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=s>&#34;studygolang&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>相对路径到绝对路径的转变，需要经过路径的拼接。<code>Join</code> 用于将多个路径拼接起来，会根据情况添加路径分隔符。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Join(elem ...string) string
</span></span></code></pre></td></tr></table></div></div><p><code>Join</code> 函数可以将任意数量的路径元素放入一个单一路径里，会根据需要添加路径分隔符。结果是经过 <code>Clean</code> 的，所有的空字符串元素会被忽略。对于拼接路径的需求，我们应该总是使用 <code>Join</code> 函数来处理。</p><p>有时，我们需要分割 <code>PATH</code> 或 <code>GOPATH</code> 之类的环境变量（这些路径被特定于 <code>OS</code> 的列表分隔符连接起来），<code>filepath.SplitList</code> 就是这个用途：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func SplitList(path string) []string
</span></span></code></pre></td></tr></table></div></div><p>注意，与 <code>strings.Split</code> 函数的不同之处是：对 &ldquo;"，SplitList 返回[]string{}，而 <code>strings.Split</code> 返回 []string{&rdquo;"}。<code>SplitList</code> 内部调用的是 <code>strings.Split</code>。</p><h2 id=14-规整化路径>1.4. 规整化路径</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Clean(path string) string
</span></span></code></pre></td></tr></table></div></div><p><code>Clean</code> 函数通过单纯的词法操作返回和 <code>path</code> 代表同一地址的最短路径。</p><p>它会不断的依次应用如下的规则，直到不能再进行任何处理：</p><ol><li>将连续的多个路径分隔符替换为单个路径分隔符</li><li>剔除每一个 <code>.</code> 路径名元素（代表当前目录）</li><li>剔除每一个路径内的 <code>..</code> 路径名元素（代表父目录）和它前面的非 <code>..</code> 路径名元素</li><li>剔除开始于根路径的 <code>..</code> 路径名元素，即将路径开始处的 <code>/..</code> 替换为 <code>/</code>（假设路径分隔符是 <code>/</code>）</li></ol><p>返回的路径只有其代表一个根地址时才以路径分隔符结尾，如 Unix 的 <code>/</code> 或 Windows 的 <code>C:\</code>。</p><p>如果处理的结果是空字符串，Clean 会返回 <code>.</code>，代表当前路径。</p><h2 id=15-符号链接指向的路径名>1.5. 符号链接指向的路径名</h2><p>在上一节 <code>os</code> 包中介绍了 <code>Readlink</code>，可以读取符号链接指向的路径名。不过，如果原路径中又包含符号链接，<code>Readlink</code> 却不会解析出来。<code>filepath.EvalSymlinks</code> 会将所有路径的符号链接都解析出来。除此之外，它返回的路径，是直接可访问的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func EvalSymlinks(path string) (string, error)
</span></span></code></pre></td></tr></table></div></div><p>如果 <code>path</code> 或返回值是相对路径，则是相对于进程当前工作目录。</p><p><code>os.Readlink</code> 和 <code>filepath.EvalSymlinks</code> 区别示例程序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 在当前目录下创建一个 studygolang.txt 文件和一个 symlink 目录，在 symlink 目录下对 studygolang.txt 建一个符号链接 studygolang.txt.2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>EvalSymlinks</span><span class=p>(</span><span class=s>&#34;symlink/studygolang.txt.2&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nf>Readlink</span><span class=p>(</span><span class=s>&#34;symlink/studygolang.txt.2&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Ouput:
</span></span></span><span class=line><span class=cl><span class=c1>// studygolang.txt &lt;nil&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// ../studygolang.txt &lt;nil&gt;
</span></span></span></code></pre></td></tr></table></div></div><h2 id=16-文件路径匹配>1.6. 文件路径匹配</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Match(pattern, name string) (matched bool, err error)
</span></span></code></pre></td></tr></table></div></div><p><code>Match</code> 指示 <code>name</code> 是否和 shell 的文件模式匹配。模式语法如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>pattern</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>term</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>term</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=sc>&#39;*&#39;</span>         <span class=nx>匹配</span> <span class=mi>0</span> <span class=nx>或多个非路径分隔符的字符</span>
</span></span><span class=line><span class=cl>    <span class=sc>&#39;?&#39;</span>         <span class=nx>匹配</span> <span class=mi>1</span> <span class=nx>个非路径分隔符的字符</span>
</span></span><span class=line><span class=cl>    <span class=sc>&#39;[&#39;</span> <span class=p>[</span> <span class=sc>&#39;^&#39;</span> <span class=p>]</span> <span class=p>{</span> <span class=nx>character</span><span class=o>-</span><span class=k>range</span> <span class=p>}</span> <span class=sc>&#39;]&#39;</span>  
</span></span><span class=line><span class=cl>                  <span class=nx>字符组</span><span class=err>（</span><span class=nx>必须非空</span><span class=err>）</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span>           <span class=nx>匹配字符</span> <span class=nx>c</span><span class=err>（</span><span class=nx>c</span> <span class=o>!=</span> <span class=sc>&#39;*&#39;</span><span class=p>,</span> <span class=sc>&#39;?&#39;</span><span class=p>,</span> <span class=sc>&#39;\\&#39;</span><span class=p>,</span> <span class=sc>&#39;[&#39;</span><span class=err>）</span>
</span></span><span class=line><span class=cl>    <span class=sc>&#39;\\&#39;</span> <span class=nx>c</span>      <span class=nx>匹配字符</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl><span class=nx>character</span><span class=o>-</span><span class=k>range</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span>           <span class=nx>匹配字符</span> <span class=nx>c</span><span class=err>（</span><span class=nx>c</span> <span class=o>!=</span> <span class=sc>&#39;\\&#39;</span><span class=p>,</span> <span class=sc>&#39;-&#39;</span><span class=p>,</span> <span class=sc>&#39;]&#39;</span><span class=err>）</span>
</span></span><span class=line><span class=cl>    <span class=sc>&#39;\\&#39;</span> <span class=nx>c</span>      <span class=nx>匹配字符</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl>    <span class=nx>lo</span> <span class=sc>&#39;-&#39;</span> <span class=nx>hi</span>   <span class=nx>匹配区间</span><span class=p>[</span><span class=nx>lo</span><span class=p>,</span> <span class=nx>hi</span><span class=p>]</span><span class=nx>内的字符</span>
</span></span></code></pre></td></tr></table></div></div><p>匹配要求 <code>pattern</code> 必须和 <code>name</code> 全匹配上，不只是子串。在 Windows 下转义字符被禁用。</p><p><code>Match</code> 函数很少使用，搜索了一遍，标准库没有用到这个函数。而 <code>Glob</code> 函数在模板标准库中被用到了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Glob(pattern string) (matches []string, err error)
</span></span></code></pre></td></tr></table></div></div><p><code>Glob</code> 函数返回所有匹配了 模式字符串 <code>pattern</code> 的文件列表或者 nil（如果没有匹配的文件）。<code>pattern</code> 的语法和 <code>Match</code> 函数相同。<code>pattern</code> 可以描述多层的名字，如 <code>/usr/*/bin/ed</code>（假设路径分隔符是 <code>/</code>）。</p><p>注意，<code>Glob</code> 会忽略任何文件系统相关的错误，如读目录引发的 I/O 错误。唯一的错误和 <code>Match</code> 一样，在 <code>pattern</code> 不合法时，返回 <code>filepath.ErrBadPattern</code>。返回的结果是根据文件名字典顺序进行了排序的。</p><p><code>Glob</code> 的常见用法，是读取某个目录下所有的文件，比如写单元测试时，读取 <code>testdata</code> 目录下所有测试数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filepath.Glob(&#34;testdata/*.input&#34;)
</span></span></code></pre></td></tr></table></div></div><h2 id=17-遍历目录>1.7. 遍历目录</h2><p>在介绍 <code>os</code> 时，讲解了读取目录的方法，并给出了一个遍历目录的示例。在 <code>filepath</code> 中，提供了 <code>Walk</code> 函数，用于遍历目录树。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func Walk(root string, walkFn WalkFunc) error
</span></span></code></pre></td></tr></table></div></div><p><code>Walk</code> 函数会遍历 <code>root</code> 指定的目录下的文件树，对每一个该文件树中的目录和文件都会调用 <code>walkFn</code>，包括 <code>root</code> 自身。所有访问文件 / 目录时遇到的错误都会传递给 <code>walkFn</code> 过滤。文件是按字典顺序遍历的，这让输出更漂亮，但也导致处理非常大的目录时效率会降低。<code>Walk</code> 函数不会遍历文件树中的符号链接（快捷方式）文件包含的路径。</p><p><code>walkFn</code> 的类型 <code>WalkFunc</code> 的定义如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type WalkFunc func(path string, info os.FileInfo, err error) error
</span></span></code></pre></td></tr></table></div></div><p><code>Walk</code> 函数对每一个文件 / 目录都会调用 <code>WalkFunc</code> 函数类型值。调用时 <code>path</code> 参数会包含 <code>Walk</code> 的 <code>root</code> 参数作为前缀；就是说，如果 <code>Walk</code> 函数的 <code>root</code> 为 &ldquo;dir&rdquo;，该目录下有文件 &ldquo;a&rdquo;，将会使用 &ldquo;dir/a&rdquo; 作为调用 <code>walkFn</code> 的参数。<code>walkFn</code> 参数被调用时的 <code>info</code> 参数是 <code>path</code> 指定的地址（文件 / 目录）的文件信息，类型为 <code>os.FileInfo</code>。</p><p>如果遍历 <code>path</code> 指定的文件或目录时出现了问题，传入的参数 <code>err</code> 会描述该问题，<code>WalkFunc</code> 类型函数可以决定如何去处理该错误（<code>Walk</code> 函数将不会深入该目录）；如果该函数返回一个错误，<code>Walk</code> 函数的执行会中止；只有一个例外，如果 <code>Walk</code> 的 <code>walkFn</code> 返回值是 <code>SkipDir</code>，将会跳过该目录的内容而 <code>Walk</code> 函数照常执行处理下一个文件。</p><p>和 <code>os</code> 遍历目录树的示例对应，使用 <code>Walk</code> 遍历目录树的示例程序在 <a href=http://books.studygolang.com/The-Golang-Standard-Library-by-Example/code/src/chapter06/filepath/walk/main.go target=_blank rel="external nofollow noopener noreferrer">walk</a>，程序简单很多。</p><h2 id=18-windows-起作用的函数>1.8. Windows 起作用的函数</h2><p><code>filepath</code> 中有三个函数：<code>VolumeName</code>、<code>FromSlash</code> 和 <code>ToSlash</code>，针对非 Unix 平台的。</p><h2 id=19-关于-path-包>1.9. 关于 path 包</h2><p><code>path</code> 包提供了对 <code>/</code> 分隔的路径的实用操作函数。</p><p>在 Unix 中，路径的分隔符是 <code>/</code>，但 Windows 是 <code>\</code>。在使用 <code>path</code> 包时，应该总是使用 <code>/</code>，不论什么系统。</p><p><code>path</code> 包中提供的函数，<code>filepath</code> 都有提供，功能类似，但实现不同。</p><p>一般应该总是使用 <code>filepath</code> 包，而不是 <code>path</code> 包。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-08-13 09:03:08">更新于 2023-08-13</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/filepath/ data-title="Go filepath 标准库" data-hashtags="Go 库"><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/filepath/ data-hashtag="Go 库"><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/filepath/ data-title="Go filepath 标准库"><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/Notes/tags/go-%E5%BA%93/>Go 库</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/time/ class=prev rel=prev title="Go time 标准库"><i class="fa-solid fa-angle-left fa-fw"></i>Go time 标准库</a>
<a href=/Notes/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93/math/ class=next rel=next title="Go math 标准库">Go math 标准库<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022 - 2023</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"7I9AMOLA4S",algoliaIndex:"Notes",algoliaSearchKey:"3c1638dfe9f4d49a59d81ff6943416b8",highlightTag:"em",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>