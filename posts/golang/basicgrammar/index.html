<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Go 基础语法 - 伤心肠粉的酱油碟子</title><meta name=author content><meta name=author-link content><meta name=description content="Golang Go is an open source programming language supported by Google Easy to learn and get started with Built-in concurrency and a robust standard library Growing ecosystem of partners, communities, and tools 安装 下载地址：h"><meta name=keywords content="Theme,Hugo"><meta itemprop=name content="Go 基础语法"><meta itemprop=description content="Golang Go is an open source programming language supported by Google Easy to learn and get started with Built-in concurrency and a robust standard library Growing ecosystem of partners, communities, and tools 安装 下载地址：h"><meta itemprop=datePublished content="2022-02-08T00:00:00+00:00"><meta itemprop=dateModified content="2022-08-15T10:22:35+00:00"><meta itemprop=wordCount content="23140"><meta itemprop=image content="https://trouvaille0198.github.io/logo.png"><meta itemprop=keywords content><meta property="og:title" content="Go 基础语法"><meta property="og:description" content="Golang Go is an open source programming language supported by Google Easy to learn and get started with Built-in concurrency and a robust standard library Growing ecosystem of partners, communities, and tools 安装 下载地址：h"><meta property="og:type" content="article"><meta property="og:url" content="https://trouvaille0198.github.io/Notes/posts/golang/basicgrammar/"><meta property="og:image" content="https://trouvaille0198.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-15T10:22:35+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://trouvaille0198.github.io/logo.png"><meta name=twitter:title content="Go 基础语法"><meta name=twitter:description content="Golang Go is an open source programming language supported by Google Easy to learn and get started with Built-in concurrency and a robust standard library Growing ecosystem of partners, communities, and tools 安装 下载地址：h"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://trouvaille0198.github.io/Notes/posts/golang/basicgrammar/><link rel=prev href=https://trouvaille0198.github.io/Notes/posts/linux/useful/install/><link rel=next href=https://trouvaille0198.github.io/Notes/posts/%E5%88%B7%E9%A2%98/array/%E6%8E%92%E5%BA%8F/56.-%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/><link rel=stylesheet href=/Notes/lib/normalize/normalize.min.css><link rel=stylesheet href=/Notes/css/style.min.css><link rel=stylesheet href=/Notes/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/Notes/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go 基础语法","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/basicgrammar\/"},"genre":"posts","wordcount":23140,"url":"https:\/\/trouvaille0198.github.io\/Notes\/posts\/golang\/basicgrammar\/","datePublished":"2022-02-08T00:00:00+00:00","dateModified":"2022-08-15T10:22:35+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"MelonCholi"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/Notes/ title=伤心肠粉的酱油碟子><span class=header-title-text>伤心肠粉</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/Notes/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/Notes/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/Notes/posts/>文章</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Go 基础语法</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle"></i>
MelonCholi</span></span>
<span class=post-category>收录于 <a href=/Notes/categories/golang/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Golang</a></span></div><div class=post-meta-line><span title="2022-02-08 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-02-08>2022-02-08</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 23140 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 47 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png data-srcset="https://booklovinmamas.com/wp-content/uploads/2017/09/go.png, https://booklovinmamas.com/wp-content/uploads/2017/09/go.png 1.5x, https://booklovinmamas.com/wp-content/uploads/2017/09/go.png 2x" data-sizes=auto alt=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png title=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#安装>安装</a></li><li><a href=#基本结构>基本结构</a><ul><li><a href=#运行>运行</a></li><li><a href=#基本结构-1>基本结构</a></li><li><a href=#一些命令>一些命令</a><ul><li><a href=#go-build>go build</a></li><li><a href=#go-clean>go clean</a></li><li><a href=#go-get>go get</a></li><li><a href=#go-install>go install</a></li><li><a href=#go-test>go test</a></li></ul></li></ul></li><li><a href=#项目>项目</a><ul><li><a href=#gopath>GOPATH</a><ul><li><a href=#编写应用包例>编写应用包例</a></li><li><a href=#编译安装应用包>编译安装应用包</a></li><li><a href=#编译程序>编译程序</a></li></ul></li><li><a href=#go-module>Go Module</a><ul><li><a href=#基本操作>基本操作</a></li><li><a href=#更新依赖>更新依赖</a></li></ul></li></ul></li><li><a href=#数据类型>数据类型</a><ul><li><a href=#变量-variable>变量 Variable</a></li><li><a href=#常量>常量</a></li><li><a href=#内置基本类型>内置基本类型</a></li><li><a href=#字符串>字符串</a><ul><li><a href=#utf-8>utf-8</a></li><li><a href=#特性>特性</a></li><li><a href=#处理中文>处理中文</a></li><li><a href=#修改字符串>修改字符串</a></li></ul></li><li><a href=#错误类型>错误类型</a></li><li><a href=#数据类型之间的转换>数据类型之间的转换</a></li><li><a href=#数组-array>数组 array</a></li><li><a href=#切片-slice>切片 slice</a><ul><li><a href=#性质>性质</a></li><li><a href=#声明>声明</a></li><li><a href=#使用>使用</a></li><li><a href=#内置函数>内置函数</a></li><li><a href=#小例子>小例子</a></li></ul></li><li><a href=#字典--键值对map>字典 / 键值对，map</a><ul><li><a href=#声明-1>声明</a></li><li><a href=#特性-1>特性</a></li><li><a href=#删除>删除</a></li></ul></li><li><a href=#make-new-操作>make, new 操作</a></li><li><a href=#零值>零值</a></li><li><a href=#指针-pointer>指针 pointer</a></li><li><a href=#位运算>位运算</a><ul><li><a href=#按位与>按位与</a></li><li><a href=#按位或>按位或</a></li><li><a href=#异或>异或</a></li><li><a href=#取反>取反</a></li><li><a href=#左移>左移</a></li><li><a href=#右移>右移</a></li></ul></li></ul></li><li><a href=#流程控制>流程控制</a><ul><li><a href=#条件语句-if-else>条件语句 if else</a></li><li><a href=#goto>goto</a></li><li><a href=#switch>switch</a><ul><li><a href=#switch-用于判断变量类型><code>switch</code> 用于判断变量类型</a></li><li><a href=#啊>啊</a></li></ul></li><li><a href=#for-循环>for 循环</a></li></ul></li><li><a href=#函数-functions>函数 functions</a><ul><li><a href=#参数与返回值>参数与返回值</a></li><li><a href=#变参->变参 <code>...</code></a></li><li><a href=#延迟语句-defer>延迟语句 defer</a></li><li><a href=#函数作为值类型>函数作为值、类型</a></li><li><a href=#闭包-closures>闭包 Closures</a></li><li><a href=#错误处理-error-handling>错误处理 error handling</a><ul><li><a href=#panic-和-recover>panic 和 recover</a></li></ul></li><li><a href=#main-函数和-init-函数><code>main</code> 函数和 <code>init</code> 函数</a></li><li><a href=#程序的初始化过程>程序的初始化过程</a></li><li><a href=#import>import</a><ul><li><a href=#点操作>点操作</a></li><li><a href=#别名操作>别名操作</a></li><li><a href=#_-操作><code>_</code> 操作</a></li></ul></li></ul></li><li><a href=#结构体方法和接口>结构体，方法和接口</a><ul><li><a href=#结构体-struct>结构体 struct</a><ul><li><a href=#匿名字段>匿名字段</a></li></ul></li><li><a href=#方法-methods>方法 methods</a><ul><li><a href=#值类型调用与指针类型调用>值类型调用与指针类型调用</a></li><li><a href=#普通函数与方法的区别>普通函数与方法的区别</a></li><li><a href=#method-继承>method 继承</a></li><li><a href=#method-重写>method 重写</a></li><li><a href=#interface-函数参数>interface 函数参数</a></li></ul></li><li><a href=#接口-interfaces>接口 interfaces</a></li><li><a href=#空接口>空接口</a></li><li><a href=#类型断言>类型断言</a></li></ul></li><li><a href=#并发编程-goroutine>并发编程 goroutine</a><ul><li><a href=#sync>sync</a></li><li><a href=#channel>channel</a></li></ul></li><li><a href=#单元测试-unit-test>单元测试 (unit test)</a></li><li><a href=#包-package-和模块-modules>包 (Package) 和模块 (Modules)</a><ul><li><a href=#package>Package</a></li><li><a href=#modules>Modules</a></li></ul></li><li><a href=#一些技巧和特性>一些技巧和特性</a><ul><li><a href=#零散的特性>零散的特性</a></li><li><a href=#分组声明>分组声明</a></li><li><a href=#iota-枚举>iota 枚举</a></li><li><a href=#变量函数命名原则>变量、函数命名原则</a></li><li><a href=#切片中删除元素>切片中删除元素</a><ul><li><a href=#从开头位置删除>从开头位置删除</a></li><li><a href=#从中间位置删除>从中间位置删除</a></li><li><a href=#从尾部删除>从尾部删除</a></li></ul></li><li><a href=#类型选择>类型选择</a></li><li><a href=#判断-map-中是否存在某键>判断 map 中是否存在某键</a></li><li><a href=#init-函数>init 函数</a></li><li><a href=#runtimecaller>runtime.Caller()</a></li><li><a href=#使用空白标识符进行接口检查>使用空白标识符进行接口检查</a></li><li><a href=#make-和-new-的区别><code>make</code> 和 <code>new</code> 的区别</a></li><li><a href=#解决-go-的相对路径问题>解决 Go 的相对路径问题</a><ul><li><a href=#获取当前可执行文件路径>获取当前可执行文件路径</a></li><li><a href=#增加-osgetwd-进行多层判断>增加 <code>os.Getwd()</code> 进行多层判断</a></li><li><a href=#配置全局系统变量>配置全局系统变量</a></li></ul></li><li><a href=#包装错误>包装错误</a></li><li><a href=#不要忘记为-iota-指定一种类型>不要忘记为 <code>iota</code> 指定一种类型</a></li><li><a href=#防止结构体字段用纯值方式初始化添加-_-struct--字段>防止结构体字段用纯值方式初始化，添加 <code>_ struct {}</code> 字段：</a></li><li><a href=#二维数组的创建方法>二维数组的创建方法</a></li><li><a href=#集合的实现>集合的实现</a></li><li><a href=#字符串拼接的-7-种姿势>字符串拼接的 7 种姿势</a><ul><li><a href=#string-concat>String Concat</a></li><li><a href=#string-sprintf>String Sprintf</a></li><li><a href=#string-join>String Join</a></li><li><a href=#buffer-write>Buffer Write</a></li><li><a href=#bytes-append>Bytes Append</a></li><li><a href=#string-copy>String Copy</a></li><li><a href=#string-builder>String Builder</a></li><li><a href=#性能测试>性能测试</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=golang>Golang</h1><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png data-srcset="https://booklovinmamas.com/wp-content/uploads/2017/09/go.png, https://booklovinmamas.com/wp-content/uploads/2017/09/go.png 1.5x, https://booklovinmamas.com/wp-content/uploads/2017/09/go.png 2x" data-sizes=auto alt=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png title=img></p><ul><li>Go is an open source programming language supported by Google</li><li>Easy to learn and get started with</li><li>Built-in concurrency and a robust standard library</li><li>Growing ecosystem of partners, communities, and tools</li></ul><h2 id=安装>安装</h2><p>下载地址：https://go.dev/dl/</p><p>使用 Linux</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ wget https://studygolang.com/dl/golang/go1.13.6.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>$ tar -zxvf go1.13.6.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>$ sudo mv go /usr/local/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ go version
</span></span><span class=line><span class=cl>go version go1.13.6 linux/amd64
</span></span></code></pre></td></tr></table></div></div><p>从 <code>Go 1.11</code> 版本开始，Go 提供了 Go Modules 的机制，推荐设置以下环境变量，第三方包的下载将通过国内镜像，避免出现官方网址被屏蔽的问题。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ go env -w GOPROXY=https://goproxy.cn,direct
</span></span></code></pre></td></tr></table></div></div><p>或在 <code>~/.profile</code> 中设置环境变量</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>export GOPROXY=https://goproxy.cn
</span></span></code></pre></td></tr></table></div></div><h2 id=基本结构>基本结构</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=运行>运行</h3><p>执行 <code>go run main.go</code> 或 <code>go run .</code>，将会输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go run .
</span></span><span class=line><span class=cl>Hello World!
</span></span></code></pre></td></tr></table></div></div><p><code>go run main.go</code>，其实是 2 步：</p><ul><li>go build main.go：编译成二进制可执行程序</li><li>./main：执行该程序</li></ul><blockquote><p>如果强制启用了 Go Modules 机制，即环境变量中设置了 GO111MODULE=on，则需要先初始化模块 go mod init hello
否则会报错误：go: cannot find main module; see ‘go help modules’</p></blockquote><p>或者直接编译生成可执行文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go build main.go 
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl>go build -o hello.exe ./main.go  <span class=c1># 指定可执行文件名</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=基本结构-1>基本结构</h3><ul><li><code>package main</code>：声明了 main.go 所在的包，Go 语言中使用包来组织代码。一般一个文件夹即一个包，包内可以暴露类型或方法供其他包使用。</li><li><code>import “fmt”</code>：fmt 是 Go 语言的一个标准库/包，用来处理标准输入输出。</li><li><code>func main</code>：main 函数是整个程序的入口，main 函数所在的包名也必须为 <code>main</code>。</li><li><code>fmt.Println(“Hello World!”)</code>：调用 fmt 包的 Println 方法，打印出 “Hello World!”</li></ul><h3 id=一些命令>一些命令</h3><h4 id=go-build>go build</h4><p>这个命令主要用于<strong>编译</strong>代码。在包的编译过程中，若有必要，会同时编译与之相关联的包。</p><ul><li><p>如果是普通应用包，执行后不会产生任何文件。如果你需要在 <code>$GOPATH/pkg</code>下生成相应的文件，那就得执行 <code>go install</code>。</p></li><li><p>如果是 <code>main</code> 包，执行后会在当前目录下生成一个可执行文件。如果你需要在 <code>$GOPATH/bin</code> 下生成相应的文件，需要执行 <code>go install</code>，或者使用 <code>go build -o 路径/a.exe</code>。</p></li><li><p>如果某个项目文件夹下有多个文件，而你只想编译某个文件，就可在<code>go build</code>之后加上文件名，例如<code>go build a.go</code>；<code>go build</code> 命令默认会编译当前目录下的所有 go 文件。</p></li><li><p>你也可以指定编译输出的文件名。</p><ul><li>例如 <code>go build -o hello.exe ./main.go</code></li></ul></li><li><p>go build 会忽略目录下以 “_” 或 “.” 开头的 go 文件。</p></li><li><p>如果你的源代码针对不同的操作系统需要不同的处理，那么你可以根据不同的操作系统后缀来命名文件。例如有一个读取数组的程序，它对于不同的操作系统可能有如下几个源文件：</p><p>array_linux.go, array_darwin.go, array_windows.go, array_freebsd.go</p><p><code>go build</code> 的时候会选择性地编译以系统名结尾的文件（Linux、Darwin、Windows、Freebsd）。例如Linux 系统下面编译只会选择 array_linux.go 文件，其它系统命名后缀文件全部忽略。</p></li></ul><p><strong>参数</strong></p><ul><li><code>-o</code> 指定输出的文件名，可以带上路径，例如 <code>go build -o a/b/c</code></li><li><code>-i</code> 安装相应的包，编译+<code>go install</code></li><li><code>-a</code> 更新全部已经是最新的包的，但是对标准包不适用</li><li><code>-n</code> 把需要执行的编译命令打印出来，但是不执行，这样就可以很容易的知道底层是如何运行的</li><li><code>-p n</code> 指定可以并行可运行的编译数目，默认是CPU数目</li><li><code>-race</code> 开启编译的时候自动检测数据竞争的情况，目前只支持64位的机器</li><li><code>-v</code> 打印出来我们正在编译的包名</li><li><code>-work</code> 打印出来编译时候的临时文件夹名称，并且如果已经存在的话就不要删除</li><li><code>-x</code> 打印出来执行的命令，其实就是和<code>-n</code>的结果类似，只是这个会执行</li><li><code>-ccflags 'arg list'</code> 传递参数给5c, 6c, 8c 调用</li><li><code>-compiler name</code> 指定相应的编译器，gccgo还是gc</li><li><code>-gccgoflags 'arg list'</code> 传递参数给gccgo编译连接调用</li><li><code>-gcflags 'arg list'</code> 传递参数给5g, 6g, 8g 调用</li><li><code>-installsuffix suffix</code> 为了和默认的安装包区别开来，采用这个前缀来重新安装那些依赖的包，<code>-race</code>的时候默认已经是<code>-installsuffix race</code>,大家可以通过<code>-n</code>命令来验证</li><li><code>-ldflags 'flag list'</code> 传递参数给 5l, 6l, 8l 调用</li><li><code>-tags 'tag list'</code> 设置在编译的时候可以适配的那些 tag</li></ul><h4 id=go-clean>go clean</h4><p>移除当前源码包和关联源码包里面编译生成的文件。这些文件包括</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>_obj/            旧的object目录，由Makefiles遗留
</span></span><span class=line><span class=cl>_test/           旧的test目录，由Makefiles遗留
</span></span><span class=line><span class=cl>_testmain.go     旧的gotest文件，由Makefiles遗留
</span></span><span class=line><span class=cl>test.out         旧的test记录，由Makefiles遗留
</span></span><span class=line><span class=cl>build.out        旧的test记录，由Makefiles遗留
</span></span><span class=line><span class=cl>*.[568ao]        object文件，由Makefiles遗留
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DIR(.exe)        由go build产生
</span></span><span class=line><span class=cl>DIR.test(.exe)   由go test -c产生
</span></span><span class=line><span class=cl>MAINFILE(.exe)   由go build MAINFILE.go产生
</span></span><span class=line><span class=cl>*.so             由 SWIG 产生
</span></span></code></pre></td></tr></table></div></div><p>可以利用这个命令清除编译文件，然后 git 递交源码，在本机测试的时候这些编译文件都是和系统相关的，但是对于源码管理来说没必要。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go clean -i -n
</span></span><span class=line><span class=cl><span class=nb>cd</span> /Users/astaxie/develop/gopath/src/mathapp
</span></span><span class=line><span class=cl>rm -f mathapp mathapp.exe mathapp.test mathapp.test.exe app app.exe
</span></span><span class=line><span class=cl>rm -f /Users/astaxie/develop/gopath/bin/mathapp
</span></span></code></pre></td></tr></table></div></div><p><strong>参数</strong></p><ul><li><code>-i</code> 清除关联的安装的包和可运行文件，也就是通过 go install 安装的文件</li><li><code>-n</code> 把需要执行的清除命令打印出来，但是不执行，这样就可以很容易的知道底层是如何运行的</li><li><code>-r</code> 循环的清除在 import 中引入的包</li><li><code>-x</code> 打印出来执行的详细命令，其实就是 <code>-n</code> 打印的执行版本</li></ul><h4 id=go-get>go get</h4><p>这个命令是用来动态获取远程代码包的，目前支持的有 BitBucket、GitHub、Google Code 和 Launchpad。</p><p>这个命令在内部实际上分成了两步操作</p><ol><li>下载源码包</li><li>执行 <code>go install</code></li></ol><p>下载源码包的 go 工具会自动根据不同的域名调用不同的源码工具，对应关系如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>BitBucket (Mercurial Git)
</span></span><span class=line><span class=cl>GitHub (Git)
</span></span><span class=line><span class=cl>Google Code Project Hosting (Git, Mercurial, Subversion)
</span></span><span class=line><span class=cl>Launchpad (Bazaar)
</span></span></code></pre></td></tr></table></div></div><p>所以为了 <code>go get</code> 能正常工作，你必须确保安装了合适的源码管理工具，并同时把这些命令加入你的 PATH 中。</p><p><strong>参数</strong></p><ul><li><code>-d</code> 只下载不安装</li><li><code>-f</code> 只有在你包含了 <code>-u</code> 参数的时候才有效，不让 <code>-u</code> 去验证 import 中的每一个都已经获取了，这对于本地fork 的包特别有用</li><li><code>-fix</code> 在获取源码之后先运行 fix，然后再去做其他的事情</li><li><code>-t</code> 同时也下载需要为运行测试所需要的包</li><li><code>-u</code> 强制使用网络去更新包和它的依赖包</li><li><code>-v</code> 显示执行的命令</li></ul><h4 id=go-install>go install</h4><p>这个命令在内部实际上分成了两步操作：第一步是生成结果文件(可执行文件或者 .a 包)，第二步会把编译好的结果移到 <code>$GOPATH/pkg</code> 或者 <code>$GOPATH/bin</code>。</p><p>参数支持 <code>go build</code> 的编译参数。只要记住一个参数 <code>-v</code> 就好了，这个随时随地的可以查看底层的执行信息。</p><h4 id=go-test>go test</h4><p>执行这个命令，会自动读取源码目录下面名为 <code>*_test.go</code> 的文件，生成并运行测试用的可执行文件。</p><p>输出的信息类似</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ok   archive/tar   0.011s
</span></span><span class=line><span class=cl>FAIL archive/zip   0.022s
</span></span><span class=line><span class=cl>ok   compress/gzip 0.033s
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>默认的情况下，不需要任何的参数，它会自动把你源码包下面所有 test 文件测试完毕</p><p><strong>参数</strong></p><ul><li><code>-bench regexp</code> 执行相应的 benchmarks，例如 <code>-bench=.</code></li><li><code>-cover</code> 开启测试覆盖率</li><li><code>-run regexp</code> 只运行 regexp 匹配的函数，例如 <code>-run=Array</code> 那么就执行包含有 Array 开头的函数</li><li><code>-v</code> 显示测试的详细命令</li></ul><h2 id=项目>项目</h2><h3 id=gopath>GOPATH</h3><p>go 命令依赖一个重要的环境变量：$GOPATH</p><blockquote><p>Windows 系统中环境变量的形式为 <code>%GOPATH%</code></p><p>GOPATH 允许多个目录，当有多个目录时，请注意分隔符，Windows 是分号，Linux 是冒号，当有多个 GOPATH 时，默认会将 go get 的内容放在第一个目录下</p></blockquote><p>$GOPATH 目录有三个子目录：</p><ul><li>src 存放源代码（比如：.go .c .h .s等）</li><li>pkg 编译后生成的文件（比如：.a）</li><li>bin 编译后生成的可执行文件</li></ul><p>GOPATH 下的 src 目录就是接下来开发程序的主要目录，所有的源码都是放在这个目录下面。一般情况下，一个文件夹就是一个项目</p><ul><li>例如: $GOPATH/src/mymath 表示 mymath 是个应用包或者可执行应用（根据 package 是 main 还是其他来决定，main 的话就是可执行应用）</li><li>允许多级目录，例如在 src 下面新建了目录 $GOPATH/src/github.com/astaxie/beedb 那么这个包路径就是 &ldquo;github.com/astaxie/beedb&rdquo;，包名称是最后一个目录 beedb</li></ul><p><strong>文件结构举例</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bin/
</span></span><span class=line><span class=cl>	mathapp
</span></span><span class=line><span class=cl>pkg/
</span></span><span class=line><span class=cl>	平台名/ 如：darwin_amd64、linux_amd64
</span></span><span class=line><span class=cl>		 mymath.a
</span></span><span class=line><span class=cl>		 github.com/
</span></span><span class=line><span class=cl>			  astaxie/
</span></span><span class=line><span class=cl>				   beedb.a
</span></span><span class=line><span class=cl>src/	
</span></span><span class=line><span class=cl>	mathapp
</span></span><span class=line><span class=cl>		  main.go
</span></span><span class=line><span class=cl>	mymath/
</span></span><span class=line><span class=cl>		  sqrt.go
</span></span><span class=line><span class=cl>	github.com/
</span></span><span class=line><span class=cl>		   astaxie/
</span></span><span class=line><span class=cl>				beedb/
</span></span><span class=line><span class=cl>					beedb.go
</span></span><span class=line><span class=cl>					util.go
</span></span></code></pre></td></tr></table></div></div><h4 id=编写应用包例>编写应用包例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> <span class=nv>$GOPATH</span>/src
</span></span><span class=line><span class=cl>mkdir mymath
</span></span></code></pre></td></tr></table></div></div><p>新建文件 sqrt.go，内容如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// $GOPATH/src/mymath/sqrt.go源码如下：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>mymath</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Sqrt</span><span class=p>(</span><span class=nx>x</span> <span class=kt>float64</span><span class=p>)</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>z</span> <span class=o>:=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>1000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>z</span> <span class=o>-=</span> <span class=p>(</span><span class=nx>z</span><span class=o>*</span><span class=nx>z</span> <span class=o>-</span> <span class=nx>x</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>z</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这样 sqrt 应用包目录和代码已经新建完毕</p><blockquote><p>建议 package 的名称和目录名保持一致</p></blockquote><h4 id=编译安装应用包>编译安装应用包</h4><ol><li>在任意的目录执行 <code>go install [pkg_name]</code></li><li>进入对应的应用包目录，然后执行 <code>go install</code>，即完成对应应用包的安装</li></ol><p>在 pkg 目录可以看到安装好的应用包（.a 结尾）</p><h4 id=编译程序>编译程序</h4><p>进入该应用目录，然后执行 <code>go build</code>，将在此目录下生成一个同名可执行文件</p><p>进入该目录，执行 <code>go install</code>，将在 $GOPATH/bin/ 下生成一个同名可执行文件</p><p>在命令行输入同名就能运行</p><h3 id=go-module>Go Module</h3><h4 id=基本操作>基本操作</h4><p>初始化</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-v data-lang=v><span class=line><span class=cl><span class=k>go</span> <span class=nv>mod</span> <span class=nv>init</span> <span class=p>[</span><span class=na>module</span> <span class=na>名称</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>检测和清理依赖</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>go mod tidy
</span></span></code></pre></td></tr></table></div></div><p>执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>run</span> <span class=nx>XX</span><span class=p>.</span><span class=k>go</span>
</span></span></code></pre></td></tr></table></div></div><p>第一次执行时，go mod 会自动查找依赖自动下载</p><blockquote><p>go module 安装 package 的原則是先拉最新的 release tag，若无 tag 则拉最新的commit</p><p>go 会自动生成一个 go.sum 文件来记录 dependency tree</p></blockquote><p>安装指定包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>go get -v github.com/go-ego/gse@v0.60.0-rc4.2
</span></span></code></pre></td></tr></table></div></div><p>检查可以升级的 package</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>go list -m -u all
</span></span></code></pre></td></tr></table></div></div><p>下载依赖文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>go mod download
</span></span></code></pre></td></tr></table></div></div><h4 id=更新依赖>更新依赖</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>go get -u
</span></span></code></pre></td></tr></table></div></div><p>更新指定包依赖:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>go get -u github.com/go-ego/gse
</span></span></code></pre></td></tr></table></div></div><p>指定版本:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>go get -u github/com/go-ego/gse@v0.60.0-rc4.2
</span></span></code></pre></td></tr></table></div></div><p>替换无法直接获取的 pkg</p><p>modules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nf>replace</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>golang</span><span class=p>.</span><span class=nx>org</span><span class=o>/</span><span class=nx>x</span><span class=o>/</span><span class=nx>crypto</span> <span class=nx>v0</span><span class=mf>.0.0</span><span class=o>-</span><span class=mi>20190313024323</span><span class=o>-</span><span class=nx>a1f597ede03a</span> <span class=p>=&gt;</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>golang</span><span class=o>/</span><span class=nx>crypto</span> <span class=nx>v0</span><span class=mf>.0.0</span><span class=o>-</span><span class=mi>20190313024323</span><span class=o>-</span><span class=nx>a1f597ede03a</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>使用七牛的镜像源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>env</span> <span class=o>-</span><span class=nx>w</span> <span class=nx>GOPROXY</span><span class=p>=</span><span class=nx>https</span><span class=p>:</span><span class=c1>//goproxy.cn
</span></span></span></code></pre></td></tr></table></div></div><h2 id=数据类型>数据类型</h2><h3 id=变量-variable>变量 Variable</h3><p>Go 语言是<strong>静态类型</strong>的，变量声明时必须明确变量的类型。</p><p><strong>Go 语言的类型在变量后面</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>a</span> <span class=kt>int</span> <span class=c1>// 如果没有赋值，默认为0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>a</span> <span class=kt>int</span> <span class=p>=</span> <span class=mi>1</span> <span class=c1>// 声明时赋值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>a</span> <span class=p>=</span> <span class=mi>1</span> <span class=c1>// 声明时赋值
</span></span></span></code></pre></td></tr></table></div></div><p><code>var a = 1</code>，因为 1 是 int 类型的，所以赋值时，a 自动被确定为 int 类型，所以类型名可以省略不写，这种方式还有一种更简单的表达：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>msg</span> <span class=o>:=</span> <span class=s>&#34;Hello World!&#34;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>:=</code> 只能用在函数内部；在函数外部使用则会无法编译通过，所以一般用 <code>var</code> 方式来定义全局变量。</p></blockquote><p><code>_</code>（下划线）是个特殊的变量名，任何赋予它的值都会被丢弃。在这个例子中，我们将值 <code>35</code> 赋予 <code>b</code>，并同时丢弃 <code>34</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>_</span><span class=p>,</span> <span class=nx>b</span> <span class=o>:=</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>35</span>
</span></span></code></pre></td></tr></table></div></div><p>Go 对于已声明但未使用的变量会在编译阶段报错</p><h3 id=常量>常量</h3><p>常量可定义为数值、布尔值或字符串等类型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span> <span class=nx>constantName</span> <span class=p>=</span> <span class=nx>value</span>
</span></span><span class=line><span class=cl><span class=c1>//如果需要，也可以明确指定常量的类型：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>Pi</span> <span class=kt>float32</span> <span class=p>=</span> <span class=mf>3.1415926</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// example
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>Pi</span> <span class=p>=</span> <span class=mf>3.1415926</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>i</span> <span class=p>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>MaxThread</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>prefix</span> <span class=p>=</span> <span class=s>&#34;astaxie_&#34;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Go 常量和一般程序语言不同的是，可以指定相当多的小数位数 (例如 200 位)， 若指定给 float32 自动缩短为 32bit，指定给 float64 自动缩短为 64bit</p></blockquote><h3 id=内置基本类型>内置基本类型</h3><p>Go 支持如下内置基本类型：</p><ul><li>一种内置<strong>布尔类型</strong>：<code>bool</code>。</li><li>11 种内置<strong>整数类型</strong>：<code>int8</code>、<code>uint8</code>、<code>int16</code>、<code>uint16</code>、<code>int32</code>、<code>uint32</code>、<code>int64</code>、<code>uint64</code>、<code>int</code>、<code>uint</code> 和 <code>uintptr</code>。</li><li>两种内置<strong>浮点数类型</strong>：<code>float32</code> 和 <code>float64</code>。</li><li>两种内置<strong>复数类型</strong>：<code>complex64</code> 和 <code>complex128</code>。</li><li>一种内置<strong>字符串类型</strong>：<code>string</code>。</li></ul><p>内置类型也称为预声明类型</p><p>除了 <code>bool</code> 和 <code>string</code> 类型，其它的 15 种内置基本类型都称为数值类型（整型、浮点数型和复数型）。</p><p>Go 中有两种内置类型别名（type alias）：</p><ul><li><code>byte</code> 是 <code>uint8</code>的内置别名。 它们是同一个类型。</li><li><code>rune</code> 是 <code>int32</code>的内置别名。 它们是同一个类型。</li></ul><p>任一个类型的所有值的尺寸都是相同的，所以一个值的尺寸也常称为它的类型的尺寸。</p><p><code>uintptr</code>、<code>int</code> 以及 <code>uint</code> 类型的值的尺寸依赖于具体编译器实现。</p><ul><li>通常地，在 64 位的架构上，<code>int</code> 和 <code>uint</code> 类型的值是 64 位的；</li><li>在 32 位的架构上，它们是 32 位的。</li><li>编译器必须保证 <code>uintptr</code> 类型的值的尺寸能够存下任意一个内存地址。</li></ul><p>一个 <code>complex64</code> 复数值的实部和虚部都是 <code>float32</code> 类型的值。 一个 <code>complex128</code> 复数值的实部和虚部都是 <code>float64</code> 类型的值。</p><p>复数的形式为 <code>RE + IMi</code>，其中 <code>RE</code> 是实数部分，<code>IM</code> 是虚数部分，而最后的 <code>i</code> 是虚数单位。下面是一个使用复数的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>c</span> <span class=kt>complex64</span> <span class=p>=</span> <span class=mi>5</span><span class=o>+</span><span class=m>5i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Value is: %v&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>)</span> <span class=c1>//output: (5+5i)
</span></span></span></code></pre></td></tr></table></div></div><p>在内存中，所有的浮点数都使用 IEEE-754 格式存储。</p><p>从逻辑上说，一个字符串值表示一段文本。 在内存中，<strong>一个字符串存储为一个字节序列</strong>。 此字节序列体现了此字符串所表示的文本的 UTF-8 编码形式。</p><h3 id=字符串>字符串</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>//示例代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>frenchHello</span> <span class=kt>string</span>  <span class=c1>// 声明变量为字符串的一般方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>emptyString</span> <span class=kt>string</span> <span class=p>=</span> <span class=s>&#34;&#34;</span>  <span class=c1>// 声明了一个字符串变量，初始化为空字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>no</span><span class=p>,</span> <span class=nx>yes</span><span class=p>,</span> <span class=nx>maybe</span> <span class=o>:=</span> <span class=s>&#34;no&#34;</span><span class=p>,</span> <span class=s>&#34;yes&#34;</span><span class=p>,</span> <span class=s>&#34;maybe&#34;</span>  <span class=c1>// 简短声明，同时声明多个变量
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>japaneseHello</span> <span class=o>:=</span> <span class=s>&#34;Konichiwa&#34;</span>  <span class=c1>// 同上
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>frenchHello</span> <span class=p>=</span> <span class=s>&#34;Bonjour&#34;</span>  <span class=c1>// 常规赋值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=utf-8>utf-8</h4><p>在 Go 语言中，字符串使用 UTF8 编码</p><p>UTF8 的好处在于，如果基本是英文，每个字符占 1 byte，和 ASCII 编码是一样的，非常节省空间，如果是中文，一般占 3 字节。包含中文的字符串的处理方式与纯 ASCII 码构成的字符串有点区别。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;reflect&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>str1</span> <span class=o>:=</span> <span class=s>&#34;Golang&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>str2</span> <span class=o>:=</span> <span class=s>&#34;Go语言&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>TypeOf</span><span class=p>(</span><span class=nx>str2</span><span class=p>[</span><span class=mi>2</span><span class=p>]).</span><span class=nf>Kind</span><span class=p>())</span> <span class=c1>// uint8
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>str1</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nb>string</span><span class=p>(</span><span class=nx>str1</span><span class=p>[</span><span class=mi>2</span><span class=p>]))</span>       <span class=c1>// 108 l
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%d %c\n&#34;</span><span class=p>,</span> <span class=nx>str2</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>str2</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>     <span class=c1>// 232 è
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;len(str2)：&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>str2</span><span class=p>))</span>       <span class=c1>// len(str2)： 8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>reflect.TypeOf().Kind()</code> 可以知道某个变量的类型，我们可以看到，字符串是以 byte 数组形式保存的，类型是 uint8，占 1 个 byte，打印时需要用 string 进行类型转换，否则打印的是编码值。</li><li>因为字符串是以 byte 数组的形式存储的，所以，<code>str2[2]</code> 的值并不等于 <code>语</code>。str2 的长度 <code>len(str2)</code> 也不是 4，而是 8（ <code>Go</code> 占 2 byte，<code>语言</code> 占 6 byte）。</li></ul><h4 id=特性>特性</h4><p>使用 <code>+</code> 操作符来连接两个字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;hello,&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>m</span> <span class=o>:=</span> <span class=s>&#34; world&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>a</span> <span class=o>:=</span> <span class=nx>s</span> <span class=o>+</span> <span class=nx>m</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s\n&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>修改字符串也可写为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>s</span> <span class=p>=</span> <span class=s>&#34;c&#34;</span> <span class=o>+</span> <span class=nx>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=c1>// 字符串虽不能更改，但可进行切片操作
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s\n&#34;</span><span class=p>,</span> <span class=nx>s</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>使用反引号来声明多行字符串（没有字符转义）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>m</span> <span class=o>:=</span> <span class=s>`hello
</span></span></span><span class=line><span class=cl><span class=s>	world`</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=处理中文>处理中文</h4><p>正确的处理方式是将 string 转为 rune 数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;unicode/utf8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>str</span> <span class=p>=</span> <span class=s>&#34;hello 你好&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//golang中string底层是通过byte数组实现的，座椅直接求len 实际是在按字节长度计算  所以一个汉字占3个字节算了3个长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;len(str):&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//以下两种都可以得到str的字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>//golang中的unicode/utf8包提供了用utf-8获取长度的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;RuneCountInString:&#34;</span><span class=p>,</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneCountInString</span><span class=p>(</span><span class=nx>str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//通过rune类型处理unicode字符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;rune:&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>([]</span><span class=nb>rune</span><span class=p>(</span><span class=nx>str</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>转换成 <code>[]rune</code> 类型后，字符串中的每个字符，无论占多少个字节都用 int32 来表示，因而可以正确处理中文。</p><blockquote><p><code>byte</code> 表示一个字节，可以表示英文字符等占用一个字节的字符，占用多于一个字节的字符就无法正确表示，例如占用 3 个字节的汉字
<code>rune</code> 表示一个字符，用来表示任何一个字符</p></blockquote><h4 id=修改字符串>修改字符串</h4><p>在Go中字符串是不可变的，如果真的想要改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>c</span> <span class=o>:=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>  <span class=c1>// 将字符串 s 转换为 []byte 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=p>=</span> <span class=sc>&#39;c&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>s2</span> <span class=o>:=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>  <span class=c1>// 再转换回 string 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s\n&#34;</span><span class=p>,</span> <span class=nx>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// or
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>s</span> <span class=p>=</span> <span class=s>&#34;c&#34;</span> <span class=o>+</span> <span class=nx>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=c1>// 字符串虽不能更改，但可进行切片操作
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s\n&#34;</span><span class=p>,</span> <span class=nx>s</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=错误类型>错误类型</h3><p>Go 内置有一个 <code>error</code> 类型，专门用来处理错误信息，Go 的 <code>package</code> 里面还专门有一个包 <code>errors</code> 来处理错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>err</span> <span class=o>:=</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;emit macho dwarf: elf header corrupted&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=数据类型之间的转换>数据类型之间的转换</h3><p>转换数据类型的方式很简单。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>valueOfTypeB</span> <span class=p>=</span> <span class=nf>typeB</span><span class=p>(</span><span class=nx>valueOfTypeA</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 浮点数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=o>:=</span> <span class=mf>5.0</span>
</span></span><span class=line><span class=cl><span class=c1>// 转换为int类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>b</span> <span class=o>:=</span> <span class=nb>int</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Go允许在底层结构相同的两个类型之间互转。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// IT类型的底层是int类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>IT</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// a的类型为IT，底层是int
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>a</span> <span class=nx>IT</span> <span class=p>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将a(IT)转换为int，b现在是int类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>b</span> <span class=o>:=</span> <span class=nb>int</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将b(int)转换为IT，c现在是IT类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>c</span> <span class=o>:=</span> <span class=nf>IT</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>但注意：</p><ol><li>不是所有数据类型都能转换的，例如字母格式的 string 类型 &ldquo;abcd&rdquo; 转换为 int 肯定会失败</li><li>低精度转换为高精度时是安全的，高精度的值转换为低精度时会丢失精度。例如 int32 转换为 int16，float32 转换为 int</li><li>这种简单的转换方式不能对 int(float) 和 string 进行互转，要跨大类型转换，可以使用 <code>strconv</code> 包提供的函数</li></ol><h3 id=数组-array>数组 array</h3><ul><li>数组是值。将一个数组赋予另一个数组会复制其所有元素。</li><li>特别地，若将某个数组传入某个函数，它将接收到该数组的一份副本而非指针。</li><li>数组的大小是其类型的一部分。类型 <code>[10]int</code> 和<code> [20]int</code> 是不同的。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>arr</span> <span class=p>[</span><span class=nx>n</span><span class=p>]</span><span class=kd>type</span>
</span></span></code></pre></td></tr></table></div></div><p>声明数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>arr</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span>     <span class=c1>// 一维
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>arr2</span> <span class=p>[</span><span class=mi>5</span><span class=p>][</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span> <span class=c1>// 二维 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>arr</span> <span class=p>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span> <span class=c1>// 声明时初始化
</span></span></span></code></pre></td></tr></table></div></div><p>使用 <code>:=</code> 声明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=nx>b</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span> <span class=c1>// 前三个元素初始化为1、2、3，其它默认为0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>c</span> <span class=o>:=</span> <span class=p>[</span><span class=o>...</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>}</span> <span class=c1>// 可以省略长度而采用`...`的方式，Go会自动根据元素个数来计算长度
</span></span></span></code></pre></td></tr></table></div></div><p>声明嵌套数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 声明了一个二维数组，该数组以两个数组作为元素，其中每个数组中又有4个int类型的元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>doubleArray</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>4</span><span class=p>]</span><span class=kt>int</span><span class=p>{[</span><span class=mi>4</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>},</span> <span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 上面的声明可以简化，直接忽略内部的类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>easyArray</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>4</span><span class=p>]</span><span class=kt>int</span><span class=p>{{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>},</span> <span class=p>{</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>}}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>[]</code> 索引/修改数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>arr</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>arr</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span>  <span class=c1>// [101 102 103 104 105]
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>由于长度也是数组类型的一部分，因此 <code>[3]int</code> 与 <code>[4]int</code> 是不同的类型，数组也就不能改变长度。</p><p>数组之间的赋值是值的赋值，即当把一个数组作为参数传入函数的时候，传入的其实是该数组的副本，而不是它的指针。要传指针得使用 <code>slice</code></p></blockquote><h3 id=切片-slice>切片 slice</h3><p>数组的长度不能改变，如果想拼接 2 个数组，或是获取子数组，需要使用切片</p><p>切片通过对数组进行封装，为数据序列提供了更通用、强大而方便的接口。 除了矩阵变换这类需要明确维度的情况外，<strong>Go 中的大部分数组编程都是通过切片来完成的</strong>。</p><blockquote><p>Go 和 Python 的切片在底层实现上完全不同</p><p>python 的切片产生的是新的对象，对新对象的成员的操作不影响旧对象；</p><p>go 的切片产生的是旧对象一部分的引用，对其成员的操作会影响旧对象。</p><p>这其实也体现了脚本语言和编译语言的不同。虽然两个语言都有类似的切片操作；但是 python 主要目标是方便；go 主要目标却是快速（并弥补丢弃指针运算的缺陷）</p></blockquote><h4 id=性质>性质</h4><ul><li><p>切片是数组的抽象。</p></li><li><p>切片<strong>使用数组作为底层结构</strong>。</p></li><li><p>切片包含三个组件</p><ul><li><p>容量：<code>slice</code> 开始位置到数组的最后位置的长度，也叫最大长度</p></li><li><p>长度：<code>slice</code> 的长度</p></li><li><p>指向底层数组的指针：指向数组中 <code>slice</code> 指定的开始位置</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.slice2.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.slice2.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.slice2.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.slice2.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.slice2.png title=img></p></li></ul></li><li><p>切片可以随时进行扩展</p></li></ul><blockquote><p><code>slice</code> 并不是真正意义上的动态数组，而是一个<strong>引用</strong>类型。<code>slice</code> 总是指向一个<strong>底层</strong> <code>array</code></p></blockquote><h4 id=声明>声明</h4><p>声明切片和 <code>array</code> 一样，只是不需要指定长度</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 普通声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>fslice</span> <span class=p>[]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明并初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>slice</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>byte</span> <span class=p>{</span><span class=sc>&#39;a&#39;</span><span class=p>,</span> <span class=sc>&#39;b&#39;</span><span class=p>,</span> <span class=sc>&#39;c&#39;</span><span class=p>,</span> <span class=sc>&#39;d&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 从一个数组或一个已经存在的slice中再次声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>ar</span> <span class=p>=</span> <span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=kt>byte</span> <span class=p>{</span><span class=sc>&#39;a&#39;</span><span class=p>,</span> <span class=sc>&#39;b&#39;</span><span class=p>,</span> <span class=sc>&#39;c&#39;</span><span class=p>,</span> <span class=sc>&#39;d&#39;</span><span class=p>,</span> <span class=sc>&#39;e&#39;</span><span class=p>,</span> <span class=sc>&#39;f&#39;</span><span class=p>,</span> <span class=sc>&#39;g&#39;</span><span class=p>,</span> <span class=sc>&#39;h&#39;</span><span class=p>,</span> <span class=sc>&#39;i&#39;</span><span class=p>,</span> <span class=sc>&#39;j&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>a</span> <span class=o>:=</span> <span class=nx>ar</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>5</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>或者使用 <code>make()</code> 创建切片</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>slice1</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>float32</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=c1>// 长度为0的切片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>slice2</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>float32</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=c1>// [0 0 0] 长度为3容量为5的切片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>slice2</span><span class=p>),</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>slice2</span><span class=p>))</span> <span class=c1>// 3 5
</span></span></span></code></pre></td></tr></table></div></div><p>从 Go1.2 开始 <code>slice</code> 支持三个参数的声明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>array</span> <span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nx>slice</span> <span class=o>:=</span> <span class=nx>array</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span>   <span class=c1>// 一般声明方法, cap=8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>slice</span> <span class=p>=</span> <span class=nx>array</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>:</span><span class=mi>7</span><span class=p>]</span>  <span class=c1>//使用三个参数声明, cap=7-2
</span></span></span></code></pre></td></tr></table></div></div><h4 id=使用>使用</h4><p>使用切片：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 添加元素，切片容量可以根据需要自动扩展
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>slice2</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>slice2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span> <span class=c1>// [0, 0, 0, 1, 2, 3, 4]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>slice2</span><span class=p>),</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>slice2</span><span class=p>))</span> <span class=c1>// 7 12
</span></span></span><span class=line><span class=cl><span class=c1>// 子切片 [start, end)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>sub1</span> <span class=o>:=</span> <span class=nx>slice2</span><span class=p>[</span><span class=mi>3</span><span class=p>:]</span> <span class=c1>// [1 2 3 4]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>sub2</span> <span class=o>:=</span> <span class=nx>slice2</span><span class=p>[:</span><span class=mi>3</span><span class=p>]</span> <span class=c1>// [0 0 0]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>sub3</span> <span class=o>:=</span> <span class=nx>slice2</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=c1>// [0 0 1]
</span></span></span><span class=line><span class=cl><span class=c1>// 合并切片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>combined</span> <span class=o>:=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>sub1</span><span class=p>,</span> <span class=nx>sub2</span><span class=o>...</span><span class=p>)</span> <span class=c1>// [1, 2, 3, 4, 0, 0, 0]
</span></span></span></code></pre></td></tr></table></div></div><ul><li>声明切片时可以为切片设置容量大小，为切片预分配空间。</li><li>在实际使用的过程中，如果容量不够，切片容量会<strong>自动扩展</strong>。</li><li><code>sub2...</code> 是切片解构的写法，将切片解构为 N 个独立的元素。</li></ul><h4 id=内置函数>内置函数</h4><ul><li><code>len()</code>：获取 <code>slice</code> 的长度</li><li><code>cap()</code>：获取 <code>slice</code> 的最大容量</li><li><code>append()</code>：向 <code>slice</code> 里面追加一个或者多个元素，然后返回一个和 <code>slice</code> 一样类型的 <code>slice</code></li><li><code>copy()</code>：函数 <code>copy</code> 从源 <code>slice</code> 的 <code>src</code> 中复制元素到目标 <code>dst</code>，并且返回复制的元素的个数</li></ul><blockquote><p><code>append</code> 函数会改变 <code>slice</code> 所引用的数组的内容，从而影响到引用同一数组的其它 <code>slice</code>。</p><p>但当 <code>slice</code> 中没有剩余空间（即 <code>(cap-len) == 0</code>）时，此时将动态分配新的数组空间。返回的 <code>slice</code> 数组指针将指向这个空间，而原数组的内容将保持不变；其它引用此数组的 <code>slice</code> 则不受影响。</p></blockquote><h4 id=小例子>小例子</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>fn1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>arr</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span> <span class=p>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>slice</span> <span class=o>:=</span> <span class=nx>arr</span><span class=p>[:</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=nx>slice</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span> <span class=c1>// 直接覆盖原数组的4
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span>         <span class=c1>// [1,2,3,100]
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span>           <span class=c1>// [1,2,3,100,5]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>fn2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>arr</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span> <span class=p>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>slice</span> <span class=o>:=</span> <span class=nx>arr</span><span class=p>[:</span><span class=mi>3</span><span class=p>:</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=nx>slice</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span> <span class=c1>// 扩容 分配新内存 不影响原数组
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span>         <span class=c1>// [1,2,3,100]
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span>           <span class=c1>// [1,2,3,4,5]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>fn1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>fn2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=字典--键值对map>字典 / 键值对，map</h3><p>map 类似于 java 的 HashMap，Python 的字典 (dict)，是一种存储键值对 (Key-Value) 的数据结构。使用方式和其他语言几乎没有区别。</p><h4 id=声明-1>声明</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 仅声明，这种方式的声明需要在使用之前使用make初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>m0</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=c1>// 声明并用make初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>m1</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 声明时初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>m2</span> <span class=o>:=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;Sam&#34;</span><span class=p>:</span> <span class=s>&#34;Male&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;Alice&#34;</span><span class=p>:</span> <span class=s>&#34;Female&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 赋值/修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>m1</span><span class=p>[</span><span class=s>&#34;Tom&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=mi>18</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=特性-1>特性</h4><ul><li><code>map</code> 是无序的，每次打印出来的 <code>map</code> 都会不一样，它不能通过 <code>index</code> 获取，而必须通过 <code>key</code> 获取</li><li><code>map</code> 的长度不固定，和 <code>slice</code> 一样，也是一种引用类型</li><li>内置的 <code>len</code> 函数将返回 <code>map</code> 拥有的 <code>key</code> 的数量</li><li><code>map</code> 和其他基本型别不同，它不是 thread-safe，在多个 go-routine 存取时，必须使用 mutex lock 机制</li><li>若试图通过映射中不存在的键来取值，就会返回与该映射中项的类型对应的<strong>零值</strong>。</li></ul><p>因为 <code>map</code> 也是一种引用类型，如果两个 <code>map</code> 同时指向一个底层，那么一个改变，另一个也相应的改变：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>m</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>m</span><span class=p>[</span><span class=s>&#34;Hello&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;Bonjour&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>m1</span> <span class=o>:=</span> <span class=nx>m</span>
</span></span><span class=line><span class=cl><span class=nx>m1</span><span class=p>[</span><span class=s>&#34;Hello&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;Salut&#34;</span>  <span class=c1>// 现在m[&#34;hello&#34;]的值已经是Salut了
</span></span></span></code></pre></td></tr></table></div></div><h4 id=删除>删除</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 初始化一个字典
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>rating</span> <span class=o>:=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>float32</span><span class=p>{</span><span class=s>&#34;C&#34;</span><span class=p>:</span><span class=mi>5</span><span class=p>,</span> <span class=s>&#34;Go&#34;</span><span class=p>:</span><span class=mf>4.5</span><span class=p>,</span> <span class=s>&#34;Python&#34;</span><span class=p>:</span><span class=mf>4.5</span><span class=p>,</span> <span class=s>&#34;C++&#34;</span><span class=p>:</span><span class=mi>2</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// map有两个返回值，第二个返回值，如果不存在key，那么ok为false，如果存在ok为true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>csharpRating</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>rating</span><span class=p>[</span><span class=s>&#34;C#&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;C# is in the map and its rating is &#34;</span><span class=p>,</span> <span class=nx>csharpRating</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;We have no rating associated with C# in the map&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>delete</span><span class=p>(</span><span class=nx>rating</span><span class=p>,</span> <span class=s>&#34;C&#34;</span><span class=p>)</span>  <span class=c1>// 删除key为C的元素
</span></span></span></code></pre></td></tr></table></div></div><h3 id=make-new-操作>make, new 操作</h3><p><code>make</code> 用于内建类型（<code>map</code>、<code>slice</code> 和 <code>channel</code>）的内存分配。<code>new</code> 用于各种类型的内存分配。</p><p>内建函数 <code>new</code> 本质上说跟其它语言中的同名函数功能一样：<code>new(T)</code> 分配了零值填充的 <code>T</code> 类型的内存空间，并且返回其地址，即一个 <code>*T</code> 类型的值。用 Go 的术语说，它返回了一个指针，指向新分配的类型 <code>T</code> 的零值。</p><p>一言以蔽之：<strong><code>new</code> 返回指针。</strong></p><p>内建函数 <code>make(T, args)</code> 与 <code>new(T)</code> 有着不同的功能，<code>make</code> 只能创建 <code>slice</code>、<code>map</code> 和 <code>channel</code>，并且返回一个有初始值(非零)的 <code>T</code> 类型，而不是 <code>*T</code>。</p><p>本质来讲，导致这三个类型有所不同的原因是指向数据结构的引用在使用前必须被初始化。例如，一个 <code>slice</code>，是一个包含指向数据（内部 <code>array</code>）的指针、长度和容量的三项描述符；在这些项目被初始化之前，<code>slice</code> 为<code>nil</code>。对于 <code>slice</code>、<code>map</code> 和 <code>channel</code> 来说，<code>make</code> 初始化了内部的数据结构，填充适当的值。</p><p>一言以蔽之：<strong><code>make</code> 返回初始化后的（非零）值。</strong></p><p>下面这个图详细的解释了 <code>new</code> 和 <code>make</code> 之间的区别。</p><img src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.2.makenew.png alt=img style=zoom:67%><h3 id=零值>零值</h3><p>关于“零值”，所指并非是空值，而是一种“变量未填充前”的默认值，通常为 0。 此处罗列部分类型的“零值”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kt>int</span>     <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kt>int8</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kt>int32</span>   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kt>int64</span>   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kt>uint</span>    <span class=mh>0x0</span>
</span></span><span class=line><span class=cl><span class=kt>rune</span>    <span class=mi>0</span>   <span class=c1>//rune的实际类型是 int32
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>byte</span>    <span class=mh>0x0</span> <span class=c1>// byte的实际类型是 uint8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>float32</span> <span class=mi>0</span>   <span class=c1>//长度为 4 byte
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>float64</span> <span class=mi>0</span>   <span class=c1>//长度为 8 byte
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span>    <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=kt>string</span>  <span class=s>&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>布尔类型的零值（初始值）为 false，数值类型的零值为 0，字符串类型的零值为空字符串<code>""</code>，而<strong>指针、切片、映射、通道、函数和接口的零值则是 nil</strong>。</p><h3 id=指针-pointer>指针 pointer</h3><p>指针即某个值的地址，类型定义时使用符号 <code>*</code>，对一个已经存在的变量，使用 <code>&</code> 获取该变量的地址。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>str</span> <span class=o>:=</span> <span class=s>&#34;Golang&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>p</span> <span class=o>*</span><span class=kt>string</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>str</span> <span class=c1>// p 是指向 str 的指针
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>*</span><span class=nx>p</span> <span class=p>=</span> <span class=s>&#34;Hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>str</span><span class=p>)</span> <span class=c1>// Hello 修改了 p，str 的值也发生了改变
</span></span></span></code></pre></td></tr></table></div></div><p>一般来说，指针通常在函数传递参数，或者给某个类型定义新的方法时使用。</p><p>Go 语言中，参数是按值传递的，如果不使用指针，函数内部将会拷贝一份参数的副本，对参数的修改并不会影响到外部变量的值。如果参数使用指针，对参数的传递将会影响到外部变量。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>realAdd</span><span class=p>(</span><span class=nx>num</span> <span class=o>*</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>*</span><span class=nx>num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>num</span> <span class=o>:=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>	<span class=nf>add</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>  <span class=c1>// 100，num 没有变化
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=nf>realAdd</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>  <span class=c1>// 101，指针传递，num 被修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>传指针使得多个函数能操作同一个对象。</li><li>传指针比较轻量级 (8bytes),只是传内存地址，我们可以用指针传递体积大的结构体。如果用参数值传递的话, 在每次 copy 上面就会花费相对较多的系统开销（内存和时间）。所以当你要传递大的结构体的时候，用指针是一个明智的选择。</li><li>Go语言中 <code>channel</code>，<code>slice</code>，<code>map</code> 这三种类型的实现机制类似指针，所以可以直接传递，而不用取地址后传递指针。（注：若函数需改变 <code>slice</code> 的长度，则仍需要取地址传递指针）</li></ul><h3 id=位运算>位运算</h3><table><thead><tr><th style=text-align:left>符号</th><th style=text-align:left>描述</th><th style=text-align:left>运算规则</th></tr></thead><tbody><tr><td style=text-align:left>&</td><td style=text-align:left>与</td><td style=text-align:left>两个位都为 1 时，结果才为 1</td></tr><tr><td style=text-align:left>|</td><td style=text-align:left>或</td><td style=text-align:left>两个位都为 0 时，结果才为 0</td></tr><tr><td style=text-align:left>^</td><td style=text-align:left>异或</td><td style=text-align:left>两个位相同为 0，相异为 1</td></tr><tr><td style=text-align:left>~</td><td style=text-align:left>取反</td><td style=text-align:left>0 变 1，1 变 0</td></tr><tr><td style=text-align:left>&#171;</td><td style=text-align:left>左移</td><td style=text-align:left>各二进位全部左移若干位，高位丢弃，低位补 0</td></tr><tr><td style=text-align:left>&#187;</td><td style=text-align:left>右移</td><td style=text-align:left>各二进位全部右移若干位，对无符号数，高位补 0，有符号数，各编译器处理方法不一样，有的补符号位（算术右移），有的补 0（逻辑右移）</td></tr></tbody></table><h4 id=按位与>按位与</h4><ul><li><p>清零</p><ul><li>如果想将一个单元清零，即使其全部二进制位为 0，只要<strong>与一个各位都为零的数值相与</strong>，结果为零。</li></ul></li><li><p>取一个数的指定位</p><ul><li>比如取数 X=1010 1110 的低 4 位，只需要另找一个数 Y，令 Y 的低 4 位为 1，其余位为 0，即 Y=0000 1111，然后将 X 与 Y 进行按位与运算（X&Y=0000 1110）即可得到 X 的指定位。</li></ul></li><li><p><strong>判断奇偶</strong></p><ul><li>只要根据最末位是 0 还是 1 来决定，为 0 就是偶数，为 1 就是奇数。</li><li>因此可以用 <code>if ((a & 1) == 0)</code> 代替 <code>if (a % 2 == 0)</code> 来判断 a 是不是偶数。</li></ul></li></ul><h4 id=按位或>按位或</h4><ul><li>常用来对一个数据的某些位设置为 1<ul><li>比如将数 X=1010 1110 的低 4 位设置为 1，只需要另找一个数 Y，令 Y 的低 4 位为 1，其余位为 0，即Y=0000 1111，然后将 X 与 Y 进行按位或运算（X|Y=1010 1111）即可得到。</li></ul></li></ul><h4 id=异或>异或</h4><ul><li><p><strong>异或 1 来翻转指定位</strong></p><ul><li>比如将数 X=1010 1110 的低 4 位进行翻转，只需要另找一个数 Y，令 Y 的低 4 位为 1，其余位为 0，即Y=0000 1111，然后将 X 与 Y 进行异或运算（X^Y=1010 0001）即可得到。</li></ul></li><li><p>与 0 相异或值不变</p><ul><li>例如：1010 1110 ^ 0000 0000 = 1010 1110</li></ul></li><li><p>交换两个数</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>  <span class=nx>void</span> <span class=nf>Swap</span><span class=p>(</span><span class=kt>int</span> <span class=o>&amp;</span><span class=nx>a</span><span class=p>,</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=nx>b</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>a</span> <span class=o>!=</span> <span class=nx>b</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=nx>a</span> <span class=p>^=</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>b</span> <span class=p>^=</span> <span class=nx>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>a</span> <span class=p>^=</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li></ul><h4 id=取反>取反</h4><ul><li>使一个数的最低位为零<ul><li>使 a 的最低位为 0，可以表示为：<code>a & ~1</code>。~1 的值为 1111 1111 1111 1110，再按"与"运算，最低位一定为 0。</li><li>因为" ~&ldquo;运算符的优先级比算术运算符、关系运算符、逻辑运算符和其他运算符都高。</li></ul></li></ul><h4 id=左移>左移</h4><p>每左移一位，相当于该数乘以 2</p><h4 id=右移>右移</h4><p>每右移一位，相当于该数除以 2</p><h2 id=流程控制>流程控制</h2><h3 id=条件语句-if-else>条件语句 if else</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>age</span> <span class=o>:=</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>age</span> <span class=p>&lt;</span> <span class=mi>18</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Kid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Adult&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 可以简写为：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=nx>age</span> <span class=o>:=</span> <span class=mi>18</span><span class=p>;</span> <span class=nx>age</span> <span class=p>&lt;</span> <span class=mi>18</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Kid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Adult&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>多个条件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>integer</span> <span class=o>==</span> <span class=mi>3</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The integer is equal to 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>integer</span> <span class=p>&lt;</span> <span class=mi>3</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The integer is less than 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The integer is greater than 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=goto>goto</h3><p>Go 有 <code>goto</code> 语句——请明智地使用它。用 <code>goto</code> 跳转到必须在当前函数内定义的标签。例如假设这样一个循环：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>myFunc</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>Here</span><span class=p>:</span>   <span class=c1>//这行的第一个词，以冒号结束作为标签
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nb>println</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>i</span><span class=o>++</span>
</span></span><span class=line><span class=cl>	<span class=k>goto</span> <span class=nx>Here</span>   <span class=c1>//跳转到Here去
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>标签名是大小写敏感的。</p></blockquote><h3 id=switch>switch</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Gender</span> <span class=kt>int8</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>MALE</span>   <span class=nx>Gender</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=nx>FEMALE</span> <span class=nx>Gender</span> <span class=p>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>gender</span> <span class=o>:=</span> <span class=nx>MALE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=nx>gender</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>FEMALE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;female&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>MALE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;male&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// male
</span></span></span></code></pre></td></tr></table></div></div><ul><li>在这里，使用了<code>type</code> 关键字定义了一个新的类型 Gender。</li><li>使用 const 定义了 MALE 和 FEMALE 2 个常量，<strong>Go 语言中没有枚举 (enum) 的概念</strong>，一般可以用常量的方式来模拟枚举。</li><li>和其他语言不同的地方在于，Go 语言的 switch 不需要 break，匹配到某个 case，执行完该 case 定义的行为后，默认不会继续往下执行。<strong>如果需要继续往下执行，需要使用 <code>fallthrough</code></strong>，例如：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>switch</span> <span class=nx>gender</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>FEMALE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;female&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>fallthrough</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>MALE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;male&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>fallthrough</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出结果
</span></span></span><span class=line><span class=cl><span class=c1>// male
</span></span></span><span class=line><span class=cl><span class=c1>// unknown
</span></span></span></code></pre></td></tr></table></div></div><p>可以将很多值聚合在一个 <code>case</code> 里</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>i</span> <span class=o>:=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=nx>i</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;i is equal to 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;i is equal to 2, 3 or 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;i is equal to 10&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;All I know is that i is an integer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=switch-用于判断变量类型><code>switch</code> 用于判断变量类型</h4><p>A type <code>switch</code> compares types instead of values. You can use this to discover the type of an interface value. In this example, the variable <code>t</code> will have the type corresponding to its clause.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>whatAmI</span> <span class=o>:=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>i</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>t</span> <span class=o>:=</span> <span class=nx>i</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=kt>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;I&#39;m a bool&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=kt>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;I&#39;m an int&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Don&#39;t know type %T\n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>whatAmI</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>whatAmI</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>whatAmI</span><span class=p>(</span><span class=s>&#34;hey&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=啊>啊</h4><p>break 语句可以使 switch 提前终止。不仅是 switch， 有时候也必须打破层层的循环。在 Go 中，我们只需将标签放置到循环外，然后 “蹦” 到那里即可。下面的例子展示了二者的用法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>Loop</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>src</span><span class=p>);</span> <span class=nx>n</span> <span class=o>+=</span> <span class=nx>size</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>src</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span> <span class=p>&lt;</span> <span class=nx>sizeOne</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>validateOnly</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>size</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=nf>update</span><span class=p>(</span><span class=nx>src</span><span class=p>[</span><span class=nx>n</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>src</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span> <span class=p>&lt;</span> <span class=nx>sizeTwo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>n</span><span class=o>+</span><span class=mi>1</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>src</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>err</span> <span class=p>=</span> <span class=nx>errShortInput</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span> <span class=nx>Loop</span> <span class=c1>// here, jump to Loop tag
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>validateOnly</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>size</span> <span class=p>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            <span class=nf>update</span><span class=p>(</span><span class=nx>src</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span> <span class=o>+</span> <span class=nx>src</span><span class=p>[</span><span class=nx>n</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=nx>shift</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当然，<code>continue</code> 语句也能接受一个可选的标签，不过它只能在循环中使用。</p><h3 id=for-循环>for 循环</h3><p>一个简单的累加的例子，break 和 continue 的用法与其他语言没有区别。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>sum</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>sum</span> <span class=p>&gt;</span> <span class=mi>50</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>sum</span> <span class=o>+=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当忽略 <code>expression1</code> 和 <code>expression3</code> 时，<code>;</code> 可以省略</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>sum</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>;</span> <span class=nx>sum</span> <span class=p>&lt;</span> <span class=mi>1000</span><span class=p>;</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sum</span> <span class=o>+=</span> <span class=nx>sum</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 冒号可以省略
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>sum</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>sum</span> <span class=p>&lt;</span> <span class=mi>1000</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sum</span> <span class=o>+=</span> <span class=nx>sum</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>break</code> 和 <code>continue</code> 还可以跟着标号，用来跳到多重循环中的外层循环</p><p>对数组 (arr)、切片 (slice)、字典 (map) 可以使用 for range 遍历：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>nums</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>num</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>nums</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 0 10
</span></span></span><span class=line><span class=cl><span class=c1>// 1 20
</span></span></span><span class=line><span class=cl><span class=c1>// 2 30
</span></span></span><span class=line><span class=cl><span class=c1>// 3 40
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>m2</span> <span class=o>:=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;Sam&#34;</span><span class=p>:</span>   <span class=s>&#34;Male&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;Alice&#34;</span><span class=p>:</span> <span class=s>&#34;Female&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>value</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>m2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// Sam Male
</span></span></span><span class=line><span class=cl><span class=c1>// Alice Female
</span></span></span></code></pre></td></tr></table></div></div><h2 id=函数-functions>函数 functions</h2><h3 id=参数与返回值>参数与返回值</h3><p>一个典型的函数定义如下，使用关键字 <code>func</code>，参数可以有多个，返回值也支持有多个。特别地，<code>package main</code> 中的 <code>func main()</code> 约定为可执行程序的入口。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>funcName</span><span class=p>(</span><span class=nx>param1</span> <span class=nx>Type1</span><span class=p>,</span> <span class=nx>param2</span> <span class=nx>Type2</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=p>(</span><span class=nx>return1</span> <span class=nx>Type3</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// body
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>value1</span><span class=p>,</span> <span class=nx>value2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>例如，实现2个数的加法（一个返回值）和除法（多个返回值）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>num1</span> <span class=o>+</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>div</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>num1</span> <span class=o>/</span> <span class=nx>num2</span><span class=p>,</span> <span class=nx>num1</span> <span class=o>%</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>quo</span><span class=p>,</span> <span class=nx>rem</span> <span class=o>:=</span> <span class=nf>div</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>17</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>quo</span><span class=p>,</span> <span class=nx>rem</span><span class=p>)</span>     <span class=c1>// 5 15
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>add</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>17</span><span class=p>))</span> <span class=c1>// 117
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以给返回值命名，简化 return，例如 add 函数可以改写为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>ans</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ans</span> <span class=p>=</span> <span class=nx>num1</span> <span class=o>+</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>不建议这样做，虽然使得代码更加简洁了，但是会造成生成的文档可读性差</p></blockquote><p>函数参数的类型默认为离它最近的类型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>max</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>a</span> <span class=p>&gt;</span> <span class=nx>b</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>a</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述代码中，<code>max</code> 函数有两个参数，它们的类型都是 <code>int</code>，那么第一个变量的类型就可以省略（即 <code>a,b int</code>, 而非 <code>a int, b int</code>)</p><h3 id=变参->变参 <code>...</code></h3><p>Go 函数支持变参。接受变参的函数是有着不定数量的参数的。为了做到这点，首先需要定义函数使其接受变参：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>myfunc</span><span class=p>(</span><span class=nx>arg</span> <span class=o>...</span><span class=kt>int</span><span class=p>)</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>arg ...int</code> 告诉 Go 这个函数接受不定数量的参数。注意，这些参数的类型全部是 <code>int</code>。在函数体中，变量<code>arg</code> 是一个 <code>int</code> 的 <code>slice</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>n</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>arg</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;And the number is: %d\n&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=延迟语句-defer>延迟语句 defer</h3><p>Go 语言中有种不错的设计，即延迟（defer）语句，你可以在函数中添加多个 defer 语句。</p><p>当函数执行到最后时，这些 defer 语句会按照逆序执行（栈），最后该函数返回。</p><p>即：先执行 defer，后返回</p><p>特别是当你在进行一些打开资源的操作时，遇到错误需要提前返回，在返回前你需要关闭相应的资源，不然很容易造成资源泄露等问题。</p><p>如下代码所示，我们一般写打开一个资源是这样操作的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReadWrite</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 做一些工作
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>failureX</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>failureY</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>我们看到上面有很多重复的代码，Go 的 <code>defer</code> 有效解决了这个问题。使用它后，不但代码量减少了很多，而且程序变得更优雅。在 <code>defer</code> 后指定的函数会在函数退出前调用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReadWrite</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>failureX</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>failureY</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果有很多调用 <code>defer</code>，那么 <code>defer</code> 是采用后进先出模式，所以如下代码会输出<code>4 3 2 1 0</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=函数作为值类型>函数作为值、类型</h3><p>在 Go 中函数也是一种变量，我们可以通过 <code>type</code> 来定义它，它的类型就是所有拥有相同的参数，相同的返回值的一种类型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>typeName</span> <span class=kd>func</span><span class=p>(</span><span class=nx>input1</span> <span class=nx>inputType1</span> <span class=p>,</span> <span class=nx>input2</span> <span class=nx>inputType2</span> <span class=p>[,</span> <span class=o>...</span><span class=p>])</span> <span class=p>(</span><span class=nx>result1</span> <span class=nx>resultType1</span> <span class=p>[,</span> <span class=o>...</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>将函数作为类型后，可以把这个类型的函数当做值来传递</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>testInt</span> <span class=kd>func</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=c1>// 声明了一个函数类型
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>isOdd</span><span class=p>(</span><span class=nx>integer</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>integer</span><span class=o>%</span><span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>isEven</span><span class=p>(</span><span class=nx>integer</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>integer</span><span class=o>%</span><span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明的函数类型在这个地方当做了一个参数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>filter</span><span class=p>(</span><span class=nx>slice</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>f</span> <span class=nx>testInt</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>result</span> <span class=p>[]</span><span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>value</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>slice</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nf>f</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>result</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>result</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=nx>slice</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;slice = &#34;</span><span class=p>,</span> <span class=nx>slice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>odd</span> <span class=o>:=</span> <span class=nf>filter</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=nx>isOdd</span><span class=p>)</span>    <span class=c1>// 函数当做值来传递了
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Odd elements of slice are: &#34;</span><span class=p>,</span> <span class=nx>odd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>even</span> <span class=o>:=</span> <span class=nf>filter</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=nx>isEven</span><span class=p>)</span>  <span class=c1>// 函数当做值来传递了
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Even elements of slice are: &#34;</span><span class=p>,</span> <span class=nx>even</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>函数当做值和类型在我们写一些通用接口的时候非常有用</p><p>上面例子中 <code>testInt</code> 类型是一个函数类型，然后两个 <code>filter</code> 函数的参数和返回值与 <code>testInt</code> 类型是一样的，但是我们可以实现很多种的逻辑，这样使得我们的程序变得非常的灵活。</p><h3 id=闭包-closures>闭包 Closures</h3><p>Go supports anonymous functions, which can form closures. Anonymous functions are useful when you want to define a function inline without having to name it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>intSeq</span><span class=p>()</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>i</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>nextInt</span> <span class=o>:=</span> <span class=nf>intSeq</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>nextInt</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>nextInt</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>nextInt</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>newInts</span> <span class=o>:=</span> <span class=nf>intSeq</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>newInts</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/*</span> <span class=nx>output</span><span class=p>:</span>
</span></span><span class=line><span class=cl> <span class=o>*</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=o>*</span>  <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=o>*</span>  <span class=mi>3</span>
</span></span><span class=line><span class=cl> <span class=o>*</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl> 
</span></span></code></pre></td></tr></table></div></div><p>This function <code>intSeq</code> returns another function, which we define anonymously in the body of <code>intSeq</code>.</p><p>The returned function <em>closes over</em> the variable <code>i</code> to form a closure.</p><p>We call <code>intSeq</code>, assigning the result (a function) to <code>nextInt</code>. This function value captures its own <code>i</code> value, which will be updated each time we call <code>nextInt</code>.</p><h3 id=错误处理-error-handling>错误处理 error handling</h3><p>如果函数实现过程中，如果出现不能处理的错误，可以返回给调用者处理。比如我们调用标准库函数<code>os.Open</code>读取文件，<code>os.Open</code> 有2个返回值，第一个是 <code>*File</code>，第二个是 <code>error</code>， 如果调用成功，error 的值是 nil，如果调用失败，例如文件不存在，我们可以通过 error 知道具体的错误信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;filename.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// open filename.txt: no such file or directory
</span></span></span></code></pre></td></tr></table></div></div><p>可以通过 <code>errorw.New</code> 返回自定义的错误</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hello</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;error: name is null&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Hello,&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>hello</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// error: name is null
</span></span></span></code></pre></td></tr></table></div></div><h4 id=panic-和-recover>panic 和 recover</h4><p>error 往往是能预知的错误，但是也可能出现一些不可预知的错误，例如数组越界，这种错误可能会导致程序非正常退出，在 Go 语言中称之为 panic。</p><p><strong>Panic</strong></p><ul><li>它是一个内建函数，可以中断原有的控制流程，进入一个 <code>panic</code> 状态中。</li><li>当函数 <code>F</code> 调用 <code>panic</code>，函数的执行被中断，但是 <code>F</code> 中的延迟函数 <code>defer</code> 会正常执行，然后 <code>F</code> 返回到调用它的地方。</li><li>在调用的地方，<code>F</code> 的行为就像调用了 <code>panic</code>。这一过程继续向上，直到发生 <code>panic</code> 的 <code>goroutine</code> 中所有调用的函数返回，此时程序退出。</li><li><code>panic</code> 可以直接调用 <code>panic</code> 产生。也可以由运行时错误产生，例如访问越界的数组。</li></ul><p><strong>Recover</strong></p><ul><li>它是一个内建的函数，可以让进入 <code>panic</code> 状态的 <code>goroutine</code> 恢复过来。</li><li><code>recover</code> 仅在延迟函数 <code>defer</code> 中有效。</li><li>在正常的执行过程中，调用 <code>recover</code> 会返回 <code>nil</code>，并且没有其它任何效果。</li><li><strong>如果当前的 <code>goroutine</code> 陷入 <code>panic</code> 状态，调用 <code>recover</code> 可以捕获到 <code>panic</code> 的输入值，并且恢复正常的执行。</strong></li></ul><p>例一：下面这个函数演示了如何在过程中使用 <code>panic</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>user</span> <span class=p>=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>user</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;no value for $USER&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>下面这个函数检查作为其参数的函数在执行时是否会产生 <code>panic</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>throwsPanic</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>())</span> <span class=p>(</span><span class=nx>b</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>x</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>x</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>b</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=nf>f</span><span class=p>()</span> <span class=c1>//执行函数f，如果f中出现了panic，那么就可以恢复回来
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>例二：数组越界的情况</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>get</span><span class=p>(</span><span class=nx>index</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>arr</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>get</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=k>go</span> <span class=nx>run</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>panic</span><span class=p>:</span> <span class=nx>runtime</span> <span class=kt>error</span><span class=p>:</span> <span class=nx>index</span> <span class=nx>out</span> <span class=nx>of</span> <span class=k>range</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=nx>with</span> <span class=nx>length</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=nx>goroutine</span> <span class=mi>1</span> <span class=p>[</span><span class=nx>running</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=nx>exit</span> <span class=nx>status</span> <span class=mi>2</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>panic</code> 和 <code>recover</code> 来捕获错误</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>get</span><span class=p>(</span><span class=nx>index</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>ret</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>r</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>r</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Some error happened!&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>ret</span> <span class=p>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=nx>arr</span> <span class=o>:=</span> <span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>get</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=k>go</span> <span class=nx>run</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Some</span> <span class=kt>error</span> <span class=nx>happened</span><span class=p>!</span> <span class=nx>runtime</span> <span class=kt>error</span><span class=p>:</span> <span class=nx>index</span> <span class=nx>out</span> <span class=nx>of</span> <span class=k>range</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=nx>with</span> <span class=nx>length</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>finished</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在 get 函数中，使用 defer 定义了异常处理的函数，在协程退出前，会执行完 defer 挂载的任务。因此如果触发了 panic，控制权就交给了 defer。</li><li>在 defer 的处理逻辑中，使用 recover，使程序恢复正常，并且将返回值设置为 -1，在这里也可以不处理返回值，如果不处理返回值，返回值将被置为默认值 0。</li></ul><blockquote><p>应当在关键的时刻使用 panic 和 recover，而不能滥用</p></blockquote><h3 id=main-函数和-init-函数><code>main</code> 函数和 <code>init</code> 函数</h3><p>Go 里面有两个保留的函数：<code>init</code> 函数（能够应用于所有的 <code>package</code>）和 <code>main</code> 函数（只能应用于 <code>package main</code>）。这两个函数在定义时<strong>不能有任何的参数和返回值</strong>。</p><p>每个 <code>package</code> 中的 <code>init</code> 函数都是可选的，但 <code>package main</code> 必须包含一个 <code>main</code> 函数。</p><p>虽然一个 <code>package</code> 里面可以写任意多个 <code>init</code> 函数，但无论是对于可读性还是以后的可维护性来说，建议只写一个 <code>init</code> 函数。</p><p>Go 程序会自动调用 <code>init()</code> 和 <code>main()</code>，你不需要在任何地方调用这两个函数。</p><h3 id=程序的初始化过程>程序的初始化过程</h3><p>程序的初始化和执行都起始于 <code>main</code> 包。如果 <code>main</code> 包还导入了其它的包，那么就会在编译时将它们依次导入。</p><p>有时一个包会被多个包同时导入，那么它只会被导入一次（例如很多包可能都会用到 <code>fmt</code> 包，但它只会被导入一次，因为没有必要导入多次）。</p><p>当一个包被导入时，如果该包还导入了其它的包，那么会先将其它包导入进来，然后再对这些包中的包级常量和变量进行初始化，接着执行 <code>init</code> 函数（如果有的话），依次类推。</p><p>等所有被导入的包都加载完毕了，就会开始对 <code>main</code> 包中的包级常量和变量进行初始化，然后执行 <code>main</code> 包中的 <code>init</code> 函数（如果存在的话），最后执行 <code>main</code> 函数。下图详细地解释了整个执行过程：</p><p><img class=lazyload src=/Notes/svg/loading.min.svg data-src=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.3.init.png data-srcset="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.3.init.png, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.3.init.png 1.5x, https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.3.init.png 2x" data-sizes=auto alt=https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2.3.init.png title=img></p><h3 id=import>import</h3><h4 id=点操作>点操作</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl> <span class=kn>import</span><span class=p>(</span>
</span></span><span class=line><span class=cl>     <span class=p>.</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl> <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>点操作允许使用<strong>省略前缀</strong>的包名</p><h4 id=别名操作>别名操作</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl> <span class=kn>import</span><span class=p>(</span>
</span></span><span class=line><span class=cl>     <span class=nx>f</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl> <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>别名操作允许使用别名来使用包</p><h4 id=_-操作><code>_</code> 操作</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;database/sql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/ziutek/mymysql/godrv&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>_</code> 操作引入了包，而不直接使用包里面的函数，而是调用了该包里面的 <code>init</code> 函数</p><h2 id=结构体方法和接口>结构体，方法和接口</h2><h3 id=结构体-struct>结构体 struct</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明一个新的类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>person</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 比较两个人的年龄，返回年龄大的那个人，并且返回年龄差
</span></span></span><span class=line><span class=cl><span class=c1>// struct也是传值的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Older</span><span class=p>(</span><span class=nx>p1</span><span class=p>,</span> <span class=nx>p2</span> <span class=nx>person</span><span class=p>)</span> <span class=p>(</span><span class=nx>person</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>p1</span><span class=p>.</span><span class=nx>age</span><span class=p>&gt;</span><span class=nx>p2</span><span class=p>.</span><span class=nx>age</span> <span class=p>{</span>  <span class=c1>// 比较p1和p2这两个人的年龄
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>p1</span><span class=p>,</span> <span class=nx>p1</span><span class=p>.</span><span class=nx>age</span><span class=o>-</span><span class=nx>p2</span><span class=p>.</span><span class=nx>age</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>p2</span><span class=p>,</span> <span class=nx>p2</span><span class=p>.</span><span class=nx>age</span><span class=o>-</span><span class=nx>p1</span><span class=p>.</span><span class=nx>age</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 赋值初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>tom</span> <span class=nx>person</span>
</span></span><span class=line><span class=cl>	<span class=nx>tom</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>tom</span><span class=p>.</span><span class=nx>age</span> <span class=p>=</span> <span class=s>&#34;Tom&#34;</span><span class=p>,</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 两个字段都写清楚的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>bob</span> <span class=o>:=</span> <span class=nx>person</span><span class=p>{</span><span class=nx>age</span><span class=p>:</span><span class=mi>25</span><span class=p>,</span> <span class=nx>name</span><span class=p>:</span><span class=s>&#34;Bob&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 按照struct定义顺序初始化值
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>paul</span> <span class=o>:=</span> <span class=nx>person</span><span class=p>{</span><span class=s>&#34;Paul&#34;</span><span class=p>,</span> <span class=mi>43</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>    <span class=c1>// 当然也可以通过new函数分配一个指针，此处P的类型为*person
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// P := new(person)
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>	<span class=nx>tb_Older</span><span class=p>,</span> <span class=nx>tb_diff</span> <span class=o>:=</span> <span class=nf>Older</span><span class=p>(</span><span class=nx>tom</span><span class=p>,</span> <span class=nx>bob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>tp_Older</span><span class=p>,</span> <span class=nx>tp_diff</span> <span class=o>:=</span> <span class=nf>Older</span><span class=p>(</span><span class=nx>tom</span><span class=p>,</span> <span class=nx>paul</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>bp_Older</span><span class=p>,</span> <span class=nx>bp_diff</span> <span class=o>:=</span> <span class=nf>Older</span><span class=p>(</span><span class=nx>bob</span><span class=p>,</span> <span class=nx>paul</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Of %s and %s, %s is older by %d years\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>tom</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>bob</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>tb_Older</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>tb_diff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Of %s and %s, %s is older by %d years\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>tom</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>paul</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>tp_Older</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>tp_diff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Of %s and %s, %s is older by %d years\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>bob</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>paul</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>bp_Older</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>bp_diff</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=匿名字段>匿名字段</h4><p>Go 语言支持只提供类型，而不写字段名的方式，也就是匿名字段，或称为嵌入字段。</p><p>当匿名字段是一个 struct 的时候，那么这个 struct 所拥有的<strong>全部字段以及方法</strong>都被隐式地引入了当前定义的这个 struct</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>weight</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Student</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span>  <span class=c1>// 匿名字段，那么默认Student就包含了Human的所有字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>speciality</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 初始化一个学生
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>mark</span> <span class=o>:=</span> <span class=nx>Student</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Mark&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>120</span><span class=p>},</span> <span class=s>&#34;Computer Science&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 访问相应的字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His name is &#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His age is &#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His weight is &#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His speciality is &#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>speciality</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改对应的备注信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>mark</span><span class=p>.</span><span class=nx>speciality</span> <span class=p>=</span> <span class=s>&#34;AI&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mark changed his speciality&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His speciality is &#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>speciality</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改其年龄信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mark become old&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span><span class=p>.</span><span class=nx>age</span> <span class=p>=</span> <span class=mi>46</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His age is&#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改其体重信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mark is not an athlet anymore&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span><span class=p>.</span><span class=nx>weight</span> <span class=o>+=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;His weight is&#34;</span><span class=p>,</span> <span class=nx>mark</span><span class=p>.</span><span class=nx>weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>匿名字段能够实现字段的继承</p><p>student 还能访问 Human 这个字段作为字段名。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>mark</span><span class=p>.</span><span class=nx>Human</span> <span class=p>=</span> <span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Marcus&#34;</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>220</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>mark</span><span class=p>.</span><span class=nx>Human</span><span class=p>.</span><span class=nx>age</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p>不仅仅是 struct，所有的内置类型和自定义类型都可以作为匿名字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Skills</span> <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>weight</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Student</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span>  <span class=c1>// 匿名字段，struct
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Skills</span> <span class=c1>// 匿名字段，自定义的类型string slice
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kt>int</span>    <span class=c1>// 内置类型作为匿名字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>speciality</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 初始化学生Jane
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>jane</span> <span class=o>:=</span> <span class=nx>Student</span><span class=p>{</span><span class=nx>Human</span><span class=p>:</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Jane&#34;</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>100</span><span class=p>},</span> <span class=nx>speciality</span><span class=p>:</span><span class=s>&#34;Biology&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 访问相应的字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her name is &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her age is &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her weight is &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her speciality is &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>speciality</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改其skill技能字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>jane</span><span class=p>.</span><span class=nx>Skills</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;anatomy&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her skills are &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>Skills</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;She acquired two new ones &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>jane</span><span class=p>.</span><span class=nx>Skills</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>jane</span><span class=p>.</span><span class=nx>Skills</span><span class=p>,</span> <span class=s>&#34;physics&#34;</span><span class=p>,</span> <span class=s>&#34;golang&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her skills now are &#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=nx>Skills</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改匿名内置类型字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>jane</span><span class=p>.</span><span class=kt>int</span> <span class=p>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Her preferred number is&#34;</span><span class=p>,</span> <span class=nx>jane</span><span class=p>.</span><span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当存在两个相同的字段时，<strong>最外层的优先访问</strong>，这就允许我们去重载通过匿名字段继承的一些字段</p><p>如果想要访问重载后对应匿名类型里面的字段，可以通过匿名字段名来访问。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>phone</span> <span class=kt>string</span>  <span class=c1>// Human类型拥有的字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Employee</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span>  <span class=c1>// 匿名字段Human
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>speciality</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>phone</span> <span class=kt>string</span>  <span class=c1>// 雇员的phone字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bob</span> <span class=o>:=</span> <span class=nx>Employee</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Bob&#34;</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=s>&#34;777-444-XXXX&#34;</span><span class=p>},</span> <span class=s>&#34;Designer&#34;</span><span class=p>,</span> <span class=s>&#34;333-222&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Bob&#39;s work phone is:&#34;</span><span class=p>,</span> <span class=nx>Bob</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 如果我们要访问Human的phone字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Bob&#39;s personal phone is:&#34;</span><span class=p>,</span> <span class=nx>Bob</span><span class=p>.</span><span class=nx>Human</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=方法-methods>方法 methods</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>ReceiverType</span><span class=p>)</span> <span class=nf>funcName</span><span class=p>(</span><span class=nx>parameters</span><span class=p>)</span> <span class=p>(</span><span class=nx>results</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>&ldquo;A method is a function with an implicit first argument, called a receiver.&rdquo;</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Rectangle</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>width</span><span class=p>,</span> <span class=nx>height</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Circle</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>radius</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>Rectangle</span><span class=p>)</span> <span class=nf>area</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=nx>r</span><span class=p>.</span><span class=nx>height</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=nx>Circle</span><span class=p>)</span> <span class=nf>area</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nx>radius</span> <span class=o>*</span> <span class=nx>c</span><span class=p>.</span><span class=nx>radius</span> <span class=o>*</span> <span class=nx>math</span><span class=p>.</span><span class=nx>Pi</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r1</span> <span class=o>:=</span> <span class=nx>Rectangle</span><span class=p>{</span><span class=mi>12</span><span class=p>,</span> <span class=mi>2</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>r2</span> <span class=o>:=</span> <span class=nx>Rectangle</span><span class=p>{</span><span class=mi>9</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c1</span> <span class=o>:=</span> <span class=nx>Circle</span><span class=p>{</span><span class=mi>10</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c2</span> <span class=o>:=</span> <span class=nx>Circle</span><span class=p>{</span><span class=mi>25</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Area of r1 is: &#34;</span><span class=p>,</span> <span class=nx>r1</span><span class=p>.</span><span class=nf>area</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Area of r2 is: &#34;</span><span class=p>,</span> <span class=nx>r2</span><span class=p>.</span><span class=nf>area</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Area of c1 is: &#34;</span><span class=p>,</span> <span class=nx>c1</span><span class=p>.</span><span class=nf>area</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Area of c2 is: &#34;</span><span class=p>,</span> <span class=nx>c2</span><span class=p>.</span><span class=nf>area</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>method 可以定义在任何你自定义的类型、内置类型、struct 等各种类型上面。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>WHITE</span> <span class=p>=</span> <span class=kc>iota</span>
</span></span><span class=line><span class=cl>	<span class=nx>BLACK</span>
</span></span><span class=line><span class=cl>	<span class=nx>BLUE</span>
</span></span><span class=line><span class=cl>	<span class=nx>RED</span>
</span></span><span class=line><span class=cl>	<span class=nx>YELLOW</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Color</span> <span class=kt>byte</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Box</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>width</span><span class=p>,</span> <span class=nx>height</span><span class=p>,</span> <span class=nx>depth</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>	<span class=nx>color</span> <span class=nx>Color</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>BoxList</span> <span class=p>[]</span><span class=nx>Box</span> <span class=c1>//a slice of boxes
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=nx>Box</span><span class=p>)</span> <span class=nf>Volume</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=nx>b</span><span class=p>.</span><span class=nx>height</span> <span class=o>*</span> <span class=nx>b</span><span class=p>.</span><span class=nx>depth</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>Box</span><span class=p>)</span> <span class=nf>SetColor</span><span class=p>(</span><span class=nx>c</span> <span class=nx>Color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>b</span><span class=p>.</span><span class=nx>color</span> <span class=p>=</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>bl</span> <span class=nx>BoxList</span><span class=p>)</span> <span class=nf>BiggestColor</span><span class=p>()</span> <span class=nx>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>v</span> <span class=o>:=</span> <span class=mf>0.00</span>
</span></span><span class=line><span class=cl>	<span class=nx>k</span> <span class=o>:=</span> <span class=nf>Color</span><span class=p>(</span><span class=nx>WHITE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>b</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>bl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>bv</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nf>Volume</span><span class=p>();</span> <span class=nx>bv</span> <span class=p>&gt;</span> <span class=nx>v</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>v</span> <span class=p>=</span> <span class=nx>bv</span>
</span></span><span class=line><span class=cl>			<span class=nx>k</span> <span class=p>=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>color</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>k</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>bl</span> <span class=nx>BoxList</span><span class=p>)</span> <span class=nf>PaintItBlack</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>bl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>bl</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nf>SetColor</span><span class=p>(</span><span class=nx>BLACK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=nx>Color</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>strings</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span> <span class=p>{</span><span class=s>&#34;WHITE&#34;</span><span class=p>,</span> <span class=s>&#34;BLACK&#34;</span><span class=p>,</span> <span class=s>&#34;BLUE&#34;</span><span class=p>,</span> <span class=s>&#34;RED&#34;</span><span class=p>,</span> <span class=s>&#34;YELLOW&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>strings</span><span class=p>[</span><span class=nx>c</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>boxes</span> <span class=o>:=</span> <span class=nx>BoxList</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=nx>RED</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>YELLOW</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=nx>BLACK</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>BLUE</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>WHITE</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Box</span><span class=p>{</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=nx>YELLOW</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;We have %d boxes in our set\n&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>boxes</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The volume of the first one is&#34;</span><span class=p>,</span> <span class=nx>boxes</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nf>Volume</span><span class=p>(),</span> <span class=s>&#34;cm³&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The color of the last one is&#34;</span><span class=p>,</span><span class=nx>boxes</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=nx>boxes</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>].</span><span class=nx>color</span><span class=p>.</span><span class=nf>String</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The biggest one is&#34;</span><span class=p>,</span> <span class=nx>boxes</span><span class=p>.</span><span class=nf>BiggestColor</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Let&#39;s paint them all black&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>boxes</span><span class=p>.</span><span class=nf>PaintItBlack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The color of the second one is&#34;</span><span class=p>,</span> <span class=nx>boxes</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=nx>color</span><span class=p>.</span><span class=nf>String</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Obviously, now, the biggest one is&#34;</span><span class=p>,</span> <span class=nx>boxes</span><span class=p>.</span><span class=nf>BiggestColor</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=值类型调用与指针类型调用>值类型调用与指针类型调用</h4><p><a href=https://learnku.com/docs/effective-go/2020/method/6245 target=_blank rel="external nofollow noopener noreferrer">https://learnku.com/docs/effective-go/2020/method/6245</a></p><blockquote><p>如果一个 method 的 receiver 是 *T，你可以在一个 T 类型的实例变量 V 上面调用这个 method，而不需要 &V 去调用这个 method</p><p>如果一个 method 的 receiver 是 T，你可以在一个 *T 类型的变量 P 上面调用这个 method，而不需要 *P 去调用这个 method</p><p><strong>但是一切结果取决于 receiver 的类型</strong></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Data</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 值类型调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=nx>User</span><span class=p>)</span> <span class=nf>NotifyValue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v : %v \n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 指针类型调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=nf>NotifyPointer</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v : %v \n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当接受者不是一个指针时，<strong>方法</strong>操作对应接受者的值的<strong>副本</strong>——即使你使用了指针调用函数，但是函数的接受者是值类型，所以函数内部操作还是对副本的操作，而不是指针操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 值类型调用方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>u1</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span><span class=s>&#34;golang&#34;</span><span class=p>,</span> <span class=s>&#34;golang@golang.com&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>u1</span><span class=p>.</span><span class=nf>NotifyValue</span><span class=p>()</span> <span class=c1>//正常
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 指针类型调用方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>u2</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span><span class=s>&#34;go&#34;</span><span class=p>,</span> <span class=s>&#34;go@go.com&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>u3</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>u2</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 可以简写成 u3 := &amp;User{&#34;go&#34;, &#34;go@go.com&#34;}
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>u3</span><span class=p>.</span><span class=nf>NotifyValue</span><span class=p>()</span> <span class=c1>//当我们使用指针时，Go 调整和解引用指针使得调用可以被执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>同理，当接受者是指针时，即使用值类型调用那么函数内部也是对指针的操作</p><p>所以，是值调用还是指针调用，<strong>一切取决于接受者的类型</strong></p><h4 id=普通函数与方法的区别>普通函数与方法的区别</h4><ul><li>对于普通函数，接收者为值类型时，不能将指针类型的数据直接传递，反之亦然。</li><li>对于方法（如 struct 的方法），接收者为值类型时，可以直接用指针类型的变量调用方法，反过来同样也可以。</li></ul><h4 id=method-继承>method 继承</h4><p>如果匿名字段实现了一个 method，那么包含这个匿名字段的 struct 也能调用该 method</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>phone</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Student</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span> <span class=c1>//匿名字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>school</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Employee</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span> <span class=c1>//匿名字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>company</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//在human上面定义了一个method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Human</span><span class=p>)</span> <span class=nf>SayHi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Hi, I am %s you can call me on %s\n&#34;</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span> <span class=o>:=</span> <span class=nx>Student</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Mark&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=s>&#34;222-222-YYYY&#34;</span><span class=p>},</span> <span class=s>&#34;MIT&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>sam</span> <span class=o>:=</span> <span class=nx>Employee</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Sam&#34;</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=s>&#34;111-888-XXXX&#34;</span><span class=p>},</span> <span class=s>&#34;Golang Inc&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span><span class=p>.</span><span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>sam</span><span class=p>.</span><span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=method-重写>method 重写</h4><p>可以在 Employee 上面定义一个 method，重写匿名字段的方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Employee的method重写Human的method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Employee</span><span class=p>)</span> <span class=nf>SayHi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Hi, I am %s, I work at %s. Call me on %s\n&#34;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>e</span><span class=p>.</span><span class=nx>company</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span> <span class=c1>//Yes you can split into 2 lines here.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span> <span class=o>:=</span> <span class=nx>Student</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Mark&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=s>&#34;222-222-YYYY&#34;</span><span class=p>},</span> <span class=s>&#34;MIT&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>sam</span> <span class=o>:=</span> <span class=nx>Employee</span><span class=p>{</span><span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Sam&#34;</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=s>&#34;111-888-XXXX&#34;</span><span class=p>},</span> <span class=s>&#34;Golang Inc&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mark</span><span class=p>.</span><span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>sam</span><span class=p>.</span><span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=interface-函数参数>interface 函数参数</h4><p>interface 的变量可以持有任意实现该 interface 类型的对象，这给我们编写函数 (包括 method ) 提供了一些额外的思考，我们是不是可以通过定义 interface 参数，让函数接受各种类型的参数。</p><p>举个例子：fmt.Println 是我们常用的一个函数，但是它可以接受任意类型的数据。打开 fmt 的源码文件，你会看到这样一个定义:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Stringer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	 <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>也就是说，任何实现了 String 方法的类型都能作为参数被 fmt.Println 调用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strconv&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>phone</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 通过这个方法 Human 实现了 fmt.Stringer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=nx>Human</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s>&#34;❰&#34;</span><span class=o>+</span><span class=nx>h</span><span class=p>.</span><span class=nx>name</span><span class=o>+</span><span class=s>&#34; - &#34;</span><span class=o>+</span><span class=nx>strconv</span><span class=p>.</span><span class=nf>Itoa</span><span class=p>(</span><span class=nx>h</span><span class=p>.</span><span class=nx>age</span><span class=p>)</span><span class=o>+</span><span class=s>&#34; years -  ✆ &#34;</span> <span class=o>+</span><span class=nx>h</span><span class=p>.</span><span class=nx>phone</span><span class=o>+</span><span class=s>&#34;❱&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bob</span> <span class=o>:=</span> <span class=nx>Human</span><span class=p>{</span><span class=s>&#34;Bob&#34;</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=s>&#34;000-7777-XXX&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;This Human is : &#34;</span><span class=p>,</span> <span class=nx>Bob</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=接口-interfaces>接口 interfaces</h3><p>一般而言，<strong>接口定义了一组方法的集合</strong>，我们通过 interface 来定义对象的一组行为。</p><ul><li><p>如果某个对象实现了某个接口的所有方法，则此对象就实现了此接口</p></li><li><p>接口不能被实例化</p></li><li><p>一个类型可以实现多个接口。</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Human</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>age</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>phone</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Student</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span> <span class=c1>//匿名字段Human
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>school</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>loan</span> <span class=kt>float32</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Employee</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Human</span> <span class=c1>//匿名字段Human
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>company</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>money</span> <span class=kt>float32</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Human对象实现Sayhi方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Human</span><span class=p>)</span> <span class=nf>SayHi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Hi, I am %s you can call me on %s\n&#34;</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Human对象实现Sing方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Human</span><span class=p>)</span> <span class=nf>Sing</span><span class=p>(</span><span class=nx>lyrics</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;La la, la la la, la la la la la...&#34;</span><span class=p>,</span> <span class=nx>lyrics</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Human对象实现Guzzle方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Human</span><span class=p>)</span> <span class=nf>Guzzle</span><span class=p>(</span><span class=nx>beerStein</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Guzzle Guzzle Guzzle...&#34;</span><span class=p>,</span> <span class=nx>beerStein</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Employee重载Human的Sayhi方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Employee</span><span class=p>)</span> <span class=nf>SayHi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Hi, I am %s, I work at %s. Call me on %s\n&#34;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>e</span><span class=p>.</span><span class=nx>company</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>phone</span><span class=p>)</span> <span class=c1>//此句可以分成多行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Student实现BorrowMoney方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>Student</span><span class=p>)</span> <span class=nf>BorrowMoney</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float32</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span><span class=p>.</span><span class=nx>loan</span> <span class=o>+=</span> <span class=nx>amount</span> <span class=c1>// (again and again and...)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Employee实现SpendSalary方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Employee</span><span class=p>)</span> <span class=nf>SpendSalary</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float32</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>e</span><span class=p>.</span><span class=nx>money</span> <span class=o>-=</span> <span class=nx>amount</span> <span class=c1>// More vodka please!!! Get me through the day!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义interface
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Men</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>Sing</span><span class=p>(</span><span class=nx>lyrics</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Guzzle</span><span class=p>(</span><span class=nx>beerStein</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>YoungChap</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>Sing</span><span class=p>(</span><span class=nx>song</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>BorrowMoney</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ElderlyGent</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>SayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>Sing</span><span class=p>(</span><span class=nx>song</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>SpendSalary</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>任意的类型都实现了空 interface（我们这样定义：<code>interface{}</code>)，也就是包含 0 个方法的 interface。</p></blockquote><ul><li>对象不需要显式地声明实现了哪一个接口，只需要直接实现该接口对应的方法即可。</li><li>如果我们定义了一个 interface 的变量，那么这个变量里面可以存实现这个 interface 的任意类型的对象</li></ul><p>总而言之，interface 就是一组抽象方法的集合，它必须由其他非 interface 类型来实现，而不能自我实现； Go 通过 interface 实现了 duck-typing：&ldquo;当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子&rdquo;。</p><h3 id=空接口>空接口</h3><p>如果定义了一个没有任何方法的空接口，那么这个接口可以表示任意类型，有点类似于 C 语言的 <code>void*</code> 类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义a为空接口
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>a</span> <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>i</span> <span class=kt>int</span> <span class=p>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;Hello world&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// a可以存储任意类型的数值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>a</span> <span class=p>=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>    <span class=nx>a</span> <span class=p>=</span> <span class=nx>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span><span class=p>[</span><span class=s>&#34;name&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;Tom&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span><span class=p>[</span><span class=s>&#34;age&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span><span class=p>[</span><span class=s>&#34;scores&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>98</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>85</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>m</span><span class=p>)</span> <span class=c1>// map[age:18 name:Tom scores:[98 99 85]]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=类型断言>类型断言</h3><p>类型断言（Type Assertion）是一个<strong>使用在接口值上</strong>的操作，用于检查接口类型变量所持有的值是否实现了期望的接口或者具体的类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>x</span><span class=p>.(</span><span class=nx>T</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>x 表示一个接口的类型，T 表示一个具体的类型（也可为接口类型）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>x</span> <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>x</span><span class=p>.(</span><span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=s>&#34;,&#34;</span><span class=p>,</span> <span class=nx>ok</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>10,true
</span></span></code></pre></td></tr></table></div></div><h2 id=并发编程-goroutine>并发编程 goroutine</h2><blockquote><p>不要通过共享来通信，而要通过通信来共享</p></blockquote><h3 id=sync>sync</h3><p>Go 语言提供了 sync 和 channel 两种方式支持协程 (goroutine) 的并发。</p><p>例如我们希望并发下载 N 个资源，多个并发协程之间不需要通信，那么就可以使用 sync.WaitGroup，等待所有并发协程执行结束。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>wg</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>download</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;start to download&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>// 模拟耗时操作
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=nf>download</span><span class=p>(</span><span class=s>&#34;a.com/&#34;</span> <span class=o>+</span> <span class=nb>string</span><span class=p>(</span><span class=nx>i</span><span class=o>+</span><span class=sc>&#39;0&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Done!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>wg.Add(1)</code>：为 wg 添加一个计数，<code>wg.Done()</code>，减去一个计数。</li><li><code>go download()</code>：启动新的协程并发执行 download 函数。</li><li><code>wg.Wait()</code>：等待所有的协程执行结束。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$  time go run .
</span></span><span class=line><span class=cl>start to download a.com/2
</span></span><span class=line><span class=cl>start to download a.com/0
</span></span><span class=line><span class=cl>start to download a.com/1
</span></span><span class=line><span class=cl>Done!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real    0m1.563s
</span></span></code></pre></td></tr></table></div></div><p>可以看到串行需要 3s 的下载操作，并发后，只需要 1s。</p><h3 id=channel>channel</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ch</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>string</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=c1>// 创建大小为 10 的缓冲信道
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>download</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;start to download&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>url</span> <span class=c1>// 将 url 发送给信道
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=nf>download</span><span class=p>(</span><span class=s>&#34;a.com/&#34;</span> <span class=o>+</span> <span class=nb>string</span><span class=p>(</span><span class=nx>i</span><span class=o>+</span><span class=sc>&#39;0&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span> <span class=c1>// 等待信道返回消息。
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;finish&#34;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Done!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 channel 信道，可以在协程之间传递消息。阻塞等待并发协程返回消息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>time</span> go run .
</span></span><span class=line><span class=cl>start to download a.com/2
</span></span><span class=line><span class=cl>start to download a.com/0
</span></span><span class=line><span class=cl>start to download a.com/1
</span></span><span class=line><span class=cl>finish a.com/2
</span></span><span class=line><span class=cl>finish a.com/1
</span></span><span class=line><span class=cl>finish a.com/0
</span></span><span class=line><span class=cl>Done!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real    0m1.528s
</span></span></code></pre></td></tr></table></div></div><h2 id=单元测试-unit-test>单元测试 (unit test)</h2><p>假设我们希望测试 package main 下 <code>calc.go</code> 中的函数，要只需要新建 <code>calc_test.go</code> 文件，在 <code>calc_test.go</code> 中新建测试用例即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// calc.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>num1</span> <span class=o>+</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// calc_test.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestAdd</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>ans</span> <span class=o>:=</span> <span class=nf>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span> <span class=nx>ans</span> <span class=o>!=</span> <span class=mi>3</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=s>&#34;add(1, 2) should be equal to 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>go test</code>，将自动运行当前 package 下的所有测试用例，如果需要查看详细的信息，可以添加<code>-v</code>参数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go <span class=nb>test</span> -v
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestAdd
</span></span><span class=line><span class=cl>--- PASS: TestAdd <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok      example 0.040s
</span></span></code></pre></td></tr></table></div></div><h2 id=包-package-和模块-modules>包 (Package) 和模块 (Modules)</h2><h3 id=package>Package</h3><p>一般来说，一个文件夹可以作为 package，同一个 package 内部变量、类型、方法等定义可以相互看到。</p><p>比如我们新建一个文件 <code>calc.go</code>， <code>main.go</code> 平级，分别定义 add 和 main 方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// calc.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>num1</span> <span class=o>+</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// main.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>add</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span> <span class=c1>// 8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>go run main.go</code>，会报错，add 未定义：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./main.go:6:14: undefined: add
</span></span></code></pre></td></tr></table></div></div><p>因为 <code>go run main.go</code> 仅编译 main.go 一个文件，所以命令需要换成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ go run main.go calc.go
</span></span><span class=line><span class=cl>8
</span></span></code></pre></td></tr></table></div></div><p>或</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ go run .
</span></span><span class=line><span class=cl>8
</span></span></code></pre></td></tr></table></div></div><p>Go 语言也有 Public 和 Private 的概念，粒度是包。如果类型/接口/方法/函数/字段的首字母大写，则是 Public 的，对其他 package 可见，如果首字母小写，则是 Private 的，对其他 package 不可见。</p><h3 id=modules>Modules</h3><p>Go Modules 是 Go 1.11 版本之后引入的，Go 1.11 之前使用 $GOPATH 机制。</p><p>Go Modules 可以算作是较为完善的包管理工具。同时支持代理，国内也能享受高速的第三方包镜像服务。</p><p>Go Modules 在 1.13 版本仍是可选使用的，环境变量 GO111MODULE 的值默认为 AUTO，强制使用 Go Modules 进行依赖管理，可以将 GO111MODULE 设置为 ON。</p><p>在一个空文件夹下，初始化一个 Module</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ go mod init example
</span></span><span class=line><span class=cl>go: creating new go.mod: module example
</span></span></code></pre></td></tr></table></div></div><p>此时，在当前文件夹下生成了<code>go.mod</code>，这个文件记录当前模块的模块名以及所有依赖包的版本。</p><p>接着，我们在当前目录下新建文件 <code>main.go</code>，添加如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;rsc.io/quote&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>quote</span><span class=p>.</span><span class=nf>Hello</span><span class=p>())</span>  <span class=c1>// Ahoy, world!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>go run .</code>，将会自动触发第三方包 <code>rsc.io/quote</code>的下载，具体的版本信息也记录在了<code>go.mod</code>中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-v data-lang=v><span class=line><span class=cl><span class=kn>module</span> <span class=nv>example</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=mf>1.13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>require</span> <span class=nv>rsc</span><span class=p>.</span><span class=nv>io</span><span class=o>/</span><span class=nv>quote</span> <span class=nv>v3</span><span class=mf>.1.0</span><span class=o>+</span><span class=nv>incompatible</span>
</span></span></code></pre></td></tr></table></div></div><p>我们在当前目录，添加一个子 package calc，代码目录如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>demo/
</span></span><span class=line><span class=cl>   |--calc/
</span></span><span class=line><span class=cl>      |--calc.go
</span></span><span class=line><span class=cl>   |--main.go
</span></span></code></pre></td></tr></table></div></div><p>在 <code>calc.go</code> 中写入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>calc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>num1</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>num2</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>num1</span> <span class=o>+</span> <span class=nx>num2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在 package main 中如何使用 package cal 中的 Add 函数呢？<code>import 模块名/子目录名</code> 即可，修改后的 main 函数如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;example/calc&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;rsc.io/quote&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>quote</span><span class=p>.</span><span class=nf>Hello</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>calc</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=k>go</span> <span class=nx>run</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Ahoy</span><span class=p>,</span> <span class=nx>world</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=mi>13</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=一些技巧和特性>一些技巧和特性</h2><h3 id=零散的特性>零散的特性</h3><ul><li>Go 的相对路径是相对于<strong>执行命令时的目录</strong></li></ul><h3 id=分组声明>分组声明</h3><p>在Go语言中，同时声明多个常量、变量，或者导入多个包时，可采用分组的方式进行声明。</p><p>例如下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>i</span> <span class=p>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>pi</span> <span class=p>=</span> <span class=mf>3.1415</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>prefix</span> <span class=p>=</span> <span class=s>&#34;Go_&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>i</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>pi</span> <span class=kt>float32</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>prefix</span> <span class=kt>string</span>
</span></span></code></pre></td></tr></table></div></div><p>可以分组写成如下形式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>i</span> <span class=p>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>	<span class=nx>pi</span> <span class=p>=</span> <span class=mf>3.1415</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=p>=</span> <span class=s>&#34;Go_&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>i</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>pi</span> <span class=kt>float32</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=iota-枚举>iota 枚举</h3><p>Go 里面有一个关键字 <code>iota</code>，这个关键字用来声明 <code>enum</code> 的时候采用，它默认开始值是 0，const 中每增加一行加 1</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>x</span> <span class=p>=</span> <span class=kc>iota</span> <span class=c1>// x == 0
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>y</span> <span class=p>=</span> <span class=kc>iota</span> <span class=c1>// y == 1
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>z</span> <span class=p>=</span> <span class=kc>iota</span> <span class=c1>// z == 2
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>w</span>        <span class=c1>// 常量声明省略值时，默认和之前一个值的字面相同。这里隐式地说w = iota，因此w == 3。其实上面y和z可同样不用&#34;= iota&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>v</span> <span class=p>=</span> <span class=kc>iota</span> <span class=c1>// 每遇到一个const关键字，iota就会重置，此时v == 0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>h</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=p>=</span> <span class=kc>iota</span><span class=p>,</span> <span class=kc>iota</span><span class=p>,</span> <span class=kc>iota</span> <span class=c1>//h=0,i=0,j=0 iota在同一行值相同
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>a</span>       <span class=p>=</span> <span class=kc>iota</span> <span class=c1>// a=0
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>b</span>       <span class=p>=</span> <span class=s>&#34;B&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span>       <span class=p>=</span> <span class=kc>iota</span>             <span class=c1>//c=2
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>d</span><span class=p>,</span> <span class=nx>e</span><span class=p>,</span> <span class=nx>f</span> <span class=p>=</span> <span class=kc>iota</span><span class=p>,</span> <span class=kc>iota</span><span class=p>,</span> <span class=kc>iota</span> <span class=c1>//d=3,e=3,f=3
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>g</span>       <span class=p>=</span> <span class=kc>iota</span>             <span class=c1>//g = 4
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>d</span><span class=p>,</span> <span class=nx>e</span><span class=p>,</span> <span class=nx>f</span><span class=p>,</span> <span class=nx>g</span><span class=p>,</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>除非被显式设置为其它值或 <code>iota</code>，每个 <code>const</code> 分组的第一个常量被默认设置为它的 0 值，第二及后续的常量被默认设置为它前面那个常量的值，如果前面那个常量的值是 <code>iota</code>，则它也被设置为 <code>iota</code>。</p><h3 id=变量函数命名原则>变量、函数命名原则</h3><ul><li>大写字母开头的变量是可导出的，也就是其它包可以读取的，是公有变量；小写字母开头的就是不可导出的，是私有变量。</li><li>大写字母开头的函数也是一样，相当于 <code>class</code> 中的带 <code>public</code> 关键词的公有函数；小写字母开头的就是有<code>private</code> 关键词的私有函数。</li></ul><h3 id=切片中删除元素>切片中删除元素</h3><p>Go语言并没有对删除切片元素提供专用的语法或者接口，需要使用切片本身的特性来删除元素，根据要删除元素的位置有三种情况，分别是从开头位置删除、从中间位置删除和从尾部删除，其中删除切片尾部的元素速度最快。</p><h4 id=从开头位置删除>从开头位置删除</h4><p>删除开头的元素可以直接移动数据指针：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=c1>// 删除开头1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[</span><span class=nx>N</span><span class=p>:]</span> <span class=c1>// 删除开头N个元素
</span></span></span></code></pre></td></tr></table></div></div><p>也可以不移动数据指针，但是将后面的数据向开头移动，可以用 <code>append()</code> 原地完成（所谓原地完成是指在原有的切片数据对应的内存区间内完成，不会导致内存空间结构的变化）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span><span class=nx>a</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>a</span><span class=p>[:</span><span class=mi>0</span><span class=p>],</span> <span class=nx>a</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span> <span class=c1>// 删除开头1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>a</span><span class=p>[:</span><span class=mi>0</span><span class=p>],</span> <span class=nx>a</span><span class=p>[</span><span class=nx>N</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span> <span class=c1>// 删除开头N个元素
</span></span></span></code></pre></td></tr></table></div></div><p>还可以用 <code>copy()</code> 函数来删除开头的元素：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nb>copy</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>a</span><span class=p>[</span><span class=mi>1</span><span class=p>:])]</span> <span class=c1>// 删除开头1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nb>copy</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>a</span><span class=p>[</span><span class=nx>N</span><span class=p>:])]</span> <span class=c1>// 删除开头N个元素
</span></span></span></code></pre></td></tr></table></div></div><h4 id=从中间位置删除>从中间位置删除</h4><p>对于删除中间的元素，需要对剩余的元素进行一次整体挪动，同样可以用 <code>append()</code> 或 <code>copy()</code> 原地完成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=o>...</span><span class=p>}</span><span class=nx>a</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>a</span><span class=p>[:</span><span class=nx>i</span><span class=p>],</span> <span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span> <span class=c1>// 删除中间1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>a</span><span class=p>[:</span><span class=nx>i</span><span class=p>],</span> <span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=nx>N</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span> <span class=c1>// 删除中间N个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nx>i</span><span class=o>+</span><span class=nb>copy</span><span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=p>:],</span> <span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:])]</span> <span class=c1>// 删除中间1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nx>i</span><span class=o>+</span><span class=nb>copy</span><span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=p>:],</span> <span class=nx>a</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=nx>N</span><span class=p>:])]</span> <span class=c1>// 删除中间N个元素
</span></span></span></code></pre></td></tr></table></div></div><h4 id=从尾部删除>从尾部删除</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=c1>// 删除尾部1个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>a</span> <span class=p>=</span> <span class=nx>a</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span><span class=o>-</span><span class=nx>N</span><span class=p>]</span> <span class=c1>// 删除尾部N个元素
</span></span></span></code></pre></td></tr></table></div></div><p>删除开头的元素和删除尾部的元素都可以认为是删除中间元素操作的特殊情况，下面来看一个示例。</p><p>示例：删除切片指定位置的元素。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>seq</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;b&#34;</span><span class=p>,</span> <span class=s>&#34;c&#34;</span><span class=p>,</span> <span class=s>&#34;d&#34;</span><span class=p>,</span> <span class=s>&#34;e&#34;</span><span class=p>}</span>    <span class=c1>// 指定删除位置    
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>index</span> <span class=o>:=</span> <span class=mi>2</span>    <span class=c1>// 查看删除位置之前的元素和之后的元素    
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>seq</span><span class=p>[:</span><span class=nx>index</span><span class=p>],</span> <span class=nx>seq</span><span class=p>[</span><span class=nx>index</span><span class=o>+</span><span class=mi>1</span><span class=p>:])</span>    <span class=c1>// 将删除点前后的元素连接起来    
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>seq</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>seq</span><span class=p>[:</span><span class=nx>index</span><span class=p>],</span> <span class=nx>seq</span><span class=p>[</span><span class=nx>index</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>seq</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=类型选择>类型选择</h3><p>switch 也可用于判断接口变量的动态类型。如 类型选择 通过圆括号中的关键字 type 使用类型断言语法。若 switch 在表达式中声明了一个变量，那么该变量的每个子句中都将有该变量对应的类型。在每一个 case 子句中，重复利用该变量名字也是惯常的做法，实际上这是在每一个 case 子句中，分别声明一个拥有相同名字，但类型不同的新变量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>t</span> <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=nx>t</span> <span class=p>=</span> <span class=nf>functionOfSomeType</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=nx>t</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;unexpected type %T\n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>     <span class=c1>// %T 打印任何类型的 t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>case</span> <span class=kt>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;boolean %t\n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>             <span class=c1>// t 是 bool 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>case</span> <span class=kt>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;integer %d\n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>             <span class=c1>// t 是 int 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>case</span> <span class=o>*</span><span class=kt>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;pointer to boolean %t\n&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>t</span><span class=p>)</span> <span class=c1>// t 是 *bool 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>case</span> <span class=o>*</span><span class=kt>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;pointer to integer %d\n&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>t</span><span class=p>)</span> <span class=c1>// t 是 *int 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=判断-map-中是否存在某键>判断 map 中是否存在某键</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>seconds</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>timeZone</span><span class=p>[</span><span class=nx>tz</span><span class=p>];</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>t</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=init-函数>init 函数</h3><p>每个源文件都可以通过定义自己的无参数 init 函数来设置一些必要的状态。 （其实每个文件都可以拥有多个 init 函数。）而它的结束就意味着初始化结束： 只有该包中的所有变量声明都通过它们的初始化器求值后 init 才会被调用， 而包中的变量只有在所有已导入的包都被初始化后才会被求值。</p><p>除了那些不能被表示成声明的初始化外，init 函数还常被用在程序真正开始执行前，检验或校正程序的状态。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>user</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;$USER not set&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>home</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>home</span> <span class=p>=</span> <span class=s>&#34;/home/&#34;</span> <span class=o>+</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>gopath</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>gopath</span> <span class=p>=</span> <span class=nx>home</span> <span class=o>+</span> <span class=s>&#34;/go&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// gopath 可通过命令行中的 --gopath 标记覆盖掉。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>flag</span><span class=p>.</span><span class=nf>StringVar</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>gopath</span><span class=p>,</span> <span class=s>&#34;gopath&#34;</span><span class=p>,</span> <span class=nx>gopath</span><span class=p>,</span> <span class=s>&#34;override default GOPATH&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=runtimecaller>runtime.Caller()</h3><p>报告当前 go 程调用栈所执行的函数的文件和行号信息</p><p>获取（调用处）上 n 个函数的信息，像一个栈</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Caller</span><span class=p>(</span><span class=nx>skip</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>pc</span> <span class=kt>uintptr</span><span class=p>,</span> <span class=nx>file</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>line</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>ok</span> <span class=kt>bool</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>参数</p><ul><li><p>skip：要提升的堆栈帧数，0 当前函数，1 上一层函数</p><p>返回值</p></li><li><p>pc：函数指针</p></li><li><p>file：函数所在文件名目录</p></li><li><p>line：所在行号</p></li><li><p>ok：是否可以获取到信息</p></li></ul><h3 id=使用空白标识符进行接口检查>使用空白标识符进行接口检查</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>_</span> <span class=nx>json</span><span class=p>.</span><span class=nx>Marshaler</span> <span class=p>=</span> <span class=p>(</span><span class=o>*</span><span class=nx>RawMessage</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>在此声明中，我们调用了一个 *RawMessage 转换并将其赋予了 Marshaler，以此来要求 *RawMessage 实现 Marshaler，这时其属性就会在编译时被检测。</p><p>若 json.Marshaler 接口被更改，此包将无法通过编译， 而我们则会注意到它需要更新。</p><p>在这种结构中出现空白标识符，即表示该声明的存在只是为了类型检查。</p><p>不过请不要为满足接口就将它用于任何类型。作为约定， 只有当代码中不存在静态类型转换时才能使用这种声明，毕竟这是种非常罕见的情况。</p><h3 id=make-和-new-的区别><code>make</code> 和 <code>new</code> 的区别</h3><p>可以参考：https://learnku.com/docs/effective-go/2020/data/6243</p><ul><li><code>make</code> 的作用是初始化内置的数据结构，也就是我们在前面提到的切片、哈希表和 Channel</li><li><code>new</code> 的作用是根据传入的类型分配一片内存空间并返回指向这片内存空间的指针<ul><li>表达式 <code>new(File)</code> 和 <code>&File{}</code> 是等价的。</li></ul></li></ul><h3 id=解决-go-的相对路径问题>解决 Go 的相对路径问题</h3><h4 id=获取当前可执行文件路径>获取当前可执行文件路径</h4><p>将配置文件的相对路径与<code>GetAppPath()</code>的结果相拼接，可解决 <code>go build main.go</code> 的可执行文件跨目录执行的问题（如：<code>go build ./src/gin-blog/main.go</code>）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;path/filepath&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;os/exec&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;string&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetAppPath</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>file</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>exec</span><span class=p>.</span><span class=nf>LookPath</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>filepath</span><span class=p>.</span><span class=nf>Abs</span><span class=p>(</span><span class=nx>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>index</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>LastIndex</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>PathSeparator</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>path</span><span class=p>[:</span><span class=nx>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>但是这种方式，对于 <code>go run</code> 依旧无效。因为 <code>go run</code> 执行时会将文件放到 <code>/tmp/go-build...</code> 目录下，编译并运行：</p><blockquote><p>Run compiles and runs the main package comprising the named Go source files.</p><p>A Go source file is defined to be a file ending in a literal &ldquo;.go&rdquo; suffix.</p></blockquote><p>通过传递参数指定路径，可解决 <code>go run</code> 的问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>appPath</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>flag</span><span class=p>.</span><span class=nf>StringVar</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>appPath</span><span class=p>,</span> <span class=s>&#34;app-path&#34;</span><span class=p>,</span> <span class=s>&#34;app-path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;App path: %s&#34;</span><span class=p>,</span> <span class=nx>appPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>run</span> <span class=nx>main</span><span class=p>.</span><span class=k>go</span> <span class=o>--</span><span class=nx>app</span><span class=o>-</span><span class=nx>path</span> <span class=s>&#34;Your project address&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=增加-osgetwd-进行多层判断>增加 <code>os.Getwd()</code> 进行多层判断</h4><p>参见 <a href=https://github.com/astaxie/beego/blob/master/config.go#L133-L146 target=_blank rel="external nofollow noopener noreferrer">beego</a> 读取 <code>app.conf</code> 的代码</p><p>该写法可兼容 <code>go build</code> 和在项目根目录执行 <code>go run</code> ，但是若跨目录执行 <code>go run</code> 就不行</p><h4 id=配置全局系统变量>配置全局系统变量</h4><p>我们可以通过 <code>os.Getenv</code> 来获取系统全局变量，然后与相对路径进行拼接</p><p>1、 设置项目工作区</p><p>简单来说，就是设置项目（应用）的工作路径，然后与配置文件、日志文件等相对路径进行拼接，达到相对的绝对路径来保证路径一致</p><p>参见 <a href=https://github.com/gogits/gogs/blob/master/pkg/setting/setting.go#L351 target=_blank rel="external nofollow noopener noreferrer">gogs</a> 读取 <code>GOGS_WORK_DIR</code> 进行拼接的代码</p><p>2、 利用系统自带变量</p><p>简单来说就是通过系统自带的全局变量，例如 <code>$HOME</code> 等，将配置文件存放在 <code>$HOME/conf</code>或<code>/etc/conf</code> 下</p><p>这样子就能更加固定的存放配置文件，<strong>不需要额外去设置一个环境变量</strong></p><blockquote><p><code>go test</code> 在一些场景下也会遇到路径问题，因为<code>go test</code>只能够在当前目录执行，所以在执行测试用例的时候，你的执行目录已经是测试目录了</p></blockquote><h3 id=包装错误>包装错误</h3><p>使用 <code>errors.Wrap</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;additional message to a given error&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=不要忘记为-iota-指定一种类型>不要忘记为 <code>iota</code> 指定一种类型</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=p>=</span> <span class=kc>iota</span>
</span></span><span class=line><span class=cl>    <span class=nx>testvar</span>         <span class=c1>// testvar 将是 int 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>vs</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>myType</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=nx>myType</span> <span class=p>=</span> <span class=kc>iota</span>
</span></span><span class=line><span class=cl>    <span class=nx>testvar</span>         <span class=c1>// testvar 将是 myType 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=防止结构体字段用纯值方式初始化添加-_-struct--字段>防止结构体字段用纯值方式初始化，添加 <code>_ struct {}</code> 字段：</h3><p>当你的结构体要求强制给出所有参数才允许初始化时：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Point</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>X</span><span class=p>,</span> <span class=nx>Y</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>  <span class=nx>_</span>    <span class=kd>struct</span><span class=p>{}</span> <span class=c1>// to prevent unkeyed literals
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上例结构体的初始化，允许有 <code>Point {X：1，Y：1}</code> ，但是对于 <code>Point {1,1}</code> 则会出现编译错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>./file.go:1:11: too few values in Point literal
</span></span></code></pre></td></tr></table></div></div><p>当在你所有的结构体中添加了 <code>_ struct{}</code> 后，使用 <code>go vet</code> 命令进行检查，（原来声明的方式）就会提示没有足够的参数。</p><h3 id=二维数组的创建方法>二维数组的创建方法</h3><p>有时必须分配一个二维数组，例如在处理像素的扫描行时，这种情况就会发生。 我们有两种方式来达到这个目的。</p><ol><li>独立地分配每一个切片；</li><li>只分配一个数组， 将各个切片都指向它。</li></ol><p>采用哪种方式取决于你的应用。若切片会增长或收缩， 就应该通过独立分配来避免覆盖下一行；若不会，用单次分配来构造对象会更加高效。</p><p>一次一行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 分配底层切片.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>picture</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([][]</span><span class=kt>uint8</span><span class=p>,</span> <span class=nx>YSize</span><span class=p>)</span> <span class=c1>// y每一行的大小
</span></span></span><span class=line><span class=cl><span class=c1>//循环遍历每一行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>picture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>picture</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>uint8</span><span class=p>,</span> <span class=nx>XSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>一次分配，对行进行切片：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 分配底层切片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>picture</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([][]</span><span class=kt>uint8</span><span class=p>,</span> <span class=nx>YSize</span><span class=p>)</span> <span class=c1>//  每 y 个单元一行。
</span></span></span><span class=line><span class=cl><span class=c1>// 分配一个大一些的切片以容纳所有的元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pixels</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>uint8</span><span class=p>,</span> <span class=nx>XSize</span><span class=o>*</span><span class=nx>YSize</span><span class=p>)</span> <span class=c1>// 指定类型[]uint8, 即便图片是 [][]uint8.
</span></span></span><span class=line><span class=cl><span class=c1>//循环遍历图片所有行，从剩余像素切片的前面对每一行进行切片。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>picture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>picture</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>pixels</span> <span class=p>=</span> <span class=nx>pixels</span><span class=p>[:</span><span class=nx>XSize</span><span class=p>],</span> <span class=nx>pixels</span><span class=p>[</span><span class=nx>XSize</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=集合的实现>集合的实现</h3><p>集合可实现成一个值类型为 bool 的映射。将该映射中的项置为 true 可将该值放入集合中，此后通过简单的索引操作即可判断是否存在。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>attended</span> <span class=o>:=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>bool</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;Ann&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;Joe&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>attended</span><span class=p>[</span><span class=nx>person</span><span class=p>]</span> <span class=p>{</span> <span class=c1>// person不在集合中，返回 false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>person</span><span class=p>,</span> <span class=s>&#34;was at the meeting&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=字符串拼接的-7-种姿势>字符串拼接的 7 种姿势</h3><h4 id=string-concat>String Concat</h4><p>简单</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>str</span> <span class=o>+=</span> <span class=s>&#34;test-string&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=string-sprintf>String Sprintf</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>str</span> <span class=p>=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s%s&#34;</span><span class=p>,</span> <span class=nx>str</span><span class=p>,</span> <span class=s>&#34;test-string&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=string-join>String Join</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>str</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>([]</span><span class=kt>string</span><span class=p>{</span><span class=nx>str</span><span class=p>,</span> <span class=s>&#34;test-string&#34;</span><span class=p>},</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=buffer-write>Buffer Write</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>buf</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>buf</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;test-string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>str</span> <span class=o>:=</span> <span class=nx>buf</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=bytes-append>Bytes Append</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>b</span> <span class=p>[]</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl><span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;test-string&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>b</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>b</span><span class=p>,</span> <span class=nx>s</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>str</span> <span class=o>:=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=string-copy>String Copy</h4><p>奇奇怪怪，但是快</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ts</span> <span class=o>:=</span> <span class=s>&#34;test-string&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>n</span> <span class=o>:=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=nx>tsl</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>ts</span><span class=p>)</span> <span class=o>*</span> <span class=nx>n</span>
</span></span><span class=line><span class=cl><span class=nx>bs</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>tsl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>bl</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>bl</span> <span class=p>&lt;</span> <span class=nx>tsl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>bl</span> <span class=o>+=</span> <span class=nb>copy</span><span class=p>(</span><span class=nx>bs</span><span class=p>[</span><span class=nx>bl</span><span class=p>:],</span> <span class=nx>ts</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>str</span> <span class=o>:=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>bs</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=string-builder>String Builder</h4><p>好用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>builder</span> <span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span>
</span></span><span class=line><span class=cl><span class=nx>builder</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;test-string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>str</span> <span class=o>:=</span> <span class=nx>builder</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=性能测试>性能测试</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;bytes&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>sss</span> <span class=p>=</span> <span class=s>&#34;hello world!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>cnt</span> <span class=p>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>expected</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Repeat</span><span class=p>(</span><span class=nx>sss</span><span class=p>,</span> <span class=nx>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkStringConcat</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>str</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>str</span> <span class=o>+=</span> <span class=nx>sss</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nx>str</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkStringSprintf</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>str</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>str</span> <span class=p>=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s%s&#34;</span><span class=p>,</span> <span class=nx>str</span><span class=p>,</span> <span class=nx>sss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nx>str</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkStringJoin</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>str</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>str</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>([]</span><span class=kt>string</span><span class=p>{</span><span class=nx>str</span><span class=p>,</span> <span class=nx>sss</span><span class=p>},</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nx>str</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkBufferWrite</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>buf</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>buf</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>sss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nx>buf</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkBytesAppend</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>bbb</span> <span class=p>[]</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>bbb</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>bbb</span><span class=p>,</span> <span class=nx>sss</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>bbb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkStringCopy</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>tsl</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>sss</span><span class=p>)</span> <span class=o>*</span> <span class=nx>cnt</span>
</span></span><span class=line><span class=cl>        <span class=nx>bs</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>tsl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>bl</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>bl</span> <span class=p>&lt;</span> <span class=nx>tsl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>bl</span> <span class=o>+=</span> <span class=nb>copy</span><span class=p>(</span><span class=nx>bs</span><span class=p>[</span><span class=nx>bl</span><span class=p>:],</span> <span class=nx>sss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>bs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkStringBuilder</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>builder</span> <span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>cnt</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>builder</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>sss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=p>=</span> <span class=nx>builder</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>StopTimer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unexpected result; got=%s, want=%s&#34;</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>result</span><span class=p>),</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试结果:</p><p>BenchmarkStringConcat-4 19 61431933 ns/op 632845167 B/op 10005 allocs/op BenchmarkStringSprintf-4 10 109283838 ns/op 1075688336 B/op 29688 allocs/op BenchmarkStringJoin-4 15 75854431 ns/op 632844905 B/op 10003 allocs/op BenchmarkBufferWrite-4 10743 113597 ns/op 441616 B/op 13 allocs/op BenchmarkBytesAppend-4 15578 73796 ns/op 645104 B/op 24 allocs/op BenchmarkStringCopy-4 21416 55761 ns/op 245760 B/op 2 allocs/op BenchmarkStringBuilder-4 15961 74010 ns/op 522224 B/op 23 allocs/op</p><p>从测试结果来看，语法中的字符串拼接操作性能是极其低下的，对于操作频繁的大字符串，我们需考虑用更高效的方式替代。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-08-15 10:22:35">更新于 2022-08-15</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://trouvaille0198.github.io/Notes/posts/golang/basicgrammar/ data-title="Go 基础语法"><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://trouvaille0198.github.io/Notes/posts/golang/basicgrammar/><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://trouvaille0198.github.io/Notes/posts/golang/basicgrammar/ data-title="Go 基础语法" data-image=https://booklovinmamas.com/wp-content/uploads/2017/09/go.png><i class="fa-brands fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/Notes/>主页</a></span></section></div><div class=post-nav><a href=/Notes/posts/linux/useful/install/ class=prev rel=prev title="Linux 上的环境安装"><i class="fa-solid fa-angle-left fa-fw"></i>Linux 上的环境安装</a>
<a href=/Notes/posts/%E5%88%B7%E9%A2%98/array/%E6%8E%92%E5%BA%8F/56.-%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/ class=next rel=next title="56. 合并区间">56. 合并区间<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">酒困路长惟欲睡，日高人渴漫思茶</div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><div id=mask></div></div><link rel=stylesheet href=/Notes/lib/katex/katex.min.css><link rel=stylesheet href=/Notes/lib/katex/copy-tex.min.css><link rel=stylesheet href=/Notes/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/Notes/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/Notes/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/Notes/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/Notes/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/Notes/lib/katex/katex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/Notes/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/Notes/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:45},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/Notes/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/Notes/lib/lunr/lunr.segmentit.js",maxResultLength:30,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/Notes/js/theme.min.js defer></script><script type=text/javascript src=/Notes/js/_custom.min.js defer></script></body></html>