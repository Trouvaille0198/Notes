---
title: "Go æ³›å‹"
date: 2022-02-08
draft: false
author: "MelonCholi"
tags: []
categories: [Golang]
featuredImage: https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2048px-Go_gopher_favicon.svg.png
---

# Go æ³›å‹

<img src="https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/2048px-Go_gopher_favicon.svg.png" alt="File:Go gopher favicon.svg - Wikimedia Commons" style="zoom: 23%;" />

é€šè¿‡å¼•å…¥**ç±»å‹å½¢å‚**ï¼ˆtype parameterï¼‰å’Œ**ç±»å‹å®å‚**ï¼ˆtype argumentï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬è®©ä¸€ä¸ªå‡½æ•°è·å¾—äº†å¤„ç†å¤šç§ä¸åŒç±»å‹æ•°æ®çš„èƒ½åŠ›ï¼Œè¿™ç§ç¼–ç¨‹æ–¹å¼è¢«ç§°ä¸º**æ³›å‹ç¼–ç¨‹**ã€‚

æ³›å‹èƒ½å®ç°çš„åŠŸèƒ½é€šè¿‡**æ¥å£ + åå°„**ä¹ŸåŸºæœ¬èƒ½å®ç°ï¼Œä½†æ˜¯å®ƒæœ‰å¾ˆå¤šé—®é¢˜ï¼š

1. ç”¨èµ·æ¥éº»çƒ¦
2. å¤±å»äº†ç¼–è¯‘æ—¶çš„ç±»å‹æ£€æŸ¥ï¼Œä¸ä»”ç»†å†™å®¹æ˜“å‡ºé”™
3. æ€§èƒ½ä¸å¤ªç†æƒ³



Go çš„æ³›å‹(æˆ–è€…æˆ–ç±»å‹å½¢å‚)ç›®å‰å¯ä½¿ç”¨åœ¨3ä¸ªåœ°æ–¹

1. æ³›å‹ç±»å‹ - ç±»å‹å®šä¹‰ä¸­å¸¦ç±»å‹å½¢å‚çš„ç±»å‹
2. æ³›å‹ receiver - æ³›å‹ç±»å‹çš„ receiver
3. æ³›å‹å‡½æ•° - å¸¦ç±»å‹å½¢å‚çš„å‡½æ•°

ä¸ºäº†å®ç°æ³›å‹ï¼ŒGo å¼•å…¥äº†ä¸€äº›æ–°çš„æ¦‚å¿µï¼š

1. ç±»å‹å½¢å‚
2. ç±»å‹å½¢å‚åˆ—è¡¨
3. ç±»å‹å®å‚
4. ç±»å‹çº¦æŸ
5. å®ä¾‹åŒ– - æ³›å‹ç±»å‹ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè¦ä½¿ç”¨çš„è¯å¿…é¡»ä¼ å…¥ç±»å‹å®å‚è¿›è¡Œå®ä¾‹åŒ–

## æ³›å‹ç±»å‹

### å®šä¹‰

> æœ¬èŠ‚æ¶‰åŠå››ä¸ªå®šä¹‰ï¼šç±»å‹å½¢å‚ã€ç±»å‹å®å‚ã€ç±»å‹çº¦æŸå’Œæ³›å‹ç±»å‹

```go
// æ³›å‹çš„ç±»å‹å®šä¹‰
type Slice[T int|float32|float64 ] []T
```

è¿™é‡Œç±»å‹åç§° `Slice` åå¸¦äº†ä¸­æ‹¬å·ï¼Œå¯¹å„ä¸ªéƒ¨åˆ†åšä¸€ä¸ªè§£è¯´å°±æ˜¯ï¼š

- `T` æ˜¯**ç±»å‹å½¢å‚ (Type parameter)**ï¼Œå…¶ä»£è¡¨çš„å…·ä½“ç±»å‹å¹¶ä¸ç¡®å®šï¼Œç±»ä¼¼ä¸€ä¸ªå ä½ç¬¦
- `int|float32|float64` æ˜¯**ç±»å‹çº¦æŸ (Type constraint)**
    - `|` è¡¨ç¤ºâ€œæˆ–â€
- `T int|float32|float64` æ˜¯**ç±»å‹å½¢å‚åˆ—è¡¨ (type parameter list)**
    - è¿™ä¸€æ•´ä¸²å®šä¹‰äº†æ‰€æœ‰çš„ç±»å‹å½¢å‚ (åœ¨è¿™ä¸ªä¾‹å­é‡Œåªæœ‰ä¸€ä¸ªç±»å‹å½¢å‚ Tï¼‰
- è¿™é‡Œæ–°å®šä¹‰çš„ç±»å‹åç§°å« `Slice[T]`

ç±»å‹å®šä¹‰ä¸­å¸¦ç±»å‹å½¢å‚çš„ç±»å‹ï¼Œç§°ä¹‹ä¸º**æ³›å‹ç±»å‹(Generic type)**

### å®ä¾‹åŒ–

æ³›å‹ç±»å‹ä¸èƒ½ç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼Œå¿…é¡»ä¼ å…¥**ç±»å‹å®å‚ (Type argument)**å°†å…¶ç¡®å®šä¸ºå…·ä½“çš„ç±»å‹ä¹‹åæ‰å¯ä½¿ç”¨ã€‚è€Œä¼ å…¥ç±»å‹å®å‚ç¡®å®šå…·ä½“ç±»å‹çš„æ“ä½œè¢«ç§°ä¸º**å®ä¾‹åŒ–(Instantiations)** 

```go
// è¿™é‡Œä¼ å…¥äº†ç±»å‹å®å‚intï¼Œæ³›å‹ç±»å‹Slice[T]è¢«å®ä¾‹åŒ–ä¸ºå…·ä½“çš„ç±»å‹ Slice[int]
var a Slice[int] = []int{1, 2, 3}  
fmt.Printf("Type Name: %T",a)  //è¾“å‡ºï¼šType Name: Slice[int]

// ä¼ å…¥ç±»å‹å®å‚float32, å°†æ³›å‹ç±»å‹Slice[T]å®ä¾‹åŒ–ä¸ºå…·ä½“çš„ç±»å‹ Slice[string]
var b Slice[float32] = []float32{1.0, 2.0, 3.0} 
fmt.Printf("Type Name: %T",b)  //è¾“å‡ºï¼šType Name: Slice[float32]

// âœ— é”™è¯¯ã€‚å› ä¸ºå˜é‡açš„ç±»å‹ä¸ºSlice[int]ï¼Œbçš„ç±»å‹ä¸ºSlice[float32]ï¼Œä¸¤è€…ç±»å‹ä¸åŒ
a = b  

// âœ— é”™è¯¯ã€‚stringä¸åœ¨ç±»å‹çº¦æŸ int|float32|float64 ä¸­ï¼Œä¸èƒ½ç”¨æ¥å®ä¾‹åŒ–æ³›å‹ç±»å‹
var c Slice[string] = []string{"Hello", "World"} 

// âœ— é”™è¯¯ã€‚Slice[T]æ˜¯æ³›å‹ç±»å‹ï¼Œä¸å¯ç›´æ¥ä½¿ç”¨å¿…é¡»å®ä¾‹åŒ–ä¸ºå…·ä½“çš„ç±»å‹
var x Slice[T] = []int{1, 2, 3} 
```

ä¸Šé¢åªæ˜¯ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå®é™…ä¸Šç±»å‹å½¢å‚çš„æ•°é‡å¯ä»¥è¿œè¿œä¸æ­¢ä¸€ä¸ªï¼Œå¦‚ä¸‹ï¼š

```go
// MyMapç±»å‹å®šä¹‰äº†ä¸¤ä¸ªç±»å‹å½¢å‚ KEY å’Œ VALUEã€‚åˆ†åˆ«ä¸ºä¸¤ä¸ªå½¢å‚æŒ‡å®šäº†ä¸åŒçš„ç±»å‹çº¦æŸ
// è¿™ä¸ªæ³›å‹ç±»å‹çš„åå­—å«ï¼š MyMap[KEY, VALUE]
type MyMap[KEY int | string, VALUE float32 | float64] map[KEY]VALUE  

// ç”¨ç±»å‹å®å‚ string å’Œ flaot64 æ›¿æ¢äº†ç±»å‹å½¢å‚ KEY ã€ VALUEï¼Œæ³›å‹ç±»å‹è¢«å®ä¾‹åŒ–ä¸ºå…·ä½“çš„ç±»å‹ï¼šMyMap[string, float64]
var a MyMap[string, float64] = map[string]float64{
    "jack_score": 9.6,
    "bob_score":  8.4,
}
```

![img](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/bVcYRiO)

### å…¶ä»–çš„æ³›å‹ç±»å‹

æ‰€æœ‰ç±»å‹å®šä¹‰éƒ½å¯ä½¿ç”¨ç±»å‹å½¢å‚ï¼Œæ‰€ä»¥ä¸‹é¢è¿™ç§**ç»“æ„ä½“**ã€**æ¥å£**ä»¥åŠ**é€šé“**çš„å®šä¹‰ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å½¢å‚ï¼š

```go
// ä¸€ä¸ªæ³›å‹ç±»å‹çš„ç»“æ„ä½“ã€‚å¯ç”¨ int æˆ– sring ç±»å‹å®ä¾‹åŒ–
type MyStruct[T int | string] struct {  
    Name string
    Data T
}

// ä¸€ä¸ªæ³›å‹æ¥å£(å…³äºæ³›å‹æ¥å£åœ¨ååŠéƒ¨åˆ†ä¼šè¯¦ç»†è®²è§£ï¼‰
type IPrintData[T int | float32 | string] interface {
    Print(data T)
}

// ä¸€ä¸ªæ³›å‹é€šé“ï¼Œå¯ç”¨ç±»å‹å®å‚ int æˆ– string å®ä¾‹åŒ–
type MyChan[T int | string] chan T
```

### ç±»å‹å½¢å‚çš„äº’ç›¸å¥—ç”¨

ç±»å‹å½¢å‚æ˜¯å¯ä»¥äº’ç›¸å¥—ç”¨çš„ï¼Œå¦‚ä¸‹

```go
type WowStruct[T int | float32, S []T] struct {
    Data     S
    MaxValue T
    MinValue T
}
```

è¿™ä¸ªä¾‹å­çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ä¸”éš¾ä»¥ç†è§£ï¼Œä½†å®é™…ä¸Šåªè¦è®°ä½ä¸€ç‚¹ï¼šä»»ä½•æ³›å‹ç±»å‹éƒ½å¿…é¡»ä¼ å…¥ç±»å‹å®å‚å®ä¾‹åŒ–æ‰å¯ä»¥ä½¿ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™å°±å°è¯•ä¼ å…¥ç±»å‹å®å‚çœ‹çœ‹ï¼š

```go
var ws WowStruct[int, []int]
// æ³›å‹ç±»å‹ WowStuct[T, S] è¢«å®ä¾‹åŒ–åçš„ç±»å‹åç§°å°±å« WowStruct[int, []int]
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸º T ä¼ å…¥äº†å®å‚ `int`ï¼Œç„¶åå› ä¸º S çš„å®šä¹‰æ˜¯ `[]T` ï¼Œæ‰€ä»¥ S çš„å®å‚è‡ªç„¶æ˜¯ `[]int` ã€‚ç»è¿‡å®ä¾‹åŒ–ä¹‹å `WowStruct[T,S]` çš„å®šä¹‰ç±»ä¼¼å¦‚ä¸‹ï¼š

```go
// ä¸€ä¸ªå­˜å‚¨intç±»å‹åˆ‡ç‰‡ï¼Œä»¥åŠåˆ‡ç‰‡ä¸­æœ€å¤§ã€æœ€å°å€¼çš„ç»“æ„ä½“
type WowStruct[int, []int] struct {
    Data     []int
    MaxValue int
    MinValue int
}
```

å› ä¸º S çš„å®šä¹‰æ˜¯ []T ï¼Œæ‰€ä»¥ T ä¸€æ—¦å†³å®šäº†çš„è¯ S çš„å®å‚å°±ä¸èƒ½éšä¾¿ä¹±ä¼ äº†ï¼Œä¸‹é¢è¿™æ ·çš„ä»£ç æ˜¯é”™è¯¯çš„ï¼š

```go
// é”™è¯¯ã€‚Sçš„å®šä¹‰æ˜¯[]Tï¼Œè¿™é‡ŒTä¼ å…¥äº†å®å‚int, æ‰€ä»¥Sçš„å®å‚åº”å½“ä¸º []int è€Œä¸èƒ½æ˜¯ []float32
ws := WowStruct[int, []float32]{
        Data:     []float32{1.0, 2.0, 3.0},
        MaxValue: 3,
        MinValue: 1,
    }
```

### å‡ ç§è¯­æ³•é”™è¯¯

1. å®šä¹‰æ³›å‹ç±»å‹çš„æ—¶å€™ï¼Œ**åŸºç¡€ç±»å‹ä¸èƒ½åªæœ‰ç±»å‹å½¢å‚**ï¼Œå¦‚ä¸‹ï¼š

    ```go
    // é”™è¯¯ï¼Œç±»å‹å½¢å‚ä¸èƒ½å•ç‹¬ä½¿ç”¨
    type CommonType[T int|string|float32] T
    ```

2. å½“ç±»å‹çº¦æŸçš„ä¸€äº›å†™æ³•ä¼šè¢«ç¼–è¯‘å™¨è¯¯è®¤ä¸ºæ˜¯è¡¨è¾¾å¼æ—¶ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹ï¼š

    ```go
    //âœ— é”™è¯¯ã€‚T *intä¼šè¢«ç¼–è¯‘å™¨è¯¯è®¤ä¸ºæ˜¯è¡¨è¾¾å¼ Tä¹˜ä»¥intï¼Œè€Œä¸æ˜¯intæŒ‡é’ˆ
    type NewType[T *int] []T
    // ä¸Šé¢ä»£ç å†ç¼–è¯‘å™¨çœ¼ä¸­ï¼šå®ƒè®¤ä¸ºä½ è¦å®šä¹‰ä¸€ä¸ªå­˜æ”¾åˆ‡ç‰‡çš„æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦ç”± T ä¹˜ä»¥ int è®¡ç®—å¾—åˆ°
    type NewType [T * int][]T 
    
    //âœ— é”™è¯¯ã€‚å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿™é‡Œä¸å…‰*è¢«ä¼šè®¤ä¸ºæ˜¯ä¹˜å·ï¼Œ| è¿˜ä¼šè¢«è®¤ä¸ºæ˜¯æŒ‰ä½æˆ–æ“ä½œ
    type NewType2[T *int|*float64] []T 
    
    //âœ— é”™è¯¯
    type NewType2 [T (int)] []T 
    ```

    ä¸ºäº†é¿å…è¿™ç§è¯¯è§£ï¼Œè§£å†³åŠæ³•å°±æ˜¯ç»™ç±»å‹çº¦æŸåŒ…ä¸Š `interface{}` æˆ–åŠ ä¸Šé€—å·æ¶ˆé™¤æ­§ä¹‰ï¼ˆå…³äºæ¥å£å…·ä½“çš„ç”¨æ³•ä¼šåœ¨ååŠç¯‡æåŠï¼‰

    ```go
    type NewType[T interface{*int}] []T
    type NewType2[T interface{*int|*float64}] []T 
    
    // å¦‚æœç±»å‹çº¦æŸä¸­åªæœ‰ä¸€ä¸ªç±»å‹ï¼Œå¯ä»¥æ·»åŠ ä¸ªé€—å·æ¶ˆé™¤æ­§ä¹‰
    type NewType3[T *int,] []T
    
    //âœ— é”™è¯¯ã€‚å¦‚æœç±»å‹çº¦æŸä¸æ­¢ä¸€ä¸ªç±»å‹ï¼ŒåŠ é€—å·æ˜¯ä¸è¡Œçš„
    type NewType4[T *int|*float32,] []T 
    ```

    å› ä¸ºä¸Šé¢é€—å·çš„ç”¨æ³•é™åˆ¶æ¯”è¾ƒå¤§ï¼Œè¿™é‡Œæ¨èç»Ÿä¸€ç”¨ `interface{}` è§£å†³é—®é¢˜

    æœ‰ä¸€è¯´ä¸€å¾ˆä¸‘é™‹

### ç‰¹æ®Šçš„æ³›å‹ç±»å‹

è¿™é‡Œè®¨è®ºç§æ¯”è¾ƒç‰¹æ®Šçš„æ³›å‹ç±»å‹ï¼Œå¦‚ä¸‹ï¼š

```go
type Wow[T int | string] int

var a Wow[int] = 123     // ç¼–è¯‘æ­£ç¡®
var b Wow[string] = 123  // ç¼–è¯‘æ­£ç¡®
var c Wow[string] = "hello" // ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸º"hello"ä¸èƒ½èµ‹å€¼ç»™åº•å±‚ç±»å‹int
```

è¿™é‡Œè™½ç„¶ä½¿ç”¨äº†ç±»å‹å½¢å‚ï¼Œä½†å› ä¸ºç±»å‹å®šä¹‰æ˜¯ `type Wow[T int|string] int` ï¼Œæ‰€ä»¥æ— è®ºä¼ å…¥ä»€ä¹ˆç±»å‹å®å‚ï¼Œå®ä¾‹åŒ–åçš„æ–°ç±»å‹çš„åº•å±‚ç±»å‹éƒ½æ˜¯ int ã€‚æ‰€ä»¥ int ç±»å‹çš„æ•°å­— 123 å¯ä»¥èµ‹å€¼ç»™å˜é‡ a å’Œ bï¼Œä½† string ç±»å‹çš„å­—ç¬¦ä¸² â€œhelloâ€ ä¸èƒ½èµ‹å€¼ç»™ c

è¿™ä¸ªä¾‹å­æ²¡æœ‰ä»€ä¹ˆå…·ä½“æ„ä¹‰ï¼Œä½†æ˜¯å¯ä»¥è®©æˆ‘ä»¬ç†è§£æ³›å‹ç±»å‹çš„å®ä¾‹åŒ–çš„æœºåˆ¶

### æ³›å‹ç±»å‹çš„å¥—å¨ƒ

æ³›å‹å’Œæ™®é€šçš„ç±»å‹ä¸€æ ·ï¼Œå¯ä»¥äº’ç›¸åµŒå¥—å®šä¹‰å‡ºæ›´åŠ å¤æ‚çš„æ–°ç±»å‹ï¼Œå¦‚ä¸‹ï¼š

```go
// å…ˆå®šä¹‰ä¸ªæ³›å‹ç±»å‹ Slice[T]
type Slice[T int|string|float32|float64] []T

// âœ— é”™è¯¯ã€‚æ³›å‹ç±»å‹Slice[T]çš„ç±»å‹çº¦æŸä¸­ä¸åŒ…å«uint, uint8
type UintSlice[T uint|uint8] Slice[T]  

// âœ“ æ­£ç¡®ã€‚åŸºäºæ³›å‹ç±»å‹Slice[T]å®šä¹‰äº†æ–°çš„æ³›å‹ç±»å‹ FloatSlice[T] ã€‚FloatSlice[T]åªæ¥å—float32å’Œfloat64ä¸¤ç§ç±»å‹
type FloatSlice[T float32|float64] Slice[T] 

// âœ“ æ­£ç¡®ã€‚åŸºäºæ³›å‹ç±»å‹Slice[T]å®šä¹‰çš„æ–°æ³›å‹ç±»å‹ IntAndStringSlice[T]
type IntAndStringSlice[T int|string] Slice[T]  
// âœ“ æ­£ç¡® åŸºäºIntAndStringSlice[T]å¥—å¨ƒå®šä¹‰å‡ºçš„æ–°æ³›å‹ç±»å‹
type IntSlice[T int] IntAndStringSlice[T] 

// åœ¨mapä¸­å¥—ä¸€ä¸ªæ³›å‹ç±»å‹Slice[T]
type WowMap[T int|string] map[string]Slice[T]
// åœ¨mapä¸­å¥—Slice[T]çš„å¦ä¸€ç§å†™æ³•
type WowMap2[T Slice[int] | Slice[string]] map[string]T
```

### ç±»å‹çº¦æŸçš„ä¸¤ç§é€‰æ‹©

è§‚å¯Ÿä¸‹é¢ä¸¤ç§ç±»å‹çº¦æŸçš„å†™æ³•

```go
type WowStruct[T int|string] struct {
    Name string
    Data []T
}

type WowStruct2[T []int|[]string] struct {
    Name string
    Data T
}
```

ä»…é™äºè¿™ä¸ªä¾‹å­ï¼Œè¿™ä¸¤ç§å†™æ³•å’Œå®ç°çš„åŠŸèƒ½å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œå®ä¾‹åŒ–ä¹‹åç»“æ„ä½“ç›¸åŒã€‚ä½†æ˜¯åƒä¸‹é¢è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰ä¸€ç§å†™æ³•ä¼šæ›´å¥½ï¼š

```go
// åˆåŒ…å«TåˆåŒ…å«[]T
type WowStruct3[T int | string] struct {
    Data     []T
    MaxValue T
    MinValue T
}
```

### åŒ¿åç»“æ„ä½“ä¸æ”¯æŒæ³›å‹

æˆ‘ä»¬æœ‰æ—¶å€™ä¼šç»å¸¸ç”¨åˆ°åŒ¿åçš„ç»“æ„ä½“ï¼Œå¹¶åœ¨å®šä¹‰å¥½åŒ¿åç»“æ„ä½“ä¹‹åç›´æ¥åˆå§‹åŒ–ï¼š

```go
testCase := struct {
        caseName string
        got      int
        want     int
    }{
        caseName: "test OK",
        got:      100,
        want:     100,
    }
```

é‚£ä¹ˆåŒ¿åç»“æ„ä½“èƒ½ä¸èƒ½ä½¿ç”¨æ³›å‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ï¼Œä¸‹é¢çš„ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼š

```go
testCase := struct[T int|string] {
        caseName string
        got      T
        want     T
    }[int]{
        caseName: "test OK",
        got:      100,
        want:     100,
    }
```

æ‰€ä»¥åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™æˆ‘ä»¬åªèƒ½æ”¾å¼ƒä½¿ç”¨åŒ¿åç»“æ„ä½“ï¼Œå¯¹äºå¾ˆå¤šåœºæ™¯æ¥è¯´è¿™ä¼šé€ æˆéº»çƒ¦ï¼ˆæœ€ä¸»è¦éº»çƒ¦é›†ä¸­åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä¸ºæ³›å‹åšå•å…ƒæµ‹è¯•ä¼šéå¸¸éº»çƒ¦ï¼Œè¿™ç‚¹æˆ‘ä¹‹åçš„æ–‡ç« å°†ä¼šè¯¦ç»†é˜è¿°ï¼‰

## æ³›å‹ receiver

å•çº¯çš„æ³›å‹ç±»å‹å®é™…ä¸Šå¯¹å¼€å‘æ¥è¯´ç”¨å¤„å¹¶ä¸å¤§ã€‚ä½†å¦‚æœå°†æ³›å‹ç±»å‹å’Œ**æ³›å‹ receiver** ç›¸ç»“åˆçš„è¯ï¼Œæ³›å‹å°±æœ‰äº†éå¸¸å¤§çš„å®ç”¨æ€§äº†

å…è®¸ç»™æ³›å‹ç±»å‹æ·»åŠ æ–¹æ³•ï¼š

```go
type MySlice[T int | float32] []T

func (s MySlice[T]) Sum() T {
    var sum T
    for _, value := range s {
        sum += value
    }
    return sum
}
```

è¿™ä¸ªä¾‹å­ä¸ºæ³›å‹ç±»å‹ `MySlice[T]` æ·»åŠ äº†ä¸€ä¸ªè®¡ç®—æˆå‘˜æ€»å’Œçš„æ–¹æ³• `Sum()` ã€‚æ³¨æ„è§‚å¯Ÿè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š

- é¦–å…ˆçœ‹ receiver `(s MySlice[T])` ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠç±»å‹åç§° `MySlice[T]` å†™å…¥äº† receiver ä¸­
- ç„¶åæ–¹æ³•çš„è¿”å›å‚æ•°æˆ‘ä»¬ä½¿ç”¨äº†ç±»å‹å½¢å‚ T
    - å®é™…ä¸Šå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œ**æ–¹æ³•çš„æ¥æ”¶å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å½¢å‚**

- åœ¨æ–¹æ³•çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å½¢å‚ T
    - åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ `var sum T` å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å˜é‡ `sum`


å¯¹äºè¿™ä¸ªæ³›å‹ç±»å‹ `MySlice[T]` æˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿè¿˜è®°ä¸è®°å¾—ä¹‹å‰å¼ºè°ƒè¿‡å¾ˆå¤šæ¬¡çš„ï¼Œæ³›å‹ç±»å‹æ— è®ºå¦‚ä½•éƒ½éœ€è¦å…ˆç”¨ç±»å‹å®å‚å®ä¾‹åŒ–ï¼Œæ‰€ä»¥ç”¨æ³•å¦‚ä¸‹ï¼š

```go
var s MySlice[int] = []int{1, 2, 3, 4}
fmt.Println(s.Sum()) // è¾“å‡ºï¼š10

var s2 MySlice[float32] = []float32{1.0, 2.0, 3.0, 4.0}
fmt.Println(s2.Sum()) // è¾“å‡ºï¼š10.0
```

è¯¥å¦‚ä½•ç†è§£ä¸Šé¢çš„å®ä¾‹åŒ–ï¼Ÿé¦–å…ˆæˆ‘ä»¬ç”¨ç±»å‹å®å‚ int å®ä¾‹åŒ–äº†æ³›å‹ç±»å‹ `MySlice[T]`ï¼Œæ‰€ä»¥æ³›å‹ç±»å‹å®šä¹‰ä¸­çš„æ‰€æœ‰ T éƒ½è¢«æ›¿æ¢ä¸º intï¼Œæœ€ç»ˆæˆ‘ä»¬å¯ä»¥æŠŠä»£ç çœ‹ä½œä¸‹é¢è¿™æ ·ï¼š

```go
type MySlice[int] []int // å®ä¾‹åŒ–åçš„ç±»å‹åå« MyIntSlice[int]

// æ–¹æ³•ä¸­æ‰€æœ‰ç±»å‹å½¢å‚ T éƒ½è¢«æ›¿æ¢ä¸ºç±»å‹å®å‚ int
func (s MySlice[int]) Sum() int {
    var sum int 
    for _, value := range s {
        sum += value
    }
    return sum
}
```

ç”¨ float32 å®ä¾‹åŒ–å’Œç”¨ int å®ä¾‹åŒ–åŒç†

é€šè¿‡æ³›å‹ receiverï¼Œæ³›å‹çš„å®ç”¨æ€§ä¸€ä¸‹å­å¾—åˆ°äº†å·¨å¤§çš„æ‰©å±•ã€‚åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰å¦‚æœæƒ³å®ç°é€šç”¨çš„æ•°æ®ç»“æ„ï¼Œè¯¸å¦‚ï¼šå †ã€æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ä¹‹ç±»çš„è¯ï¼Œæˆ‘ä»¬çš„é€‰æ‹©åªæœ‰ä¸¤ä¸ªï¼š

- ä¸ºæ¯ç§ç±»å‹å†™ä¸€ä¸ªå®ç°
- ä½¿ç”¨ æ¥å£ + åå°„

è€Œæœ‰äº†æ³›å‹ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½éå¸¸ç®€å•åœ°åˆ›å»ºé€šç”¨æ•°æ®ç»“æ„äº†ã€‚æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªæ›´åŠ å®ç”¨çš„ä¾‹å­ â€”â€” é˜Ÿåˆ— æ¥è®²è§£

### åŸºäºæ³›å‹çš„é˜Ÿåˆ—

é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆå…¥å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œå®ƒå’Œç°å®ä¸­æ’é˜Ÿä¸€æ ·ï¼Œæ•°æ®åªèƒ½ä»é˜Ÿå°¾æ”¾å…¥ã€ä»é˜Ÿé¦–å–å‡ºï¼Œå…ˆæ”¾å…¥çš„æ•°æ®ä¼˜å…ˆè¢«å–å‡ºæ¥

```go
// è¿™é‡Œç±»å‹çº¦æŸä½¿ç”¨äº†ç©ºæ¥å£ï¼Œä»£è¡¨çš„æ„æ€æ˜¯æ‰€æœ‰ç±»å‹éƒ½å¯ä»¥ç”¨æ¥å®ä¾‹åŒ–æ³›å‹ç±»å‹ Queue[T] (å…³äºæ¥å£åœ¨ååŠéƒ¨åˆ†ä¼šè¯¦ç»†ä»‹ç»ï¼‰
type Queue[T interface{}] struct {
    elements []T
}

// å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—å°¾éƒ¨
func (q *Queue[T]) Put(value T) {
    q.elements = append(q.elements, value)
}

// ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºå¹¶ä»å¤´éƒ¨åˆ é™¤å¯¹åº”æ•°æ®
func (q *Queue[T]) Pop() (T, bool) {
    var value T
    if len(q.elements) == 0 {
        return value, true
    }

    value = q.elements[0]
    q.elements = q.elements[1:]
    return value, len(q.elements) == 0
}

// é˜Ÿåˆ—å¤§å°
func (q Queue[T]) Size() int {
    return len(q.elements)
}
```

> ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œä¸Šé¢æ˜¯é˜Ÿåˆ—éå¸¸ç®€å•çš„ä¸€ç§å®ç°æ–¹æ³•ï¼Œæ²¡æœ‰è€ƒè™‘çº¿ç¨‹å®‰å…¨ç­‰å¾ˆå¤šé—®é¢˜

`Queue[T]` å› ä¸ºæ˜¯æ³›å‹ç±»å‹ï¼Œæ‰€ä»¥è¦ä½¿ç”¨çš„è¯å¿…é¡»å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–ä¸ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```go
var q1 Queue[int]  // å¯å­˜æ”¾intç±»å‹æ•°æ®çš„é˜Ÿåˆ—
q1.Put(1)
q1.Put(2)
q1.Put(3)
q1.Pop() // 1
q1.Pop() // 2
q1.Pop() // 3

var q2 Queue[string]  // å¯å­˜æ”¾stringç±»å‹æ•°æ®çš„é˜Ÿåˆ—
q2.Put("A")
q2.Put("B")
q2.Put("C")
q2.Pop() // "A"
q2.Pop() // "B"
q2.Pop() // "C"

var q3 Queue[struct{Name string}] 
var q4 Queue[[]int] 	// å¯å­˜æ”¾[]intåˆ‡ç‰‡çš„é˜Ÿåˆ—
var q5 Queue[chan int]  // å¯å­˜æ”¾inté€šé“çš„é˜Ÿåˆ—
var q6 Queue[io.Reader]	// å¯å­˜æ”¾æ¥å£çš„é˜Ÿåˆ—
// ......
```

### åŠ¨æ€åˆ¤æ–­å˜é‡çš„ç±»å‹

ä½¿ç”¨æ¥å£çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°ç±»å‹æ–­è¨€æˆ– type swith æ¥ç¡®å®šæ¥å£å…·ä½“çš„ç±»å‹ï¼Œç„¶åå¯¹ä¸åŒç±»å‹åšå‡ºä¸åŒçš„å¤„ç†ï¼Œå¦‚ï¼š

```go
var i interface{} = 123
i.(int) // ç±»å‹æ–­è¨€

// type switch
switch i.(type) {
    case int:
        // do something
    case string:
        // do something
    default:
        // do something
    }
}
```

é‚£ä¹ˆä½ ä¸€å®šä¼šæƒ³åˆ°ï¼Œå¯¹äº `valut T` è¿™æ ·é€šè¿‡ç±»å‹å½¢å‚å®šä¹‰çš„å˜é‡ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åˆ¤æ–­å…·ä½“ç±»å‹ç„¶åå¯¹ä¸åŒç±»å‹åšå‡ºä¸åŒå¤„ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯**ä¸å…è®¸**çš„ï¼Œå¦‚ä¸‹ï¼š

```go
func (q *Queue[T]) Put(value T) {
    value.(int) // é”™è¯¯ã€‚æ³›å‹ç±»å‹å®šä¹‰çš„å˜é‡ä¸èƒ½ä½¿ç”¨ç±»å‹æ–­è¨€

    // é”™è¯¯ã€‚ä¸å…è®¸ä½¿ç”¨type switch æ¥åˆ¤æ–­ value çš„å…·ä½“ç±»å‹
    switch value.(type) {
    case int:
        // do something
    case string:
        // do something
    default:
        // do something
    }
    
    // ...
}
```

è™½ç„¶ type switch å’Œç±»å‹æ–­è¨€ä¸èƒ½ç”¨ï¼Œä½†æˆ‘ä»¬å¯é€šè¿‡**åå°„**æœºåˆ¶è¾¾åˆ°ç›®çš„ï¼š

```go
func (receiver Queue[T]) Put(value T) {
    // Printf() å¯è¾“å‡ºå˜é‡valueçš„ç±»å‹(åº•å±‚å°±æ˜¯é€šè¿‡åå°„å®ç°çš„)
    fmt.Printf("%T", value) 

    // é€šè¿‡åå°„å¯ä»¥åŠ¨æ€è·å¾—å˜é‡valueçš„ç±»å‹ä»è€Œåˆ†æƒ…å†µå¤„ç†
    v := reflect.ValueOf(value)

    switch v.Kind() {
    case reflect.Int:
        // do something
    case reflect.String:
        // do something
    }

    // ...
}
```

è¿™çœ‹èµ·æ¥è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ï¼Œå¯æ˜¯å½“ä½ å†™å‡ºä¸Šé¢è¿™æ ·çš„ä»£ç æ—¶å€™å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šä½ ä¸ºäº†é¿å…ä½¿ç”¨åå°„è€Œé€‰æ‹©äº†æ³›å‹ï¼Œç»“æœåˆ°å¤´æ¥åˆä¸ºäº†ä¸€äº›åŠŸèƒ½åœ¨åœ¨æ³›å‹ä¸­ä½¿ç”¨åå°„

å½“å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ä½ å¯èƒ½éœ€è¦é‡æ–°æ€è€ƒä¸€ä¸‹ï¼Œè‡ªå·±çš„éœ€æ±‚æ˜¯ä¸æ˜¯çœŸçš„éœ€è¦ç”¨æ³›å‹ï¼ˆæ¯•ç«Ÿæ³›å‹æœºåˆ¶æœ¬èº«å°±å¾ˆå¤æ‚äº†ï¼Œå†åŠ ä¸Šåå°„çš„å¤æ‚åº¦ï¼Œå¢åŠ çš„å¤æ‚åº¦å¹¶ä¸ä¸€å®šå€¼å¾—ï¼‰

å½“ç„¶ï¼Œè¿™ä¸€åˆ‡é€‰æ‹©æƒéƒ½åœ¨ä½ è‡ªå·±çš„æ‰‹é‡Œï¼Œæ ¹æ®å…·ä½“æƒ…å†µæ–Ÿé…Œã€‚

## æ³›å‹å‡½æ•°

å†™æ³›å‹å‡½æ•°ä¹Ÿååˆ†ç®€å•ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦å†™ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°ä¹‹å’Œçš„å‡½æ•°ï¼š

```go
func Add(a int, b int) int {
    return a + b
}
```

è¿™ä¸ªå‡½æ•°ç†æ‰€å½“ç„¶åªèƒ½è®¡ç®—intçš„å’Œï¼Œè€Œæµ®ç‚¹çš„è®¡ç®—æ˜¯ä¸æ”¯æŒçš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·å®šä¹‰ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼š

```go
func Add[T int | float32 | float64](a T, b T) T {
    return a + b
}
```

è¿™ç§å¸¦ç±»å‹å½¢å‚çš„å‡½æ•°è¢«ç§°ä¸º**æ³›å‹å‡½æ•°**

å’Œæ³›å‹ç±»å‹ä¸€æ ·ï¼Œæ³›å‹å‡½æ•°ä¹Ÿæ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨çš„ï¼Œè¦ä½¿ç”¨æ³›å‹å‡½æ•°çš„è¯å¿…é¡»ä¼ å…¥ç±»å‹å®å‚ä¹‹åæ‰èƒ½è°ƒç”¨ã€‚

```go
Add[int](1,2) // ä¼ å…¥ç±»å‹å®å‚intï¼Œè®¡ç®—ç»“æœä¸º 3
Add[float32](1.0, 2.0) // ä¼ å…¥ç±»å‹å®å‚float32, è®¡ç®—ç»“æœä¸º 3.0

Add[string]("hello", "world") // é”™è¯¯ã€‚å› ä¸ºæ³›å‹å‡½æ•°Addçš„ç±»å‹çº¦æŸä¸­å¹¶ä¸åŒ…å«string
```

æˆ–è®¸ä½ ä¼šè§‰å¾—è¿™æ ·æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨æŒ‡å®šç±»å‹å®å‚å¤ªä¸æ–¹ä¾¿äº†ã€‚æ‰€ä»¥ Go è¿˜**æ”¯æŒç±»å‹å®å‚çš„è‡ªåŠ¨æ¨å¯¼**ï¼š

```go
Add(1, 2)  		// 1ï¼Œ2æ˜¯intç±»å‹ï¼Œç¼–è¯‘è¯·è‡ªåŠ¨æ¨å¯¼å‡ºç±»å‹å®å‚Tæ˜¯int
Add(1.0, 2.0) 	// 1.0, 2.0 æ˜¯æµ®ç‚¹ï¼Œç¼–è¯‘è¯·è‡ªåŠ¨æ¨å¯¼å‡ºç±»å‹å®å‚Tæ˜¯float32
```

è‡ªåŠ¨æ¨å¯¼çš„å†™æ³•å°±å¥½åƒå…å»äº†ä¼ å…¥å®å‚çš„æ­¥éª¤ä¸€æ ·ï¼Œä½†è¯·è®°ä½è¿™ä»…ä»…åªæ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬æ¨å¯¼å‡ºäº†ç±»å‹å®å‚ï¼Œå®é™…ä¸Šä¼ å…¥å®å‚æ­¥éª¤è¿˜æ˜¯å‘ç”Ÿäº†çš„ã€‚

### åŒ¿åå‡½æ•°ä¸æ”¯æŒæ³›å‹

åœ¨ Go ä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œå¦‚ï¼š

```go
fn := func(a, b int) int {
    return a + b 
}  // å®šä¹‰äº†ä¸€ä¸ªåŒ¿åå‡½æ•°å¹¶èµ‹å€¼ç»™ fn 

fmt.Println(fn(1, 2)) // è¾“å‡º: 3
```

ä½†æ˜¯åŒ¿åå‡½æ•°**ä¸èƒ½è‡ªå·±å®šä¹‰ç±»å‹å½¢å‚**

```go
// é”™è¯¯ï¼ŒåŒ¿åå‡½æ•°ä¸èƒ½è‡ªå·±å®šä¹‰ç±»å‹å®å‚
fnGeneric := func[T int | float32](a, b T) T {
        return a + b
} 

fmt.Println(fnGeneric(1, 2))
```

ä½†æ˜¯åŒ¿åå‡½æ•°å¯ä»¥**ä½¿ç”¨åˆ«å¤„å®šä¹‰å¥½çš„ç±»å‹å®å‚**

```go
func MyFunc[T int | float32 | float64](a, b T) {
    // åŒ¿åå‡½æ•°å¯ä½¿ç”¨å·²ç»å®šä¹‰å¥½çš„ç±»å‹å½¢å‚
    fn2 := func(i T, j T) T {
        return i*2 - j*2
    }

    fn2(a, b)
}
```

### æ–¹æ³•ä¸æ”¯æŒæ³›å‹

å¾ˆä¸å¹¸ï¼Œç›®å‰ Go çš„æ–¹æ³•å¹¶ä¸æ”¯æŒæ³›å‹

```go
type A struct {
}

// ä¸æ”¯æŒæ³›å‹æ–¹æ³•
func (receiver A) Add[T int | float32 | float64](a T, b T) T {
    return a + b
}
```

ä½†æ˜¯å› ä¸º receiver æ”¯æŒæ³›å‹ï¼Œ æ‰€ä»¥å¦‚æœæƒ³åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹çš„è¯ï¼Œç›®å‰å”¯ä¸€çš„åŠæ³•å°±æ˜¯æ›²çº¿æ•‘å›½ï¼Œè¿‚å›åœ°é€šè¿‡ receiver ä½¿ç”¨ç±»å‹å½¢å‚ï¼š

```go
type A[T int | float32 | float64] struct {
}

// æ–¹æ³•å¯ä»¥ä½¿ç”¨ç±»å‹å®šä¹‰ä¸­çš„å½¢å‚ T 
func (receiver A[T]) Add(a T, b T) T {
    return a + b
}

// ç”¨æ³•ï¼š
var a A[int]
a.Add(1, 2)

var aa A[float32]
aa.Add(1.0, 2.0)
```

## å˜å¾—å¤æ‚çš„æ¥å£

æœ‰æ—¶å€™ä½¿ç”¨æ³›å‹ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬ä¼šä¹¦å†™é•¿é•¿çš„ç±»å‹çº¦æŸï¼Œå¦‚ä¸‹ï¼š

```go
// ä¸€ä¸ªå¯ä»¥å®¹çº³æ‰€æœ‰int,uintä»¥åŠæµ®ç‚¹ç±»å‹çš„æ³›å‹åˆ‡ç‰‡
type Slice[T int | int8 | int16 | int32 | int64 | uint | uint8 | uint16 | uint32 | uint64 | float32 | float64] []T
```

ç†æ‰€å½“ç„¶ï¼Œè¿™ç§å†™æ³•æ˜¯æˆ‘ä»¬æ— æ³•å¿å—ä¹Ÿéš¾ä»¥ç»´æŠ¤çš„ï¼Œè€ŒGoæ”¯æŒå°†ç±»å‹çº¦æŸå•ç‹¬æ‹¿å‡ºæ¥å®šä¹‰åˆ°æ¥å£ä¸­ï¼Œä»è€Œè®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ï¼š

```go
type IntUintFloat interface {
    int | int8 | int16 | int32 | int64 | uint | uint8 | uint16 | uint32 | uint64 | float32 | float64
}

type Slice[T IntUintFloat] []T
```

è¿™æ®µä»£ç æŠŠç±»å‹çº¦æŸç»™å•ç‹¬æ‹¿å‡ºæ¥ï¼Œå†™å…¥äº†æ¥å£ç±»å‹ `IntUintFloat` å½“ä¸­ã€‚éœ€è¦æŒ‡å®šç±»å‹çº¦æŸçš„æ—¶å€™ç›´æ¥ä½¿ç”¨æ¥å£ `IntUintFloat` å³å¯ã€‚

ä¸è¿‡è¿™æ ·çš„ä»£ç ä¾æ—§ä¸å¥½ç»´æŠ¤ï¼Œè€Œæ¥å£å’Œæ¥å£ã€æ¥å£å’Œæ™®é€šç±»å‹ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ `|` è¿›è¡Œç»„åˆï¼š

```go
type Int interface {
    int | int8 | int16 | int32 | int64
}

type Uint interface {
    uint | uint8 | uint16 | uint32
}

type Float interface {
    float32 | float64
}

type Slice[T Int | Uint | Float] []T  // ä½¿ç”¨ '|' å°†å¤šä¸ªæ¥å£ç±»å‹ç»„åˆ
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº† Int, Uint, Float ä¸‰ä¸ªæ¥å£ç±»å‹ï¼Œå¹¶æœ€ç»ˆåœ¨ `Slice[T]` çš„ç±»å‹çº¦æŸä¸­é€šè¿‡ä½¿ç”¨ `|` å°†å®ƒä»¬ç»„åˆåˆ°ä¸€èµ·ã€‚

åŒæ—¶ï¼Œåœ¨æ¥å£é‡Œä¹Ÿèƒ½ç›´æ¥ç»„åˆå…¶ä»–æ¥å£ï¼Œæ‰€ä»¥è¿˜å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š

```go
type SliceElement interface {
    Int | Uint | Float | string // ç»„åˆäº†ä¸‰ä¸ªæ¥å£ç±»å‹å¹¶é¢å¤–å¢åŠ äº†ä¸€ä¸ª string ç±»å‹
}

type Slice[T SliceElement] []T 
```

### `~` : æŒ‡å®šåº•å±‚ç±»å‹ :heavy_check_mark:

ä¸Šé¢å®šä¹‰çš„ `Slice[T]` è™½ç„¶å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼š

```go
var s1 Slice[int] // æ­£ç¡® 

type MyInt int
var s2 Slice[MyInt] // âœ— é”™è¯¯ã€‚MyIntç±»å‹åº•å±‚ç±»å‹æ˜¯intä½†å¹¶ä¸æ˜¯intç±»å‹ï¼Œä¸ç¬¦åˆ Slice[T] çš„ç±»å‹çº¦æŸ
```

è¿™é‡Œå‘ç”Ÿé”™è¯¯çš„åŸå› æ˜¯ï¼Œæ³›å‹ç±»å‹ `Slice[T]` å…è®¸çš„æ˜¯ int ä½œä¸ºç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ MyInt ï¼ˆè™½ç„¶ MyInt ç±»å‹åº•å±‚ç±»å‹æ˜¯ int ï¼Œä½†å®ƒä¾æ—§ä¸æ˜¯ int ç±»å‹ï¼‰ã€‚

ä¸ºäº†ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGo æ–°å¢äº†ä¸€ä¸ªç¬¦å· `~` ï¼Œåœ¨ç±»å‹çº¦æŸä¸­ä½¿ç”¨ç±»ä¼¼ `~int` è¿™ç§å†™æ³•çš„è¯ï¼Œå°±ä»£è¡¨ç€**ä¸å…‰æ˜¯ int ï¼Œæ‰€æœ‰ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„ç±»å‹ä¹Ÿéƒ½å¯ç”¨äºå®ä¾‹åŒ–**ã€‚

ä½¿ç”¨ `~` å¯¹ä»£ç è¿›è¡Œæ”¹å†™ä¹‹åå¦‚ä¸‹ï¼š

```go
type Int interface {
    ~int | ~int8 | ~int16 | ~int32 | ~int64
}

type Uint interface {
    ~uint | ~uint8 | ~uint16 | ~uint32
}
type Float interface {
    ~float32 | ~float64
}

type Slice[T Int | Uint | Float] []T 

var s Slice[int] // æ­£ç¡®

type MyInt int
var s2 Slice[MyInt]  // MyIntåº•å±‚ç±»å‹æ˜¯intï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºå®ä¾‹åŒ–

type MyMyInt MyInt
var s3 Slice[MyMyInt]  // æ­£ç¡®ã€‚MyMyInt è™½ç„¶åŸºäº MyInt ï¼Œä½†åº•å±‚ç±»å‹ä¹Ÿæ˜¯intï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨äºå®ä¾‹åŒ–

type MyFloat32 float32  // æ­£ç¡®
var s4 Slice[MyFloat32]
```

**é™åˆ¶**ï¼šä½¿ç”¨ `~` æ—¶æœ‰ä¸€å®šçš„é™åˆ¶ï¼š

1. `~` åé¢çš„ç±»å‹ä¸èƒ½ä¸ºæ¥å£
2. `~` åé¢çš„ç±»å‹**å¿…é¡»ä¸ºåŸºæœ¬ç±»å‹**

```go
type MyInt int

type _ interface {
    ~[]byte  // æ­£ç¡®
    ~MyInt   // é”™è¯¯ï¼Œ~åçš„ç±»å‹å¿…é¡»ä¸ºåŸºæœ¬ç±»å‹
    ~error   // é”™è¯¯ï¼Œ~åçš„ç±»å‹ä¸èƒ½ä¸ºæ¥å£
}
```

### ä»æ–¹æ³•é›† (Method set) åˆ°ç±»å‹é›† (Type set)

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ åˆ°äº†ä¸€ç§æ¥å£çš„å…¨æ–°å†™æ³•ï¼Œè€Œè¿™ç§å†™æ³•åœ¨ Go1.18 ä¹‹å‰æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœä½ æ¯”è¾ƒæ•é”çš„è¯ï¼Œä¸€å®šä¼šéšçº¦è®¤è¯†åˆ°è¿™ç§å†™æ³•çš„æ”¹å˜è¿™ä¹Ÿä¸€å®šæ„å‘³ç€ Go è¯­è¨€ä¸­ `æ¥å£(interface)` è¿™ä¸ªæ¦‚å¿µå‘ç”Ÿäº†éå¸¸å¤§çš„å˜åŒ–ã€‚

æ˜¯çš„ï¼Œåœ¨ Go1.18 ä¹‹å‰ï¼ŒGo å®˜æ–¹å¯¹ `æ¥å£(interface)` çš„å®šä¹‰æ˜¯ï¼šæ¥å£æ˜¯ä¸€ä¸ªæ–¹æ³•é›† (method set)

> An interface type specifies a **method set** called its interface

å°±å¦‚ä¸‹é¢è¿™ä¸ªä»£ç ä¸€æ ·ï¼Œ `ReadWriter` æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ¥å£(æ–¹æ³•é›†)ï¼Œè¿™ä¸ªé›†åˆä¸­åŒ…å«äº† `Read()` å’Œ `Write()` è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚æ‰€æœ‰åŒæ—¶å®šä¹‰äº†è¿™ä¸¤ç§æ–¹æ³•çš„ç±»å‹è¢«è§†ä¸ºå®ç°äº†è¿™ä¸€æ¥å£ã€‚

```go
type ReadWriter interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
}
```

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœæ¢ä¸€ä¸ªè§’åº¦æ¥é‡æ–°æ€è€ƒä¸Šé¢è¿™ä¸ªæ¥å£çš„è¯ï¼Œä¼šå‘ç°æ¥å£çš„å®šä¹‰å®é™…ä¸Šè¿˜èƒ½è¿™æ ·ç†è§£ï¼š

> æˆ‘ä»¬å¯ä»¥æŠŠ `ReaderWriter` æ¥å£çœ‹æˆä»£è¡¨äº†ä¸€ä¸ª **ç±»å‹çš„é›†åˆ**ï¼Œæ‰€æœ‰å®ç°äº† `Read()` `Writer()` è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç±»å‹éƒ½åœ¨æ¥å£ä»£è¡¨çš„ç±»å‹é›†åˆå½“ä¸­

é€šè¿‡æ¢ä¸ªè§’åº¦çœ‹å¾…æ¥å£ï¼Œåœ¨æˆ‘ä»¬çœ¼ä¸­æ¥å£çš„å®šä¹‰å°±ä» `æ–¹æ³•é›†(method set)` å˜ä¸ºäº† `ç±»å‹é›†(type set)`ã€‚è€Œ Go1.18 å¼€å§‹å°±æ˜¯ä¾æ®è¿™ä¸€ç‚¹å°†æ¥å£çš„å®šä¹‰æ­£å¼æ›´æ”¹ä¸ºäº†**ç±»å‹é›†(Type set)**

> An interface type defines a ***type set*** *(ä¸€ä¸ª*æ¥å£ç±»å‹å®šä¹‰äº†ä¸€ä¸ªç±»å‹é›†)

ä½ æˆ–è®¸ä¼šè§‰å¾—ï¼Œè¿™ä¸å°±æ˜¯æ”¹äº†ä¸‹æ¦‚å¿µä¸Šçš„å®šä¹‰å®é™…ä¸Šæ²¡ä»€ä¹ˆç”¨å—ï¼Ÿæ˜¯çš„ï¼Œå¦‚æœæ¥å£åŠŸèƒ½æ²¡å˜åŒ–çš„è¯ç¡®å®å¦‚æ­¤ã€‚ä½†æ˜¯è¿˜è®°å¾—ä¸‹é¢è¿™ç§ç”¨æ¥å£æ¥ç®€åŒ–ç±»å‹çº¦æŸçš„å†™æ³•å—ï¼š

```go
type Float interface {
    ~float32 | ~float64
}

type Slice[T Float] []T 
```

è¿™å°±ä½“ç°å‡ºäº†ä¸ºä»€ä¹ˆè¦æ›´æ”¹æ¥å£çš„å®šä¹‰äº†ã€‚ç”¨ **ç±»å‹é›†** çš„æ¦‚å¿µé‡æ–°ç†è§£ä¸Šé¢çš„ä»£ç çš„è¯å°±æ˜¯ï¼š

> æ¥å£ç±»å‹ Float ä»£è¡¨äº†ä¸€ä¸ª **ç±»å‹é›†åˆ**ï¼Œ æ‰€æœ‰ä»¥ float32 æˆ– float64 ä¸ºåº•å±‚ç±»å‹çš„ç±»å‹ï¼Œéƒ½åœ¨è¿™ä¸€ç±»å‹é›†ä¹‹ä¸­

è€Œ `type Slice[T Float] []T` ä¸­ï¼Œ **ç±»å‹çº¦æŸ**çš„çœŸæ­£æ„æ€æ˜¯ï¼š

> **ç±»å‹çº¦æŸ**æŒ‡å®šäº†ç±»å‹å½¢å‚å¯æ¥å—çš„ç±»å‹**é›†åˆ**ï¼Œåªæœ‰å±äºè¿™ä¸ªé›†åˆä¸­çš„ç±»å‹æ‰èƒ½æ›¿æ¢å½¢å‚ç”¨äºå®ä¾‹åŒ–

å¦‚ï¼š

```go
var s Slice[int]      // int å±äºç±»å‹é›† Float ï¼Œæ‰€ä»¥intå¯ä»¥ä½œä¸ºç±»å‹å®å‚
var s Slice[chan int] // chan int ç±»å‹ä¸åœ¨ç±»å‹é›† Float ä¸­ï¼Œæ‰€ä»¥é”™è¯¯
```

#### æ¥å£å®ç° (implement) å®šä¹‰çš„å˜åŒ–

æ—¢ç„¶æ¥å£å®šä¹‰å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆä» Go1.18 å¼€å§‹ `æ¥å£å®ç°(implement)` çš„å®šä¹‰è‡ªç„¶ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼š

å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯´**ç±»å‹ T å®ç°äº†æ¥å£ I ( type T implements interface I)**ï¼š

- T ä¸æ˜¯æ¥å£æ—¶ï¼šç±»å‹ T æ˜¯æ¥å£ I ä»£è¡¨çš„ç±»å‹é›†ä¸­çš„ä¸€ä¸ª**æˆå‘˜**  (T is an element of the type set of I)
- T æ˜¯æ¥å£æ—¶ï¼š T æ¥å£ä»£è¡¨çš„ç±»å‹é›†æ˜¯ I ä»£è¡¨çš„ç±»å‹é›†çš„**å­é›†** (Type set of T is a subset of the type set of I)

#### ç±»å‹çš„å¹¶é›†

å¹¶é›†æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„ `|` ç¬¦å·å°±æ˜¯æ±‚ç±»å‹çš„å¹¶é›† (`union`)

```go
type Uint interface {  // ç±»å‹é›† Uint æ˜¯ ~uint å’Œ ~uint8 ç­‰ç±»å‹çš„å¹¶é›†
    ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64
}
```

#### ç±»å‹çš„äº¤é›†

æ¥å£å¯ä»¥ä¸æ­¢ä¹¦å†™ä¸€è¡Œï¼Œå¦‚æœä¸€ä¸ªæ¥å£æœ‰å¤šè¡Œç±»å‹å®šä¹‰ï¼Œé‚£ä¹ˆå–å®ƒä»¬ä¹‹é—´çš„ **äº¤é›†**

```go
type AllInt interface {
    ~int | ~int8 | ~int16 | ~int32 | ~int64 | ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint32
}

type Uint interface {
    ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64
}

type A interface { // æ¥å£Aä»£è¡¨çš„ç±»å‹é›†æ˜¯ AllInt å’Œ Uint çš„äº¤é›†
    AllInt
    Uint
}

type B interface { // æ¥å£Bä»£è¡¨çš„ç±»å‹é›†æ˜¯ AllInt å’Œ ~int çš„äº¤é›†
    AllInt
    ~int
}
```

ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­

- æ¥å£ A ä»£è¡¨çš„æ˜¯ AllInt ä¸ Uint çš„ **äº¤é›†**ï¼Œå³ `~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64`
- æ¥å£ B ä»£è¡¨çš„åˆ™æ˜¯ AllInt å’Œ ~int çš„**äº¤é›†**ï¼Œå³ `~int`

é™¤äº†ä¸Šé¢çš„äº¤é›†ï¼Œä¸‹é¢ä¹Ÿæ˜¯ä¸€ç§äº¤é›†ï¼š

```go
type C interface {
    ~int
    int
}
```

å¾ˆæ˜¾ç„¶ï¼Œ~int å’Œ int çš„äº¤é›†åªæœ‰ int ä¸€ç§ç±»å‹ï¼Œæ‰€ä»¥æ¥å£ C ä»£è¡¨çš„ç±»å‹é›†ä¸­åªæœ‰ int ä¸€ç§ç±»å‹

#### ç©ºé›†

å½“å¤šä¸ªç±»å‹çš„äº¤é›†å¦‚ä¸‹é¢ `Bad` è¿™æ ·ä¸ºç©ºçš„æ—¶å€™ï¼Œ `Bad` è¿™ä¸ªæ¥å£ä»£è¡¨çš„ç±»å‹é›†ä¸ºä¸€ä¸ª**ç©ºé›†**ï¼š

```go
type Bad interface {
    int
    float32 
} // ç±»å‹ int å’Œ float32 æ²¡æœ‰ç›¸äº¤çš„ç±»å‹ï¼Œæ‰€ä»¥æ¥å£ Bad ä»£è¡¨çš„ç±»å‹é›†ä¸ºç©º
```

**æ²¡æœ‰ä»»ä½•ä¸€ç§ç±»å‹å±äºç©ºé›†**ã€‚è™½ç„¶ Bad è¿™æ ·çš„å†™æ³•æ˜¯å¯ä»¥ç¼–è¯‘çš„ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰

#### ç©ºæ¥å£å’Œ any :heavy_check_mark:

ä¸Šé¢è¯´äº†ç©ºé›†ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹é›†â€”â€”`ç©ºæ¥å£ interface{}` ã€‚å› ä¸ºï¼ŒGo1.18 å¼€å§‹æ¥å£çš„å®šä¹‰å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ `interface{}` çš„å®šä¹‰ä¹Ÿå‘ç”Ÿäº†ä¸€äº›å˜æ›´ï¼š

> ç©ºæ¥å£ä»£è¡¨äº†æ‰€æœ‰ç±»å‹çš„é›†åˆ

æ‰€ä»¥ï¼Œå¯¹äº Go1.18 ä¹‹åçš„ç©ºæ¥å£åº”è¯¥è¿™æ ·ç†è§£ï¼š

1. è™½ç„¶ç©ºæ¥å£å†…æ²¡æœ‰å†™å…¥ä»»ä½•çš„ç±»å‹ï¼Œä½†å®ƒä»£è¡¨çš„æ˜¯æ‰€æœ‰ç±»å‹çš„é›†åˆï¼Œè€Œéä¸€ä¸ªç©ºé›†

2. ç±»å‹çº¦æŸä¸­æŒ‡å®šç©ºæ¥å£çš„æ„æ€æ˜¯æŒ‡å®šäº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç±»å‹çš„ç±»å‹é›†ï¼Œå¹¶ä¸æ˜¯ç±»å‹çº¦æŸé™å®šäº†åªèƒ½ä½¿ç”¨ç©ºæ¥å£æ¥åšç±»å‹å½¢å‚

    ```go
    // ç©ºæ¥å£ä»£è¡¨æ‰€æœ‰ç±»å‹çš„é›†åˆã€‚å†™å…¥ç±»å‹çº¦æŸæ„å‘³ç€æ‰€æœ‰ç±»å‹éƒ½å¯æ‹¿æ¥åšç±»å‹å®å‚
    type Slice[T interface{}] []T
    
    var s1 Slice[int]    // æ­£ç¡®
    var s2 Slice[map[string]string]  // æ­£ç¡®
    var s3 Slice[chan int]  // æ­£ç¡®
    var s4 Slice[interface{}]  // æ­£ç¡®
    ```

å› ä¸ºç©ºæ¥å£æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰ç±»å‹çš„ç±»å‹é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°å®ƒã€‚äºæ˜¯ï¼ŒGo1.18 å¼€å§‹æä¾›äº†ä¸€ä¸ª**ä¸ç©ºæ¥å£ `interface{}` ç­‰ä»·çš„æ–°å…³é”®è¯ `any`** ï¼Œç”¨æ¥ä½¿ä»£ç æ›´ç®€å•ï¼š

```go
type Slice[T any] []T // ä»£ç ç­‰ä»·äº type Slice[T interface{}] []T
```

å®é™…ä¸Š `any` çš„å®šä¹‰å°±ä½äº Go è¯­è¨€çš„ `builtin.go` æ–‡ä»¶ä¸­ï¼ˆå‚è€ƒå¦‚ä¸‹ï¼‰ï¼Œ `any` å®é™…ä¸Šå°±æ˜¯ `interaface{}` çš„åˆ«å (alias)ï¼Œä¸¤è€…å®Œå…¨ç­‰ä»·

```go
// any is an alias for interface{} and is equivalent to interface{} in all ways.
type any = interface{} 
```

æ‰€ä»¥ä» Go 1.18 å¼€å§‹ï¼Œæ‰€æœ‰å¯ä»¥ç”¨åˆ°ç©ºæ¥å£çš„åœ°æ–¹å…¶å®éƒ½å¯ä»¥ç›´æ¥æ›¿æ¢ä¸º anyï¼Œå¦‚ï¼š

```go
var s []any // ç­‰ä»·äº var s []interface{}
var m map[string]any // ç­‰ä»·äº var m map[string]interface{}

func MyPrint(value any){
    fmt.Println(value)
}
```

å¦‚æœä½ é«˜å…´çš„è¯ï¼Œé¡¹ç›®è¿ç§»åˆ° Go1.18 ä¹‹åå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™è¡Œå‘½ä»¤ç›´æ¥æŠŠæ•´ä¸ªé¡¹ç›®ä¸­çš„ç©ºæ¥å£å…¨éƒ½æ›¿æ¢æˆ anyã€‚å½“ç„¶å› ä¸ºå¹¶ä¸å¼ºåˆ¶ï¼Œæ‰€ä»¥åˆ°åº•æ˜¯ç”¨ `interface{}` è¿˜æ˜¯ `any` å…¨çœ‹è‡ªå·±å–œå¥½

```go
gofmt -w -r 'interface{} -> any' ./...
```

> ğŸ’¡ Go è¯­è¨€é¡¹ç›®ä¸­å°±æ›¾ç»æœ‰äººæå‡ºè¿‡æŠŠ Go è¯­è¨€ä¸­æ‰€æœ‰ `interface{}` æ›¿æ¢æˆ `any` çš„ [issue](https://link.segmentfault.com/?enc=RCoMS3v%2BV%2FL44OvJADRwiQ%3D%3D.ZRvUGCJTKyfIjtNqp0BaKKYOPErogpQ%2BInFNEKBvVpDbPP47e6dAfcEOmZzWpA73)ï¼Œç„¶åå› ä¸ºå½±å“èŒƒå›´è¿‡å¤§è¿‡è€Œä¸”å½±å“å› ç´ ä¸ç¡®å®šï¼Œç†æ‰€å½“ç„¶è¢«é©³å›äº†

#### å¯æ¯”è¾ƒ (comparable) å’Œå¯æ’åº (ordered) :heavy_check_mark:

å¯¹äºä¸€äº›æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»å‹çº¦æŸä¸­é™åˆ¶åªæ¥å—èƒ½ `!=` å’Œ `==` å¯¹æ¯”çš„ç±»å‹ï¼Œå¦‚ mapï¼š

```go
// é”™è¯¯ã€‚å› ä¸ºmapä¸­é”®çš„ç±»å‹å¿…é¡»æ˜¯å¯è¿›è¡Œ!=å’Œ==æ¯”è¾ƒçš„ç±»å‹
type MyMap[KEY any, VALUE any] map[KEY]VALUE 
```

æ‰€ä»¥Goç›´æ¥å†…ç½®äº†ä¸€ä¸ªå« `comparable` çš„æ¥å£ï¼Œå®ƒä»£è¡¨äº†æ‰€æœ‰å¯ç”¨ `!=` ä»¥åŠ `==` å¯¹æ¯”çš„ç±»å‹ï¼š

```go
type MyMap[KEY comparable, VALUE any] map[KEY]VALUE // æ­£ç¡®
```

`comparable` æ¯”è¾ƒå®¹æ˜“å¼•èµ·è¯¯è§£çš„ä¸€ç‚¹æ˜¯å¾ˆå¤šäººå®¹æ˜“æŠŠä»–ä¸å¯æ’åºææ··æ·†ã€‚å¯æ¯”è¾ƒæŒ‡çš„æ˜¯ å¯ä»¥æ‰§è¡Œ `!=` `==` æ“ä½œçš„ç±»å‹ï¼Œå¹¶æ²¡ç¡®ä¿è¿™ä¸ªç±»å‹å¯ä»¥æ‰§è¡Œå¤§å°æ¯”è¾ƒï¼ˆ `>,<,<=,>=` ï¼‰ã€‚å¦‚ä¸‹ï¼š

```go
type OhMyStruct struct {
    a int
}

var a, b OhMyStruct

a == b // æ­£ç¡®ã€‚ç»“æ„ä½“å¯ä½¿ç”¨ == è¿›è¡Œæ¯”è¾ƒ
a != b // æ­£ç¡®

a > b // é”™è¯¯ã€‚ç»“æ„ä½“ä¸å¯æ¯”å¤§å°
```

è€Œå¯è¿›è¡Œå¤§å°æ¯”è¾ƒçš„ç±»å‹è¢«ç§°ä¸º `Orderd` ã€‚ç›®å‰ Go è¯­è¨€å¹¶æ²¡æœ‰åƒ `comparable` è¿™æ ·ç›´æ¥å†…ç½®å¯¹åº”çš„å…³é”®è¯ï¼Œæ‰€ä»¥æƒ³è¦çš„è¯éœ€è¦è‡ªå·±æ¥å®šä¹‰ç›¸å…³æ¥å£ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å‚è€ƒ Go å®˜æ–¹åŒ… `golang.org/x/exp/constraints` å¦‚ä½•å®šä¹‰ï¼š

```go
// Ordered ä»£è¡¨æ‰€æœ‰å¯æ¯”å¤§å°æ’åºçš„ç±»å‹
type Ordered interface {
    Integer | Float | ~string
}

type Integer interface {
    Signed | Unsigned
}

type Signed interface {
    ~int | ~int8 | ~int16 | ~int32 | ~int64
}

type Unsigned interface {
    ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr
}

type Float interface {
    ~float32 | ~float64
}
```

> ğŸ’¡ è¿™é‡Œè™½ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹åŒ… [golang.org/x/exp/constraints](https://link.segmentfault.com/?enc=fUJXUVvWNlWckJHC5B2y2w%3D%3D.SYrmd%2B%2FFGwy4Gyk7MvYIgwWK0D1NdklbRuZEsObjPYBc9kyqZM2jIBF0A1NK%2Fp64) ï¼Œä½†å› ä¸ºè¿™ä¸ªåŒ…å±äºå®éªŒæ€§è´¨çš„ x åŒ…ï¼Œä»Šåå¯èƒ½ä¼šå‘ç”Ÿéå¸¸å¤§å˜åŠ¨ï¼Œæ‰€ä»¥å¹¶ä¸æ¨èç›´æ¥ä½¿ç”¨

### æ¥å£ä¸¤ç§ç±»å‹

æˆ‘ä»¬æ¥ä¸‹æ¥å†è§‚å¯Ÿä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­æ˜¯é˜è¿°æ¥å£æ˜¯ç±»å‹é›†æœ€å¥½çš„ä¾‹å­ï¼š

```go
type ReadWriter interface {
    ~string | ~[]rune

    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
}
```

æœ€å¼€å§‹çœ‹åˆ°è¿™ä¸€ä¾‹å­ä½ ä¸€å®šæœ‰ç‚¹æ‡µä¸å¤ªç†è§£å®ƒä»£è¡¨çš„æ„æ€ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ç”¨ç±»å‹é›†çš„æ¦‚å¿µå°±èƒ½æ¯”è¾ƒè½»æ¾ç†è§£è¿™ä¸ªæ¥å£çš„æ„æ€ï¼š

> æ¥å£ç±»å‹ `ReadWriter` ä»£è¡¨äº†ä¸€ä¸ªç±»å‹é›†åˆï¼Œæ‰€æœ‰ä»¥ `string` æˆ– `[]rune` ä¸ºåº•å±‚ç±»å‹ï¼Œå¹¶ä¸”å®ç°äº† `Read()` `Write()` è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç±»å‹éƒ½åœ¨ `ReadWriter `ä»£è¡¨çš„ç±»å‹é›†å½“ä¸­

å¦‚ä¸‹é¢ä»£ç ä¸­ï¼Œ`StringReadWriter` å­˜åœ¨äºæ¥å£ `ReadWriter` ä»£è¡¨çš„ç±»å‹é›†ä¸­ï¼Œè€Œ `BytesReadWriter` å› ä¸ºåº•å±‚ç±»å‹æ˜¯ `[]byte`ï¼ˆæ—¢ä¸æ˜¯ `string` ä¹Ÿæ˜¯ä¸ `[]rune`ï¼‰ ï¼Œæ‰€ä»¥å®ƒä¸å±äº `ReadWriter` ä»£è¡¨çš„ç±»å‹é›†

```go
// ç±»å‹ StringReadWriter å®ç°äº†æ¥å£ Readwriter
type StringReadWriter string 

func (s StringReadWriter) Read(p []byte) (n int, err error) {
    // ...
}

func (s StringReadWriter) Write(p []byte) (n int, err error) {
 // ...
}

//  ç±»å‹BytesReadWriter æ²¡æœ‰å®ç°æ¥å£ Readwriter
type BytesReadWriter []byte 

func (s BytesReadWriter) Read(p []byte) (n int, err error) {
 ...
}

func (s BytesReadWriter) Write(p []byte) (n int, err error) {
 ...
}
```

ä½ ä¸€å®šä¼šè¯´ï¼Œå•Šç­‰ç­‰ï¼Œè¿™æ¥å£ä¹Ÿå˜å¾—å¤ªå¤æ‚äº†æŠŠï¼Œé‚£æˆ‘å®šä¹‰ä¸€ä¸ª `ReadWriter` ç±»å‹çš„æ¥å£å˜é‡ï¼Œç„¶åæ¥å£å˜é‡èµ‹å€¼çš„æ—¶å€™ä¸å…‰è¦è€ƒè™‘åˆ°æ–¹æ³•çš„å®ç°ï¼Œè¿˜å¿…é¡»è€ƒè™‘åˆ°å…·ä½“åº•å±‚ç±»å‹ï¼Ÿå¿ƒæ™ºè´Ÿæ‹…ä¹Ÿå¤ªå¤§äº†å§ã€‚æ˜¯çš„ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸ºäº†ä¿æŒ Go è¯­è¨€çš„å…¼å®¹æ€§ï¼ŒGo1.18 å¼€å§‹å°†æ¥å£åˆ†ä¸ºäº†ä¸¤ç§ç±»å‹

- **åŸºæœ¬æ¥å£ (Basic interface)**
- **ä¸€èˆ¬æ¥å£ (General interface)**

#### åŸºæœ¬æ¥å£ (Basic interface)

æ¥å£å®šä¹‰ä¸­å¦‚æœåªæœ‰æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆè¿™ç§æ¥å£è¢«ç§°ä¸º**åŸºæœ¬æ¥å£ (Basic interface)**ã€‚è¿™ç§æ¥å£å°±æ˜¯ Go1.18 ä¹‹å‰çš„æ¥å£ï¼Œç”¨æ³•ä¹ŸåŸºæœ¬å’Œ Go1.18 ä¹‹å‰ä¿æŒä¸€è‡´ã€‚åŸºæœ¬æ¥å£å¤§è‡´å¯ä»¥ç”¨äºå¦‚ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

- æœ€å¸¸ç”¨çš„ï¼Œ**å®šä¹‰æ¥å£å˜é‡å¹¶èµ‹å€¼**

    ```go
    type MyError interface { // æ¥å£ä¸­åªæœ‰æ–¹æ³•ï¼Œæ‰€ä»¥æ˜¯åŸºæœ¬æ¥å£
        Error() string
    }
    
    // ç”¨æ³•å’Œ Go1.18ä¹‹å‰ä¿æŒä¸€è‡´
    var err MyError = fmt.Errorf("hello world")
    ```

- åŸºæœ¬æ¥å£å› ä¸ºä¹Ÿä»£è¡¨äº†ä¸€ä¸ªç±»å‹é›†ï¼Œæ‰€ä»¥ä¹Ÿå¯**ç”¨åœ¨ç±»å‹çº¦æŸä¸­**

    ```go
    // io.Reader å’Œ io.Writer éƒ½æ˜¯åŸºæœ¬æ¥å£ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ç±»å‹çº¦æŸä¸­
    type MySlice[T io.Reader | io.Writer]  []Slice
    ```

#### ä¸€èˆ¬æ¥å£ (General interface)

å¦‚æœæ¥å£å†…ä¸å…‰åªæœ‰æ–¹æ³•ï¼Œè¿˜æœ‰ç±»å‹çš„è¯ï¼Œè¿™ç§æ¥å£è¢«ç§°ä¸º**ä¸€èˆ¬æ¥å£ (General interface)** ï¼Œå¦‚ä¸‹ä¾‹å­éƒ½æ˜¯ä¸€èˆ¬æ¥å£ï¼š

```go
type Uint interface { // æ¥å£ Uint ä¸­æœ‰ç±»å‹ï¼Œæ‰€ä»¥æ˜¯ä¸€èˆ¬æ¥å£
    ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64
}

type ReadWriter interface {  // ReadWriter æ¥å£æ—¢æœ‰æ–¹æ³•ä¹Ÿæœ‰ç±»å‹ï¼Œæ‰€ä»¥æ˜¯ä¸€èˆ¬æ¥å£
    ~string | ~[]rune

    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
}
```

**ä¸€èˆ¬æ¥å£ç±»å‹ä¸èƒ½ç”¨æ¥å®šä¹‰å˜é‡ï¼Œåªèƒ½ç”¨äºæ³›å‹çš„ç±»å‹çº¦æŸä¸­**ã€‚æ‰€ä»¥ä»¥ä¸‹çš„ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼š

```go
type Uint interface {
    ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64
}

var uintInf Uint // é”™è¯¯ã€‚Uintæ˜¯ä¸€èˆ¬æ¥å£ï¼Œåªèƒ½ç”¨äºç±»å‹çº¦æŸï¼Œä¸å¾—ç”¨äºå˜é‡å®šä¹‰
```

è¿™ä¸€é™åˆ¶ä¿è¯äº†ä¸€èˆ¬æ¥å£çš„ä½¿ç”¨è¢«é™å®šåœ¨äº†æ³›å‹ä¹‹ä¸­ï¼Œä¸ä¼šå½±å“åˆ° Go1.18 ä¹‹å‰çš„ä»£ç ï¼ŒåŒæ—¶ä¹Ÿæå¤§å‡å°‘äº†ä¹¦å†™ä»£ç æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…

### æ³›å‹æ¥å£

æ‰€æœ‰ç±»å‹çš„å®šä¹‰ä¸­éƒ½å¯ä»¥ä½¿ç”¨ç±»å‹å½¢å‚ï¼Œæ‰€ä»¥**æ¥å£å®šä¹‰è‡ªç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å½¢å‚**ï¼Œè§‚å¯Ÿä¸‹é¢è¿™ä¸¤ä¸ªä¾‹å­ï¼š

```go
type DataProcessor[T any] interface {
    Process(oriData T) (newData T)
    Save(data T) error
}

type DataProcessor2[T any] interface {
    int | ~struct{ Data interface{} }

    Process(data T) (newData T)
    Save(data T) error
}
```

å› ä¸ºå¼•å…¥äº†ç±»å‹å½¢å‚ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ¥å£æ˜¯æ³›å‹ç±»å‹ã€‚**è€Œæ³›å‹ç±»å‹è¦ä½¿ç”¨çš„è¯å¿…é¡»ä¼ å…¥ç±»å‹å®å‚å®ä¾‹åŒ–æ‰æœ‰æ„ä¹‰**ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥å°è¯•å®ä¾‹åŒ–ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¥å£ã€‚å› ä¸º `T` çš„ç±»å‹çº¦æŸæ˜¯ anyï¼Œæ‰€ä»¥å¯ä»¥éšä¾¿æŒ‘ä¸€ä¸ªç±»å‹æ¥å½“å®å‚(æ¯”å¦‚string)ï¼š

```go
DataProcessor[string]

// å®ä¾‹åŒ–ä¹‹åçš„æ¥å£å®šä¹‰ç›¸å½“äºå¦‚ä¸‹æ‰€ç¤ºï¼š
type DataProcessor[string] interface {
    Process(oriData string) (newData string)
    Save(data string) error
}
```

ç»è¿‡å®ä¾‹åŒ–ä¹‹åå°±å¥½ç†è§£äº†ï¼Œ `DataProcessor[string]` å› ä¸ºåªæœ‰æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒå®é™…ä¸Šå°±æ˜¯ä¸ª **åŸºæœ¬æ¥å£ (Basic interface)**ï¼Œè¿™ä¸ªæ¥å£åŒ…å«ä¸¤ä¸ªèƒ½å¤„ç† string ç±»å‹çš„æ–¹æ³•ã€‚åƒä¸‹é¢è¿™æ ·å®ç°äº†è¿™ä¸¤ä¸ªèƒ½å¤„ç† string ç±»å‹çš„æ–¹æ³•å°±ç®—å®ç°äº†è¿™ä¸ªæ¥å£ï¼š

```go
type CSVProcessor struct {
}

// æ³¨æ„ï¼Œæ–¹æ³•ä¸­ oriData ç­‰çš„ç±»å‹æ˜¯ string
func (c CSVProcessor) Process(oriData string) (newData string) {
    ....
}

func (c CSVProcessor) Save(oriData string) error {
    ...
}

// CSVProcessorå®ç°äº†æ¥å£ DataProcessor[string] ï¼Œæ‰€ä»¥å¯èµ‹å€¼
var processor DataProcessor[string] = CSVProcessor{}  
processor.Process("name,age\nbob,12\njack,30")
processor.Save("name,age\nbob,13\njack,31")

// é”™è¯¯ã€‚CSVProcessoræ²¡æœ‰å®ç°æ¥å£ DataProcessor[int]
var processor2 DataProcessor[int] = CSVProcessor{}
```

å†ç”¨åŒæ ·çš„æ–¹æ³•å®ä¾‹åŒ– `DataProcessor2[T]` ï¼š

```go
DataProcessor2[string]

// å®ä¾‹åŒ–åçš„æ¥å£å®šä¹‰å¯è§†ä¸º
type DataProcessor2[T string] interface {
    int | ~struct{ Data interface{} }

    Process(data string) (newData string)
    Save(data string) error
}
```

`DataProcessor2[string]` å› ä¸ºå¸¦æœ‰ç±»å‹å¹¶é›†æ‰€ä»¥å®ƒæ˜¯**ä¸€èˆ¬æ¥å£(General interface)**ï¼Œæ‰€ä»¥å®ä¾‹åŒ–ä¹‹åçš„è¿™ä¸ªæ¥å£ä»£è¡¨çš„æ„æ€æ˜¯ï¼š

1. åªæœ‰å®ç°äº† `Process(string) string` å’Œ `Save(string) error` è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”ä»¥ `int` æˆ– `struct{ Data interface{} }` ä¸ºåº•å±‚ç±»å‹çš„ç±»å‹æ‰ç®—å®ç°äº†è¿™ä¸ªæ¥å£
2. **ä¸€èˆ¬æ¥å£ (General interface)** ä¸èƒ½ç”¨äºå˜é‡å®šä¹‰åªèƒ½ç”¨äºç±»å‹çº¦æŸï¼Œæ‰€ä»¥æ¥å£ `DataProcessor2[string]` åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªç”¨äºç±»å‹çº¦æŸçš„ç±»å‹é›†

```go
// XMLProcessor è™½ç„¶å®ç°äº†æ¥å£ DataProcessor2[string] çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å› ä¸ºå®ƒçš„åº•å±‚ç±»å‹æ˜¯ []byteï¼Œæ‰€ä»¥ä¾æ—§æ˜¯æœªå®ç° DataProcessor2[string]
type XMLProcessor []byte

func (c XMLProcessor) Process(oriData string) (newData string) {

}

func (c XMLProcessor) Save(oriData string) error {

}

// JsonProcessor å®ç°äº†æ¥å£ DataProcessor2[string] çš„ä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶åº•å±‚ç±»å‹æ˜¯ struct{ Data interface{} }ã€‚æ‰€ä»¥å®ç°äº†æ¥å£ DataProcessor2[string]
type JsonProcessor struct {
    Data interface{}
}

func (c JsonProcessor) Process(oriData string) (newData string) {

}

func (c JsonProcessor) Save(oriData string) error {

}

// é”™è¯¯ã€‚DataProcessor2[string]æ˜¯ä¸€èˆ¬æ¥å£ä¸èƒ½ç”¨äºåˆ›å»ºå˜é‡
var processor DataProcessor2[string]

// æ­£ç¡®ï¼Œå®ä¾‹åŒ–ä¹‹åçš„ DataProcessor2[string] å¯ç”¨äºæ³›å‹çš„ç±»å‹çº¦æŸ
type ProcessorList[T DataProcessor2[string]] []T

// æ­£ç¡®ï¼Œæ¥å£å¯ä»¥å¹¶å…¥å…¶ä»–æ¥å£
type StringProcessor interface {
    DataProcessor2[string]

    PrintString()
}

// é”™è¯¯ï¼Œå¸¦æ–¹æ³•çš„ä¸€èˆ¬æ¥å£ä¸èƒ½ä½œä¸ºç±»å‹å¹¶é›†çš„æˆå‘˜(å‚è€ƒ6.5 æ¥å£å®šä¹‰çš„ç§ç§é™åˆ¶è§„åˆ™
type StringProcessor interface {
    DataProcessor2[string] | DataProcessor2[[]byte]

    PrintString()
}
```

### æ¥å£å®šä¹‰çš„ç§ç§é™åˆ¶è§„åˆ™

ä» Go1.18 å¼€å§‹ï¼Œåœ¨å®šä¹‰ç±»å‹é›† (æ¥å£) çš„æ—¶å€™å¢åŠ äº†éå¸¸å¤šååˆ†çç¢çš„é™åˆ¶è§„åˆ™ï¼Œå…¶ä¸­å¾ˆå¤šè§„åˆ™éƒ½åœ¨ä¹‹å‰çš„å†…å®¹ä¸­ä»‹ç»è¿‡äº†ï¼Œä½†å‰©ä¸‹è¿˜æœ‰ä¸€äº›è§„åˆ™å› ä¸ºæ‰¾ä¸åˆ°å¥½çš„åœ°æ–¹ä»‹ç»ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç»Ÿä¸€ä»‹ç»ä¸‹ï¼š

1. ç”¨ `|` è¿æ¥å¤šä¸ªç±»å‹çš„æ—¶å€™ï¼Œç±»å‹ä¹‹é—´ä¸èƒ½æœ‰ç›¸äº¤çš„éƒ¨åˆ† (å³å¿…é¡»æ˜¯ä¸äº¤é›†):

    ```go
    type MyInt int
    
    // é”™è¯¯ï¼ŒMyIntçš„åº•å±‚ç±»å‹æ˜¯int,å’Œ ~int æœ‰ç›¸äº¤çš„éƒ¨åˆ†
    type _ interface {
        ~int | MyInt
    }
    ```

    ä½†æ˜¯ç›¸äº¤çš„ç±»å‹ä¸­æ˜¯æ¥å£çš„è¯ï¼Œåˆ™ä¸å—è¿™ä¸€é™åˆ¶ï¼š

    ```go
    type MyInt int
    
    type _ interface {
        ~int | interface{ MyInt }  // æ­£ç¡®
    }
    
    type _ interface {
        interface{ ~int } | MyInt // ä¹Ÿæ­£ç¡®
    }
    
    type _ interface {
        interface{ ~int } | interface{ MyInt }  // ä¹Ÿæ­£ç¡®
    }
    ```

2. ç±»å‹çš„å¹¶é›†ä¸­ä¸èƒ½æœ‰ç±»å‹å½¢å‚

    ```go
    type MyInf[T ~int | ~string] interface {
        ~float32 | T  // é”™è¯¯ã€‚Tæ˜¯ç±»å‹å½¢å‚
    }
    
    type MyInf2[T ~int | ~string] interface {
        T  // é”™è¯¯
    }
    ```

3. æ¥å£ä¸èƒ½ç›´æ¥æˆ–é—´æ¥åœ°å¹¶å…¥è‡ªå·±

    ```go
    type Bad interface {
        Bad // é”™è¯¯ï¼Œæ¥å£ä¸èƒ½ç›´æ¥å¹¶å…¥è‡ªå·±
    }
    
    type Bad2 interface {
        Bad1
    }
    type Bad1 interface {
        Bad2 // é”™è¯¯ï¼Œæ¥å£Bad1é€šè¿‡Bad2é—´æ¥å¹¶å…¥äº†è‡ªå·±
    }
    
    type Bad3 interface {
        ~int | ~string | Bad3 // é”™è¯¯ï¼Œé€šè¿‡ç±»å‹çš„å¹¶é›†å¹¶å…¥äº†è‡ªå·±
    }
    ```

4. æ¥å£çš„å¹¶é›†æˆå‘˜ä¸ªæ•°å¤§äºä¸€çš„æ—¶å€™ä¸èƒ½ç›´æ¥æˆ–é—´æ¥å¹¶å…¥ `comparable` æ¥å£

    ```javascript
    type OK interface {
        comparable // æ­£ç¡®ã€‚åªæœ‰ä¸€ä¸ªç±»å‹çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ comparable
    }
    
    type Bad1 interface {
        []int | comparable // é”™è¯¯ï¼Œç±»å‹å¹¶é›†ä¸èƒ½ç›´æ¥å¹¶å…¥ comparable æ¥å£
    }
    
    type CmpInf interface {
        comparable
    }
    type Bad2 interface {
        chan int | CmpInf  // é”™è¯¯ï¼Œç±»å‹å¹¶é›†é€šè¿‡ CmpInf é—´æ¥å¹¶å…¥äº†comparable
    }
    type Bad3 interface {
        chan int | interface{comparable}  // ç†æ‰€å½“ç„¶ï¼Œè¿™æ ·ä¹Ÿæ˜¯ä¸è¡Œçš„
    }
    ```

5. å¸¦æ–¹æ³•çš„æ¥å£ (æ— è®ºæ˜¯åŸºæœ¬æ¥å£è¿˜æ˜¯ä¸€èˆ¬æ¥å£)ï¼Œéƒ½ä¸èƒ½å†™å…¥æ¥å£çš„å¹¶é›†ä¸­ï¼š

    ```go
    type _ interface {
        ~int | ~string | error // é”™è¯¯ï¼Œerroræ˜¯å¸¦æ–¹æ³•çš„æ¥å£(ä¸€èˆ¬æ¥å£) ä¸èƒ½å†™å…¥å¹¶é›†ä¸­
    }
    
    type DataProcessor[T any] interface {
        ~string | ~[]byte
    
        Process(data T) (newData T)
        Save(data T) error
    }
    
    // é”™è¯¯ï¼Œå®ä¾‹åŒ–ä¹‹åçš„ DataProcessor[string] æ˜¯å¸¦æ–¹æ³•çš„ä¸€èˆ¬æ¥å£ï¼Œä¸èƒ½å†™å…¥ç±»å‹å¹¶é›†
    type _ interface {
        ~int | ~string | DataProcessor[string] 
    }
    
    type Bad[T any] interface {
        ~int | ~string | DataProcessor[T]  // ä¹Ÿä¸è¡Œ
    }
    ```