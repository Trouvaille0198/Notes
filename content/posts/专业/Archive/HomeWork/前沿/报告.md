---
draft: true
---

# 地铁满载率的计算与预测

## 背景介绍与说明

400

便利的交通系统是现代社会的一大基本特征。而地铁又是公共交通的代表类型。近几年来，随着国家现代化建设加速，居民交通出行需求也在持续不断增长，公共交通的拥堵状况日益频，包含地铁作为一种重要的城市轨道交通系统，自然首先遇到拥挤带来的负卖能影响。在地铁近百年的运营历史中，如何对地铁的客运满载率进行准确的计算，如何根据外界因素预测地铁载客量的变化，一直是设计人员与工程师致力于解决与优化的课题。

满载率指列车装载的乘客数量与列车所能承载的最大乘客数量的比值，是衡量列车拥挤程度的唯一性指标。满载率会在列车运行时发生实时性的变化，但是其变化具有大致的规律性，会受到一系列外部因素的影响。

对地铁载客率算法的探究具有重要的现实意义：对影响地铁载客量因素的探索与权重比较可以优化地铁站、车厢等设施的建造设计；准确的载客量预测有助于地铁频次的调度分配和列车时刻表的修正；各个地铁站满载率的比较研究可以帮助工程师设计出更加合理快速的地铁线路。

## 国内外研究现状

2000

对于地铁满载率的计算，现在主要有三大研究方向：传统的统计学方法、设备记录方法、自动检票系统与机器学习结合的方法。

使用传统的统计学理论，实地调研获取真实数据，这类方法拥有最高的准确度，却也有它的局限性：首先，它需要调用大量的人力物力、花费不可接受的时间成本来换取准确度；其次，以此法调查出来的数据拥有极大的地域局限性，很难推广到所有的地铁站；最后，数据的实时性明显不足

设备记录方法的使用相对比较广泛。各种方案的准确率、成本上的差异也比较大。其中，车辆称重与票务清分是使用最为广泛的两种满载率的计算方法。

车辆称重是指使用轨道车辆称重调簧及轮重减载率测试系统对整个列车车身进行质量测算，与已有的重量分级表进行比较，估算出乘客数量的技术。车厢称重系统在每次到站时，将测量的数据通过站台区域覆盖的无线网络上传至数据中心，完成一次数据采集过程。此法准确率有限，计算得到的结果只能以分级的形式呈现，数据精度难以达到目标；而且设备的维护成较高。

票务清分通过清分模型，将地铁运营的票款收入分配至各个运营线路上；其中保有每位乘客的进出站信息，可以根据这个信息粗略地得到乘客的出行数据，进而推测出乘客的线路乘坐情况。现代票务情分基本上由计算机程序进行控制，乘客的进出站数据的收集难度较小，可以使用最短路径清分法、k 短路径清分法或多路径选择概率清分算法来大致刻画乘客的出行路线。票务清分系统使用了当前广泛普及的自动检票系统来完成客流走向的估算，成本较低；但是在准确度上尚有不足。乘客的进出站数据不能完美复现其行车走向；其步行到站时间、等车时间、漏乘到下一班的可能性都将被忽略，换乘的出现也将加大分析的难度，若没有一个精确可靠的数学模型来支撑这些数据，此种方法仍然不能较好地完成满载率测算的任务。

另一种新兴的测量方法是 WIFI 探针采集技术。这种技术将对开启 WIFI 的乘客设备进行数据采集，获取设备的 MAC 地址等可以识别身份的关键性、唯一性信息以记录乘客的数量。该方法的准确度较高，信号传输不易受到非视距误差和多径衰落影响，而且可以和传统的车联称重、票务分析的测算方法结合进行综合分析，准确度可以达到一个较高水准；但是此种方法也有一定缺陷：首先，WIFI 探针具有一定的设备成本，使用时，还需要工作人员高举探针设备进行数据采集，而且普及率不高；其次，地下信号波动较大，而地面的信号干扰有比较大，WIFI 探针的实际使用将会受这两个缺点的影响，工作场景并不是完美的；最后，这种放法针对的目标是具有 WIFI 功能的智能设备而不是乘客实体，没有考虑到一人多机的情况，也没有考虑到并不携带此种设备的乘客，这将会加大测算结果的偏差。

自动检票系统与机器学习结合是一种成本较低、准确率较高的测算方法，这种方法通过分析乘客的进出站时间、站点等数据，附加上天气、站点地理位置、列车班次表等因素，运用人工智能机器学习方法，构建一个估计乘客乘坐班次的数学模型，从而达到计算每个班次列车满载率的目标。这也是之后章节将要涉及的方向。这种方法的优点是人力、物力成本极小，不需要添置新的技术设备，也不需要工作人员做实时数据的采集，最为重要的乘客进出站数据已由自动检票系统代为收集；而且其维护成本低，一旦迭代出一个较为准确的数学模型，它就拥有一个极长的生命周期，不需要在使用时做很大的改动，全程自动化的特性极大方便了相关人员的使用；不仅对维护人员友好，这种测算方法也对乘客友好，相比于传统的人工收集、设备收集对于乘客较强的侵入性，自动检票系统更被大众接受，后台的机器学习模型也不会对乘客产生任何干扰和影响。综合来说，这种方法是最优的。不过如何构建出一个稳定、具有泛用性的数学模型，成了一个难题。

其中一种方法是使用 SVR 模型。支持向量机回归（SVR）是一种将特征向量映射到高维空间中再进行回归的支持向量机方法。通过提取耗时最短乘车事务的方法，可以得到一个不同起点站和终点站的矩阵，结合站台人数的变化确定列车驶离站台的时间，前后波峰波谷的插值估算出每班列车展台上的装载人数，再将这些数据作为特征输入到模型中进行训练，最后以均方根误差和平均绝对误差为评判指标不断优化迭代模型。

在对列车满载率进行实时估算之上的目标，就是预测出未来班次列车的满载率了。预测相较于估算有着更高的不确定性，传统的人工采集、设备采集的方法几乎不能再这个领域起到任何作用。这时候，基于机器学习算法的预测模型成为了最佳选择。

对列车满载率的预测，需要大量已知数据作为训练集，也需要收集许多可能影响乘客行程耗时的因素，组成一个庞大的多维度特征向量群来提高预测精确度。天气、温度、以天为单位的时刻、星期、节假日、站点的地理位置、站点容量、列车时间表等等变量都将对乘客的行程耗时造成影响，如何分析这些因素，是否可以得出其间的依赖关系，筛选去无关信息，是国内外研究的重点。

## 关键问题难点分析

1000

本章节将简述使用自动检票系统与机器学习结合的方法对列车满载率进行测算和预估的一些难点介绍与分析

由于自动检票系统只能提供乘客的进出站时间、进出站站点信息，乘客实际上做了哪一班车无从而知，需要进行推测。

首先对普通乘客乘坐列车的常规行为进行分析。乘客的行程分为以下几个部分：进站——步行至站台——等候列车到站——上车——列车行进——到站下车——步行至出站闸机——出站。

其次，根据具体行为的不同，乘客也可以分为一般乘客和逗留乘客。前者按照通用的行程路线上下列车、进出站点，没有延长乘车时间的行为。后者还会因为种种原因在地铁站内进行长短时间不定的逗留，如天气影响、列车延误、等待同行者、站点属性（商住文教）等等。后者还可再次细分：主观逗留乘客和被动逗留乘客。

明确上述信息后，我们对直达乘客的乘坐班次问题进行进一步研究。这个问题主要想实现在输入乘客 i 进站时间、乘客 i 的出站时间、站点 O 的列车班次时间表和站点 D 的列车班次时间表之后，得到乘客 i 的乘车班次（上车时间）。目前构想的思路是：根据乘客的出站时间，将时间相近的乘客进行聚类，通过比较该类乘客最后一人的出站时间，结合列车班次的乘车时长，推算出这一批乘客在站台上车的具体时间点。

对于单次换乘乘客乘坐班次，我们进行如下分析：通过输入乘客 i 的 O 站进站时刻，O 站到换乘站的乘车时间，换乘站的上车时刻，换乘站列车到站时刻，最后得到乘客 i 的乘车班次（上车时间）。目前构想的思路是：设置乘客的步行速度，得出进出站与换乘的步行时间；通过已知的输入数据计算乘客候车的时间总和，以耗时相同为标准将乘客进行分类：乘坐第一班次列车、乘坐后一班次列车。其中，留候的乘客又分为在 O 站候车和在换乘站候车两种情况。最后，结合乘客换乘站列车到站时刻的数据，减去对应的乘车时间便可得到乘客 i 的 O 站的乘坐班次，即上车时间。

在讨论的过程中，我们遇到不少的挑战。

对于一个单次换乘乘客而言，在已知其 O 站进站时刻、各线路乘车时间、换乘站列车到站时刻以及换乘点平均候车时间之后，如何得出乘客 i 的最优换乘路径？要达到最优状态，就得确保乘客换乘次数最少和耗时较少。而有时两者却不可兼得。我们的假想是对相应数据设置权重，运用图论建立站点之间的联系并计算。

此外，在乘坐班次的相关问题中，我们要对逗留乘客进行更加细致的分类：先等候后上车和先上车后等候。若该逗留乘客与同某一班次列车的乘客一同出站的话，就可以通过逗留乘客入站时间减去该批次乘客的平均入站时间得到 i 乘客的逗留时间，若逗留时间与列车班次的时间比值接近整数，则可得到逗留乘客是先等候后上车类型的乘客，进而推断出其等候的班次数，最后推导出乘坐班次。但这仅仅是一种未验证的设想。具体的实践需要结合大量样本的测试和验证。

## 研究探索与尝试

2000

本章节主要运用到了两个关键技术来研究地铁客流量。第一个是 EM 算法，利用该算法与已有的进出站数据模拟乘客留乘的模型。第二个是 K-means 算法，结合 EM 算法对乘客耗时、天气温度、高峰期等因素进行聚类，从而使实验结果更接近真实的地铁客流量

EM 算法又称最大期望算法，是在概率模型中寻找参数最大似然估计或者最大后验估计的算法，其中概率模型依赖于无法观测的隐性变量。最大期望算法经过两个步骤交替进行计算，第一步是计算期望（E），利用对隐藏变量的现有估计值，计算其最大似然估计值；第二步是最大化（M），最大化在 E 步上求得的最大似然值来计算参数的值。M 步上找到的参数估计值被用于下一个 E 步计算中，这个过程不断交替进行。EM 算法的具体思想就是：给隐变量θ自主规定个初值；根据给定观测数据和当前的参数θ，求未观测数据 z 的条件概率分布的期望；z 已经求出来了，于是根据极大似然估计求最优的θ’；因为第二步和第三步的结果可能不是最优的，所以重复第二步和第三步，直到收敛。

K-means 算法又称 K 均值聚类算法，是一种迭代求解的聚类分析算法，其步骤是，预先将数据分为 K 组，则随机选取 K 个对象作为初始的聚类中心，然后计算每个对象与各个种子聚类中心之间的距离，把每个对象分配给距离它最近的聚类中心。聚类中心以及分配给它们的对象就代表一个聚类。每分配一个样本，聚类的聚类中心会根据聚类中现有的对象被重新计算。这个过程将不断重复直到满足某个终止条件。终止条件可以是没有（或最小数目）对象被重新分配给不同的聚类，没有（或最小数目）聚类中心再发生变化，误差平方和局部最小。

## 总结

300