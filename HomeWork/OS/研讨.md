# 研讨

Linux 环境下进程信息查看和作业控制

![image-20210921220123092](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921220123092.png)

## 命令

### fg 

（foreground）

将**后台运行**的或**挂起**的任务切换到前台运行

```
fg <job_id>
```

### bg

（background）

b将**挂起**的任务切换到后台运行

```shell
bg <job_id>
```

### ctrl + z

**挂起**：将一个正在前台执行的命令放到后台，并且暂停

### &

当在前台运行某个作业时，终端被该作业占据；可以在命令后面加上 `&` 实现后台运行。

不过，作业在后台运行一样**会将结果输出到屏幕上**，干扰你的工作。

```shell
<command> &
```

如果放在后台运行的作业会产生大量的输出，最好使用下面的方法把它的输出重定向到某个文件中：

```shell
command  >  out.file  2>&1  &
```

使用 & 命令后，作业被提交到后台运行，当前控制台没有被占用，但是一但把当前控制台关掉（退出帐户时），作业就会停止运行

### nohup

（no hang up）

在系统后台运行命令（。）

```shell
nohup <command> &
```

**与 `&` 的区别**：

- 使用 nohup 命令，退出终端不会影响程序的运行
- nohup 命令将输出重定向至 `nohup.out`，`&` 则直接将输出打印到屏幕上

### ps

显示进程信息

- **-e: 显示所有进程；**

- **-f: 显示丰富格式信息**；

- -A：所有的进程均显示出来，与 -e 具有同样的效用；
- -a： 显示现行终端机下的所有进程，包括其他用户的进程；
- -u：以用户为主的进程状态 ；
- -x：通常与 a 这个参数一起使用，可列出较完整信息；
- **-l：较长、较详细的将该PID 的的信息列出；**
- -j：工作的格式 (jobs format)；
- -f：做一个更为完整的输出。

将本次登入的 PID 与相关信息列示出来

```shell
ps -l
```

列出目前所有的正在内存当中的程序

```shell
ps -axu
```

列出所有用户的进程详细信息（包括优先级 PRI 和nice值 NI）

```shell
ps -efl
```

参数解释

- F（Process Flag）：进程标志
    - 若 4 表示此进程的权限 root ；
    - 若 1 表示此子进程仅能 fork
- S（State）：状态
    - R (Running)：该进程正在运行；
    - S (Sleep)：该进程正在睡眠，可被唤醒。
    - D ：不可被唤醒
    - T ：停止状态(stop)；
    - Z (Zombie)：僵尸进程。
- ADDR：在内存的起始位置
    - 如果是个 running 进程，一般就会显示 `-` 
- SZ：内存使用量
- WCHAN：是否正在运行
    - 若为 - 表示正在工作中

### pstree

展示进程树

- -p 显示进程号

### renice

设置进程 / 用户 / 群组的优先级

用例

```shell
renice -n N –u username
renice -n N –g gid
renice -n N –p pid
```

选项

- -n = priority：优先级

- -u = name：用户名，用于设置用户的优先级

- -g = gid：组号，用于设置组的优先级

- -p = PID：进程号，用于设置进程的优先级

#### PRI 与 NI 的区别

详见：https://blog.csdn.net/u010317005/article/details/80531985

**优先运行序 (priority, PRI)**：其值越低，代表优先度越高；PRI 由核心动态调整，用户无权更改其值

**nice 值（NI）**：反应一个进程优先级状态的值，其范围在 -20-19 之间

两者关系：PRI(new) = PRI(old) + nice

### nice

在执行命令时设置其优先级

```shell
nice -N <command>
```

- -N：要设置的优先级

## 步骤

在 root 用户下创建 f1 文件，挂起

```shell
vi f1.txt
```

用 `jobs` 命令查看被挂起的进程

```shell
jobs
```

![image-20210921143428610](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921143428610.png)

用 `nohup` 命令后台启动 `find` 进程

```shell
nohup find &
```

![image-20210921145430969](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145430969.png)

显示当前所有进程和进程号

```shell
ps -e
```

![image-20210921145533893](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145533893.png)

显示所有进程含优先级的详细信息

```shell
ps -efl
```

![image-20210921145718774](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145718774.png)

打印进程家族树

```shell
pstree -p
```

![image-20210921145828991](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145828991.png)

终止 find 进程的后台运行

```shell
kill <pid>
```

![image-20210921145902524](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145902524.png)

此时查看进程，find 进程已被终结

![image-20210921145953388](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921145953388.png)

切换到 student 用户，创建 f2 文件并设置优先级（nice 值）为 5，挂起

```shell
su student
nice -5 vi f2.txt 
```

![image-20210921150136165](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921150136165.png)

后台启动 find 进程

```shell
nohup find &
```

显示所有进程含优先级的详细信息

```shell
ps -efl
```

可以看到，`vi f2.txt` 命令的优先级被设为了 5

![image-20210921150308341](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921150308341.png)

切换到 root 用户（非 root 用户无法将优先级别调高），将 student 的用户进程优先数改为 -5

```shell
su root # 或 sudo su
renice -n -5 -u student
```

![image-20210921150543885](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921150543885.png)

显示所有进程含优先级的详细信息

```shell
ps -efl
```

可以看到，student 用户所有进程的优先级都被设为了 -5

![image-20210921150602261](https://markdown-1303167219.cos.ap-shanghai.myqcloud.com/image-20210921150602261.png)





