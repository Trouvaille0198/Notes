# 一、概述

## 1.1 互联网的组成

### 1.1.1 边缘部分

由所有连接在互联网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和资源共享。

#### 1）端系统之间的两种通信方式
- **客户-服务器方式**（C/S）

    客户是服务的请求方，服务器是服务的提供方

    <img src="http://image.trouvaille0198.top/914894c2-0bc4-46b5-bef9-0316a69ef521.jpg" alt="img" style="zoom:67%;" />

    - 客户软件的特点
        1. 被用户调用后运行，在打算通信时主动向远地服务器发起通信（请求服务）。因此，**客户程序必须知道服务器程序的地址**
        2. 不需要特殊的硬件和很复杂的操作系统
    - 服务器软件的特点
        1. 一种专门用来提供某种服务的程序，可同时处理多个远地或本地客户的请求
        2. 系统启动后即自动调用并一直不断地运行着，被动地等待并接受来自各地的客户的通信请求。因此，**服务器程序不需要知道客户程序的地址**
        3. 一般需要强大的硬件和高级的操作系统支持

- **对等方式**（P2P）

    不区分客户和服务器。

    <img src="http://image.trouvaille0198.top/42430e94-3137-48c0-bdb6-3cebaf9102e3.jpg" alt="img" style="zoom:67%;" />



### 1.1.2 核心部分

由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）

- 在网络核心部分起特殊作用的是**路由器** (router)。

- 路由器是实现**分组交换** (packet switching) 的关键构件，其任务是转发收到的分组，这是网络核心部分最重要的功能。
- 分组交换是网络核心部分最重要的功能

#### 1）电路交换

$N$ 部电话机两两直接相连，需 $N(N – 1)/2$ 对电线。这种直接连接方法所需要的电线对的数量与电话机数量的平方（ $N2$ ）成正比。

当电话机的数量增多时，就要使用**交换机**来完成全网的分组任务，这就是电路交换

- 特点
    1. 电路交换必定是面向连接的
    2. 电路交换分为三个阶段：
        1. 建立连接：建立一条专用的物理通路，以保证双方通话时所需的通信资源在通信时不会被其他用户占用；
        2. 通话：主叫和被叫双方一直占用通信资源；
        3. 释放连接：释放刚才使用的这条专用的物理通路（释放刚才占用的所有通信资源）
- 总结

电路交换用于电话通信系统，两个用户要通信之前需要建立一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%

#### 2）分组交换

分组交换采用**存储转发**技术

- **步骤**
    1. 在发送端，先把较长的报文划分成较短的、固定长度的数据段
    2. 每一个数据段前面添加上**首部**构成分组 (packet)
    3. 分组交换网以“分组”（也称为“包”，首部也可称为“包头”）作为数据传输单元，依次把各分组发送到接收端（假定接收端在左边）
    4. 接收端收到分组后剥去首部还原成报文
    5. 最后，在接收端把收到的数据恢复成为原来的报文。

<img src="http://image.trouvaille0198.top/image-20210330090825113.png" alt="image-20210330090825113" style="zoom: 33%;" />

<img src="http://image.trouvaille0198.top/image-20210330090845396.png" alt="image-20210330090845396" style="zoom:33%;" />

<img src="http://image.trouvaille0198.top/image-20210330090900606.png" alt="image-20210330090900606" style="zoom:33%;" />

<img src="http://image.trouvaille0198.top/image-20210330090922592.png" alt="image-20210330090922592" style="zoom:33%;" />

- **首部的重要性**
    - 每一个分组的首部都含有地址（诸如目的地址和源地址）等控制信息。
    - 分组交换网中的结点交换机根据收到的分组首部中的地址信息，把分组转发到下一个结点交换机。
    - 每个分组在互联网中独立地选择传输路径。（通过路由器）
    - 用这样的存储转发方式，最后分组就能到达最终目的地。
- **路由器的作用**
    - 在路由器中的输入和输出端口之间没有直接连线。
    - 路由器处理分组的过程是：
        1. 把收到的分组先放入缓存（暂时存储）；
        2. 查找转发表，找出到某个目的地址应从哪个端口转发；
        3. 把分组送到适当的端口转发出去。
- **优点**
    - 高效：在分组传输的过程中动态分配传输带宽，对通信链路是逐段占用
    - 灵活：为每一个分组独立地选择最合适的转发路由
    - 迅速：以分组作为传送单位，可以不先建立连接就能向其他主机发送分组。
    - 可靠：保证可靠性的网络协议；分布式多路由的分组交换网，使网络有很好的生存性
- 缺点
    - 分组在各结点存储转发时需要排队，这就会造成一定的**时延**。
    - 分组必须携带的首部（里面有必不可少的控制信息）也造成了一定的开销
- **总结**

每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上同时传输多个分组互相不会影响，因此在同一条传输线路上允许同时传输多个分组，也就是说分组交换不需要占用传输线路。

在一个邮局通信系统中，邮局收到一份邮件之后，先存储下来，然后把相同目的地的邮件一起转发到下一个目的地，这个过程就是存储转发过程，分组交换也使用了存储转发过程。

#### 3）报文交换

在 20 世纪 40 年代，电报通信也采用了基于存储转发原理的报文交换 (message switching)。

报文交换的时延较长，从几分钟到几小时不等。现在报文交换已经很少有人使用了。

#### 4）三种交换的比较

<img src="http://image.trouvaille0198.top/image-20210330092542877.png" alt="image-20210330092542877" style="zoom: 50%;" />

### 1.1.3 核心与边缘

- 互联网的核心部分是由许多网络和把它们互连起来的路由器组成，而主机处在互联网的边缘部分。
- 互联网核心部分中的路由器之间一般都用高速链路相连接，而在网络边缘的主机接入到核心部分则通常以相对较低速率的链路相连接。
- 主机的用途是为用户进行信息处理的，并且可以和其他主机通过网络交换信息。路由器的用途则是用来转发分组的，即进行分组交换的。

## 1.2 计算机网络的分类

### 1.2.1 按照网络的作用范围进行分类

- **广域网 WAN** (Wide Area Network)：作用范围通常为几十到几千公里（跨越国家），是互联网的核心部分。
- **城域网 MAN** (Metropolitan Area Network)：作用距离约为 5 ~ 50 公里（几个街区甚至整个城市）。
- **局域网 LAN** (Local Area Network) ：局限在较小的范围（如 1 公里左右），校园网或企业网。
- **个人区域网 PAN** (Personal Area Network) ：范围很小，大约在 10 米左右，通过无线技术连接。

### 1.2.2 按照网络的使用者进行分类

- **公用网** (public network)

    电信公司建造的大型网络。按 规定交纳费用的人都
    可以 使用的 网络。因此也可称为公众网。

- **专用网** (private network)

    某个单位 为特殊业务工作的需要而建造的网络 ，例
    如军队、铁路、银行、电力等系统。

### 1.2.3 用来把用户接入到互联网的网络

- **接入网 AN** (Access Network)

    又称为本地接入网或居民接入网。

    接入网是一类比较特殊的计算机网络 ，用于将用户接入互联网。 只是起到让用户能够与互联网连接的“桥梁”作用。

    使用不同接入网技术，如电话线拨号、宽带

    接入网本身既不属于互联网的核心部分，也不属于互联网的边缘部分。

    接入网是从某个用户端系统到互联网中的第一个路由器（也称为边缘路由器）之间的一种网络。

    从覆盖的范围看，很多接入网还是属于局域网。

<img src="http://image.trouvaille0198.top/image-20210402101159250.png" alt="image-20210402101159250" style="zoom: 50%;" />

## 1.3 计算机网络的性能

### 1.3.1 性能指标

#### 1）速率

连接在计算机网络上的主机在数字信道上传送数据位数的速率，也称为数据率 (data rate) 或比特率 (bit)

速率的单位是 bit/s ，或 kbit /s 、 Mbit/s 、 Gbit /s 等。例如 $4 \times 10^{10} bit/s$ 的数据率就记为 40 Gbit /s 。


#### 2）带宽

带宽 (bandwidth) 用来表示网络中某通道传送数据的能力 。 表示在单位时间内网络中的某信道所能通过的“ **最高数据率** ”。

更常用的带宽单位是

- 千比特每秒 ，即 kb/s (10^3^ b/s )
- 兆比特每秒 ，即 Mb/s (10 ^6^ b/s )
- 吉比特每秒 ，即 Gb/s (10^9^ b/s )
- 太比特每秒 ，即 Tb/s (10^12^ b/s )

#### 3）吞吐量

吞吐量 (throughput) 表示在单位时间内通过某个网络（或信道、接口）的数据量，包括进和出

#### 4）时延

时延 (delay 或 latency) 是指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间

有时也称为延迟或迟延

网络中的时延由以下几个不同的部分组成

1. 发送时延

    发送数据时，数据帧从结点进入到传输媒体所需要的时间。

    也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。

    发送时延 = 数据帧长度 (bit) / 发送速率（bit/s)

2. 传播时延

    电磁波在信道中需要传播一定的距离而花费的时间。

    传播时延 = 信道长度（米) / 信号在信道上的传播速率 (米/秒)

3. 处理时延

    主机或路由器在收到分组时,为处理分组（例如分析首部、提取数据、差错检验或查找路由 ）所花费的时间。

4. 排队时延

    分组在路由器输入、输出队列中排队等待处理 所经历的时延。

    排队时延的长短往往取决于网络中当时的通信量。

    队列溢出时，相当于排队时延无限大。

<img src="http://image.trouvaille0198.top/image-20210402102835716.png" alt="image-20210402102835716" style="zoom: 40%;" />

#### 5）时延带宽积

链路的时延带宽积又称为 以比特为单位的链路长度。

时延带宽积 = 传播时延 × 带宽

<img src="http://image.trouvaille0198.top/image-20210402103609371.png" alt="image-20210402103609371" style="zoom:40%;" />

#### 6）往返时间 RTT

(Round Trip Time)

往返时间 表示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时间。

<img src="http://image.trouvaille0198.top/image-20210402103729831.png" alt="image-20210402103729831" style="zoom: 35%;" />



#### 6）利用率

- **信道利用率**

    指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零。

- **网络利用率** 

    全网络的信道利用率的加权平均值。

信道利用率并非越高越好。 当某信道的利用率增大时，该信道引起的时延也就迅速增加 。

<img src="http://image.trouvaille0198.top/image-20210402103941538.png" alt="image-20210402103941538" style="zoom:33%;" />

<img src="http://image.trouvaille0198.top/image-20210402104133315.png" alt="image-20210402104133315" style="zoom:33%;" />

### 1.3.2 非性能特征

（nonperformance characteristics）

费用 (cost)
质量 (quality of service) (QoS)
标准化
可靠性 (reliability)
可扩展性 (scalability)和可升级性 (upgradability)
易于管理和维护

## 1.4 计算机网络的体系结构

（协议分层）

### 1.4.1 计算机网络体系结构的形成
开放系统互连基本参考模型 OSI/RM (Open Systems Interconnection Reference Model) Model)，简称为 OSI 。

法律上的 (de jure) 国际标准 OSI 并没有得到市场的认可，非国际标准 TCP/IP 却获得了最广泛的应用。TCP/IP 常被称为 事实上的 (de facto) 国际标准

### 1.4.2 协议与划分层次
网络协议 (network protocol)，简称为协议，是为进行网络中的数据交换而建立的规则、标准或约定。

#### 1）网络协议的三个组成要素

- 语法： 数据与控制信息的结构或格式 。
- 语义： 需要发出何种控制信息，完成何种动作以及做出何种响应。
- 同步： 事件实现顺序的详细说明。

#### 2）层次式协议结构

划分层次的概念举例：主机 1 向主机 2 通过网络发送文件。

<img src="http://image.trouvaille0198.top/image-20210402110300736.png" alt="image-20210402110300736" style="zoom: 33%;" />

<img src="http://image.trouvaille0198.top/image-20210402110317587.png" alt="image-20210402110317587" style="zoom:33%;" />

<img src="http://image.trouvaille0198.top/image-20210402110340122.png" alt="image-20210402110340122" style="zoom:33%;" />

**分层的优劣**

- 优点
    - 各层之间是独立的。
    - 灵活性好。
    - 结构上可分割开。
    - 易于实现和维护。
    - 能促进标准化工作。

- 缺点
    - 降低效率
    - 有些功能会在不同的层次中重复出现，因而产生了额外开销 。

**层数控制**

层数太少，就会使每一层的协议太复杂。

层数太多，又会在描述和综合各层功能的系统工程任务时遇到较多的困难。

**各层完成的主要功能**

1. 差错控制：使相应层次对等方的通信更加可靠。
2. 流量控制：发送端的发送速率必须使接收端来得及接收，不要太快。
3. 分段和重装：发送端将要发送的数据块划分为更小的单位，在接收端将其还原。
4. 复用和分用：发送端几个高层会话复用一条低层的连接，在接收端再进行分用。
5. 连接建立和释放：交换数据前先建立一条逻辑连接，数据传送结束后释放连接。

#### 3）计算机网络的体系结构

**计算机网络的体系结构** (architecture) 是计算机网络的各层及其协议的集合。

体系结构就是这个计算机网络及其部件 所应完成的功能的精确定义。

**实现** (implementation) 是遵循这种体系结构的前提下用何种硬件或软件完成这些功能的问题。

体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件。



### 1.4.3 具有五层协议的体系结构

采取折中的办法，即综合 OSI 和 TCP/IP 的优点，采用一种只有五层协议的体系结构

<img src="http://image.trouvaille0198.top/0fa6c237-a909-4e2a-a771-2c5485cd8ce0.png" alt="img" style="zoom:67%;" />

#### 1）应用层 (application layer)
通过应用进程间的交互来完成特定网络应用

域名系统 DNS ，万维网 HTTP 协议，电子邮件 SMTP 协议
#### 2）运输层 (transport layer)
向两台主机中进程之间的通信提供通用的 数据传输 服务

传输控制协议 TCP 、用户数据报协议 UDP

#### 3）网络层 (network layer)
为分组交换网上的不同主机提供通信服务；选择合适的路由

网际协议 IP 和路由选择协议

#### 4）数据链路层 (data link layer)
两个相邻节点之间传送数据
#### 5）物理层 (physical layer)
传输数据单位为比特，要考虑多大的电压代表 1 或 0

不包含物理媒介

### 1.4.4 实体、协议、服务和服务访问点

**实体** (entity) 表示任何可发送或接收信息的硬件或软件进程。

**协议**是控制两个对等实体进行通信的规则的集合。

语法规则定义了信息的格式，语义规则定义了发送者或接收者所要完成的操作

在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。

要实现本层协议，还需要使用下层所提供的服务

#### 协议和服务的关系

协议的实现保证了能够向上一层提供服务 。

本层的服务用户 只能看见服务 而无法看见下面的协议。即下面的协议对上面的服务用户是 透明 的。

- 协议 是“ 水平的 ”，即协议是控制对等实体之间通信的规则。

- 服务 是“ 垂直的 ”，即服务是由下层向上层通过层间接口提供的。

上层使用下层提供的服务必须通过**服务原语**。

#### 服务访问点

同一系统相邻两层的实体进行交互的地方，称为**服务访问点 SAP** (Service Access) 。
服务访问点 SAP 是一个抽象的概念，它实际上就是一个逻辑接口 。
OSI 把层与层之间交换的数据的单位称为服务数据单元 SDU (Service Data)。

<img src="http://image.trouvaille0198.top/image-20210402112931105.png" alt="image-20210402112931105" style="zoom:40%;" />

### 1.4.5 TCP/IP 的体系结构

它只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。

TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层

<img src="http://image.trouvaille0198.top/48d79be8-085b-4862-8a9d-18402eb93b31.png" alt="img" style="zoom: 80%;" />

#### 沙漏型协议族

IP over everything

<img src="http://image.trouvaille0198.top/image-20210402113442576.png" alt="image-20210402113442576" style="zoom:33%;" />

# 二、物理层

## 2.1 物理层的基本概念

物理层考虑的是怎样才能在连接计算机的各种传输媒体上**传输数据比特流**，而不是指具体的传输媒体。

物理层的作用是要尽可能地屏蔽掉不同**传输媒体**和**通信手段**的差异 ，使数据链路层感觉不到这些差异。

用于物理层的协议也常称为**物理层规程**（procedure）

### 2.1.1 主要任务

确定与传输媒体接口的一些特性

- 机械特性：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。

- 电气特性：指明在接口电缆的各条线上出现的电压的范围。

- 功能特性：指明某条线上出现的某一电平的电压表示何种意义。

- 过程特性：指明对于不同功能的各种可能事件的出现顺序。

## 2.2 数据通信的基础知识

### 2.2.1 数据通信系统的模型

<img src="http://image.trouvaille0198.top/image-20210406081727830.png" alt="image-20210406081727830" style="zoom:40%;" />

#### 1）组成

- **源系统**

    - 源点（信源）：源点设备产生要传输的数据，例如计算机键盘输入汉字通过计算机产生输出的**数字比特流**。
    - 发送器：数字比特流要经过发送器编码后才能在传输系统中传输。例如：**调制器**

- **传输系统**

    传输系统可以是传输线，也可以是复杂的网络系统。

- **目的系统**
    - 终点（信宿）：终点设备将数字比特流转换成信息输出，例如把汉字显示在屏幕上。
    - 接收器：接收器把来自传输线路上的模拟信号进行解调，还原出数字比特流。例如：**解调器**

#### 2）术语

- 数据 (data)：运送消息（话音、文字、图像等）的实体。
- 信号 (signal)：数据的电气的或电磁的表现 。 数据 在信道中以电信号的形式传送，电信号分为：模拟信号和数字信号。
    - 模拟信号 (analogous)：代表消息的参数的取值是连续的
    - 数字信号 (digital signal)：代表消息的参数的取值是离散的。
    - 码元 (code)：在使用时间域（或简称为时域）的波形表示数字信号时，代表不同离散数值的基本波形。
- 使用二进制编码时，只有两种不同的码元（代表 0 和 1）
- 调制：把数字信号转换为模拟信号的过程 。
- 解调：把模拟信号转换为数字信号的过程。

#### 3）模拟信号与数字信号

<img src="http://image.trouvaille0198.top/image-20210406082341720.png" alt="image-20210406082341720" style="zoom:40%;" />

- 模拟数据、模拟信号

    最早的电话系统

- 模拟数据、数字信号

    模拟数据数字化后，可以使用先进的数字传输和交换设备，如现代的电话系统。

- 数字数据、模拟信号

    有些传输媒体只适合传输模拟信号，如光纤和无线信道。

- 数字数据、数字信号

    数字数据编码成数字信号的设备，比起数字到模拟设备更简单、更廉价。

#### 4）信道

- 信道 ( channel )：一般用来表示向 某一个方向传送信息的媒体。一条通信电路往往包含发送信道和接收信道。
- 信道类型
    - 单向通信（单工通信）：只能有一个方向的通信而没有反方向的交互。例：无线电广播
    - 双向交替通信（半双工通信）：通信的双方都可以发送信息，但不能双方同时发送 当然也就不能同时接收 。
    - 双向同时通信（全双工通信）：通信的双方可以同时发送和接收信息。

- 在计算机提供的二进制数字信号与电话网提供的模拟信号之间进行转换，这类技术统称为**调制解调技术**。

- 基带信号 （即基本频带信号）：来自信源的信号，就是将数字信号 1 或 0 直接用两种不同的电压来表示，然后送到线路上去传输基带信号
    - 计算机输出的信号通常为基带信号
    - 基带信号往往包含有较多的**低频**成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进调行**调制**（modulation）
- 调制类型
    - **基带调制**：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。把这种过程称为编码(coding）
    - **带通调制**：使用载波 (carrier) 进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道） 。
    - 带通信号：经过载波调制后的信号。

### 2.2.2 数字信号编码

基带调制技术

#### 1）常用编码方式

- **不归零码**：正电平代表 1，负电平代表 0 。
    - 在一个码元的全部时间内，电压保持恒定
    - 频率低
    - 连续发送多个“ 1” 码或“ 0” 码时，码元之间没有间隙，不容易区分

<img src="http://image.trouvaille0198.top/image-20210406083520317.png" alt="image-20210406083520317" style="zoom:90%;" />

- **归零码**：正脉冲代表 1，负脉冲代表 0，有跳变
    - 在一个码元的全部时间内，非零电压的持续时间小于一个码元的时间
    - 在一个码元的后半部分时间内，电压总是归于零的
    - 好处：解决了不归零码在连续发送“ 1” 码或“ 0” 码不容易区分的问题
    - 缺点：跳变次数过多，携带的数据量相对较少

<img src="http://image.trouvaille0198.top/image-20210406083714627.png" alt="image-20210406083714627" style="zoom:40%;" />

- 曼彻斯特编码
    - 位周期中心的向上跳变代表 0 ，位周期中心的向下跳变代表 1 
    - 也可反过来定义。
- 差分曼彻斯特编码
    - 在每一位的中心处始终都有跳变。
    - 利用每个码元的开始时有无跳变来表示“ 0” 或“ 1” 。
    - 位开始边界有跳变代表 0 ，没有跳变代表 1

<img src="http://image.trouvaille0198.top/image-20210406083912068.png" alt="image-20210406083912068" style="zoom:40%;" />

#### 2）编码方式比较

从信号波形中可以看出，曼彻斯特编码 和差分 曼彻斯特 编码 产生的信号频率比不归零制高。

从自同步能力来看，不归零制不能从信号波形本身中提取 信号时钟频率 这叫 作 没有自同步 能力）， 而曼彻斯特编码 和差分曼彻斯特 编码 具有自同步能力 。

<img src="http://image.trouvaille0198.top/image-20210406084105639.png" alt="image-20210406084105639" style="zoom:40%;" />

### 2.2.3 数字调制技术

**带通调制方法**

#### 1）二元制调制方法

选取一个适合于在线路上传输的 正弦波 作为载波，让载波的某些特性（ 幅度 、 频率 、 相位随基带信号的变化而变化（即波形变换）。

<img src="http://image.trouvaille0198.top/image-20210406085800066.png" alt="image-20210406085800066" style="zoom:40%;" />

最基本的二元制调制方法有以下几种：

##### **1. 调幅** (AM)

载波的 **振幅** 随基带数字信号而变化。

- 实现起来简单 , 但抗干扰性能差
- 极端情况：0 不波动，1 波动

##### **2. 调频** (FM)

载波的 **频率** 随基带数字信号而变化。

- 抗干扰性能好 , 但占用带宽较大

##### **3. 调相** (PM)

载波的 **初始相位** 随基带数字信号而变化。

- 抗干扰性能最好，且相位的变化也可以同步发送器和接收器的时钟
- 绝对 PM 与相对 PM
    - 用载波的相位绝对值或变化来表示数据。
    - **绝对调相**： 0 对应相位 “0”，1 对应相位 “180” 。
    - **相对调相**：发送的信号与前一个信号同相（相位不发生变化），则表示 “0”；发送的信号与前一个信号反相（相位发生变化），则表示 “1” 。
    - 注意：检测相位变化比检测相位值要容易。

<img src="http://image.trouvaille0198.top/image-20210406090628078.png" alt="image-20210406090628078" style="zoom:50%;" />

#### 2）多元制混合调制方法

上面几种调制方式，一个码元仅包含 2 个状态（两种振幅、频率、相位），即 1 个码元携带 1bit 信息

多元制混合调制方法可以获得更高的信息传输速率，让 1 个码元携带多位比特信息

##### 1. **正交振幅调制**（QAM）

(Quadrature Amplitude Modulation）

例如：

- 可供选择的相位有 12 种，而对于每一种相位有 1 或 2 种振幅可供选择。总共有 16 种组合，即 16 个码元。
- 由于 4 bit 编码共有 16 种不同的组合，因此这 16 个点中的每个点可对应于一种 4 bit 的编码。数据传输率可提高 4 倍
- 注意：不是码元越多越好。若每一个码元可表示的比特数越多，则在接收端进行解调时要正确识别每一种状态就越困难，出错率增加

<img src="http://image.trouvaille0198.top/image-20210406092648130.png" alt="image-20210406092648130" style="zoom:40%;" />

##### **2. 脉冲编码调制**（PCM）

<img src="http://image.trouvaille0198.top/image-20210406093759655.png" alt="image-20210406093759655" style="zoom: 40%;" />

(Pulse Code Modulation)

- 话音、图像等模拟信号在时间上和取值上都是连续的，对其进行数字信号编码 ，是将其转换成一系列在时间和取值上都是离散的 二进制数码脉冲。最常用的编码方法就是 PCM 
- 现在的数字传输系统均采用脉码调制 PCM 体制 。
- PCM 包括三个主要步骤（将模拟信号转换为数字信号的过程）：**采样 -> 量化 -> 编码**

<img src="http://image.trouvaille0198.top/image-20210409101108721.png" alt="image-20210409101108721" style="zoom: 33%;" />

###### **采样**

- 实现时间上的离散化

- 每隔一定时间间隔 , 取模拟信号的当前值作为样本，该样本代表了模拟信号在某一时刻的瞬时值 

    <img src="http://image.trouvaille0198.top/image-20210406092623480.png" alt="image-20210406092623480" style="zoom: 33%;" />

- 采样频率需远高于信号频率

    <img src="C:\Users\Tyeah\AppData\Roaming\Typora\typora-user-images\image-20210406092830172.png" alt="image-20210406092830172" style="zoom:33%;" />

    <img src="http://image.trouvaille0198.top/image-20210406092840719.png" alt="image-20210406092840719" style="zoom:33%;" />

- 采样的依据：奈奎斯特 (Nyquist) 采样定理

<img src="http://image.trouvaille0198.top/image-20210406093211498.png" alt="image-20210406093211498" style="zoom:30%;" />

###### 量化

是使采样值在取值上离散化

抽样信号虽然是时间轴上离散的信号，但仍然是模拟信号，其取值是连续值, 必须量化为离散值。

具体做法是：将原始信号的取值范围划分为若干个等级，将每个采样值“取整”到离它最近的一个等级上

量化后的抽样信号与量化前的抽样信号相比较，当然有所失真，表现为噪声

离散值的个数（等级划分）决定了量化的精度。

我国电话信号的PCM体制中，量化等级为256，即 8 位。

###### 编码

将量化后的采样值用一定位数的二进制数码来表示

编码的位数和量化的级数有关，若量化级数为 N ，则每个采样值就可以编码成 Log 2 N 为的二进制码。

我国的 PCM 体制的编码位数为 8 ，即每个脉冲信号编码为 8bit 信息，由于每秒 8000 个脉冲，话音的标准编码速率为 64Kb/s 。

<img src="http://image.trouvaille0198.top/image-20210409100923046.png" alt="image-20210409100923046" style="zoom: 45%;" />

### 2.2.4 通信的极限容量

任何实际的信道都不是理想的，在传输信号时会产生各种失真以及带来多种干扰。

码元传输速率越高，或信号传输距离越远，或噪声干扰越大，或传输媒体质量越差在信道的输出端的波形的失真就越严重。

限制码元在信道上的传输速率的因素有以下两个

- 信道能够通过的频率范围
- 信噪比

#### 1）信道能够通过的频率范围

具体的信道所能通过的频率范围（信道的带宽 Hz ）总是有限的。信号中的许多高频分量往往不能通过信道

- 理想低通信道 ：信号的所有低频分量，只要频率不超过某个上限，都能够不失真地通过信道。
- 理想带通信道 ：信号的频率在某个范围之间的频率分量能够不失真地通过信道，其它分量不能通过。

##### 1. 奈氏（Nyquist）准则

奈奎斯特给出了在假定的理想条件下，为了避免 **码间串扰**，码元的传输速率的上限值。



**理想低通信道的最高码元传输速率 = 2W Baud**

<img src="http://image.trouvaille0198.top/image-20210409101952122.png" alt="image-20210409101952122" style="zoom: 33%;" />

- W 是理想低通信道的带宽，单位为赫 (Hz)
- 公式含义：每赫带宽的理想低通信道的最高码元传输速率是每秒 2 个码元
- Baud 是**波特**，是码元传输速率的单位，1 波特为每秒传送 1 个码元 （即，码元 / 秒）



**理想带通特性信道的最高码元传输速率 = W Baud**

<img src="http://image.trouvaille0198.top/image-20210409102404633.png" alt="image-20210409102404633" style="zoom:33%;" />

##### 2. 结论

在任何信道中，码元传输的速率是有上限的， 否则就会出现码间串扰的问题，使接收端对码元的判决（即识别）成为不可能

如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以用更高的速率传送码元而不出现码间串扰。

##### 3. 比特率与波特率

比特率：数据传输速率，单位“比特 / 秒”

波特率：码元传输速率，单位“码元 / 秒

若码元的状态数为 2 时，比特率 = 波特率（即每秒钟传输的二进制位数等于每秒钟传输码元数）。

若码元的状态数为 4 时，四种状态分别表示为00” 01” 10” 11” 。则一个码元可以携带两位二进制数，此时比特率 = 2 * 波特率。

若 1 个码元携带 n bit 的信息量， M Baud 的码元传输速率所对应的信息传输速率为 M × n b/s

#### 2）信噪比

噪声存在于所有的电子设备和通信信道中。

噪声是随机产生的，它的瞬时值有时会很大。因此噪声会使接收端对码元的判决产生错误 。

但噪声的影响是相对的 。 如果信号相对较强，那么噪声的影响就相对较小。

##### 1. 信噪比公式

信噪比就是**信号的平均功率和噪声的平均功率之比** 。常记为 S / N ，并用 **分贝 (dB)** 作为度量单位。即：
$$
信噪比 \ (dB) = 10 \log_{10}(s/n) \ (dB)
$$
例如，当 S / N = 10 时，信噪比为 10dB ，而当 S / N = 1000 时，信噪比为 30dB 。

##### 2. 香农公式

信道的极限信息**传输速率 C** 可表达为
$$
C=W\log_2(1+S/N) / (bits/s)
$$
其中

- W 为信道的带宽 ，以 Hz 为单位
- S 为信道内所传信号的平均功率；
- N 为信道内部的高斯噪声功率。

- S/N 不带单位

##### 3. 结论

信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。

只要信息传输速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输。

若信道带宽 W 或信噪比 S/N 没有上限（当然实际信道不可能是这样的），则信道的极限信息传输速率 C 也就没有上限。

实际信道上能够达到的信息传输速率要比香农的极限传输速率低不少。

对于频带宽度已确定的信道，如果信噪比不能再提高了，并且码元传输速率也达到了上限值，那么还有办法提高信息的传输速率。这就是： 用编码的方法让每一个码元携带更多比特的信息量。

## 2.3 物理层下面的传输媒体

传输媒体也称为传输介质或传输媒介， 它就是数据传输系统中在发送器和接收器之间的物理通路 。

传输媒体可分为两大类

- 导引型传输媒体：电磁波被导引沿着固体媒体（铜线或光纤）传播 。
- 非导引型传输媒体：自由空间中传播，电磁波的传输常称为无线传输。

频谱

<img src="C:\Users\Tyeah\AppData\Roaming\Typora\typora-user-images\image-20210409104306071.png" alt="image-20210409104306071" style="zoom: 33%;" />

### 2.3.1 导引型传输媒体

#### 1）双绞线

古老但最常用的传输媒体 。

电话系统使用的就是双绞线。

绞合可减少对相邻双绞线的电磁干扰。

模拟传输和数字传输都可以使用双绞线，其通信距离一般为几到十几公里。

带宽依赖于线的粗细和传输距离

##### 1. 分类

- 屏蔽双绞线 STP (Shielded Twisted Pair)：带金属屏蔽层
- 无屏蔽双绞线 UTP (Unshielded Twisted Pair)

<img src="http://image.trouvaille0198.top/image-20210409105739084.png" alt="image-20210409105739084" style="zoom: 33%;" />

##### 2. 标准 EIA/TIA 568 A 。

此标准规定了 5 个种类的 UTP 标准 （从 1 类线到 5 类线）。

对传送数据来说，现在最常用的 UTP 是 5 类线（Category 5 或 CAT5）

<img src="http://image.trouvaille0198.top/image-20210409110108199.png" alt="image-20210409110108199" style="zoom: 33%;" />

#### 2）同轴电缆

同轴电缆具有很好的抗干扰特性，被广泛用于传输较高速率的数据 。

同轴电缆的带宽取决于电缆的质量

<img src="http://image.trouvaille0198.top/image-20210409110150416.png" alt="image-20210409110150416" style="zoom:33%;" />

##### 1. 分类

- 基带同轴电缆

    局域网发展初期常用

- 宽带同轴电缆

    有线电视常用

<img src="http://image.trouvaille0198.top/image-20210409110335133.png" alt="image-20210409110335133" style="zoom: 33%;" />

#### 3）光缆

光纤是光纤通信的传输媒体。

光纤 由非常透明的石英玻璃拉成细丝，主要由纤芯和薄层构成双层通信圆柱体，纤芯很细直径只有 8 至 100um ，纤芯和包层具有不同的折射系数。

由于可见光的频率非常高，约为 10 8 MHz 的量级，因此一个光纤通信系统的传输带宽远远大于目前其他各种传输媒体的带宽

##### 1. 工作原理

光线在纤芯中传输的方式是不断地全反射

只要从纤芯中射到纤芯表面的光线的入射角大于某个临界角度，就可产生全反射 。

##### 2. 分类

- 多模光纤

    可以存在多条不同角度入射的光线在一条光纤中传输。这种光纤就称为多模光纤

    传输中光脉冲会逐渐展宽，造成失真，适合短距离传输

- 单模光纤

    若光纤的直径减小到只有一个光的波长，则光纤就像一根波导那样，它可使光线一直向前传播，而不会产生多次反射。这样的光纤称为单模光纤

    使用昂贵的半导体激光源，光脉冲的衰耗小，适合长距离传输

<img src="http://image.trouvaille0198.top/image-20210409110749407.png" alt="image-20210409110749407" style="zoom:33%;" />

##### 3. 优点

1. 通信容量非常大 。

2. 传输损耗小，中继距离长。

3. 抗雷电和电磁干扰性能好。

4. 无串音干扰，保密性好。

5. 体积小，重量轻。

##### 4. 光纤通信中使用的光波的波段
常用的三个波段的中心分别位于 850 nm （多模）1300 nm（多模和单模）和 1550 nm（单模）。

所有这三个波段都具有 25000~30000 GHz 的带宽， 可见光纤的通信容量非常大 。

### 2.3.2 非引导型传输媒体

将自由空间称为“非导引型传输媒体”。

无线传输所使用的频段很广。

##### 1. 分类

- 短波通信 （即高频通信） 主要是靠电离层的反射，但短波信道的通信质量较差，传输速率低。
- 微波通信 由于地球表面的弯曲，信号的直线传输有限，需要建微波中继站。
    - 地面微波接力通信
    - 卫星通信

##### 2. 无线局域网使用的 ISM 频段

要使用某一段无线电频谱进行通信，通常必须得到本国政府有关无线电频谱管理机构的许可证。但是，也有一些无线电频段是可自由使用的，正好满足计算机 无线局域网 的需求。例如： ISM（工业、科学、医学）频段。

<img src="http://image.trouvaille0198.top/image-20210409112820331.png" alt="image-20210409112820331" style="zoom:33%;" />

## 2.4 信道复用技术

复用 (multiplexing) 是将多路信号组合在一条物理信道上进行传输，在接收端再将各路信号分离开来，提高通信线路的利用率。

<img src="http://image.trouvaille0198.top/image-20210409113003491.png" alt="image-20210409113003491" style="zoom:33%;" />

### 2.4.1 频分复用 FDM

(Frequency Division Multiplexing)

将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。

频分复用的所有用户在**同样的时间占用不同的带宽资源** （请注意，这里的“带宽”是频率带宽而不是数据的发送速率）

<img src="http://image.trouvaille0198.top/image-20210409113115483.png" alt="image-20210409113115483" style="zoom: 33%;" />

#### 1）例：ADSL 技术

（非对称数字用户线路）

利用现有电话线 实际带宽 1.1 MHz) 实现宽带网络连接

非对称（Asymmetric）的含义：下行速率大于上行

### 2.4.2 时分复用 TDM

(Time Division Multiplexing)

时分复用 的所有用户是 **在不同的时间** 占用 **同样的** 频带宽度。

用户轮流使用

#### 1）同步 TDM

（普通 TDM）

是将时间划分为一段段**等长的时分复用帧**（TDM 帧），每个用户占用的时隙周期性出现。 

即：信号源与时隙序号固定，即**同步** 。

- 时间片的分配事先约定，且固定不变。
- 优点：控制简单，接收设备根据预约的时间片分配方案，将收到的数据分发到不同的输出线路上。
- 缺点：当某个信号源没有数据时，仍然占用时间片，不能充分利用信道。

<img src="http://image.trouvaille0198.top/image-20210409113719891.png" alt="image-20210409113719891" style="zoom:33%;" />

##### 造成线路资源的浪费

<img src="http://image.trouvaille0198.top/image-20210413080513341.png" alt="image-20210413080513341" style="zoom:40%;" />

#### 2）异步 TDM

（统计时分复用 STDM）

时间片**按需分配**，需要发送数据的信号源提出申请，才能获得时间片。

即：公共信道的时隙实行“ 按需分配 ”，对那些需要传送信息或正在工作的终端（信号源）才分配时隙，可以使得所有时隙都能够饱满地得到使用，可以**使得服务的终端数大于时隙的个数**，提高信道的利用率

特点：可以充分利用信道，但控制比较复杂 。

<img src="http://image.trouvaille0198.top/image-20210413080207165.png" alt="image-20210413080207165" style="zoom:40%;" />

- 例
    - 电话系统中为了有效地利用传输线路，可将多个话路的 PCM 信号用时分复用 TDM (Time Division Multiplexing) 的方法装成时分复用帧，然后发送到线路上。
    - 北美体制： 用于北美和日本的电话系统 T1 信号（1.544 Mbps）
    - 欧洲体制： 我国电信部门使用的 E1 传输系统（2.048 Mbps）

### 2.4.3 波分复用

（Wavelength Division Multiplexing）

同 FDM 类似，主要用于光纤通信中； **波分复用就是光的频分复用** 。

不同的信号源使用不同频率（波长）的光波来传输数据，各路光经过一个棱镜（或衍射光栅），合成一个光束在光纤上传输；在接收端再将各路光波分开。

密集波分复用 DWDM（Dense WDM ）：技术的发展一根光纤上复用的光载波信息路数越来越多，例如 80 或更多路数。

<img src="http://image.trouvaille0198.top/image-20210413080843390.png" alt="image-20210413080843390" style="zoom:40%;" />

### 2.4.4 码分复用

（Code Division Multiplexing）

常用的名词是 码分多址 **CDMA** (Code Division Multiple Access)

每个用户在 **同样的时间** 使用 **同样的频带** 进行通信。

各用户使用经过特殊挑选的不同 **码型** ，因此彼此不会造成干扰。

这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。

特别在无线局域网中，采用 CDMA 可提高话音质量、数据传输可靠性、增大通信系统容量（是 GSM 的 4 5倍），降低手机的平均发射功率。

#### 1）码片序列

（chip sequence）

- 每一个比特时间划分为 m 个短的间隔，称为 **码片** （chip）。设 m =8

- 每个站被指派一个 唯一 的 m bit 码片序列 。
    - 如发送比特 1 ，则发送自己的 m bit 码片序列。
    - 如发送比特 0 ，则发送该码片序列的 **二进制反码** 。

- 例如：
    - S 站的 8 bit 码片序列是 00011011 。
    - 发送比特 1 时，就发送序列 00011011
    - 发送比特 0 时，就发送序列 11100100 。

- 按惯例， 0 写成 - 1，1 写成 +1， S 站的码片序列：（ - 1 - 1- 1 + 1 + 1 - 1 + 1 + 1）

- 码片序列实现了扩频

    假定 S 站要发送信息的数据率为 **b bit/s** 。由于每一个比特要转换成 m 个比特的码片，因此 S 站实际上发送的数据率提高到 **mb bit/s** ，同时 S 站所占用的频带宽度也提高到原来数值的 m 倍。

    这种通信方式是 **扩频** (spread) 通信 

#### 2）CDMA 的一个重要特性
每个站分配的码片序列不仅 **必须各不相同**， 并且还 **必须互相正交** (orthogonal) 。

在实用的系统中是使用 **伪随机码序列**。

令向量 S 表示站 S 的码片向量，令 T 表示其他任何站的码片向量。

两个不同站的码片序列**正交**，就是向量 S 和 T的 **规格化内积 (inner product) 等于 0** 
$$
S*T\equiv\frac{1}{m}\sum_{i=1}^{m}S_iT_i=0
$$

#### 3）码片序列的正交关系举例

向量 S 为 ( - 1 - 1 - 1 + 1 + 1 - 1 + 1 + 1 )，向量 T 为 ( - 1 - 1 + 1 - 1 + 1 + 1 + 1 - 1) 。

把向量 S 和 T 的各分量值代入公式就可看出这两个码片序列是正交的。

向量 S 和 T 的码片反码的向量内积也是 0 

#### 4）正交关系的另一个重要特性

任何一个码片向量和该码片向量自己的规格化内积都是 1 

一个码片向量和该码片反码的向量的规格化内积值是 - 1

#### 5）CMDA 工作原理

每个站各自发送扩频信号，在接收端形成 叠加 的信号。

当接收站打算接收 S 站的信号时，就用 S 站的码片序列与收到的叠加信号求规格化内积：

- 若 S 站有信号发送 ，则内积结果为 1 ( 发送数据 1 ) 或 - 1 ( 发送数据 0 )

- 若 S 站没有信号发送 ，则内积结果为 0

<img src="http://image.trouvaille0198.top/image-20210413083114067.png" alt="image-20210413083114067" style="zoom:40%;" />

# 三、数据链路层

- 点对点信道
    -  这种信道使用 **一对一的点对点通信** 方式。（ PPP 协议 ）
- 广播信道。
    - 这种信道使用 **一对多的广播通信** 方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的 共享信道 协议来协调这些主机的数据发送。 CSMA/CD 协议

<img src="http://image.trouvaille0198.top/image-20210413091627584.png" alt="image-20210413091627584" style="zoom: 33%;" />

为了分析链路层协议，采用简化的链路层模型

- 数据链路层以上的各层用一个主机代替；
- 物理层和通信线路等效成一条简单数据链路；

<img src="http://image.trouvaille0198.top/image-20210413091915572.png" alt="image-20210413091915572" style="zoom: 33%;" />

## 3.1 使用点对点信道的数据链路层

### 3.1.1 数据链路和帧

**链路** (link) 是一条无源的结点到 **相邻结点** 的 **物理线路**（有线或无线），中间没有任何其他的交换结点。

- 一条链路只是一条通路的一个组成部分。

**数据链路** (data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

- 现在最常用的方法是使用 网络适配器（即网卡） 来实现这些协议的硬件和软件。

- 一般的适配器都包括了数据链路层和物理层这两层的功能。

#### 1）数据链路层的基本概念

也有人采用另外的术语。这就是把链路分为物理链路和逻辑链路。

**物理链路** 就是上面所说的链路 。

**逻辑链路** 就是上面的数据链路，是物理链路加上必要的通信协议。

早期的数据通信协议曾叫做通信规程 (procedure) 。因此在数据链路层，规程和协议是同义语。

#### 2）数据链路层的协议数据单元 - 帧

<img src="http://image.trouvaille0198.top/image-20210413092636979.png" alt="image-20210413092636979" style="zoom:33%;" />

常常在两个对等的数据链路层之间画出一个数字管道，而在这条数字管道上传输的数据单位是帧

<img src="http://image.trouvaille0198.top/image-20210413092901799.png" alt="image-20210413092901799" style="zoom:33%;" />

数据链路层不必考虑物理层如何实现比特传输的细节。 甚至还可以更简单地设想好像是沿着两个数据链路层之间的水平方向把帧直接发送到对方

### 3.1.2 三个基本问题

#### 1）封装成帧

（framing）

##### 1. 定义

在一段数据的前后分别添加 **首部** 和 **尾部** 然后就构成了一个帧 。 使接收方能确定帧的界限。换句话说，首部和尾部的一个重要作用就是进行**帧定界**

<img src="http://image.trouvaille0198.top/image-20210413093306049.png" alt="image-20210413093306049" style="zoom:33%;" />

##### 2. 字节计数法

- 思想

    在帧头设置一个长度域，放置该帧的字节数，当收
    方收到帧后，通过帧的长度，确定帧的开始。

- 问题

    当帧的长度域出错，帧同步完全丢失；

    该方法很少单独使用。

<img src="http://image.trouvaille0198.top/image-20210413093606864.png" alt="image-20210413093606864" style="zoom:33%;" />

##### 3. 字符填充法

当数据是由可打印的 ASCII 码组成的文本文件时 帧定界可以使用特殊的 ASCII 码 **不可打印的控制字符** 作为 **帧定界符**。

控制字符 SOH (Start Of Header) 放在一帧的最前面 表示帧的首部开始 。 另一个控制字符 EOT (End Of Transmission) 表示帧的结束 。

<img src="http://image.trouvaille0198.top/image-20210413093658195.png" alt="image-20210413093658195" style="zoom:33%;" />

##### 4. 比特填充法

- 思想

    使用一个**特殊的比特**模式 **01111110** 作为帧的起始和结束标志。

    发送方边发送边检查数据，每连续发送 5 个“ 1” 后在后面自动插入一个“ 0” 。这样数据中只会连续出现 5个“ 1”1”，而不会出现定界符。

    接收方 在收到 5 个连续的“ 1” 后将后面的“ 0” 删掉而恢复出原始数据。

- 好处

    数据传输的基本单位是比特而不是字符，可用来传输任意长度的二进制比特串，通用性强。

<img src="http://image.trouvaille0198.top/image-20210416100509288.png" alt="image-20210416100509288" style="zoom: 33%;" />

##### 5. 违法编码法

- 前提

    物理介质上使用的信号编码有冗余码字时，使用这些冗余的码字来作为帧的定界。

- 举例

    如曼彻斯特编码或差分曼彻斯特编码中，有效电平是 “低－高” 或 “高－低”，而 “低－低” 和 “高－高” 电平没有定义，这种违法编码可以作为帧的边界。

#### 2）透明传输

若所传的数据的比特片段与某一个控制信息相同，要有可靠机制，保证收方能正确识别

如果数据中的某个字节的二进制代码恰好和 SOH 或 EOT 一样，数据链路层就会错误地“找到帧的边界”

<img src="http://image.trouvaille0198.top/image-20210413093931784.png" alt="image-20210413093931784" style="zoom:33%;" />

- 解决方法
    - 发送端的数据链路层在数据中出现控制字符 “SOH” 或 “EOT” 的前面 插入一个转义字符 “ESC” （其十六进制编码是 1B) 。
    - 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
    - 如果转义字符也出现在数据当中，那么应在转义字符前面插入一个**转义字符 ESC** 。当接收端收到连续的两个转义字符时，就删除其中前面的一个。
    - 对应**字节填充法**

<img src="http://image.trouvaille0198.top/image-20210416100830452.png" alt="image-20210416100830452" style="zoom:40%;" />

#### 3）差错控制

纠错：通过编码技术，接收方自动将差错改正过来

检错：检测出帧有错误，要么忽略或重传

- 在传输过程中可能会产生 比特差错： 1 可能会变成 0 而 0 也可能变成 1 。

- 在一段时间内，传输错误的比特占所传输比特总数的比率称为 **误码率 BER** (Bit Error Rate)
    - 例如误码率 10^-10^ ，表示 10^10^ 个比特就会出现 1 个比特的差错

- 误码率与信噪比有很大的关系。

- 为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种 **差错控制** 措施。
    - 考虑怎样发现和纠正信号传输中的差错。
- 方法
    - 如何发现差错？
        - 检错码（奇偶校验码、 CRC）：能检测出错误，但不能纠正错误
        - 纠错码（海明码）：能知道错误，且知道错误的位置
    - 发现差错如何处理？
        - 前向纠错：由接收方来检查并纠正错误
        - 自动重发请求：不能纠正，接收方反馈。若有错误则重发，否则给肯定应答

##### 1. 前向纠错

（FEC Forward Error Correct）

即发送方发送能使接收方 **检错并纠错** 的冗余位， 纠错任务由接收方完成 ；常采用 **海明码**

主要应用于没有反向信道或反向传输时间很长的场合

- 缺点：为纠错附加的冗余码较多，传输效率低；；

- 优点：实时性好。

##### 2. 自动重发请求

（ARQ Automatic Repeat reQuest）

即发送方发送能使接收方 检错 的冗余位，若无差错，则接收方回送一个 肯定应答 ( ACK)；若有差错，则接收方回送一个 否定应答 ( NAK)，要求发送方重发。

- 缺点：信息传递连贯性差
- 优点：接收端设备简单，只要请求重发，无需纠正错误。

### 3.1.3 检错码

- 构造
    - **检错码** (码字、传输帧) = 信息位＋冗余校验位
    - **码字长** n = K (信息位位数) + r (校验位位数)
    - **编码效率** R = 有效数据位 K / 码字长 n
- 信息字段和校验字段之间的对应关系
    - **校验字段越长，编码的检错能力越强，编码解码越复杂**；附加的冗余信息在整个编码中所占的比例越大，传输的有效成分越低，传输的效率下降。
    - 检错码一旦形成，整个检错码将作为一个整体被发往线路，通常的发送顺序是信息字段在前，校验字段在后。

#### 1）奇偶校验码

根据数据字节中 1 的个数来检验数据传输中是否发生了错误。

- 奇校验：使码字中“ 1 的总个数为 奇数 。

- 偶校验：使码字中“ 1” 的总个数为 偶数 。

- 奇 / 偶校验码：最常用的一种检验码，包括：
    - 水平奇 / 偶校验码
    - 垂直奇 / 偶校验码
    - 水平垂直奇 / 偶校验码

##### 1. 水平奇 / 偶校验码

其信息字段以字符为单位，校验字段仅含一个比特称为校验比特或校验位。

例如：使用七比特的 ASCII 码来构造成八比特的检错码时若采用奇 / 偶校验，校验位的取值应使整个码字**包括校验位**， 1 的比特个数为奇数或偶数。
                信息字段       奇校验码 		偶校验码
				1000001      1000001**1**       1000001**0**



- 编码效率： Q / (Q+1) ( 信息字段占 Q 个比特 )
- 应用： 通常在异步传输方式中采用偶校验， 同
    步传输方式中采取奇校验。

##### 2. 垂直奇 / 偶校验码

被传输的信息进行分组，并排列为若干行和若干列。组中每行的相同列进行奇 偶校验，最终产生由校验位形成的校验字符 (校验行)，并附加在信息分组之后传输

举例： 4 个字符（ 4 行）组成一信息组
<img src="http://image.trouvaille0198.top/image-20210416103334881.png" alt="image-20210416103334881" style="zoom: 40%;" />

- 编码效率： PQ / P(Q+1) （假设信息分组占 Q 行 P 列）

##### 3. 水平垂直奇 / 偶校验

也叫方阵校验

**在水平校验的基础上实施垂直校验。**

例： 4 行 7 列信息组的水平垂直偶校验码为：

<img src="http://image.trouvaille0198.top/image-20210416102956936.png" alt="image-20210416102956936" style="zoom:50%;" />

#### 2）循环冗余码

（Cyclic Redundancy Check CRC）
计算机和数据通信中使用最广泛的 检错码 ，漏检率低，可用简单的电路实现。

- 操作

    给定一个 **k** 比特的帧或报文，发送方生成 **n** 比特的序列（也称为帧检验序列 FCS Frame Check Sequence ），形成 ( **k+n** ) 的码字，该码字能被某个事先确定的数整除。接收方用相同的数去除收到的帧，如果无余数，则认为数据帧无差错

- 步骤
    1. 在发送端，先把数据划分为组
    2. 假定每组 k 个比特
    3. 假设待传送的一组数据 M = 101001 （现在 k = 6 ）。我们在 M 的后面再添加供差错检测用的 n 位 **冗余码** 一起发送。

##### 1. 计算方法

- 用二进制的 **模 2 运算** 进行 **2 ^n^ 乘 M** 的运算，这相当于**在 M 后面添加 n 个 0** 
    - 得到的 ( k + n ) bit 的数**除以**事先选定好的长度为 ( n + 1) bit 的**除数 P**，得出**商是 Q 而余数是 R**，余数 R 比除数 P 少 1 位，即 R 是 n 位 。
- 将 余数 R 作为冗余码 (帧检验序列) 拼接在数据 M 后面发送出去 。

<img src="http://image.trouvaille0198.top/image-20210416104004146.png" alt="image-20210416104004146" style="zoom:40%;" />

##### 2. 说明：帧检验序列

在数据后面添加上的冗余码称为**帧检验序列 FCS** (Frame Check Sequence) 。
循环冗余检验 CRC 和帧检验序列 FCS 并不等同。

- CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。
- FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。

##### 3. 接收端对收到的每一帧进行 CRC 检验

把收到的每一个帧都 除以 相同的 除数 P 模 2 运算 然后 检查得到的余数 R

1. 若得出的余数 R 0 则判定这个帧没有差错 就 接受 (accept)
2. 若余数 R = 0 则判定这个帧有差错就丢弃

但这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错 。

漏检 CRC 不能保证检测出所有的传输错误 但是只要选择位数足够的 P 可以使得差错的概率足够小 

只要经过严格的挑选 并使用位数足够多的除数 P 那么出现检测不到的差错的概率就很小很小

<img src="http://image.trouvaille0198.top/image-20210416111310870.png" alt="image-20210416111310870" style="zoom:40%;" />

##### 4. CRC 也称多项式编码

任意一个由**二进制位串**组成的代码都可以和一个 系数仅为 ‘0’ 和 ‘1’ 取值的**多项式** 一一对应。

多项式表示：即将 k 比特的数据用 k 项多项式表示，它的各项为 X^k-1^, ..., X^0^，它的系数为数据中对应位的 0 或 1 。

<img src="http://image.trouvaille0198.top/image-20210416110941930.png" alt="image-20210416110941930" style="zoom:33%;" />

##### 5. 生成多项式 P

除数 P 可表示成生成多项式 P(X)

例如： P = 110101 ，即 P(X) = X^5^ + X^4^ + X^2^ + 1 (P 为 5 阶多项式）；

生成多项式的最高位和最低位都必须为 1

发送方用它生成冗余位，接收方用它判断是否有错；

若 P 为 r 阶（ r +1 bit ），将产生 r 位冗余位；

发送端帧检验序列 FCS 的生成和接收端 CRC 检验都是用硬件完成的，处理速度很快，不会延误数据的传输

<img src="http://image.trouvaille0198.top/image-20210416111236499.png" alt="image-20210416111236499" style="zoom:40%;" />

##### 6. P 的国际标准

<img src="http://image.trouvaille0198.top/image-20210416111411661.png" alt="image-20210416111411661" style="zoom:40%;" />

##### 7. 注意

仅用循环冗余检验 CRC 差错检测技术只能做到**无差错接受**，不能检验出帧有没有丢失、重复、失序

无差错接受是指：凡是接受的帧（即不包括丢弃的帧）我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错，也就是说，凡是接收端数据链路层接受的帧都无差错，有差错的帧就丢弃而不接受 。

区分无比特差错与无传输差错（在运输层实现）

要做到**可靠传输**（即发送什么就收到什么），就必须再加上确认和重传机制 。

<img src="http://image.trouvaille0198.top/image-20210416111800528.png" alt="image-20210416111800528" style="zoom:33%;" />

在数据链路层使用 CRC 检验 能够实现无比特差错的传输但这还不是可靠传输 。

本章介绍的数据链路层协议都不是可靠传输的协议

对于通信质量较差的无线传输链路 数据链路层协议使用确认和重传机制可以提高通信效率

#### 3）海明码（纠错码）

单比特纠错海明码

- 基本思想
    - 在 k 比特信息上附加 r 比特冗余信息（校验比特），构成 n = k + r 比特的码字，其中每个校验比特和某几个特定的信息比特构成偶校验关系。
    - 接收端对这 r 个偶校验关系进行校验，即将每个校验比特和与它关联的信息比特进行相加（异或），相加的结果为 校正因子 。
        - 如果没有错，则 r 个校正因子都为 0
        - 若校正因子不全为 0 ，根据校正因子的取值，确定错误发
            生的位置。

##### 1. 码距

（海明距离 Hamming Distance)

一个编码系统中任意两个合法编码（码字）之间不同的二进位（ bit ）数叫 这两个码字的码距 。

例：10101,00110 ，码距为 3

而整个编码系统中任意两个码字的的最小距离就是该**编码系统的码距** 。

- 两个结论

    如果要**检测**出 d 个比特的错误，则编码集的海明距离至少为 **d + 1** 

    如果要**纠正** d 个比特的错误，则编码集的海明距离至少应为 **2d + 1**

<img src="http://image.trouvaille0198.top/image-20210416112419468.png" style="zoom:40%;" /> 

##### 2. 运算

<img src="http://image.trouvaille0198.top/image-20210416112747489.png" alt="image-20210416112747489" style="zoom:40%;" />

<img src="http://image.trouvaille0198.top/image-20210416113426579.png" alt="image-20210416113426579" style="zoom:40%;" />

<img src="http://image.trouvaille0198.top/image-20210416113452481.png" alt="image-20210416113452481" style="zoom:40%;" />

<img src="http://image.trouvaille0198.top/image-20210416113526280.png" alt="image-20210416113526280" style="zoom:40%;" />

## 3.2 点对点协议 PPP

## 3.3 使用广播信道的数据链路层
## 3.4 以太网